"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5849],{129:(e,s,t)=>{t.d(s,{r:()=>x});var a=t(2432),r=t(364),n=t(2708),l=t(7304),i=t(7382),c=t(7997),d=t(8725),o=t(7693),m=t(3491),u=t(1823),h=t(4311);function x(e){let{currentUserId:s,onStartDM:t,onShowProfile:x}=e,[g,p]=(0,r.useState)(""),[f,j]=(0,r.useState)([]),[v,N]=(0,r.useState)([]),[y,b]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[k,A]=(0,r.useState)(null),[S,C]=(0,r.useState)(Date.now()),[E,T]=(0,r.useState)(null),z=(0,r.useCallback)(async()=>{if(!s){console.log("[friends-page] No currentUserId, skipping fetch");return}try{b(!0),T(null),console.log("[friends-page] Fetching friendships for user:",s);let t=await fetch("/api/friends",{credentials:"include",headers:{"Cache-Control":"no-cache"}});if(t.ok){var e;let s=await t.json();N(s.friendships),C(Date.now()),console.log("[friends-page] Successfully fetched friendships:",(null===(e=s.friendships)||void 0===e?void 0:e.length)||0)}else if(401===t.status){let e=await t.text();console.error("Authentication error fetching friendships:",t.status,e),T("Authentication failed. Please log in again.")}else{let e=await t.text();console.error("Failed to fetch friendships:",t.status,e),T("Failed to load friendships. Please try again.")}}catch(e){console.error("Failed to fetch friendships:",e),T("Network error. Please check your connection.")}finally{b(!1)}},[s]);(0,r.useEffect)(()=>{if(s){z();let e=setInterval(z,3e3);return()=>clearInterval(e)}},[z,s]);let I=async()=>{if(!g.trim()){j([]),A(null);return}_(!0),A(null);try{console.log("[friends-page] Searching for:",g);let e=await fetch("/api/users/search?q=".concat(encodeURIComponent(g.trim())));if(e.ok){let s=await e.json();console.log("[friends-page] Search results:",s.users),j(s.users||[])}else{let s=await e.json();console.error("Failed to search users:",s.error||e.statusText),A(s.error||"Failed to search users."),j([])}}catch(e){console.error("Failed to search users:",e),A(e.message||"An unexpected error occurred during search."),j([])}finally{_(!1)}};(0,r.useEffect)(()=>{let e=setTimeout(()=>{g.trim()?I():(j([]),A(null))},500);return()=>clearTimeout(e)},[g]);let F=async e=>{A(null);try{console.log("[friends-page] Sending friend request to:",e);let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)console.log("[friends-page] Friend request sent successfully"),z();else{let e=await s.json();console.error("Failed to send friend request:",e.error),A(e.error||"Failed to send friend request.")}}catch(e){console.error("Failed to send friend request:",e),A(e.message||"Something went wrong.")}},D=async(e,s)=>{try{let t=await fetch("/api/friends/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(t.ok)z();else{let e=await t.json();console.error("Failed to respond to friend request:",e.error||t.statusText),alert("Failed to respond: ".concat(e.error||t.statusText))}}catch(e){console.error("Failed to respond to friend request:",e),alert("An unexpected error occurred while responding to request.")}},$=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",R=e=>e?{color:e}:{},L=e=>{let s=P.some(s=>s.requester_id===e.id||s.addressee_id===e.id),t=q.some(s=>s.requester_id===e.id),a=M.some(s=>s.addressee_id===e.id);return s?{text:"Friends",disabled:!0,variant:"secondary"}:t?{text:"Accept?",disabled:!1,variant:"default"}:a?{text:"Pending",disabled:!0,variant:"outline"}:{text:"Add Friend",disabled:!1,variant:"default"}},q=v.filter(e=>"pending"===e.status&&e.addressee_id===s),M=v.filter(e=>"pending"===e.status&&e.requester_id===s),P=v.filter(e=>"accepted"===e.status);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Friends"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(S).toLocaleTimeString()]})]})]}),E&&(0,a.jsx)(i.Zp,{className:"border-destructive/20 bg-destructive/5",children:(0,a.jsx)(i.Wu,{className:"pt-6",children:(0,a.jsx)("div",{className:"text-sm text-destructive text-center p-2 bg-destructive/10 rounded-md",children:E})})}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"h-5 w-5"}),"Find Friends"]})}),(0,a.jsxs)(i.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.p,{value:g,onChange:e=>p(e.target.value),placeholder:"Search by username...",className:"transition-all duration-200 focus:scale-102"}),w&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),k&&(0,a.jsx)("div",{className:"text-sm text-destructive text-center p-2 bg-destructive/10 rounded-md animate-fadeIn",children:k}),f.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Found ",f.length," user(s)"]}),f.map(e=>{let s=L(e);return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>null==x?void 0:x(e.id),className:e.has_gold_animation?$(void 0,!0):"",style:e.has_gold_animation?{}:R(e.name_color),children:["@",e.username]}),(0,a.jsxs)(n.$,{size:"sm",variant:s.variant,onClick:()=>F(e.id),className:"transition-all duration-200 hover:scale-105",disabled:s.disabled,children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}),s.text]})]},e.id)})]}),g.trim()&&0===f.length&&!w&&!k&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500",children:['No users found for "',g,'"']})]})]}),q.length>0&&(0,a.jsxs)(i.Zp,{className:"border-primary/20",children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{className:"text-primary",children:["Friend Requests (",q.length,")"]})}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:q.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-primary/5",children:[(0,a.jsxs)("span",{className:e.requester_has_gold?$(void 0,!0):"",style:e.requester_has_gold?{}:R(e.requester_name_color),children:["@",e.requester_username]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{size:"sm",onClick:()=>D(e.id,"accepted"),className:"bg-green-600 hover:bg-green-700 transition-all duration-200 hover:scale-105",children:(0,a.jsx)(m.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{size:"sm",variant:"destructive",onClick:()=>D(e.id,"blocked"),className:"transition-all duration-200 hover:scale-105",children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]})]},e.id))})})]}),M.length>0&&(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{children:["Sent Requests (",M.length,")"]})}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:M.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("span",{className:e.addressee_has_gold?$(void 0,!0):"",style:e.addressee_has_gold?{}:R(e.addressee_name_color),children:["@",e.addressee_username]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground animate-pulse",children:"Pending"})]},e.id))})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{children:["Friends (",P.length,")"]})}),(0,a.jsx)(i.Wu,{children:y?(0,a.jsx)("div",{className:"text-center text-muted-foreground py-4 animate-pulse",children:"Loading friends..."}):0===P.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No friends yet. Start by searching for users above!"}):(0,a.jsx)("div",{className:"space-y-2",children:P.map(e=>{let r=e.requester_id===s?{id:e.addressee_id,username:e.addressee_username,name_color:e.addressee_name_color,has_gold:e.addressee_has_gold}:{id:e.requester_id,username:e.requester_username,name_color:e.requester_name_color,has_gold:e.requester_has_gold};return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors duration-200",children:[(0,a.jsxs)("span",{className:r.has_gold?$(void 0,!0):"",style:r.has_gold?{}:R(r.name_color),children:["@",r.username]}),(0,a.jsxs)(n.$,{size:"sm",onClick:()=>t(r.id,r.username),className:"transition-all duration-200 hover:scale-105",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-1"}),"Message"]})]},e.id)})})})]})]})}},1947:(e,s,t)=>{t.d(s,{AM:()=>i,Wv:()=>c,hl:()=>d});var a=t(2432),r=t(364),n=t(1238),l=t(4963);let i=n.bL,c=n.l9,d=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:i=4,...c}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{ref:s,align:r,sideOffset:i,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...c})})});d.displayName=n.UC.displayName},2548:(e,s,t)=>{t.d(s,{_:()=>i});var a=t(2432),r=t(364),n=t(4329),l=t(7129);function i(e){let{large:s=!1}=e,[t,i]=(0,r.useState)(new Date);(0,r.useEffect)(()=>{let e=setInterval(()=>{i(new Date)},1e3);return()=>clearInterval(e)},[]);let c=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),d=t.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"});return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(s?"text-3xl":"text-lg"," font-medium"),children:[(0,a.jsx)(n.A,{className:s?"h-7 w-7":"h-5 w-5"}),(0,a.jsx)("span",{children:c})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(s?"text-base":"text-sm"),children:[(0,a.jsx)(l.A,{className:s?"h-5 w-5":"h-4 w-4"}),(0,a.jsx)("span",{children:d})]})]})}},3143:(e,s,t)=>{t.d(s,{l:()=>Z});var a=t(2432),r=t(364),n=t(2708),l=t(6127),i=t(4311),c=t(3702),d=t(4314),o=t(7709);function m(e){let{message:s,currentUserId:t,currentUserHasGold:m=!1,onAddReaction:u,onRemoveReaction:h,onReply:x,onDelete:g,onUserClick:p}=e,[f,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),y=s.sender_id===t,b=s.is_ai_response,w=e=>{var t;(null===(t=s.reactions)||void 0===t?void 0:t.find(s=>s.emoji===e&&s.reacted_by_me))?null==h||h(s.id,e):null==u||u(s.id,e),j(!1)};return(0,a.jsx)("div",{className:"flex ".concat(y?"justify-end":"justify-start"," mb-4 group"),children:(0,a.jsxs)("div",{className:"max-w-[70%] ".concat(y?"order-2":"order-1"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 ".concat(y?"justify-end":"justify-start"),children:[(0,a.jsx)("span",{className:"".concat(b?"text-blue-500 font-medium":s.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":(s.name_color,"font-medium")," ").concat(b||y?"":"cursor-pointer hover:underline"),style:s.name_color&&!s.has_gold_animation?{color:s.name_color}:{},onClick:()=>{!b&&p&&s.sender_id!==t&&p(s.sender_id)},children:b?"AI Assistant":s.username}),s.custom_title&&(0,a.jsx)("span",{className:"text-xs italic text-gray-500",children:s.custom_title}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.parent_message_id&&s.parent_message_content&&s.parent_message_username&&(0,a.jsxs)("div",{className:"mb-1 p-2 bg-gray-100 dark:bg-gray-800 border-l-4 border-blue-400 rounded-r-md text-xs text-gray-600 dark:text-gray-300 italic",children:["Replying to @",s.parent_message_username,': "',s.parent_message_content,'"']}),(0,a.jsx)("div",{className:"px-4 py-2 rounded-2xl ".concat(y?"bg-black dark:bg-gray-700 text-white":b?"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-800"),children:"image"===s.message_type?(0,a.jsx)("div",{className:"relative max-w-sm",children:v?(0,a.jsx)("div",{className:"w-64 h-48 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Failed to load image"})}):(0,a.jsx)(o.default,{src:s.content||"/placeholder.svg",alt:"Shared image",width:400,height:300,className:"rounded-lg object-cover max-h-80 w-auto",onError:()=>N(!0),priority:!1,quality:85})}):(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.content})}),s.reactions&&s.reactions.length>0&&(0,a.jsx)("div",{className:"flex gap-1 mt-1",children:s.reactions.map(e=>(0,a.jsxs)(n.$,{variant:"outline",size:"sm",className:"h-6 px-2 rounded-full text-xs ".concat(e.reacted_by_me?"bg-blue-100 dark:bg-blue-900/50 border-blue-400":"bg-gray-50 dark:bg-gray-800"),onClick:()=>w(e.emoji),children:[e.emoji," ",e.count]},e.emoji))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity relative",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>j(!f),children:(0,a.jsx)(l.A,{className:"h-3 w-3"})}),x&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>x(s),children:(0,a.jsx)(i.A,{className:"h-3 w-3"})}),(y||m)&&g&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-red-500 hover:bg-red-500/10",onClick:()=>{confirm("Are you sure you want to delete this message?")&&(null==g||g(s.id))},children:(0,a.jsx)(c.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,a.jsx)(d.A,{className:"h-3 w-3"})}),f&&(0,a.jsx)("div",{className:"absolute bottom-full left-0 mb-2 flex gap-1 p-2 bg-white dark:bg-gray-800 border rounded-lg shadow-lg z-10",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"].map(e=>(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>w(e),children:e},e))})]})]})})}var u=t(7382),h=t(3394),x=t(4010),g=t(4329),p=t(3583),f=t(5588),j=t(7602),v=t(5501);function N(e){var s;let{message:t,currentUserId:l,onUserClick:i,onReply:c,onReaction:o,showAI:m=!0}=e,[N,y]=(0,r.useState)(null),[b,w]=(0,r.useState)(!1),[_,k]=(0,r.useState)(!1),[A,S]=(0,r.useState)({}),C=t.sender_id===l,E=t.is_ai_response;(0,r.useEffect)(()=>{m&&t.content.length>10&&T()},[t.content,m]);let T=async()=>{w(!0);try{let e=await (0,v.b1)(t.content);y(e),S({complexity:z(t.content),tone:I(t.content),intent:F(t.content),keywords:D(t.content)})}catch(e){console.error("Error analyzing message:",e)}finally{w(!1)}},z=e=>{let s=e.split(" ").length/e.split(/[.!?]+/).length;return s>15?"complex":s>10?"moderate":"simple"},I=e=>{let s=e.toLowerCase();return s.includes("!")||s.includes("\uD83D\uDE0A")||s.includes("\uD83D\uDE04")?"excited":s.includes("?")||s.includes("\uD83E\uDD14")||s.includes("hmm")?"curious":s.includes("\uD83D\uDE22")||s.includes("\uD83D\uDE2D")||s.includes("sad")?"sad":s.includes("\uD83D\uDE21")||s.includes("angry")||s.includes("frustrated")?"angry":s.includes("❤️")||s.includes("love")||s.includes("amazing")?"loving":"neutral"},F=e=>{let s=e.toLowerCase();return s.includes("?")?"question":s.includes("!")?"exclamation":s.includes("thank")||s.includes("thanks")?"gratitude":s.includes("sorry")||s.includes("apologize")?"apology":s.includes("help")||s.includes("assist")?"request":"statement"},D=e=>{let s=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","are","was","were","be","been","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them"],t=e.toLowerCase().split(/\W+/).filter(e=>e.length>3&&!s.includes(e)),a={};return t.forEach(e=>{a[e]=(a[e]||0)+1}),Object.entries(a).sort((e,s)=>{let[,t]=e,[,a]=s;return a-t}).slice(0,3).map(e=>{let[s]=e;return s})};return(0,a.jsxs)("div",{className:"group relative ".concat(C?"ml-auto":"mr-auto"," max-w-[80%] mb-4"),children:[(0,a.jsx)(u.Zp,{className:"".concat(C?"bg-primary text-primary-foreground":"bg-card"," ").concat(E?"border-l-4 border-l-blue-500":""),children:(0,a.jsxs)(u.Wu,{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[E?(0,a.jsx)(h.A,{className:"h-4 w-4 text-blue-500"}):(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium text-sm cursor-pointer hover:underline ".concat(C?"text-primary-foreground":""),onClick:()=>null==i?void 0:i(t.sender_id),style:{color:t.name_color},children:t.username}),t.custom_title&&(0,a.jsxs)("span",{className:"text-xs opacity-70",children:["(",t.custom_title,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs opacity-70",children:[(0,a.jsx)(g.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:(e=>{let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/6e4);return t<1?"Just now":t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):s.toLocaleDateString()})(t.created_at)})]}),m&&N&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(N.isAppropriate?"bg-green-500":"bg-red-500"),title:N.isAppropriate?"Appropriate":"Flagged"})})]}),(0,a.jsxs)("div",{className:"mb-2",children:[t.parent_message_content&&(0,a.jsxs)("div",{className:"text-xs opacity-70 mb-1 p-2 bg-muted rounded",children:[(0,a.jsxs)("span",{className:"font-medium",children:["Replying to ",t.parent_message_username,":"]})," ",t.parent_message_content]}),(0,a.jsx)("div",{className:"text-sm",children:t.content}),"image"===t.message_type&&(0,a.jsx)("div",{className:"mt-2 text-xs opacity-70",children:"\uD83D\uDCF7 Image shared"})]}),m&&Object.keys(A).length>0&&_&&(0,a.jsxs)("div",{className:"mt-3 p-2 bg-muted/50 rounded text-xs space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"font-medium",children:"AI Insights:"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Tone:"}),(0,a.jsx)("span",{className:(e=>{switch(e){case"excited":return"text-yellow-500";case"curious":return"text-blue-500";case"sad":return"text-blue-400";case"angry":return"text-red-500";case"loving":return"text-pink-500";default:return"text-gray-500"}})(A.tone),children:A.tone})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Complexity:"}),(0,a.jsx)("span",{className:(e=>{switch(e){case"complex":return"text-purple-500";case"moderate":return"text-orange-500";case"simple":return"text-green-500";default:return"text-gray-500"}})(A.complexity),children:A.complexity})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Intent:"}),(0,a.jsx)("span",{className:"capitalize",children:A.intent})]}),A.keywords.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Keywords:"}),(0,a.jsx)("span",{className:"text-blue-500",children:A.keywords.join(", ")})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[null===(s=t.reactions)||void 0===s?void 0:s.map((e,s)=>(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>null==o?void 0:o(t.id,e.emoji),className:"h-6 px-2 text-xs ".concat(e.reacted_by_me?"bg-primary/20":""),children:[e.emoji," ",e.count]},s)),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>null==o?void 0:o(t.id,"\uD83D\uDC4D"),className:"h-6 w-6 p-0",children:"\uD83D\uDC4D"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>null==o?void 0:o(t.id,"❤️"),className:"h-6 w-6 p-0",children:"❤️"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>null==o?void 0:o(t.id,"\uD83D\uDE0A"),className:"h-6 w-6 p-0",children:"\uD83D\uDE0A"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>null==c?void 0:c(t.id),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(f.A,{className:"h-3 w-3"})}),m&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>k(!_),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",title:"AI Analysis",children:(0,a.jsx)(p.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(d.A,{className:"h-3 w-3"})})]})]}),b&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs opacity-70",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-primary"}),(0,a.jsx)("span",{children:"Analyzing message..."})]})]})}),m&&(N||Object.keys(A).length>0)&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 bg-primary text-primary-foreground rounded-full p-1",children:(0,a.jsx)(j.A,{className:"h-3 w-3"})})]})}var y=t(7304),b=t(1823),w=t(151),_=t(7523),k=t(2539),A=t(1947);let S=["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"];function C(e){let{onSendMessage:s,placeholder:t="Type a message...",disabled:l=!1,replyToMessage:i,onClearReply:c}=e,[d,o]=(0,r.useState)(""),[m,u]=(0,r.useState)(!1),h=(0,r.useRef)(null),x=(0,r.useRef)(null);(0,r.useEffect)(()=>{i&&x.current&&x.current.focus()},[i]);let g=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){u(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(a.name)),{method:"POST",body:a});if(e.ok){let t=await e.json();s(t.url,null==i?void 0:i.id,"image"),null==c||c()}else{let s=await e.json();console.error("Image upload failed:",s.error||e.statusText),alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{u(!1),h.current&&(h.current.value="")}}},p=e=>{var s;o(s=>s+e),null===(s=x.current)||void 0===s||s.focus()};return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&!l&&(s(d.trim(),null==i?void 0:i.id,"text"),o(""),null==c||c())},className:"flex flex-col p-4 border-t bg-background",children:[i&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 mb-2 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-800",children:[(0,a.jsxs)("div",{className:"flex-1 truncate",children:["Replying to ",(0,a.jsxs)("span",{className:"font-semibold",children:["@",i.username]}),': "',i.content,'"']}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:c,className:"h-6 w-6 p-0 ml-2",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",ref:h,onChange:g,className:"hidden",disabled:l||m}),(0,a.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"shrink-0",onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.click()},disabled:l||m,children:m?(0,a.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):(0,a.jsx)(w.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(y.p,{ref:x,value:d,onChange:e=>o(e.target.value),placeholder:t,disabled:l||m,className:"pr-10 border-gray-200 focus:border-gray-400 transition-colors"}),(0,a.jsxs)(A.AM,{children:[(0,a.jsx)(A.Wv,{asChild:!0,children:(0,a.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0",disabled:l||m,children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})}),(0,a.jsx)(A.hl,{className:"w-64 p-2 grid grid-cols-6 gap-1",children:S.map(e=>(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>p(e),children:e},e))})]})]}),(0,a.jsx)(n.$,{type:"submit",disabled:!d.trim()||l||m,size:"sm",className:"shrink-0 bg-black hover:bg-gray-800 text-white",children:(0,a.jsx)(k.A,{className:"h-4 w-4"})})]})]})}var E=t(6446),T=t(2384),z=t(72),I=t(530),F=t(8915);function D(e){let{onSendMessage:s,onImageUpload:t,chatType:l,chatName:i,currentUser:c,messageHistory:d=[],userPreferences:o,disabled:m=!1}=e,[u,h]=(0,r.useState)(""),[x,g]=(0,r.useState)([]),[f,N]=(0,r.useState)(null),[y,b]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[A,S]=(0,r.useState)("assistant"),C=(0,r.useRef)(null),D=(0,r.useRef)(null);(0,r.useEffect)(()=>{C.current&&(C.current.style.height="auto",C.current.style.height="".concat(C.current.scrollHeight,"px"))},[u]),(0,r.useEffect)(()=>{u.length>10?$(u):(N(null),g([]))},[u]);let $=async e=>{b(!0);try{let s={chatType:l,chatName:i,username:c,messageHistory:d,userPreferences:o,currentTime:new Date().toLocaleTimeString()},[t,a]=await Promise.all([(0,v.b1)(e),(0,v.S8)(e,s)]);N(t),g(a||[])}catch(e){console.error("Error analyzing message:",e)}finally{b(!1)}},R=()=>{u.trim()&&!m&&(s(u.trim()),h(""),g([]),N(null))},L=e=>{h(e),_(!1)};return(0,a.jsxs)("div",{className:"space-y-4",children:[y&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground animate-pulse",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Analyzing message..."})]}),f&&(0,a.jsx)("div",{className:"flex items-center gap-4 text-xs",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 ".concat(f.isAppropriate?"text-green-500":"text-red-500"),children:[(0,a.jsx)(T.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:f.isAppropriate?"Appropriate":"Flagged"})]})}),x.length>0&&w&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map((e,s)=>(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>L(e),className:"text-xs hover:bg-accent",children:[(0,a.jsx)(z.A,{className:"h-3 w-3 mr-1"}),e]},s))}),(0,a.jsxs)("div",{className:"flex items-end gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(E.T,{ref:C,value:u,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Type your message... (Shift+Enter for new line)",className:"min-h-[60px] max-h-[120px] resize-none pr-20",disabled:m}),(0,a.jsx)("div",{className:"absolute right-2 bottom-2 flex items-center gap-1",children:x.length>0&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>_(!w),className:"h-6 w-6 p-0",title:"Smart suggestions",children:(0,a.jsx)(j.A,{className:"h-3 w-3"})})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("select",{value:A,onChange:e=>S(e.target.value),className:"text-xs bg-background border border-input rounded px-2 py-1",title:"AI Persona",children:Object.entries(v.rb).map(e=>{let[s,t]=e;return(0,a.jsx)("option",{value:s,children:t.name},s)})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.click()},disabled:m,className:"h-8 w-8 p-0",title:"Upload image",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{onClick:R,disabled:!u.trim()||m,className:"h-8 w-8 p-0 bg-primary hover:bg-primary/90",title:"Send message",children:(0,a.jsx)(k.A,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("input",{ref:D,type:"file",accept:"image/*",onChange:e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];a&&t&&t(a)},className:"hidden"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(F.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Smart features enabled"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"AI-powered moderation"})]})]})]})}var $=t(2811),R=t(9086),L=t(9815),q=t(3079),M=t(1086);function P(e){var s;let{chatType:t,chatName:l,currentUser:i,messageHistory:c,userPreferences:d,onSendMessage:o}=e,[m,x]=(0,r.useState)(!1),[N,y]=(0,r.useState)("assistant"),[w,_]=(0,r.useState)(""),[k,A]=(0,r.useState)(""),[S,C]=(0,r.useState)(!1),[E,T]=(0,r.useState)(""),[z,I]=(0,r.useState)({});(0,r.useEffect)(()=>{c.length>0&&F()},[c]);let F=async()=>{if(!(c.length<3))try{if(c.length>5){let e=await (0,v.pf)(c);A(e)}let e=c.slice(-10),s=e.filter(e=>!e.isAI),t=e.filter(e=>e.isAI);I({totalMessages:c.length,userMessages:s.length,aiMessages:t.length,conversationPace:D(c),activeParticipants:P(c),lastActivity:O(c)})}catch(e){console.error("Error generating insights:",e)}},D=e=>{if(e.length<2)return"slow";let s=new Date(e[e.length-1].timestamp).getTime()-new Date(e[0].timestamp).getTime(),t=e.length/(s/6e4);return t>2?"fast":t>.5?"moderate":"slow"},P=e=>Array.from(new Set(e.map(e=>e.username))),O=e=>{if(0===e.length)return"No activity";let s=new Date(e[e.length-1].timestamp),t=Math.floor((new Date().getTime()-s.getTime())/6e4);return t<1?"Just now":t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):"".concat(Math.floor(t/1440),"d ago")},U=async()=>{if(c.length){C(!0),T("response");try{let e=c[c.length-1],s={chatType:t,username:i,messageHistory:c.slice(-5).map(e=>({role:e.isAI?"assistant":"user",content:e.content}))},a=await (0,v.pL)(e.content,s,N);_(a.content)}catch(e){console.error("Error generating AI response:",e),_("I'm having trouble thinking right now. Could you try rephrasing that?")}finally{C(!1)}}};return(0,a.jsxs)(u.Zp,{className:"glass animate-fadeIn",children:[(0,a.jsx)(u.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(u.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(p.A,{className:"h-5 w-5 text-primary"}),"Smart AI Assistant"]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>x(!m),className:"h-6 w-6 p-0",children:m?(0,a.jsx)(R.A,{className:"h-4 w-4"}):(0,a.jsx)(L.A,{className:"h-4 w-4"})})})]})}),(0,a.jsxs)(u.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Persona:"}),(0,a.jsx)("select",{value:N,onChange:e=>y(e.target.value),className:"text-sm bg-background border border-input rounded px-2 py-1",children:Object.entries(v.rb).map(e=>{let[s,t]=e;return(0,a.jsx)("option",{value:s,children:t.name},s)})}),(e=>{switch(e){case"tutor":return(0,a.jsx)($.A,{className:"h-4 w-4"});case"creative":return(0,a.jsx)(j.A,{className:"h-4 w-4"});default:return(0,a.jsx)(h.A,{className:"h-4 w-4"})}})(N)]}),Object.keys(z).length>0&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[z.totalMessages," messages"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(q.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[(null===(s=z.activeParticipants)||void 0===s?void 0:s.length)||0," participants"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(M.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{className:(e=>{switch(e){case"fast":return"text-green-500";case"moderate":return"text-yellow-500";case"slow":return"text-blue-500";default:return"text-gray-500"}})(z.conversationPace),children:[z.conversationPace," pace"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(g.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:z.lastActivity})]})]}),k&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)($.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Conversation Summary"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:k})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:U,disabled:S||!c.length,className:"flex-1",children:[S&&"response"===E?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Generate AI Response"]})}),w&&(0,a.jsxs)("div",{className:"p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-primary",children:[v.rb[N].name," Response:"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{w&&o&&(o(w),_(""))},className:"h-6 w-6 p-0",title:"Send this response",children:(0,a.jsx)(f.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>_(""),className:"h-6 w-6 p-0",title:"Clear response",children:(0,a.jsx)(b.A,{className:"h-3 w-3"})})]})]}),(0,a.jsx)("p",{className:"text-sm",children:w})]})]}),m&&(0,a.jsxs)("div",{className:"pt-2 border-t",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:"Smart Features:"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-1 text-xs",children:Object.entries(v.W0).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(t?"bg-green-500":"bg-gray-300")}),(0,a.jsx)("span",{className:"capitalize",children:s.replace(/([A-Z])/g," $1").toLowerCase()})]},s)})})]})]})]})}var O=t(7616),U=t(1371);function Z(e){let{chatType:s,chatId:t,chatName:l,currentUserId:i,onUserClick:c}=e,[d,o]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0),[x,g]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[y,b]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[k,A]=(0,r.useState)(!0),[S,E]=(0,r.useState)(!1),T=(0,r.useRef)(null),z=(0,r.useRef)(null),I=(0,r.useRef)([]),{user:F}=(0,O.J)();(0,r.useEffect)(()=>{I.current=d},[d]);let $=()=>{var e;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),b(!1),_(!1)},R=(0,r.useCallback)(async()=>{try{let e=new URLSearchParams({chatType:s});t&&e.append("chatId",t);let a=await fetch("/api/messages?".concat(e));if(!a.ok){console.error("Failed to fetch messages:",a.status,await a.text());return}let r=await a.json();if(r.messages){let e=new Set(I.current.map(e=>e.id)),a=r.messages.filter(s=>!e.has(s.id));o(r.messages),a.length>0&&y&&_(!0),F&&F.notifications_enabled&&a.length>0&&a.forEach(e=>{e.sender_id!==i&&U.l.showMessageNotification({content:e.content,username:e.username,chatType:s,chatName:l,chatId:t,messageType:e.message_type,id:e.id},(e,s,t)=>{(e!=e||s&&s!=s)&&window.dispatchEvent(new CustomEvent("navigateToChat",{detail:{type:e,id:s,name:t}}))})})}}catch(e){console.error("Failed to fetch messages:",e)}finally{h(!1)}},[s,t,F,i,l,y]);(0,r.useEffect)(()=>{!u&&d.length>0&&setTimeout(()=>{$()},100)},[u]),(0,r.useEffect)(()=>{R();let e=setInterval(R,2e3);return()=>clearInterval(e)},[s,t,R]);let q=async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text";g(!0);try{let n=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e,chatType:s,chatId:t,parentMessageId:a,messageType:r})});if(n.ok){let e=await n.json(),s=!z.current||z.current.scrollHeight-z.current.scrollTop-z.current.clientHeight<100;await R(),s&&setTimeout(()=>{$()},100),e.trigger_popup&&(console.log("Triggering gold member popup for API keys"),window.dispatchEvent(new CustomEvent("geminiKeyExhausted")))}else{let e=await n.json().catch(()=>({error:"Unknown error"}));console.error("Failed to send message:",n.status,e),"GEMINI_KEY_EXHAUSTED"===e.error&&(console.log("Gemini API key exhausted, triggering popup"),window.dispatchEvent(new CustomEvent("geminiKeyExhausted")))}}catch(e){console.error("Failed to send message:",e)}finally{g(!1)}},M=async(e,s)=>{try{let t=await fetch("/api/messages/".concat(e,"/reactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?R():console.error("Failed to add reaction:",t.status,await t.text())}catch(e){console.error("Failed to add reaction:",e)}},Z=async(e,s)=>{try{let t=await fetch("/api/messages/".concat(e,"/reactions"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?R():console.error("Failed to remove reaction:",t.status,await t.text())}catch(e){console.error("Failed to remove reaction:",e)}},W=e=>{let s=d.find(s=>s.id===e);s&&v(s)},B=e=>{v(e)},G=async e=>{try{let s=await fetch("/api/messages/".concat(e,"/delete"),{method:"DELETE"});if(s.ok)R();else{let e=await s.json();console.error("Failed to delete message:",e.error),alert("Failed to delete message: ".concat(e.error))}}catch(e){console.error("Failed to delete message:",e),alert("An error occurred while deleting the message")}},H=async e=>{if(!x){g(!0);try{let s=new FormData;s.append("image",e);let t=await fetch("/api/upload-image",{method:"POST",body:s});if(t.ok){let e=await t.json();await q("[Image: ".concat(e.url,"]"),void 0,"image")}else console.error("Failed to upload image:",t.status)}catch(e){console.error("Error uploading image:",e)}finally{g(!1)}}};return u?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading messages..."})}):(0,a.jsxs)("div",{className:"flex flex-col h-full card-modern overflow-hidden relative",children:[(0,a.jsx)("div",{className:"border-b border-border/50 p-4 bg-background/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[l,k&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"text-xs text-primary",children:"AI Enhanced"})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"global"===s?"Global chat • Everyone can see your messages":"group"===s?"Group chat":"channel"===s?"Channel":"Direct message"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>A(!k),className:"flex items-center gap-1",title:k?"Disable smart features":"Enable smart features",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"Smart"})]}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>E(!S),className:"flex items-center gap-1",title:"AI Assistant",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"AI"})]})]})]})}),(0,a.jsxs)("div",{ref:z,className:"flex-1 overflow-y-auto p-4 space-y-1 bg-background",onScroll:()=>{if(!z.current)return;let{scrollTop:e,scrollHeight:s,clientHeight:t}=z.current,a=s-e-t<100;b(!a),a&&_(!1)},children:[0===d.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)("p",{children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Start the conversation!"})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[S&&(0,a.jsx)(P,{chatType:s,chatName:l,currentUser:(null==F?void 0:F.username)||"",messageHistory:d.map(e=>({content:e.content,username:e.username,timestamp:e.created_at,isAI:e.is_ai_response})),userPreferences:F,onSendMessage:q}),d.map(e=>k?(0,a.jsx)(N,{message:e,currentUserId:i,onUserClick:c,onReply:W,onReaction:M,showAI:k},e.id):(0,a.jsx)(m,{message:e,currentUserId:i,currentUserHasGold:(null==F?void 0:F.has_gold_animation)||!1,onAddReaction:M,onRemoveReaction:Z,onReply:B,onDelete:G,onUserClick:c},e.id))]}),(0,a.jsx)("div",{ref:T})]}),y&&(0,a.jsx)("div",{className:"absolute bottom-20 right-4 z-10",children:(0,a.jsxs)(n.$,{onClick:$,className:"rounded-full w-12 h-12 shadow-lg transition-all duration-200 hover:scale-110 ".concat(w?"bg-blue-500 hover:bg-blue-600 animate-pulse":"bg-gray-600 hover:bg-gray-700"),size:"sm",children:[(0,a.jsx)(L.A,{className:"h-5 w-5"}),w&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"})]})}),(0,a.jsxs)("div",{className:"bg-card border-t p-4",children:[f&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-muted rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"font-medium",children:["Replying to ",f.username,":"]}),(0,a.jsx)("span",{className:"text-muted-foreground ml-2",children:f.content.length>50?f.content.substring(0,50)+"...":f.content})]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{v(null)},children:"\xd7"})]})}),k?(0,a.jsx)(D,{onSendMessage:q,onImageUpload:H,chatType:s,chatName:l,currentUser:(null==F?void 0:F.username)||"",messageHistory:d.slice(-5).map(e=>({role:e.is_ai_response?"assistant":"user",content:e.content})),userPreferences:F,disabled:x}):(0,a.jsx)(C,{onSendMessage:q,disabled:x,placeholder:"global"===s?"Message everyone...":"group"===s?"Message the group...":"channel"===s?"Message the channel...":"Send a message..."})]})]})}},4188:(e,s,t)=>{t.d(s,{m:()=>n});var a=t(2432),r=t(364);function n(){let[e,s]=(0,r.useState)(null),[t,n]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let e;return(async()=>{try{var t,a;let r=await (null===(t=(a=navigator).getBattery)||void 0===t?void 0:t.call(a));if(!r)return;e=r;let l=()=>{s(Math.round(100*e.level)),n(!!e.charging)};l(),e.addEventListener("levelchange",l),e.addEventListener("chargingchange",l)}catch(e){}})(),()=>{try{e&&(e.removeEventListener("levelchange",()=>{}),e.removeEventListener("chargingchange",()=>{}))}catch(e){}}},[]),null===e)?null:(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Battery: ",e,"% ",t?"⚡":""]})}},4992:(e,s,t)=>{t.d(s,{o:()=>o});var a=t(2432),r=t(364),n=t(2708),l=t(7304),i=t(7382),c=t(7759),d=t(1823);function o(e){let{onClose:s,onCreate:t}=e,[o,m]=(0,r.useState)(""),[u,h]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[p,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();h(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}finally{f(!1)}},v=e=>{g(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},N=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",y=e=>e?{color:e}:{};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(i.Zp,{className:"w-full max-w-md mx-4",children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(i.ZB,{children:"Create Group Chat"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(i.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(l.p,{value:o,onChange:e=>m(e.target.value),placeholder:"Group chat name"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Add Friends"}),p?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"Loading friends..."}):0===u.length?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No friends to add"}):(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.S,{id:e.friend_id,checked:x.includes(e.friend_id),onCheckedChange:()=>v(e.friend_id)}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:y(e.friend_name_color),children:(0,a.jsxs)("span",{className:N(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:()=>{o.trim()&&t(o.trim(),x)},disabled:!o.trim(),className:"flex-1",children:"Create Group"}),(0,a.jsx)(n.$,{variant:"outline",onClick:s,children:"Cancel"})]})]})]})})}},6446:(e,s,t)=>{t.d(s,{T:()=>l});var a=t(2432),r=t(364),n=t(4963);let l=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});l.displayName="Textarea"},7759:(e,s,t)=>{t.d(s,{S:()=>c});var a=t(2432),r=t(364),n=t(2660),l=t(3491),i=t(4963);let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.bL,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,a.jsx)(n.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})})});c.displayName=n.bL.displayName},9495:(e,s,t)=>{t.d(s,{s:()=>o});var a=t(2432),r=t(364),n=t(7382),l=t(2708),i=t(7997),c=t(4311),d=t(5588);function o(e){let{currentUserId:s,onSelectDM:t}=e,[o,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0),[x,g]=(0,r.useState)(Date.now()),p=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/dms");if(e.ok){let s=await e.json();m(s.dms),g(Date.now())}}catch(e){console.error("Failed to fetch DMs:",e)}finally{h(!1)}},[]);(0,r.useEffect)(()=>{p();let e=setInterval(p,2e3);return()=>clearInterval(e)},[p]);let f=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",j=e=>e?{color:e}:{},v=e=>{let s=new Date(e),t=(new Date().getTime()-s.getTime())/36e5;return t<1?"Just now":t<24?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()};return u?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading DMs..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Direct Messages"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(i.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(x).toLocaleTimeString()]})]})]}),(0,a.jsxs)(n.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"}),"Direct Messages"]})}),(0,a.jsx)(n.Wu,{children:0===o.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(c.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 animate-pulse"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No direct messages yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Start a conversation with a friend!"})]}):(0,a.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,a.jsxs)("div",{className:"group flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200 hover:scale-102 animate-slideIn",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>t(e.friend_id,e.friend_username),children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary",children:e.friend_username.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:e.friend_has_gold?f(void 0,!0):"",style:e.friend_has_gold?{}:j(e.friend_name_color),children:["@",e.friend_username]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Last message: ",v(e.last_message_at)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.$,{size:"icon",variant:"ghost",onClick:()=>t(e.friend_id,e.friend_username),title:"Message",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})]},e.friend_id))})})]})]})}}}]);