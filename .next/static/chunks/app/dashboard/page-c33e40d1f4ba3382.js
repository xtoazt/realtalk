(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1325:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});var t=a(2432);let l=(0,a(9759).default)(()=>a.e(836).then(a.bind(a,836)),{loadableGenerated:{webpack:()=>[836]},ssr:!1});function r(){return(0,t.jsxs)("div",{className:"max-w-7xl mx-auto animate-fadeIn px-4",children:[(0,t.jsx)("div",{className:"sticky top-4 z-10 mb-3",children:(0,t.jsx)("button",{onClick:()=>location.href="/dashboard",className:"text-xs px-3 py-1 rounded-full border backdrop-blur-md bg-white/40 dark:bg-black/30 text-black dark:text-white border-white/40 dark:border-white/20 hover:bg-white/60 dark:hover:bg-black/50",children:"Back to Dashboard"})}),(0,t.jsx)(l,{})]})}},5564:(e,s,a)=>{Promise.resolve().then(a.bind(a,6712))},6712:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ev});var t=a(2432),l=a(364),r=a(9262),i=a(7328),n=a(2708),c=a(1947),o=a(6939),d=a(7693),m=a(5588),x=a(9861),h=a(9920),u=a(8055),g=a(8452),p=a(4010),f=a(4652),j=a(2121),v=a(1194),b=a(3394),y=a(6230),N=a(8175),w=a(7972),k=a(4504),C=a(7088),S=a(4260);function A(e){let{currentPage:s,onPageChange:a,onSignOut:r,onGlobalChatClick:i,onAIChatClick:A,username:_,onThemeCycle:F,onHueCycle:I}=e,[E,T]=(0,l.useState)(!1),[$,D]=(0,l.useState)(!1),z=[{id:"dashboard",label:"Dashboard",icon:o.A},{id:"friends",label:"Friends",icon:d.A},{id:"dms",label:"DMs",icon:m.A},{id:"channels",label:"Channels",icon:x.A},{id:"polls",label:"Polls",icon:h.A},{id:"voice",label:"Voice",icon:u.A},{id:"calendar",label:"Calendar",icon:g.A},{id:"profile",label:"Profile",icon:p.A},{id:"settings",label:"Settings",icon:f.A},{id:"about",label:"About",icon:j.A}],P=e=>{$||(D(!0),T(e),setTimeout(()=>D(!1),300))},O=e=>{"global"===e?i():"ai-chat"===e?A():a(e)};return(0,t.jsx)("div",{className:"fixed z-50 transition-all duration-300 top-4 left-1/2 -translate-x-1/2",children:(0,t.jsx)("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg border border-gray-200/60 dark:border-gray-600/60 text-gray-900 dark:text-gray-100 rounded-full shadow-2xl transition-all duration-300 ease-out ".concat(E?"px-6 py-3 min-w-[700px]":"px-8 py-4 w-fit"),onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:E?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1 py-1",children:[(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("global"),className:"h-9 w-9 rounded-xl hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",title:"Global",children:(0,t.jsx)(v.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("ai-chat"),className:"h-9 w-9 rounded-xl hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",title:"AI Chat",children:(0,t.jsx)(b.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)("div",{className:"w-px h-5 bg-border mx-1"}),z.map(e=>{let a=e.icon,l="channels"===e.id||"dms"===e.id||"polls"===e.id,r=s===e.id;return(0,t.jsxs)(n.$,{variant:"ghost",size:l?"sm":"icon",onClick:()=>O(e.id),className:"h-9 ".concat(l?"px-4":"w-9"," rounded-xl transition-colors ").concat(r?"bg-gray-200/70 dark:bg-gray-600/70 text-gray-900 dark:text-gray-100":"hover:bg-gray-100/60 dark:hover:bg-gray-700/60 text-gray-600 dark:text-gray-400"),children:[(0,t.jsx)(a,{className:"h-4 w-4"}),l&&(0,t.jsx)("span",{className:"ml-2 text-xs hidden md:inline",children:e.label})]},e.id)}),(0,t.jsxs)(c.AM,{children:[(0,t.jsx)(c.Wv,{asChild:!0,children:(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",className:"h-9 px-4 rounded-xl transition-colors ".concat("movies"===s||"games"===s||"radio"===s?"bg-gray-200/70 dark:bg-gray-600/70 text-gray-900 dark:text-gray-100":"hover:bg-gray-100/60 dark:hover:bg-gray-700/60 text-gray-600 dark:text-gray-400"),title:"Entertainment",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"ml-2 text-xs hidden md:inline",children:"Entertainment"})]})}),(0,t.jsx)(c.hl,{className:"w-48 p-2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg border border-gray-200/60 dark:border-gray-600/60 rounded-xl shadow-xl",align:"center",avoidCollisions:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("movies"),className:"justify-start gap-3 h-10 hover:bg-gray-100/60 dark:hover:bg-gray-700/60 text-gray-700 dark:text-gray-300 rounded-lg transition-colors",children:[(0,t.jsx)(y.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),(0,t.jsx)("span",{className:"text-sm",children:"Movies"})]}),(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("games"),className:"justify-start gap-3 h-10 hover:bg-gray-100/60 dark:hover:bg-gray-700/60 text-gray-700 dark:text-gray-300 rounded-lg transition-colors",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),(0,t.jsx)("span",{className:"text-sm",children:"Games"})]}),(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("radio"),className:"justify-start gap-3 h-10 hover:bg-gray-100/60 dark:hover:bg-gray-700/60 text-gray-700 dark:text-gray-300 rounded-lg transition-colors",children:[(0,t.jsx)(w.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),(0,t.jsx)("span",{className:"text-sm",children:"Radio"})]})]})})]}),(0,t.jsx)("div",{className:"w-px h-5 bg-border mx-1"}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:F,className:"h-9 w-9 rounded-xl hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",title:"Toggle Theme",children:(0,t.jsx)(k.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>{try{localStorage.setItem("ui-mode","simple")}catch(e){}window.location.href="/dashboard/simple"},className:"h-9 w-9 rounded-xl hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",title:"Simple Mode",children:(0,t.jsx)(C.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:r,className:"h-9 w-9 rounded-xl hover:bg-red-100/60 dark:hover:bg-red-900/60 transition-colors",title:"Sign out",children:(0,t.jsx)(S.A,{className:"h-4 w-4 text-red-500 dark:text-red-400"})})]}):(0,t.jsxs)("div",{className:"flex items-center gap-3 transition-all duration-200",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-green-400 rounded-full animate-ping opacity-30"})]}),(0,t.jsx)("span",{className:"text-lg font-bold tracking-wide",children:"real."}),(0,t.jsxs)("span",{className:"text-xs text-subtle font-medium",children:["@",_]})]})})})}var _=a(3143),F=a(129),I=a(9495),E=a(7304),T=a(6446),$=a(7382),D=a(7759),z=a(5009),P=a(3079),O=a(5213),R=a(4329),M=a(3702),Z=a(1823);function L(e){let{currentUserId:s,userSignupCode:a}=e,[r,i]=(0,l.useState)([]),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(!0),[g,p]=(0,l.useState)(null),[f,j]=(0,l.useState)(null),[b,y]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[k,C]=(0,l.useState)(["",""]),[S,A]=(0,l.useState)(!1),[_,F]=(0,l.useState)([]),[I,L]=(0,l.useState)(""),U=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls");if(e.ok){let s=await e.json();console.log("[polls-page] Fetched polls:",s.polls),i(s.polls)}else console.error("[polls-page] Failed to fetch polls:",e.status)}catch(e){console.error("Failed to fetch polls:",e)}finally{u(!1)}},[]),q=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();o(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{U(),q()},[U,q]);let G=async()=>{if(j(null),b.trim()&&!(k.filter(e=>e.trim()).length<2))try{let e=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b.trim(),description:N.trim()||void 0,options:k.filter(e=>e.trim()),is_public:S,shared_with:_,expires_at:I||void 0})});if(e.ok)m(!1),B(),U();else{let s=await e.json();j("Failed to create poll: ".concat(s.error))}}catch(e){j("An unexpected error occurred while creating the poll.")}},W=async e=>{j(null);try{let s=await fetch("/api/polls/".concat(e),{method:"DELETE"});if(s.ok)U();else{let e=await s.json();j("Failed to delete poll: ".concat(e.error||s.statusText))}}catch(e){j("An unexpected error occurred while deleting the poll.")}},J=async(e,s)=>{console.log("[polls-page] Voting on poll ".concat(e," with option ").concat(s)),p(e);try{let a=await fetch("/api/polls/".concat(e,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:s})});if(a.ok)console.log("[polls-page] Vote successful, refreshing polls"),await U();else{let e=await a.json();console.error("Failed to vote:",e.error),alert("Failed to vote: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Failed to vote:",e),alert("An unexpected error occurred while voting.")}finally{p(null)}},B=()=>{y(""),w(""),C(["",""]),A(!1),F([]),L("")},K=e=>{k.length>2&&C(k.filter((s,a)=>a!==e))},V=(e,s)=>{let a=[...k];a[e]=s,C(a)},Y=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",H=e=>e?{color:e}:{},Q=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=e=>!!e&&new Date(e)<new Date,ee=(e,s)=>0===s?0:Math.round(e/s*100);return x?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading polls..."})}):(0,t.jsxs)("div",{className:"space-y-6 relative z-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Polls"}),(0,t.jsxs)(n.$,{onClick:()=>m(!0),className:"hover-lift hover-glow",children:[(0,t.jsx)(z.A,{className:"h-4 w-4 mr-2"}),"Create Poll"]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:0===r.length?(0,t.jsx)($.Zp,{className:"glass-effect animate-fadeIn",children:(0,t.jsxs)($.Wu,{className:"text-center py-8",children:[(0,t.jsx)(h.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No polls yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first poll to gather opinions!"})]})}):r.map((e,a)=>{let l=void 0!==e.user_response;return(0,t.jsxs)($.Zp,{className:"glass-effect hover-lift animate-fadeIn ".concat(X(e.expires_at)?"opacity-75":""),style:{animationDelay:"".concat(.1*a,"s")},children:[(0,t.jsxs)($.aR,{children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)($.ZB,{className:"text-lg",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.is_public?(0,t.jsx)(v.A,{className:"h-3 w-3 hue-accent"}):(0,t.jsx)(P.A,{className:"h-3 w-3"}),(0,t.jsx)(O.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[e.total_responses," votes"]}),e.expires_at&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:X(e.expires_at)?"text-red-500":"",children:X(e.expires_at)?"Expired":"Expires ".concat(Q(e.expires_at))})]})]}),e.creator_id===s&&(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>W(e.id),className:"text-red-500 hover:bg-red-500/10 h-6 w-6 p-0",title:"Delete Poll",children:(0,t.jsx)(M.A,{className:"h-3 w-3"})})]})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:e.creator_username?Y(void 0,!1):"",children:["by @",e.creator_username]}),(0,t.jsxs)("span",{children:[void 0!==e.user_response?"You voted":"Click to vote"," • ",e.total_responses," total votes"]})]})]}),(0,t.jsxs)($.Wu,{className:"space-y-3",children:[e.options.map((s,a)=>{let r=e.results.find(e=>e.option_index===a),i=(null==r?void 0:r.count)||0,c=ee(i,e.total_responses),o=e.user_response===a,d=g===e.id;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.$,{variant:o?"default":"outline",className:"flex-1 justify-start hover-lift transition-all duration-200 ".concat(o?"hue-shadow":""," ").concat(X(e.expires_at)?"":"cursor-pointer"),onClick:()=>!X(e.expires_at)&&!d&&J(e.id,a),disabled:X(e.expires_at)||d,children:[(0,t.jsx)("span",{className:"flex-1 text-left",children:s}),d&&(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin ml-2"})]}),l&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground ml-3 min-w-[60px] text-right",children:[i," (",c,"%)"]})]}),l&&(0,t.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,t.jsx)("div",{className:"h-2 rounded-full transition-all duration-700 ease-out ".concat(o?"bg-gradient-to-r from-blue-500 to-purple-500 hue-shadow":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(c,"%"),backgroundColor:o?"hsl(var(--hue) 60% 50%)":void 0}})})]},a)}),!X(e.expires_at)&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4 opacity-70",children:["Click on an option to ",l?"change your vote":"cast your vote"]})]})]},e.id)})}),d&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)($.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto glass-effect animate-fadeIn",children:[(0,t.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)($.ZB,{children:"Create Poll"}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)($.Wu,{className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(E.p,{value:b,onChange:e=>y(e.target.value),placeholder:"Poll title",className:"focus:hue-shadow"})}),(0,t.jsx)("div",{children:(0,t.jsx)(T.T,{value:N,onChange:e=>w(e.target.value),placeholder:"Description (optional)",rows:2,className:"focus:hue-shadow"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Options"}),k.map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(E.p,{value:e,onChange:e=>V(s,e.target.value),placeholder:"Option ".concat(s+1),className:"focus:hue-shadow"}),k.length>2&&(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>K(s),children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]},s)),k.length<6&&(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{k.length<6&&C([...k,""])},className:"hover-lift bg-transparent",children:[(0,t.jsx)(z.A,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(E.p,{type:"datetime-local",value:I,onChange:e=>L(e.target.value),className:"focus:hue-shadow"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional expiration date"})]}),"qwea"===a&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-3 hue-bg rounded-lg",children:[(0,t.jsx)(D.S,{id:"public",checked:S,onCheckedChange:e=>A(!0===e)}),(0,t.jsx)("label",{htmlFor:"public",className:"text-sm font-medium",children:"Share with all users (public poll)"})]}),!S&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Share with friends"}),(0,t.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(D.S,{id:e.friend_id,checked:_.includes(e.friend_id),onCheckedChange:s=>{s?F([..._,e.friend_id]):F(_.filter(s=>s!==e.friend_id))}}),(0,t.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:H(e.friend_name_color),children:(0,t.jsxs)("span",{className:Y(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{onClick:G,disabled:!b.trim()||k.filter(e=>e.trim()).length<2,className:"flex-1 hover-glow",children:"Create Poll"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})})]})}function U(e){let{currentUserId:s,userSignupCode:a,onSelectChannel:r}=e,[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),[u,g]=(0,l.useState)(""),p="qwea"===a,f=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/channels");if(e.ok){let s=await e.json();c(s.channels)}}finally{d(!1)}},[]);(0,l.useEffect)(()=>{f()},[f]);let j=(0,l.useMemo)(()=>i.filter(e=>e.is_system),[i]),v=(0,l.useMemo)(()=>i.filter(e=>!e.is_system),[i]),b=async e=>{if(!confirm("Delete this channel?"))return;let s=await fetch("/api/channels/".concat(e),{method:"DELETE"});if(s.ok)f();else{let e=await s.json().catch(()=>({}));alert("Failed to delete: ".concat(e.error||s.statusText))}},y=async()=>{if(p&&u.trim()){h(!0);try{let e=await fetch("/api/channels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.trim()})});if(e.ok)g(""),f();else{let s=await e.json().catch(()=>({}));alert("Failed to create channel: ".concat(s.error||e.statusText))}}finally{h(!1)}}};return o?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading channels..."})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Channels"}),p&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.p,{value:u,onChange:e=>g(e.target.value),placeholder:"Create a new channel",className:"w-48"}),(0,t.jsxs)(n.$,{onClick:y,disabled:!u.trim()||m,className:"hover-glow",children:[(0,t.jsx)(z.A,{className:"h-4 w-4 mr-1"})," Create"]})]})]}),(0,t.jsxs)($.Zp,{className:"glass-effect",children:[(0,t.jsx)($.aR,{children:(0,t.jsx)($.ZB,{children:"Default"})}),(0,t.jsx)($.Wu,{className:"space-y-2",children:0===j.length?(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No channels."}):j.map(e=>(0,t.jsxs)(n.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>r(e.id,e.name),children:[(0,t.jsx)(x.A,{className:"h-4 w-4 mr-2"})," ",e.name]},e.id))})]}),v.length>0&&(0,t.jsxs)($.Zp,{className:"glass-effect",children:[(0,t.jsx)($.aR,{children:(0,t.jsx)($.ZB,{children:"Created by Gold users"})}),(0,t.jsx)($.Wu,{className:"space-y-2",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.$,{variant:"ghost",className:"flex-1 justify-start",onClick:()=>r(e.id,e.name),children:[(0,t.jsx)(x.A,{className:"h-4 w-4 mr-2"})," ",e.name]}),e.creator_id===s&&(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>b(e.id),className:"text-red-500",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})]},e.id))})]})]})}var q=a(6334),G=a(855);function W(e){let{currentUserId:s}=e,[a,r]=(0,l.useState)([]),[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!0),[h,u]=(0,l.useState)(new Date),[p,f]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[b,y]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[S,A]=(0,l.useState)([]),_=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/calendar");if(e.ok){let s=await e.json();r(s.events)}}catch(e){console.error("Failed to fetch events:",e)}finally{x(!1)}},[]),F=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{_(),F()},[_,F]);let I=async()=>{if(p.trim()&&b&&N)try{(await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p.trim(),description:j.trim()||void 0,start_time:b,end_time:N,is_collaborative:k,participants:S})})).ok&&(d(!1),O(),_())}catch(e){console.error("Failed to create event:",e)}},O=()=>{f(""),v(""),y(""),w(""),C(!1),A([])},M=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",L=e=>e?{color:e}:{},U=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=e=>{let s=e.toDateString();return a.filter(e=>new Date(e.start_time).toDateString()===s)},J=e=>{u(s=>{let a=new Date(s);return"prev"===e?a.setMonth(s.getMonth()-1):a.setMonth(s.getMonth()+1),a})},B=e=>{if(!e)return!1;let s=new Date;return e.toDateString()===s.toDateString()};if(m)return(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading calendar..."})});let K=(e=>{let s=e.getFullYear(),a=e.getMonth(),t=new Date(s,a,1),l=new Date(s,a+1,0).getDate(),r=t.getDay(),i=[];for(let e=0;e<r;e++)i.push(null);for(let e=1;e<=l;e++)i.push(new Date(s,a,e));return i})(h),V=h.toLocaleDateString([],{month:"long",year:"numeric"});return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Calendar"}),(0,t.jsxs)(n.$,{onClick:()=>d(!0),children:[(0,t.jsx)(z.A,{className:"h-4 w-4 mr-2"}),"Create Event"]})]}),(0,t.jsxs)($.Zp,{children:[(0,t.jsx)($.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),V]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>J("prev"),children:(0,t.jsx)(q.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>J("next"),children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]})]})}),(0,t.jsxs)($.Wu,{children:[(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,t.jsx)("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:K.map((e,s)=>{let a=e?W(e):[];return(0,t.jsx)("div",{className:"min-h-[80px] p-1 border rounded-lg ".concat(e?"hover:bg-accent/50 cursor-pointer":""," ").concat(B(e)?"bg-primary/10 border-primary":""),children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-sm font-medium ".concat(B(e)?"text-primary":""),children:e.getDate()}),(0,t.jsxs)("div",{className:"space-y-1",children:[a.slice(0,2).map(e=>(0,t.jsx)("div",{className:"text-xs p-1 bg-primary/20 rounded truncate",title:e.title,children:e.title},e.id)),a.length>2&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",a.length-2," more"]})]})]})},s)})})]})]}),(0,t.jsxs)($.Zp,{children:[(0,t.jsx)($.aR,{children:(0,t.jsx)($.ZB,{children:"Upcoming Events"})}),(0,t.jsx)($.Wu,{children:0===a.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(R.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No events scheduled"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first event to get started!"})]}):(0,t.jsx)("div",{className:"space-y-3",children:a.filter(e=>new Date(e.start_time)>=new Date).sort((e,s)=>new Date(e.start_time).getTime()-new Date(s.start_time).getTime()).slice(0,5).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:[U(e.start_time)," - ",U(e.end_time)]}),e.is_collaborative&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(P.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:"Collaborative"})]})]})]})}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Created by @",e.creator_username]})]},e.id))})})]}),o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)($.Zp,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)($.ZB,{children:"Create Event"}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)($.Wu,{className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(E.p,{value:p,onChange:e=>f(e.target.value),placeholder:"Event title"})}),(0,t.jsx)("div",{children:(0,t.jsx)(T.T,{value:j,onChange:e=>v(e.target.value),placeholder:"Description (optional)",rows:2})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Start Time"}),(0,t.jsx)(E.p,{type:"datetime-local",value:b,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"End Time"}),(0,t.jsx)(E.p,{type:"datetime-local",value:N,onChange:e=>w(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(D.S,{id:"collaborative",checked:k,onCheckedChange:e=>C(!0===e)}),(0,t.jsx)("label",{htmlFor:"collaborative",className:"text-sm",children:"Make this a collaborative event"})]}),k&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Invite participants"}),(0,t.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(D.S,{id:e.friend_id,checked:S.includes(e.friend_id),onCheckedChange:s=>{s?A([...S,e.friend_id]):A(S.filter(s=>s!==e.friend_id))}}),(0,t.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:L(e.friend_name_color),children:(0,t.jsxs)("span",{className:M(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{onClick:I,disabled:!p.trim()||!b||!N,className:"flex-1",children:"Create Event"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]})]})})]})}var J=a(1942),B=a(4311),K=a(3335),V=a(1873),Y=a(7616),H=a(7709);function Q(e){let{userId:s,onStartDM:a,onSendFriendRequest:r}=e,{user:i,setUser:c}=(0,Y.J)(),[o,x]=(0,l.useState)(null),[h,u]=(0,l.useState)(!0),[g,f]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[N,w]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[S,A]=(0,l.useState)(null),[_,F]=(0,l.useState)(""),[I,E]=(0,l.useState)(""),D=!s||s===(null==i?void 0:i.id),z=!!(null==i?void 0:i.has_gold_animation);(0,l.useEffect)(()=>{let e=async()=>{if(!D&&s&&i)try{let e=await fetch("/api/friends/check?userId=".concat(s));if(e.ok){let s=await e.json();A(s.friendship)}}catch(e){console.error("Failed to fetch friendship:",e)}};(async()=>{if(D&&i)x(i),F(i.bio||""),E(i.profile_picture||"");else if(s)try{let e=await fetch("/api/users/".concat(s));if(e.ok){let s=await e.json();x(s.user)}}catch(e){console.error("Failed to fetch profile:",e)}u(!1)})(),e()},[s,i,D]);let P=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a){C(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(a.name)),{method:"POST",body:a});if(e.ok){let s=await e.json();E(s.url)}else{let s=await e.json();alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{C(!1)}}},O=async()=>{if(D){v(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile_picture:I||null,bio:_.trim()||null})});if(e.ok){let s=await e.json();c(s.user),x(s.user),f(!1)}else{let s=await e.json();alert("Failed to update profile: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to update profile:",e),alert("An unexpected error occurred while updating profile.")}finally{v(!1)}}};return h?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading profile..."})}):o?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:D?"Your Profile":"@".concat(o.username,"'s Profile")}),D&&(0,t.jsx)(n.$,{onClick:()=>f(!g),variant:g?"outline":"default",children:g?"Cancel":"Edit Profile"})]}),(0,t.jsxs)($.Zp,{className:"glass-effect hover-lift animate-fadeIn",children:[(0,t.jsx)($.aR,{children:(0,t.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-5 w-5"}),"Profile Information"]})}),(0,t.jsxs)($.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"relative",children:[o.profile_picture?(0,t.jsx)(H.default,{src:o.profile_picture||"/placeholder.svg",alt:"".concat(o.username,"'s profile"),width:100,height:100,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:(0,t.jsx)(p.A,{className:"h-12 w-12 text-gray-400"})}),g&&(0,t.jsxs)("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-2 cursor-pointer hover:bg-primary/90 transition-colors",children:[(0,t.jsx)(J.A,{className:"h-4 w-4"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:P,className:"hidden",disabled:k})]}),k&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-2xl font-bold ".concat(o.has_gold_animation&&o.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":""),style:o.has_gold_animation?{}:o.name_color?{color:o.name_color}:{},children:["@",o.username]}),o.custom_title&&(0,t.jsx)("p",{className:"text-sm italic text-muted-foreground mt-1",children:o.custom_title}),o.signup_code&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:["asdf"===o.signup_code&&"✨ Custom Colors","qwea"===o.signup_code&&"\uD83D\uDC51 Gold Member"]})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),g?(0,t.jsx)(T.T,{value:_,onChange:e=>F(e.target.value),placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"resize-none"}):(0,t.jsx)("div",{className:"min-h-[100px] p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:o.bio?(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:o.bio}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:D?"Add a bio to tell others about yourself":"No bio available"})}),g&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[_.length,"/500 characters"]})]}),(0,t.jsx)("div",{className:"flex gap-3",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.$,{onClick:O,disabled:j,className:"flex-1",children:j?"Saving...":"Save Changes"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>f(!1),disabled:j,children:"Cancel"})]}):D?null:(0,t.jsxs)(t.Fragment,{children:[(null==S?void 0:S.status)==="accepted"?(0,t.jsxs)(n.$,{onClick:()=>null==a?void 0:a(o.id,o.username),className:"flex-1",children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-2"}),"Send Message"]}):(0,t.jsxs)(n.$,{disabled:!0,className:"flex-1 opacity-50 cursor-not-allowed",children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-2"}),(null==S?void 0:S.status)==="pending"?"Friend Request Pending":"Add Friend to Message"]}),S&&"blocked"!==S.status?"pending"===S.status?(0,t.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Request Sent"]}):(0,t.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Friends"]}):(0,t.jsxs)(n.$,{variant:"outline",onClick:()=>null==r?void 0:r(o.id),children:[(0,t.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Add Friend"]}),z&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.$,{variant:"destructive",onClick:()=>y(!0),children:[(0,t.jsx)(K.A,{className:"h-4 w-4 mr-2"})," Freeze"]}),(0,t.jsxs)(n.$,{variant:"outline",onClick:async()=>{try{await fetch("/api/freeze?targetUserId=".concat(o.id),{method:"DELETE"}),alert("User unfrozen")}catch(e){alert("Failed to unfreeze")}},children:[(0,t.jsx)(V.A,{className:"h-4 w-4 mr-2"})," Unfreeze"]})]})]})})]})]}),b&&(0,t.jsx)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/50",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white dark:bg-gray-900 rounded-xl p-4 border",children:[(0,t.jsxs)("div",{className:"text-lg font-semibold mb-2",children:["Freeze @",o.username]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Only gold members can do this. The user will be prevented from typing or using voice."}),(0,t.jsx)("textarea",{className:"w-full border rounded p-2 text-sm mb-3",rows:3,placeholder:"Optional message shown on their screen",value:N,onChange:e=>w(e.target.value)}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)(n.$,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.$,{variant:"secondary",onClick:async()=>{let e=prompt("Popup message to show immediately (optional)")||"";if(e)try{await fetch("/api/freeze/popup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,popupMessage:e})}),alert("Popup sent")}catch(e){alert("Failed to send popup")}},children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Send Popup"]}),(0,t.jsxs)(n.$,{variant:"destructive",onClick:async()=>{try{let e=await fetch("/api/freeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,message:N})});if(e.ok)alert("User frozen"),y(!1),w("");else{let s=await e.json();alert(s.error||"Failed to freeze")}}catch(e){alert("Failed to freeze")}},children:[(0,t.jsx)(K.A,{className:"h-4 w-4 mr-1"})," Confirm Freeze"]})]})]})]})})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Profile not found"})})}var X=a(9370);function ee(){let{user:e}=(0,Y.J)();return e?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(X.n,{roomId:"global-voice",userId:e.id}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{id:"voice-enable-widget",type:"checkbox",defaultChecked:"1"===localStorage.getItem("voiceWidgetEnabled"),onChange:e=>{localStorage.setItem("voiceWidgetEnabled",e.target.checked?"1":"0"),window.dispatchEvent(new Event("voice-widget-toggle"))}}),(0,t.jsx)("label",{htmlFor:"voice-enable-widget",children:"Enable floating voice widget across pages"})]})]}):null}var es=a(3215),ea=a(1325),et=a(3544);function el(e){return null}var er=a(4992);function ei(e){let{onClose:s,onJoinSuccess:a}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(""),h=async e=>{if(e.preventDefault(),r.trim()){o(!0),m("");try{let e=await fetch("/api/group-chats/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortCode:r.trim().toUpperCase()})}),t=await e.json();e.ok?(a(t.groupChat),s()):m(t.error||"Failed to join group chat")}catch(e){m("An unexpected error occurred")}finally{o(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsxs)($.Zp,{className:"w-full max-w-md mx-4",children:[(0,t.jsxs)($.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5"}),"Join Group Chat"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,t.jsx)($.Wu,{children:(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Enter Group Code"}),(0,t.jsx)(E.p,{value:r,onChange:e=>i(e.target.value.toUpperCase()),placeholder:"e.g., ABC123",maxLength:6,className:"text-center text-lg font-mono tracking-wider",disabled:c}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"6-character code provided by the group creator"})]}),d&&(0,t.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:d}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{type:"submit",disabled:!r.trim()||c,className:"flex-1",children:c?"Joining...":"Join Group"}),(0,t.jsx)(n.$,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})})]})})}var en=a(3491);function ec(e){let{groupChatId:s,groupChatName:a,onClose:r,onRequestProcessed:i}=e,[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[x,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{u()},[s]);let u=async()=>{try{let e=await fetch("/api/group-chats/".concat(s,"/requests"));if(e.ok){let s=await e.json();o(s.requests)}}catch(e){console.error("Failed to fetch requests:",e)}finally{m(!1)}},g=async(e,a,t)=>{h(e);try{let l=await fetch("/api/group-chats/".concat(s,"/requests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestId:e,requesterId:a,action:t})});if(l.ok)o(s=>s.filter(s=>s.id!==e)),i();else{let e=await l.json();alert(e.error||"Failed to process request")}}catch(e){alert("An error occurred while processing the request")}finally{h(null)}},f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return d?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsx)($.Zp,{className:"w-full max-w-md mx-4",children:(0,t.jsxs)($.Wu,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading requests..."})]})})}):(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsxs)($.Zp,{className:"w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[(0,t.jsxs)($.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(R.A,{className:"h-5 w-5"}),"Join Requests"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)($.Wu,{className:"p-0",children:[(0,t.jsx)("div",{className:"px-6 pb-2",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Pending requests for ",(0,t.jsx)("strong",{children:a})]})}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===c.length?(0,t.jsxs)("div",{className:"px-6 py-8 text-center text-muted-foreground",children:[(0,t.jsx)(p.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No pending join requests"})]}):(0,t.jsx)("div",{className:"space-y-2 px-6 pb-6",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:(0,t.jsx)(p.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-sm",children:["@",e.username]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:f(e.created_at)})]})]}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>g(e.id,e.requester_id,"approve"),disabled:x===e.id,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:(0,t.jsx)(en.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>g(e.id,e.requester_id,"reject"),disabled:x===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]})]},e.id))})})]})]})})}var eo=a(3868);function ed(e){let{currentUserId:s}=e,[a,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),c=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/users/online");if(e.ok){let s=await e.json();r(s.onlineUsers)}}catch(e){console.error("Failed to fetch online users:",e)}finally{n(!1)}},[]),o=(0,l.useCallback)(async()=>{try{await fetch("/api/user/activity",{method:"POST"})}catch(e){console.error("Failed to update activity:",e)}},[]);(0,l.useEffect)(()=>{c(),o();let e=setInterval(o,12e4),s=setInterval(c,3e4);return()=>{clearInterval(e),clearInterval(s)}},[c,o]);let d=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",m=e=>e?{color:e}:{};return i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.aR,{className:"pb-3",children:(0,t.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(P.A,{className:"h-4 w-4"}),"Online Friends"]})}),(0,t.jsx)($.Wu,{className:"pt-0",children:(0,t.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.aR,{className:"pb-3",children:(0,t.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(eo.A,{className:"h-4 w-4 text-green-500"}),"Online (",a.length,")"]})}),(0,t.jsx)($.Wu,{className:"pt-0",children:0===a.length?(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)(P.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No friends online"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:"Add friends to see them here"})]}):(0,t.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-1.5 rounded hover:bg-muted/30 transition-colors",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),(0,t.jsxs)("span",{className:e.has_gold_animation?d(void 0,!0):"text-xs",style:e.has_gold_animation?{}:m(e.name_color),children:["@",e.username]})]},e.id))})})]})}function em(e){var s;let{currentUserId:a,onViewAllPolls:r}=e,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[m,x]=(0,l.useState)(!1),u=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls/recent?userId=".concat(a));if(e.ok){let s=await e.json();c(s.poll)}}catch(e){console.error("Failed to fetch recent poll:",e)}finally{d(!1)}},[a]);(0,l.useEffect)(()=>{u()},[u]);let g=async e=>{if(i&&!m){x(!0);try{let s=await fetch("/api/polls/".concat(i.id,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:e})});if(s.ok)await u();else{let e=await s.json();console.error("Failed to vote:",e.error)}}catch(e){console.error("Failed to vote:",e)}finally{x(!1)}}},p=(e,s)=>0===s?0:Math.round(e/s*100);if(o)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.aR,{className:"pb-3",children:(0,t.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,t.jsx)($.Wu,{className:"pt-0",children:(0,t.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]});if(!i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.aR,{className:"pb-3",children:(0,t.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,t.jsx)($.Wu,{className:"pt-0",children:(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)(h.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"No polls available"}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",className:"mt-2 h-7 text-xs",onClick:r,children:"View All Polls"})]})})]});let f=void 0!==i.user_response,j=!!(s=i.expires_at)&&new Date(s)<new Date;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.aR,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-xs h-6 px-2",children:"View All"})]})}),(0,t.jsxs)($.Wu,{className:"pt-0 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-xs",children:i.title}),i.description&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:i.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[i.is_public?(0,t.jsx)(v.A,{className:"h-3 w-3"}):(0,t.jsx)(P.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[i.total_responses," votes"]}),i.expires_at&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(R.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:j?"text-red-500":"",children:j?"Expired":"".concat(new Date(i.expires_at).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[i.options.slice(0,2).map((e,s)=>{let a=i.results.find(e=>e.option_index===s),l=p((null==a?void 0:a.count)||0,i.total_responses),r=i.user_response===s;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)(n.$,{variant:r?"default":"outline",size:"sm",className:"flex-1 justify-start text-xs h-6 px-2 ".concat(r?"bg-foreground text-background":""),onClick:()=>!f&&!j&&!m&&g(s),disabled:f||j||m,children:(0,t.jsx)("span",{className:"flex-1 text-left truncate",children:e})}),f&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground min-w-[35px] text-right",children:[l,"%"]})]}),f&&(0,t.jsx)("div",{className:"w-full bg-muted/30 rounded-full h-0.5",children:(0,t.jsx)("div",{className:"h-0.5 rounded-full transition-all duration-500 ".concat(r?"bg-foreground":"bg-muted-foreground/40"),style:{width:"".concat(l,"%")}})})]},s)}),i.options.length>2&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground/60 text-center",children:["+",i.options.length-2," more"]})]})]})]})}var ex=a(8725);function eh(e){let{onClose:s,onMessageClick:a}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>{r.trim().length>=2?x():o([])},500);return()=>clearTimeout(e)},[r]);let x=async()=>{m(!0);try{let e=await fetch("/api/messages/search?q=".concat(encodeURIComponent(r.trim())));if(e.ok){let s=await e.json();o(s.messages||[])}}catch(e){console.error("Failed to search messages:",e)}finally{m(!1)}},h=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",u=e=>e?{color:e}:{},g=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=e=>"global"===e.chat_type?"Global Chat":"dm"===e.chat_type?"Direct Message":"Group Chat";return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)($.Zp,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[(0,t.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(ex.A,{className:"h-5 w-5"}),"Search Messages"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,t.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)($.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(E.p,{value:r,onChange:e=>i(e.target.value),placeholder:"Search messages...",className:"flex-1",autoFocus:!0}),d&&(0,t.jsx)("div",{className:"flex items-center px-3",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:r.trim().length<2?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(ex.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Type at least 2 characters to search"})]}):0!==c.length||d?c.map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>{null==a||a(e.chat_type,e.chat_id),s()},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsxs)("span",{className:e.has_gold_animation?h(void 0,!0):"text-sm font-medium",style:e.has_gold_animation?{}:u(e.name_color),children:["@",e.username]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:p(e)}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:g(e.created_at)})]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"image"===e.message_type?"\uD83D\uDCF7 Shared an image":e.content})]},e.id)):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(B.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsxs)("p",{children:['No messages found for "',r,'"']})]})})]})]})})}var eu=a(2548),eg=a(4188);function ep(){let e=(0,r.useRouter)(),[s,a]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{localStorage.getItem("seen-mode-gate")||a(!0)}catch(e){}},[]),(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem("refreshed-after-auth");"/dashboard"!==location.pathname&&"/dashboard/lite"!==location.pathname||e||(sessionStorage.setItem("refreshed-after-auth","1"),location.reload())}catch(e){}},[]);let i=s=>{try{localStorage.setItem("seen-mode-gate","1")}catch(e){}"lite"===s?e.push("/dashboard/lite"):e.push("/dashboard")};return s?(0,t.jsx)("div",{className:"fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-[90%] max-w-md border",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Choose your experience"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Pick a UI mode. You can change this later in Settings."}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("button",{onClick:()=>i("lite"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:"Lite"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Minimal and fast. Global chat, Friends, DMs, Settings, Group Chats."})]}),(0,t.jsxs)("button",{onClick:()=>i("full"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:"Full"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Full experience with entertainment, voice, polls, and more."})]})]})]})}):null}var ef=a(5501);function ej(e){var s,a;let{isOpen:r,onClose:i}=e,[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(""),[u,g]=(0,l.useState)(null),{user:p}=(0,Y.J)(),f=(null==p?void 0:p.signup_code)==="qwea";(0,l.useEffect)(()=>{r&&j()},[r]),(0,l.useEffect)(()=>{let e=()=>{f?j():h("AI features are temporarily unavailable. Gold members can add new API keys.")};return window.addEventListener("geminiKeyExhausted",e),()=>window.removeEventListener("geminiKeyExhausted",e)},[f]);let j=()=>{g((0,ef.BW)())},v=async()=>{if(!c.trim()){h("Please enter a valid API key");return}m(!0),h("");try{let e=await (0,ef.eE)(c,(null==p?void 0:p.username)||"Unknown");e.success?(h("API key added successfully! \uD83C\uDF89"),o(""),j()):h(e.message)}catch(e){h("Error adding API key. Please try again.")}finally{m(!1)}};return r?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Gemini API Key Management"}),!f&&(0,t.jsx)("div",{className:"text-red-600 mb-4",children:"Only gold members can add or manage Gemini API keys."}),(null==u?void 0:u.error)&&(0,t.jsx)("div",{className:"text-red-600 mb-2",children:u.error}),!(null==u?void 0:u.hasAvailableKeys)&&(0,t.jsx)("div",{className:"text-yellow-600 mb-2",children:"No available Gemini API keys. Please add a new one to restore AI features for all users."}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Current keys: ",null!==(s=null==u?void 0:u.totalKeys)&&void 0!==s?s:0]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Exhausted keys: ",null!==(a=null==u?void 0:u.exhaustedKeys)&&void 0!==a?a:0]})]}),f&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 mb-2",placeholder:"Enter Gemini API key (starts with AIza)",value:c,onChange:e=>o(e.target.value),disabled:d}),(0,t.jsx)(n.$,{onClick:v,disabled:d,className:"w-full mb-2",children:d?"Adding...":"Add API Key"}),(0,t.jsx)(n.$,{onClick:()=>{j(),h("Key status refreshed")},variant:"outline",className:"w-full",children:"Refresh Key Status"})]}),x&&(0,t.jsx)("div",{className:"text-sm text-blue-600 mb-2",children:x}),(0,t.jsx)(n.$,{onClick:i,variant:"secondary",className:"w-full mt-2",children:"Close"})]})}):null}function ev(){var e,s;let{user:a,loading:c,setUser:o}=(0,Y.J)(),{theme:d,setTheme:m}=(0,i.D)(),[h,u]=(0,l.useState)("dashboard"),[g,p]=(0,l.useState)([]),[f,j]=(0,l.useState)({type:null,name:""}),[b,y]=(0,l.useState)(!1),[N,w]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[S,E]=(0,l.useState)(!1),[T,D]=(0,l.useState)(null),[O,Z]=(0,l.useState)(!1),q=(0,r.useRouter)(),G=(0,l.useCallback)(async()=>{if(a)try{let e=await fetch("/api/group-chats");if(e.ok){let s=await e.json();p(s.groupChats)}else console.error("Failed to fetch group chats:",e.status,await e.text())}catch(e){console.error("Failed to fetch group chats:",e)}},[a]);(0,l.useEffect)(()=>{!c&&a&&G()},[c,a,G]),(0,l.useEffect)(()=>{let e=e=>{let{type:s,id:a,name:t}=e.detail;j({type:s,id:a,name:t})};return window.addEventListener("navigateToChat",e),()=>{window.removeEventListener("navigateToChat",e)}},[]),(0,l.useEffect)(()=>{let e=()=>{(null==a?void 0:a.signup_code)==="qwea"&&Z(!0)};return window.addEventListener("geminiKeyExhausted",e),()=>{window.removeEventListener("geminiKeyExhausted",e)}},[a]);let J=async(e,s)=>{try{let a=await fetch("/api/group-chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,memberIds:s})});if(a.ok){let e=await a.json();p(s=>[e.groupChat,...s]),y(!1),j({type:"group",id:e.groupChat.id,name:e.groupChat.name}),u("dashboard"),e.groupChat.short_code&&alert("Group chat created! Share this code with others: ".concat(e.groupChat.short_code))}else console.error("Failed to create group chat:",a.status,await a.text())}catch(e){console.error("Failed to create group chat:",e)}},B=async e=>{if(a&&confirm("Are you sure you want to delete this group chat? This action cannot be undone."))try{let s=await fetch("/api/group-chats/".concat(e),{method:"DELETE"});if(s.ok)console.log("Group chat ".concat(e," deleted successfully.")),G(),"group"===f.type&&f.id===e&&j({type:null,name:""});else{let e=await s.json();console.error("Failed to delete group chat:",e.error||s.statusText),alert("Failed to delete group chat: ".concat(e.error||s.statusText))}}catch(e){console.error("Failed to delete group chat:",e),alert("An unexpected error occurred while deleting the group chat.")}},K=async()=>{try{let e=await fetch("/api/auth/signout",{method:"POST",credentials:"include"});e.ok?o(null):console.error("Sign out failed:",e.status),window.location.href="/auth"}catch(e){console.error("Failed to sign out:",e),window.location.href="/auth"}},V=(e,s)=>{j({type:"dm",id:e,name:"@".concat(s)}),u("dashboard"),D(null)},H=()=>{j({type:"global",name:"Global Chat"}),u("dashboard"),D(null)},X=async()=>{},en=async()=>{},eo=async e=>{try{let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)alert("Friend request sent!");else{let e=await s.json();alert("Failed to send friend request: ".concat(e.error))}}catch(e){console.error("Failed to send friend request:",e),alert("An error occurred while sending friend request")}};return c?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading..."})}):a?(0,t.jsxs)("div",{className:"relative min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,t.jsx)("div",{className:"fixed inset-0 opacity-[0.02] dark:opacity-[0.05]",style:{backgroundImage:"radial-gradient(circle at 25% 25%, white 1px, transparent 1px),\n                              radial-gradient(circle at 75% 75%, white 1px, transparent 1px)",backgroundSize:"24px 24px"}}),(0,t.jsx)(ep,{}),(0,t.jsx)(A,{currentPage:h,onPageChange:e=>{"settings"===e?q.push("/settings"):"about"===e?q.push("/about"):"movies"===e?(q.push("/movies"),j({type:null,name:""}),D(null)):"games"===e?(q.push("/games"),j({type:null,name:""}),D(null)):"radio"===e?(q.push("/radio"),j({type:null,name:""}),D(null)):(u(e),"dashboard"!==e&&(j({type:null,name:""}),D(null)))},onSignOut:K,onGlobalChatClick:H,onAIChatClick:()=>{j({type:"dm",id:"00000000-0000-0000-0000-00000000000a",name:"real.AI"}),u("dashboard"),D(null)},username:a.username,onThemeCycle:X,onHueCycle:en}),(0,t.jsxs)("div",{className:"relative z-10 pt-20 px-4 pb-6",children:["dashboard"===h&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-1 xl:col-span-1 space-y-6",children:[(0,t.jsxs)($.Zp,{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border border-gray-200/60 dark:border-gray-700/60 shadow-xl rounded-xl",children:[(0,t.jsx)($.aR,{className:"pb-4",children:(0,t.jsxs)($.ZB,{className:"flex items-center justify-between text-base font-medium text-gray-900 dark:text-gray-100",children:[(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(P.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),"Groups"]}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",onClick:()=>E(!0),title:"Search Messages",children:(0,t.jsx)(ex.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",onClick:()=>w(!0),title:"Join Group Chat",children:(0,t.jsx)(x.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-gray-100/60 dark:hover:bg-gray-700/60 transition-colors",onClick:()=>y(!0),title:"Create Group Chat",children:(0,t.jsx)(z.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})})]})]})}),(0,t.jsx)($.Wu,{className:"pt-0",children:0===g.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center",children:(0,t.jsx)(P.A,{className:"h-6 w-6 text-slate-400"})}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"No group chats yet"}),(0,t.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Create one to get started"})]}):(0,t.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,t.jsx)("div",{className:"group",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(n.$,{variant:"ghost",className:"flex-1 justify-start text-left h-auto p-3 rounded-lg transition-all ".concat("group"===f.type&&f.id===e.id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"hover:bg-slate-50 dark:hover:bg-slate-800"),onClick:()=>j({type:"group",id:e.id,name:e.name}),children:(0,t.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(P.A,{className:"h-4 w-4 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium truncate text-slate-900 dark:text-slate-100",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400 truncate",children:["by ",e.creator_username]})]})]})}),(0,t.jsx)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:a.id===e.creator_id&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"h-8 w-8 rounded-full text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900",title:"View Join Requests",children:(0,t.jsx)(R.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>B(e.id),className:"h-8 w-8 rounded-full text-red-600 hover:bg-red-100 dark:hover:bg-red-900",title:"Delete Group Chat",children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})]})})]})},e.id))})})]}),(0,t.jsx)($.Zp,{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border border-gray-200/60 dark:border-gray-700/60 shadow-xl rounded-xl",children:(0,t.jsx)(ed,{currentUserId:a.id})}),(0,t.jsx)($.Zp,{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border border-gray-200/60 dark:border-gray-700/60 shadow-xl rounded-xl",children:(0,t.jsx)(em,{currentUserId:a.id,onViewAllPolls:()=>{u("polls"),D(null)}})})]}),(0,t.jsx)("div",{className:"lg:col-span-3 xl:col-span-4",children:f.type?(0,t.jsx)("div",{className:"h-[calc(100vh-7rem)]",children:(0,t.jsx)(_.l,{chatType:f.type,chatId:f.id,chatName:f.name,currentUserId:a.id,onUserClick:e=>{console.log("[dashboard] User clicked:",e),D(e),u("profile"),j({type:null,name:""})}})}):(0,t.jsx)("div",{className:"h-[calc(100vh-7rem)] flex items-center justify-center",children:(0,t.jsx)($.Zp,{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border border-gray-200/60 dark:border-gray-700/60 shadow-xl rounded-2xl w-full max-w-2xl",children:(0,t.jsxs)($.Wu,{className:"text-center py-16 px-8",children:[(0,t.jsxs)("div",{className:"mb-12",children:[(0,t.jsx)("div",{className:"text-6xl md:text-7xl font-black tracking-tight mb-4",children:(0,t.jsx)("span",{className:"bg-gradient-to-r from-slate-900 to-slate-600 dark:from-slate-100 dark:to-slate-400 bg-clip-text text-transparent",children:"real."})}),(0,t.jsx)("div",{className:"text-lg md:text-xl text-slate-600 dark:text-slate-400 font-light",children:"Where conversations come alive"})]}),(0,t.jsxs)("div",{className:"mb-12 space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-full px-4 py-2 text-sm text-slate-700 dark:text-slate-300",children:["Welcome back, ",(0,t.jsxs)("span",{className:"text-slate-900 dark:text-slate-100 font-semibold",children:["@",a.username]})]})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)(eu._,{large:!0}),(0,t.jsx)(eg.m,{})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-6",children:"Quick Start"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)(n.$,{className:"bg-slate-900 dark:bg-slate-100 hover:bg-slate-800 dark:hover:bg-slate-200 text-white dark:text-slate-900 h-16 flex-col gap-2 text-sm font-semibold shadow-lg",onClick:H,children:[(0,t.jsx)(v.A,{className:"w-5 h-5"}),"Global Chat"]}),(0,t.jsxs)(n.$,{variant:"outline",className:"bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-800 h-16 flex-col gap-2 text-sm font-semibold",onClick:()=>u("friends"),children:[(0,t.jsx)(P.A,{className:"w-5 h-5"}),"Friends"]}),(0,t.jsxs)(n.$,{variant:"outline",className:"bg-white/50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-800 h-16 flex-col gap-2 text-sm font-semibold",onClick:()=>u("channels"),children:[(0,t.jsx)(x.A,{className:"w-5 h-5"}),"Channels"]})]})]})]})})})})]})}),"friends"===h&&a&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(F.r,{currentUserId:a.id,onStartDM:V,onShowProfile:e=>{D(e),u("profile")}})}),"dms"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(I.s,{currentUserId:a.id,onSelectDM:V})}),"polls"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(L,{currentUserId:a.id,userSignupCode:a.signup_code})}),"channels"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(U,{currentUserId:a.id,userSignupCode:a.signup_code,onSelectChannel:(e,s)=>{j({type:"channel",id:e,name:"# ".concat(s)}),u("dashboard"),D(null)}})}),"calendar"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(W,{currentUserId:a.id})}),"voice"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(ee,{})}),"movies"===h&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(es.default,{})}),"games"===h&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(et.A,{})}),"radio"===h&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(ea.default,{})}),"profile"===h&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(Q,{userId:null!=T?T:void 0,onStartDM:V,onSendFriendRequest:eo})})]}),(0,t.jsx)(el,{currentUserId:a.id}),b&&a&&(0,t.jsx)(er.o,{onClose:()=>y(!1),onCreate:J}),N&&(0,t.jsx)(ei,{onClose:()=>w(!1),onJoinSuccess:e=>{alert("Join request sent to ".concat(e.name,"! The creator will be notified.")),G()}}),k&&(0,t.jsx)(ec,{groupChatId:(null===(e=g.find(e=>e.creator_id===(null==a?void 0:a.id)))||void 0===e?void 0:e.id)||"",groupChatName:(null===(s=g.find(e=>e.creator_id===(null==a?void 0:a.id)))||void 0===s?void 0:s.name)||"",onClose:()=>C(!1),onRequestProcessed:()=>{G()}}),S&&(0,t.jsx)(eh,{onClose:()=>E(!1),onMessageClick:(e,s)=>{if("global"===e)j({type:"global",name:"Global Chat"});else if("dm"===e)j({type:"dm",id:s,name:"Direct Message"});else if("group"===e){let e=g.find(e=>e.id===s);j({type:"group",id:s,name:(null==e?void 0:e.name)||"Group Chat"})}u("dashboard"),D(null)}}),(0,t.jsx)(ej,{isOpen:O,onClose:()=>Z(!1)})]}):null}},9370:(e,s,a)=>{"use strict";a.d(s,{n:()=>x});var t=a(2432),l=a(364),r=a(3966),i=a(2708),n=a(7382),c=a(8055),o=a(3748),d=a(7700),m=a(2815);function x(e){let{roomId:s,userId:a,signalingUrl:x="https://realtalk-voice-server.onrender.com"}=e,[h,u]=(0,l.useState)(!1),[g,p]=(0,l.useState)(!1),[f,j]=(0,l.useState)([]),v=(0,l.useRef)(null),b=(0,l.useRef)(new Map),y=(0,l.useRef)(new Map),N=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let l=await fetch("/api/users/me",{cache:"no-store"});if(l.ok){var t;let e=await l.json();if(null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.is_frozen)return}v.current=await navigator.mediaDevices.getUserMedia({audio:!0});let i=(0,r.Ay)(x,{transports:["websocket"]});N.current=i,i.on("connect",()=>u(!0)),i.on("disconnect",()=>u(!1)),i.emit("join-room",{roomId:s,userId:a}),i.on("room-peers",s=>{e&&(j(s),s.forEach(e=>{let{socketId:s}=e;return c(s)}))}),i.on("user-joined",s=>{let{socketId:a,userId:t}=s;e&&j(e=>e.concat([{socketId:a,userId:t}]))}),i.on("user-left",s=>{let{socketId:a}=s;if(!e)return;j(e=>e.filter(e=>e.socketId!==a));let t=y.current.get(a);null==t||t.close(),y.current.delete(a);let l=b.current.get(a);l&&(l.srcObject=null,l.remove(),b.current.delete(a))}),i.on("signal-offer",async e=>{let{from:s,description:a}=e,t=await n(s);await t.setRemoteDescription(a);let l=await t.createAnswer();await t.setLocalDescription(l),i.emit("signal-answer",{to:s,description:t.localDescription})}),i.on("signal-answer",async e=>{let{from:s,description:a}=e,t=await n(s);await t.setRemoteDescription(a)}),i.on("signal-ice-candidate",async e=>{let{from:s,candidate:a}=e,t=await n(s);try{await t.addIceCandidate(a)}catch(e){}});let n=async e=>{var s;let a=y.current.get(e);return a||(a=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),y.current.set(e,a),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>a.addTrack(e,v.current)),a.ontrack=s=>{let[a]=s.streams,t=b.current.get(e);t||((t=new Audio).autoplay=!0,b.current.set(e,t)),t.srcObject=a},a.onicecandidate=s=>{s.candidate&&i.emit("signal-ice-candidate",{to:e,candidate:s.candidate})}),a},c=async e=>{let s=await n(e),a=await s.createOffer();await s.setLocalDescription(a),i.emit("signal-offer",{to:e,description:s.localDescription})}}catch(e){console.error("voice init error",e)}})(),()=>{var s;e=!1;let a=N.current;try{null==a||a.emit("leave-room"),null==a||a.disconnect()}catch(e){}y.current.forEach(e=>e.close()),y.current.clear(),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>e.stop())}},[s,a,x]),(0,t.jsxs)(n.Zp,{className:"glass-effect",children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5"})," Voice Room"]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",h?"Connected":"Connecting..."," • Peers: ",f.length]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.$,{onClick:()=>{p(e=>{var s;let a=!e;return null===(s=v.current)||void 0===s||s.getAudioTracks().forEach(e=>e.enabled=!a),a})},variant:g?"destructive":"default",children:[g?(0,t.jsx)(o.A,{className:"h-4 w-4 mr-1"}):(0,t.jsx)(d.A,{className:"h-4 w-4 mr-1"}),g?"Unmute":"Mute"]}),(0,t.jsxs)(i.$,{onClick:()=>location.reload(),variant:"outline",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Leave"]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[4812,7,2261,2354,8279,6345,5849,3215,1163,5022,5575,7358],()=>s(5564)),_N_E=e.O()}]);