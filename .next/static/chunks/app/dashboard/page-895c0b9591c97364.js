(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{2681:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eF});var a=t(2432),r=t(364),l=t(9262),n=t(7328),i=t(2708),o=t(1238),c=t(4963);let d=o.bL,m=o.l9,u=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:l=4,...n}=e;return(0,a.jsx)(o.ZL,{children:(0,a.jsx)(o.UC,{ref:s,align:r,sideOffset:l,className:(0,c.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})});u.displayName=o.UC.displayName;var h=t(6939),x=t(7693),f=t(5588),p=t(9861),g=t(9920),j=t(8055),v=t(8452),b=t(4010),y=t(4652),N=t(2121),w=t(1194),_=t(3394),k=t(6230),C=t(8175),S=t(4504),A=t(2664),F=t(4260);function T(e){let{currentPage:s,onPageChange:t,onSignOut:l,onGlobalChatClick:n,onAIChatClick:o,username:c,onThemeCycle:T,onHueCycle:D}=e,[I,E]=(0,r.useState)(!1),[R,$]=(0,r.useState)(!1),z=[{id:"dashboard",label:"Dashboard",icon:h.A},{id:"friends",label:"Friends",icon:x.A},{id:"dms",label:"DMs",icon:f.A},{id:"channels",label:"Channels",icon:p.A},{id:"polls",label:"Polls",icon:g.A},{id:"voice",label:"Voice",icon:j.A},{id:"calendar",label:"Calendar",icon:v.A},{id:"profile",label:"Profile",icon:b.A},{id:"settings",label:"Settings",icon:y.A},{id:"about",label:"About",icon:N.A}],P=e=>{R||($(!0),E(e),setTimeout(()=>$(!1),300))},L=e=>{"global"===e?n():"ai-chat"===e?o():t(e)};return(0,a.jsx)("div",{className:"fixed z-50 transition-all duration-300 top-4 left-1/2 -translate-x-1/2",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-gray-900 via-black to-gray-900 dark:from-gray-800 dark:via-gray-900 dark:to-gray-800 text-white rounded-full transition-all duration-300 ease-out backdrop-blur-md border border-gray-700 dark:border-gray-600 ".concat(I?"px-4 py-2 min-w-[750px] shadow-2xl scale-105":"px-8 py-4 w-fit shadow-xl hover:shadow-2xl hover:scale-102"),onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),style:{background:I?"linear-gradient(135deg, rgba(17,24,39,0.95) 0%, rgba(0,0,0,0.98) 50%, rgba(17,24,39,0.95) 100%)":"linear-gradient(135deg, rgba(0,0,0,0.92) 0%, rgba(17,24,39,0.95) 100%)",boxShadow:I?"0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1)":"0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05)"},children:I?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 py-1",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>L("global"),className:"h-8 w-8 text-white hover:bg-gray-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-gray-600/30",title:"Global",children:(0,a.jsx)(w.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>L("ai-chat"),className:"h-8 w-8 text-white hover:bg-blue-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-blue-600/30",title:"AI Chat",children:(0,a.jsx)(_.A,{className:"h-3 w-3"})}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-600 mx-1"}),z.map(e=>{let t=e.icon,r="channels"===e.id||"dms"===e.id||"polls"===e.id;return(0,a.jsxs)(i.$,{variant:s===e.id?"secondary":"ghost",size:r?"sm":"icon",onClick:()=>L(e.id),className:"h-8 ".concat(r?"px-3":"w-8"," transition-all duration-200 hover:scale-105 rounded-full ").concat(s===e.id?"bg-white text-black hover:bg-gray-100 shadow-lg border border-gray-300":"text-white hover:bg-gray-700/50 border border-gray-600/30"),children:[(0,a.jsx)(t,{className:"h-3 w-3"}),r&&(0,a.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:e.label})]},e.id)}),(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"movies"===s||"games"===s?"secondary":"ghost",size:"sm",className:"h-8 px-3 transition-all duration-200 hover:scale-105 rounded-full ".concat("movies"===s||"games"===s?"bg-white text-black hover:bg-gray-100 shadow-lg border border-gray-300":"text-white hover:bg-gray-700/50 border border-gray-600/30"),title:"Entertainment",children:[(0,a.jsx)(k.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:"Entertainment"})]})}),(0,a.jsx)(u,{className:"w-44 p-2",align:"center",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>L("movies"),className:"justify-start gap-2",children:[(0,a.jsx)(k.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Movies"})]}),(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>L("games"),className:"justify-start gap-2",children:[(0,a.jsx)(C.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Games"})]})]})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-gray-600 mx-1"}),(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:T,className:"h-8 w-8 text-white hover:bg-purple-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-purple-600/30",title:"Toggle Theme",children:(0,a.jsx)(S.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:D,className:"h-8 w-8 text-white hover:bg-purple-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-purple-600/30",title:"Cycle Color",children:(0,a.jsx)(A.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:l,className:"h-8 w-8 text-white hover:bg-red-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-red-600/30",title:"Sign out",children:(0,a.jsx)(F.A,{className:"h-3 w-3"})})]}):(0,a.jsxs)("div",{className:"flex items-center gap-3 transition-all duration-200",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,a.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-green-400 rounded-full animate-ping opacity-30"})]}),(0,a.jsx)("span",{className:"text-lg font-bold tracking-wide bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent",children:"real."}),(0,a.jsxs)("span",{className:"text-xs text-gray-300 opacity-80 font-medium",children:["@",c]})]})})})}var D=t(6127),I=t(4311),E=t(3702),R=t(4314),$=t(7709);function z(e){let{message:s,currentUserId:t,currentUserHasGold:l=!1,onAddReaction:n,onRemoveReaction:o,onReply:c,onDelete:d,onUserClick:m}=e,[u,h]=(0,r.useState)(!1),[x,f]=(0,r.useState)(!1),p=s.sender_id===t,g=s.is_ai_response,j=e=>{var t;(null===(t=s.reactions)||void 0===t?void 0:t.find(s=>s.emoji===e&&s.reacted_by_me))?null==o||o(s.id,e):null==n||n(s.id,e),h(!1)};return(0,a.jsx)("div",{className:"flex ".concat(p?"justify-end":"justify-start"," mb-4 group"),children:(0,a.jsxs)("div",{className:"max-w-[70%] ".concat(p?"order-2":"order-1"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 ".concat(p?"justify-end":"justify-start"),children:[(0,a.jsx)("span",{className:"".concat(g?"text-blue-500 font-medium":s.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":(s.name_color,"font-medium")," ").concat(g||p?"":"cursor-pointer hover:underline"),style:s.name_color&&!s.has_gold_animation?{color:s.name_color}:{},onClick:()=>{!g&&m&&s.sender_id!==t&&m(s.sender_id)},children:g?"AI Assistant":s.username}),s.custom_title&&(0,a.jsx)("span",{className:"text-xs italic text-gray-500",children:s.custom_title}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.parent_message_id&&s.parent_message_content&&s.parent_message_username&&(0,a.jsxs)("div",{className:"mb-1 p-2 bg-gray-100 dark:bg-gray-800 border-l-4 border-blue-400 rounded-r-md text-xs text-gray-600 dark:text-gray-300 italic",children:["Replying to @",s.parent_message_username,': "',s.parent_message_content,'"']}),(0,a.jsx)("div",{className:"px-4 py-2 rounded-2xl ".concat(p?"bg-black dark:bg-gray-700 text-white":g?"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-800"),children:"image"===s.message_type?(0,a.jsx)("div",{className:"relative max-w-sm",children:x?(0,a.jsx)("div",{className:"w-64 h-48 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Failed to load image"})}):(0,a.jsx)($.default,{src:s.content||"/placeholder.svg",alt:"Shared image",width:400,height:300,className:"rounded-lg object-cover max-h-80 w-auto",onError:()=>f(!0),priority:!1,quality:85})}):(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.content})}),s.reactions&&s.reactions.length>0&&(0,a.jsx)("div",{className:"flex gap-1 mt-1",children:s.reactions.map(e=>(0,a.jsxs)(i.$,{variant:"outline",size:"sm",className:"h-6 px-2 rounded-full text-xs ".concat(e.reacted_by_me?"bg-blue-100 dark:bg-blue-900/50 border-blue-400":"bg-gray-50 dark:bg-gray-800"),onClick:()=>j(e.emoji),children:[e.emoji," ",e.count]},e.emoji))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity relative",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>h(!u),children:(0,a.jsx)(D.A,{className:"h-3 w-3"})}),c&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>c(s),children:(0,a.jsx)(I.A,{className:"h-3 w-3"})}),(p||l)&&d&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-red-500 hover:bg-red-500/10",onClick:()=>{confirm("Are you sure you want to delete this message?")&&(null==d||d(s.id))},children:(0,a.jsx)(E.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,a.jsx)(R.A,{className:"h-3 w-3"})}),u&&(0,a.jsx)("div",{className:"absolute bottom-full left-0 mb-2 flex gap-1 p-2 bg-white dark:bg-gray-800 border rounded-lg shadow-lg z-10",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"].map(e=>(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>j(e),children:e},e))})]})]})})}var P=t(7304),L=t(1823),Z=t(151),O=t(7523),U=t(2539);let M=["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"];function q(e){let{onSendMessage:s,placeholder:t="Type a message...",disabled:l=!1,replyToMessage:n,onClearReply:o}=e,[c,h]=(0,r.useState)(""),[x,f]=(0,r.useState)(!1),p=(0,r.useRef)(null),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{n&&g.current&&g.current.focus()},[n]);let j=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){f(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(a.name)),{method:"POST",body:a});if(e.ok){let t=await e.json();s(t.url,null==n?void 0:n.id,"image"),null==o||o()}else{let s=await e.json();console.error("Image upload failed:",s.error||e.statusText),alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{f(!1),p.current&&(p.current.value="")}}},v=e=>{var s;h(s=>s+e),null===(s=g.current)||void 0===s||s.focus()};return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c.trim()&&!l&&(s(c.trim(),null==n?void 0:n.id,"text"),h(""),null==o||o())},className:"flex flex-col p-4 border-t bg-white",children:[n&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 mb-2 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-800",children:[(0,a.jsxs)("div",{className:"flex-1 truncate",children:["Replying to ",(0,a.jsxs)("span",{className:"font-semibold",children:["@",n.username]}),': "',n.content,'"']}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:o,className:"h-6 w-6 p-0 ml-2",children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",ref:p,onChange:j,className:"hidden",disabled:l||x}),(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",className:"shrink-0",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},disabled:l||x,children:x?(0,a.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):(0,a.jsx)(Z.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(P.p,{ref:g,value:c,onChange:e=>h(e.target.value),placeholder:t,disabled:l||x,className:"pr-10 border-gray-200 focus:border-gray-400 transition-colors"}),(0,a.jsxs)(d,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0",disabled:l||x,children:(0,a.jsx)(O.A,{className:"h-4 w-4"})})}),(0,a.jsx)(u,{className:"w-64 p-2 grid grid-cols-6 gap-1",children:M.map(e=>(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>v(e),children:e},e))})]})]}),(0,a.jsx)(i.$,{type:"submit",disabled:!c.trim()||l||x,size:"sm",className:"shrink-0 bg-black hover:bg-gray-800 text-white",children:(0,a.jsx)(U.A,{className:"h-4 w-4"})})]})]})}var B=t(7616),W=t(9815);function G(e){let{chatType:s,chatId:t,chatName:l,currentUserId:n,onUserClick:o}=e,[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(!1),[f,p]=(0,r.useState)(null),[g,j]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),y=(0,r.useRef)(null),N=(0,r.useRef)(null),w=(0,r.useRef)([]),{user:_}=(0,B.J)();(0,r.useEffect)(()=>{w.current=c},[c]);let k=()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),j(!1),b(!1)},C=(0,r.useCallback)(async()=>{try{let e=new URLSearchParams({chatType:s});t&&e.append("chatId",t);let a=await fetch("/api/messages?".concat(e));if(!a.ok){console.error("Failed to fetch messages:",a.status,await a.text());return}let r=await a.json();if(r.messages){let e=new Set(w.current.map(e=>e.id)),s=r.messages.filter(s=>!e.has(s.id));d(r.messages),s.length>0&&g&&b(!0),_&&_.notifications_enabled&&s.length>0&&s.forEach(e=>{if(e.sender_id!==n){let s="dm"===e.chat_type?"New DM from ".concat(e.username):"group"===e.chat_type||"channel"===e.chat_type?"New message in ".concat(l):"New global message from ".concat(e.username);if("Notification"in window&&"granted"===Notification.permission)try{let t=new Notification(s,{body:"image"===e.message_type?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content,icon:"/favicon.png",tag:"".concat(e.chat_type,"-").concat(e.chat_id||"global"),badge:"/favicon.png",requireInteraction:!1,silent:!1});setTimeout(()=>{t.close()},5e3),t.onclick=()=>{window.focus(),t.close()}}catch(e){console.warn("Failed to show notification:",e)}}})}}catch(e){console.error("Failed to fetch messages:",e)}finally{u(!1)}},[s,t,_,n,l,g]);(0,r.useEffect)(()=>{!m&&c.length>0&&setTimeout(()=>{k()},100)},[m]),(0,r.useEffect)(()=>{C();let e=setInterval(C,2e3);return()=>clearInterval(e)},[s,t,C]);let S=async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text";x(!0);try{let l=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e,chatType:s,chatId:t,parentMessageId:a,messageType:r})});if(l.ok){let e=!N.current||N.current.scrollHeight-N.current.scrollTop-N.current.clientHeight<100;await C(),e&&setTimeout(()=>{k()},100)}else console.error("Failed to send message:",l.status,await l.text())}catch(e){console.error("Failed to send message:",e)}finally{x(!1)}},A=async(e,s)=>{try{let t=await fetch("/api/messages/".concat(e,"/reactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?C():console.error("Failed to add reaction:",t.status,await t.text())}catch(e){console.error("Failed to add reaction:",e)}},F=async(e,s)=>{try{let t=await fetch("/api/messages/".concat(e,"/reactions"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?C():console.error("Failed to remove reaction:",t.status,await t.text())}catch(e){console.error("Failed to remove reaction:",e)}},T=e=>{p(e)},D=async e=>{try{let s=await fetch("/api/messages/".concat(e,"/delete"),{method:"DELETE"});if(s.ok)C();else{let e=await s.json();console.error("Failed to delete message:",e.error),alert("Failed to delete message: ".concat(e.error))}}catch(e){console.error("Failed to delete message:",e),alert("An error occurred while deleting the message")}};return m?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading messages..."})}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full bg-card rounded-lg shadow-md overflow-hidden border relative",children:[(0,a.jsxs)("div",{className:"border-b p-4 bg-card",children:[(0,a.jsx)("h2",{className:"font-medium text-card-foreground",children:l}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"global"===s?"Global chat • Everyone can see your messages":"group"===s?"Group chat":"channel"===s?"Channel":"Direct message"})]}),(0,a.jsxs)("div",{ref:N,className:"flex-1 overflow-y-auto p-4 space-y-1 bg-background",onScroll:()=>{if(!N.current)return;let{scrollTop:e,scrollHeight:s,clientHeight:t}=N.current,a=s-e-t<100;j(!a),a&&b(!1)},children:[0===c.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)("p",{children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Start the conversation!"})]})}):c.map(e=>(0,a.jsx)(z,{message:e,currentUserId:n,currentUserHasGold:(null==_?void 0:_.has_gold_animation)||!1,onAddReaction:A,onRemoveReaction:F,onReply:T,onDelete:D,onUserClick:o},e.id)),(0,a.jsx)("div",{ref:y})]}),g&&(0,a.jsx)("div",{className:"absolute bottom-20 right-4 z-10",children:(0,a.jsxs)(i.$,{onClick:k,className:"rounded-full w-12 h-12 shadow-lg transition-all duration-200 hover:scale-110 ".concat(v?"bg-blue-500 hover:bg-blue-600 animate-pulse":"bg-gray-600 hover:bg-gray-700"),size:"sm",children:[(0,a.jsx)(W.A,{className:"h-5 w-5"}),v&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"})]})}),(0,a.jsx)("div",{className:"bg-card border-t",children:(0,a.jsx)(q,{onSendMessage:S,placeholder:"Message ".concat(l,"..."),disabled:h,replyToMessage:f?{id:f.id,content:f.content,username:f.username}:void 0,onClearReply:()=>{p(null)}})})]})}var J=t(7382),V=t(7997),H=t(8725),Y=t(3491);function X(e){let{currentUserId:s,onStartDM:t}=e,[l,n]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(!1),[f,p]=(0,r.useState)(!1),[g,j]=(0,r.useState)(null),[v,b]=(0,r.useState)(Date.now()),y=(0,r.useCallback)(async()=>{try{h(!0);let e=await fetch("/api/friends");if(e.ok){let s=await e.json();m(s.friendships),b(Date.now())}else console.error("Failed to fetch friendships:",e.status,await e.text())}catch(e){console.error("Failed to fetch friendships:",e)}finally{h(!1)}},[]);(0,r.useEffect)(()=>{y();let e=setInterval(y,3e3);return()=>clearInterval(e)},[y]);let N=async()=>{if(!l.trim()){c([]),j(null);return}p(!0),j(null);try{console.log("[friends-page] Searching for:",l);let e=await fetch("/api/users/search?q=".concat(encodeURIComponent(l.trim())));if(e.ok){let s=await e.json();console.log("[friends-page] Search results:",s.users),c(s.users||[])}else{let s=await e.json();console.error("Failed to search users:",s.error||e.statusText),j(s.error||"Failed to search users."),c([])}}catch(e){console.error("Failed to search users:",e),j(e.message||"An unexpected error occurred during search."),c([])}finally{p(!1)}};(0,r.useEffect)(()=>{let e=setTimeout(()=>{l.trim()?N():(c([]),j(null))},500);return()=>clearTimeout(e)},[l]);let w=async e=>{j(null);try{console.log("[friends-page] Sending friend request to:",e);let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)console.log("[friends-page] Friend request sent successfully"),y();else{let e=await s.json();console.error("Failed to send friend request:",e.error),j(e.error||"Failed to send friend request.")}}catch(e){console.error("Failed to send friend request:",e),j(e.message||"Something went wrong.")}},_=async(e,s)=>{try{let t=await fetch("/api/friends/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(t.ok)y();else{let e=await t.json();console.error("Failed to respond to friend request:",e.error||t.statusText),alert("Failed to respond: ".concat(e.error||t.statusText))}}catch(e){console.error("Failed to respond to friend request:",e),alert("An unexpected error occurred while responding to request.")}},k=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{},C=e=>{let s=F.some(s=>s.requester_id===e.id||s.addressee_id===e.id),t=S.some(s=>s.requester_id===e.id),a=A.some(s=>s.addressee_id===e.id);return s?{text:"Friends",disabled:!0,variant:"secondary"}:t?{text:"Accept?",disabled:!1,variant:"default"}:a?{text:"Pending",disabled:!0,variant:"outline"}:{text:"Add Friend",disabled:!1,variant:"default"}},S=d.filter(e=>"pending"===e.status&&e.addressee_id===s),A=d.filter(e=>"pending"===e.status&&e.requester_id===s),F=d.filter(e=>"accepted"===e.status);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Friends"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(V.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(v).toLocaleTimeString()]})]})]}),(0,a.jsxs)(J.Zp,{children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(H.A,{className:"h-5 w-5"}),"Find Friends"]})}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P.p,{value:l,onChange:e=>n(e.target.value),placeholder:"Search by username...",className:"transition-all duration-200 focus:scale-102"}),f&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),g&&(0,a.jsx)("div",{className:"text-sm text-destructive text-center p-2 bg-destructive/10 rounded-md animate-fadeIn",children:g}),o.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Found ",o.length," user(s)"]}),o.map(e=>{let s=C(e);return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200",children:[(0,a.jsxs)("span",{className:e.has_gold_animation?k(void 0,!0):"",style:e.has_gold_animation?{}:k(e.name_color),children:["@",e.username]}),(0,a.jsxs)(i.$,{size:"sm",variant:s.variant,onClick:()=>w(e.id),className:"transition-all duration-200 hover:scale-105",disabled:s.disabled,children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-1"}),s.text]})]},e.id)})]}),l.trim()&&0===o.length&&!f&&!g&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500",children:['No users found for "',l,'"']})]})]}),S.length>0&&(0,a.jsxs)(J.Zp,{className:"border-primary/20",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"text-primary",children:["Friend Requests (",S.length,")"]})}),(0,a.jsx)(J.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:S.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-primary/5",children:[(0,a.jsxs)("span",{className:e.requester_has_gold?k(void 0,!0):"",style:e.requester_has_gold?{}:k(e.requester_name_color),children:["@",e.requester_username]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{size:"sm",onClick:()=>_(e.id,"accepted"),className:"bg-green-600 hover:bg-green-700 transition-all duration-200 hover:scale-105",children:(0,a.jsx)(Y.A,{className:"h-4 w-4"})}),(0,a.jsx)(i.$,{size:"sm",variant:"destructive",onClick:()=>_(e.id,"blocked"),className:"transition-all duration-200 hover:scale-105",children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]})]},e.id))})})]}),A.length>0&&(0,a.jsxs)(J.Zp,{children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{children:["Sent Requests (",A.length,")"]})}),(0,a.jsx)(J.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:A.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("span",{className:e.addressee_has_gold?k(void 0,!0):"",style:e.addressee_has_gold?{}:k(e.addressee_name_color),children:["@",e.addressee_username]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground animate-pulse",children:"Pending"})]},e.id))})})]}),(0,a.jsxs)(J.Zp,{children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{children:["Friends (",F.length,")"]})}),(0,a.jsx)(J.Wu,{children:u?(0,a.jsx)("div",{className:"text-center text-muted-foreground py-4 animate-pulse",children:"Loading friends..."}):0===F.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No friends yet. Start by searching for users above!"}):(0,a.jsx)("div",{className:"space-y-2",children:F.map(e=>{let r=e.requester_id===s?{id:e.addressee_id,username:e.addressee_username,name_color:e.addressee_name_color,has_gold:e.addressee_has_gold}:{id:e.requester_id,username:e.requester_username,name_color:e.requester_name_color,has_gold:e.requester_has_gold};return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors duration-200",children:[(0,a.jsxs)("span",{className:r.has_gold?k(void 0,!0):"",style:r.has_gold?{}:k(r.name_color),children:["@",r.username]}),(0,a.jsxs)(i.$,{size:"sm",onClick:()=>t(r.id,r.username),className:"transition-all duration-200 hover:scale-105",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-1"}),"Message"]})]},e.id)})})})]})]})}function K(e){let{currentUserId:s,onSelectDM:t}=e,[l,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(Date.now()),u=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/dms");if(e.ok){let s=await e.json();n(s.dms),m(Date.now())}}catch(e){console.error("Failed to fetch DMs:",e)}finally{c(!1)}},[]);(0,r.useEffect)(()=>{u();let e=setInterval(u,2e3);return()=>clearInterval(e)},[u]);let h=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{},x=e=>{let s=new Date(e),t=(new Date().getTime()-s.getTime())/36e5;return t<1?"Just now":t<24?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()};return o?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading DMs..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Direct Messages"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(V.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(d).toLocaleTimeString()]})]})]}),(0,a.jsxs)(J.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(I.A,{className:"h-5 w-5"}),"Direct Messages"]})}),(0,a.jsx)(J.Wu,{children:0===l.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(I.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 animate-pulse"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No direct messages yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Start a conversation with a friend!"})]}):(0,a.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,a.jsxs)("div",{className:"group flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200 hover:scale-102 animate-slideIn",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>t(e.friend_id,e.friend_username),children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary",children:e.friend_username.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:e.friend_has_gold?h(void 0,!0):"",style:e.friend_has_gold?{}:h(e.friend_name_color),children:["@",e.friend_username]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Last message: ",x(e.last_message_at)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.$,{size:"icon",variant:"ghost",onClick:()=>t(e.friend_id,e.friend_username),title:"Message",children:(0,a.jsx)(f.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})]},e.friend_id))})})]})]})}let Q=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});Q.displayName="Textarea";var ee=t(2660);let es=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ee.bL,{ref:s,className:(0,c.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,a.jsx)(ee.C1,{className:(0,c.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(Y.A,{className:"h-4 w-4"})})})});es.displayName=ee.bL.displayName;var et=t(5009),ea=t(3079),er=t(5213),el=t(4329);function en(e){let{currentUserId:s,userSignupCode:t}=e,[l,n]=(0,r.useState)([]),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!0),[x,f]=(0,r.useState)(null),[p,j]=(0,r.useState)(""),[v,b]=(0,r.useState)(""),[y,N]=(0,r.useState)(["",""]),[_,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)([]),[A,F]=(0,r.useState)(""),T=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/polls");if(e.ok){let s=await e.json();console.log("[polls-page] Fetched polls:",s.polls),n(s.polls)}else console.error("[polls-page] Failed to fetch polls:",e.status)}catch(e){console.error("Failed to fetch polls:",e)}finally{h(!1)}},[]),D=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,r.useEffect)(()=>{T(),D()},[T,D]);let I=async()=>{if(p.trim()&&!(y.filter(e=>e.trim()).length<2))try{let e=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p.trim(),description:v.trim()||void 0,options:y.filter(e=>e.trim()),is_public:_,shared_with:C,expires_at:A||void 0})});if(e.ok)m(!1),z(),T();else{let s=await e.json();console.error("Failed to create poll:",s.error),alert("Failed to create poll: ".concat(s.error))}}catch(e){console.error("Failed to create poll:",e),alert("An unexpected error occurred while creating the poll.")}},R=async e=>{if(confirm("Are you sure you want to delete this poll? This action cannot be undone."))try{let s=await fetch("/api/polls/".concat(e),{method:"DELETE"});if(s.ok)T();else{let e=await s.json();alert("Failed to delete poll: ".concat(e.error||s.statusText))}}catch(e){console.error("Failed to delete poll:",e),alert("An unexpected error occurred while deleting the poll.")}},$=async(e,s)=>{console.log("[polls-page] Voting on poll ".concat(e," with option ").concat(s)),f(e);try{let t=await fetch("/api/polls/".concat(e,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:s})});if(t.ok)console.log("[polls-page] Vote successful, refreshing polls"),await T();else{let e=await t.json();console.error("Failed to vote:",e.error),alert("Failed to vote: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Failed to vote:",e),alert("An unexpected error occurred while voting.")}finally{f(null)}},z=()=>{j(""),b(""),N(["",""]),k(!1),S([]),F("")},Z=e=>{y.length>2&&N(y.filter((s,t)=>t!==e))},O=(e,s)=>{let t=[...y];t[e]=s,N(t)},U=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{},M=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),q=e=>!!e&&new Date(e)<new Date,B=(e,s)=>0===s?0:Math.round(e/s*100);return u?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading polls..."})}):(0,a.jsxs)("div",{className:"space-y-6 relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Polls"}),(0,a.jsxs)(i.$,{onClick:()=>m(!0),className:"hover-lift hover-glow",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 mr-2"}),"Create Poll"]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===l.length?(0,a.jsx)(J.Zp,{className:"glass-effect animate-fadeIn",children:(0,a.jsxs)(J.Wu,{className:"text-center py-8",children:[(0,a.jsx)(g.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No polls yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first poll to gather opinions!"})]})}):l.map((e,t)=>{let r=void 0!==e.user_response;return(0,a.jsxs)(J.Zp,{className:"glass-effect hover-lift animate-fadeIn ".concat(q(e.expires_at)?"opacity-75":""),style:{animationDelay:"".concat(.1*t,"s")},children:[(0,a.jsxs)(J.aR,{children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(J.ZB,{className:"text-lg",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.is_public?(0,a.jsx)(w.A,{className:"h-3 w-3 hue-accent"}):(0,a.jsx)(ea.A,{className:"h-3 w-3"}),(0,a.jsx)(er.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[e.total_responses," votes"]}),e.expires_at&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(el.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:q(e.expires_at)?"text-red-500":"",children:q(e.expires_at)?"Expired":"Expires ".concat(M(e.expires_at))})]})]}),e.creator_id===s&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>R(e.id),className:"text-red-500 hover:bg-red-500/10 h-6 w-6 p-0",title:"Delete Poll",children:(0,a.jsx)(E.A,{className:"h-3 w-3"})})]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{className:e.creator_username?U(void 0,!1):"",children:["by @",e.creator_username]}),(0,a.jsxs)("span",{children:[void 0!==e.user_response?"You voted":"Click to vote"," • ",e.total_responses," total votes"]})]})]}),(0,a.jsxs)(J.Wu,{className:"space-y-3",children:[e.options.map((s,t)=>{let l=e.results.find(e=>e.option_index===t),n=(null==l?void 0:l.count)||0,o=B(n,e.total_responses),c=e.user_response===t,d=x===e.id;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.$,{variant:c?"default":"outline",className:"flex-1 justify-start hover-lift transition-all duration-200 ".concat(c?"hue-shadow":""," ").concat(q(e.expires_at)?"":"cursor-pointer"),onClick:()=>!q(e.expires_at)&&!d&&$(e.id,t),disabled:q(e.expires_at)||d,children:[(0,a.jsx)("span",{className:"flex-1 text-left",children:s}),d&&(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin ml-2"})]}),r&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground ml-3 min-w-[60px] text-right",children:[n," (",o,"%)"]})]}),r&&(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-700 ease-out ".concat(c?"bg-gradient-to-r from-blue-500 to-purple-500 hue-shadow":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(o,"%"),backgroundColor:c?"hsl(var(--hue) 60% 50%)":void 0}})})]},t)}),!q(e.expires_at)&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4 opacity-70",children:["Click on an option to ",r?"change your vote":"cast your vote"]})]})]},e.id)})}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(J.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto glass-effect animate-fadeIn",children:[(0,a.jsxs)(J.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(J.ZB,{children:"Create Poll"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.p,{value:p,onChange:e=>j(e.target.value),placeholder:"Poll title",className:"focus:hue-shadow"})}),(0,a.jsx)("div",{children:(0,a.jsx)(Q,{value:v,onChange:e=>b(e.target.value),placeholder:"Description (optional)",rows:2,className:"focus:hue-shadow"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Options"}),y.map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P.p,{value:e,onChange:e=>O(s,e.target.value),placeholder:"Option ".concat(s+1),className:"focus:hue-shadow"}),y.length>2&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>Z(s),children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]},s)),y.length<6&&(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{y.length<6&&N([...y,""])},className:"hover-lift bg-transparent",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P.p,{type:"datetime-local",value:A,onChange:e=>F(e.target.value),className:"focus:hue-shadow"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional expiration date"})]}),"qwea"===t&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3 hue-bg rounded-lg",children:[(0,a.jsx)(es,{id:"public",checked:_,onCheckedChange:k}),(0,a.jsx)("label",{htmlFor:"public",className:"text-sm font-medium",children:"Share with all users (public poll)"})]}),!_&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Share with friends"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(es,{id:e.friend_id,checked:C.includes(e.friend_id),onCheckedChange:s=>{s?S([...C,e.friend_id]):S(C.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:U(e.friend_name_color),children:(0,a.jsxs)("span",{className:U(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{onClick:I,disabled:!p.trim()||y.filter(e=>e.trim()).length<2,className:"flex-1 hover-glow",children:"Create Poll"}),(0,a.jsx)(i.$,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})})]})}function ei(e){let{currentUserId:s,userSignupCode:t,onSelectChannel:l}=e,[n,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[m,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)(""),f="qwea"===t,g=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/channels");if(e.ok){let s=await e.json();o(s.channels)}}finally{d(!1)}},[]);(0,r.useEffect)(()=>{g()},[g]);let j=(0,r.useMemo)(()=>n.filter(e=>e.is_system),[n]),v=(0,r.useMemo)(()=>n.filter(e=>!e.is_system),[n]),b=async e=>{if(!confirm("Delete this channel?"))return;let s=await fetch("/api/channels/".concat(e),{method:"DELETE"});if(s.ok)g();else{let e=await s.json().catch(()=>({}));alert("Failed to delete: ".concat(e.error||s.statusText))}},y=async()=>{if(f&&h.trim()){u(!0);try{let e=await fetch("/api/channels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h.trim()})});if(e.ok)x(""),g();else{let s=await e.json().catch(()=>({}));alert("Failed to create channel: ".concat(s.error||e.statusText))}}finally{u(!1)}}};return c?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading channels..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Channels"}),f&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.p,{value:h,onChange:e=>x(e.target.value),placeholder:"Create a new channel",className:"w-48"}),(0,a.jsxs)(i.$,{onClick:y,disabled:!h.trim()||m,className:"hover-glow",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 mr-1"})," Create"]})]})]}),(0,a.jsxs)(J.Zp,{className:"glass-effect",children:[(0,a.jsx)(J.aR,{children:(0,a.jsx)(J.ZB,{children:"Default"})}),(0,a.jsx)(J.Wu,{className:"space-y-2",children:0===j.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No channels."}):j.map(e=>(0,a.jsxs)(i.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>l(e.id,e.name),children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"})," ",e.name]},e.id))})]}),v.length>0&&(0,a.jsxs)(J.Zp,{className:"glass-effect",children:[(0,a.jsx)(J.aR,{children:(0,a.jsx)(J.ZB,{children:"Created by Gold users"})}),(0,a.jsx)(J.Wu,{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(i.$,{variant:"ghost",className:"flex-1 justify-start",onClick:()=>l(e.id,e.name),children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"})," ",e.name]}),e.creator_id===s&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>b(e.id),className:"text-red-500",children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})]},e.id))})]})]})}var eo=t(6334),ec=t(855);function ed(e){let{currentUserId:s}=e,[t,l]=(0,r.useState)([]),[n,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(new Date),[f,p]=(0,r.useState)(""),[g,j]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[_,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)([]),A=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/calendar");if(e.ok){let s=await e.json();l(s.events)}}catch(e){console.error("Failed to fetch events:",e)}finally{u(!1)}},[]),F=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();o(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,r.useEffect)(()=>{A(),F()},[A,F]);let T=async()=>{if(f.trim()&&b&&N)try{(await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f.trim(),description:g.trim()||void 0,start_time:b,end_time:N,is_collaborative:_,participants:C})})).ok&&(d(!1),D(),A())}catch(e){console.error("Failed to create event:",e)}},D=()=>{p(""),j(""),y(""),w(""),k(!1),S([])},I=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{},E=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=e=>{let s=e.toDateString();return t.filter(e=>new Date(e.start_time).toDateString()===s)},$=e=>{x(s=>{let t=new Date(s);return"prev"===e?t.setMonth(s.getMonth()-1):t.setMonth(s.getMonth()+1),t})},z=e=>{if(!e)return!1;let s=new Date;return e.toDateString()===s.toDateString()};if(m)return(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading calendar..."})});let Z=(e=>{let s=e.getFullYear(),t=e.getMonth(),a=new Date(s,t,1),r=new Date(s,t+1,0).getDate(),l=a.getDay(),n=[];for(let e=0;e<l;e++)n.push(null);for(let e=1;e<=r;e++)n.push(new Date(s,t,e));return n})(h),O=h.toLocaleDateString([],{month:"long",year:"numeric"});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Calendar"}),(0,a.jsxs)(i.$,{onClick:()=>d(!0),children:[(0,a.jsx)(et.A,{className:"h-4 w-4 mr-2"}),"Create Event"]})]}),(0,a.jsxs)(J.Zp,{children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"h-5 w-5"}),O]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>$("prev"),children:(0,a.jsx)(eo.A,{className:"h-4 w-4"})}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>$("next"),children:(0,a.jsx)(ec.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsxs)(J.Wu,{children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:Z.map((e,s)=>{let t=e?R(e):[];return(0,a.jsx)("div",{className:"min-h-[80px] p-1 border rounded-lg ".concat(e?"hover:bg-accent/50 cursor-pointer":""," ").concat(z(e)?"bg-primary/10 border-primary":""),children:e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm font-medium ".concat(z(e)?"text-primary":""),children:e.getDate()}),(0,a.jsxs)("div",{className:"space-y-1",children:[t.slice(0,2).map(e=>(0,a.jsx)("div",{className:"text-xs p-1 bg-primary/20 rounded truncate",title:e.title,children:e.title},e.id)),t.length>2&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]})},s)})})]})]}),(0,a.jsxs)(J.Zp,{children:[(0,a.jsx)(J.aR,{children:(0,a.jsx)(J.ZB,{children:"Upcoming Events"})}),(0,a.jsx)(J.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(el.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No events scheduled"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first event to get started!"})]}):(0,a.jsx)("div",{className:"space-y-3",children:t.filter(e=>new Date(e.start_time)>=new Date).sort((e,s)=>new Date(e.start_time).getTime()-new Date(s.start_time).getTime()).slice(0,5).map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:[E(e.start_time)," - ",E(e.end_time)]}),e.is_collaborative&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(ea.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Collaborative"})]})]})]})}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Created by @",e.creator_username]})]},e.id))})})]}),c&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(J.Zp,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(J.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(J.ZB,{children:"Create Event"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.p,{value:f,onChange:e=>p(e.target.value),placeholder:"Event title"})}),(0,a.jsx)("div",{children:(0,a.jsx)(Q,{value:g,onChange:e=>j(e.target.value),placeholder:"Description (optional)",rows:2})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Start Time"}),(0,a.jsx)(P.p,{type:"datetime-local",value:b,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"End Time"}),(0,a.jsx)(P.p,{type:"datetime-local",value:N,onChange:e=>w(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(es,{id:"collaborative",checked:_,onCheckedChange:k}),(0,a.jsx)("label",{htmlFor:"collaborative",className:"text-sm",children:"Make this a collaborative event"})]}),_&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Invite participants"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:n.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(es,{id:e.friend_id,checked:C.includes(e.friend_id),onCheckedChange:s=>{s?S([...C,e.friend_id]):S(C.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:I(e.friend_name_color),children:(0,a.jsxs)("span",{className:I(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{onClick:T,disabled:!f.trim()||!b||!N,className:"flex-1",children:"Create Event"}),(0,a.jsx)(i.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]})]})})]})}var em=t(1942);function eu(e){let{userId:s,onStartDM:t,onSendFriendRequest:l}=e,{user:n,setUser:o}=(0,B.J)(),[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[h,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[j,v]=(0,r.useState)(!1),[y,N]=(0,r.useState)(""),[w,_]=(0,r.useState)(""),k=!s||s===(null==n?void 0:n.id);(0,r.useEffect)(()=>{(async()=>{if(k&&n)d(n),N(n.bio||""),_(n.profile_picture||"");else if(s)try{let e=await fetch("/api/users/".concat(s));if(e.ok){let s=await e.json();d(s.user)}}catch(e){console.error("Failed to fetch profile:",e)}u(!1)})()},[s,n,k]);let C=async e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){v(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(t.name)),{method:"POST",body:t});if(e.ok){let s=await e.json();_(s.url)}else{let s=await e.json();alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{v(!1)}}},S=async()=>{if(k){g(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile_picture:w||null,bio:y.trim()||null})});if(e.ok){let s=await e.json();o(s.user),d(s.user),f(!1)}else{let s=await e.json();alert("Failed to update profile: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to update profile:",e),alert("An unexpected error occurred while updating profile.")}finally{g(!1)}}},A=e=>e.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e.name_color?{color:e.name_color}:{};return m?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading profile..."})}):c?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:k?"Your Profile":"@".concat(c.username,"'s Profile")}),k&&(0,a.jsx)(i.$,{onClick:()=>f(!h),variant:h?"outline":"default",children:h?"Cancel":"Edit Profile"})]}),(0,a.jsxs)(J.Zp,{className:"glass-effect hover-lift animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"h-5 w-5"}),"Profile Information"]})}),(0,a.jsxs)(J.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"relative",children:[c.profile_picture?(0,a.jsx)($.default,{src:c.profile_picture||"/placeholder.svg",alt:"".concat(c.username,"'s profile"),width:100,height:100,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:(0,a.jsx)(b.A,{className:"h-12 w-12 text-gray-400"})}),h&&(0,a.jsxs)("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-2 cursor-pointer hover:bg-primary/90 transition-colors",children:[(0,a.jsx)(em.A,{className:"h-4 w-4"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:C,className:"hidden",disabled:j})]}),j&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold ".concat(c.has_gold_animation?A(c):""),style:c.has_gold_animation?{}:A(c),children:["@",c.username]}),c.custom_title&&(0,a.jsx)("p",{className:"text-sm italic text-muted-foreground mt-1",children:c.custom_title}),c.signup_code&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:["asdf"===c.signup_code&&"✨ Custom Colors","qwea"===c.signup_code&&"\uD83D\uDC51 Gold Member"]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),h?(0,a.jsx)(Q,{value:y,onChange:e=>N(e.target.value),placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"resize-none"}):(0,a.jsx)("div",{className:"min-h-[100px] p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:c.bio?(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:c.bio}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground italic",children:k?"Add a bio to tell others about yourself":"No bio available"})}),h&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[y.length,"/500 characters"]})]}),(0,a.jsx)("div",{className:"flex gap-3",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.$,{onClick:S,disabled:p,className:"flex-1",children:p?"Saving...":"Save Changes"}),(0,a.jsx)(i.$,{variant:"outline",onClick:()=>f(!1),disabled:p,children:"Cancel"})]}):k?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.$,{onClick:()=>null==t?void 0:t(c.id,c.username),className:"flex-1",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Send Message"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>null==l?void 0:l(c.id),children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Add Friend"]})]})})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Profile not found"})})}var eh=t(3966),ex=t(3748),ef=t(7700),ep=t(2815),eg=t(9266);function ej(e){let{roomId:s,userId:t,signalingUrl:l=eg.env.NEXT_PUBLIC_VOICE_URL||"https://your-voice-server.onrender.com"}=e,[n,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)([]),h=(0,r.useRef)(null),x=(0,r.useRef)(new Map),f=(0,r.useRef)(new Map),p=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{h.current=await navigator.mediaDevices.getUserMedia({audio:!0});let a=(0,eh.Ay)(l,{transports:["websocket"]});p.current=a,a.on("connect",()=>o(!0)),a.on("disconnect",()=>o(!1)),a.emit("join-room",{roomId:s,userId:t}),a.on("room-peers",s=>{e&&(u(s),s.forEach(e=>{let{socketId:s}=e;return n(s)}))}),a.on("user-joined",s=>{let{socketId:t,userId:a}=s;e&&u(e=>e.concat([{socketId:t,userId:a}]))}),a.on("user-left",s=>{let{socketId:t}=s;if(!e)return;u(e=>e.filter(e=>e.socketId!==t));let a=f.current.get(t);null==a||a.close(),f.current.delete(t);let r=x.current.get(t);r&&(r.srcObject=null,r.remove(),x.current.delete(t))}),a.on("signal-offer",async e=>{let{from:s,description:t}=e,l=await r(s);await l.setRemoteDescription(t);let n=await l.createAnswer();await l.setLocalDescription(n),a.emit("signal-answer",{to:s,description:l.localDescription})}),a.on("signal-answer",async e=>{let{from:s,description:t}=e,a=await r(s);await a.setRemoteDescription(t)}),a.on("signal-ice-candidate",async e=>{let{from:s,candidate:t}=e,a=await r(s);try{await a.addIceCandidate(t)}catch(e){}});let r=async e=>{var s;let t=f.current.get(e);return t||(t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),f.current.set(e,t),null===(s=h.current)||void 0===s||s.getTracks().forEach(e=>t.addTrack(e,h.current)),t.ontrack=s=>{let[t]=s.streams,a=x.current.get(e);a||((a=new Audio).autoplay=!0,x.current.set(e,a)),a.srcObject=t},t.onicecandidate=s=>{s.candidate&&a.emit("signal-ice-candidate",{to:e,candidate:s.candidate})}),t},n=async e=>{let s=await r(e),t=await s.createOffer();await s.setLocalDescription(t),a.emit("signal-offer",{to:e,description:s.localDescription})}}catch(e){console.error("voice init error",e)}})(),()=>{var s;e=!1;let t=p.current;try{null==t||t.emit("leave-room"),null==t||t.disconnect()}catch(e){}f.current.forEach(e=>e.close()),f.current.clear(),null===(s=h.current)||void 0===s||s.getTracks().forEach(e=>e.stop())}},[s,t,l]),(0,a.jsxs)(J.Zp,{className:"glass-effect",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"h-5 w-5"})," Voice Room"]})}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",n?"Connected":"Connecting..."," • Peers: ",m.length]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{onClick:()=>{d(e=>{var s;let t=!e;return null===(s=h.current)||void 0===s||s.getAudioTracks().forEach(e=>e.enabled=!t),t})},variant:c?"destructive":"default",children:[c?(0,a.jsx)(ex.A,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(ef.A,{className:"h-4 w-4 mr-1"}),c?"Unmute":"Mute"]}),(0,a.jsxs)(i.$,{onClick:()=>location.reload(),variant:"outline",children:[(0,a.jsx)(ep.A,{className:"h-4 w-4 mr-1"})," Leave"]})]})]})]})}function ev(){let{user:e}=(0,B.J)();return e?(0,a.jsx)(ej,{roomId:"global-voice",userId:e.id}):null}var eb=t(3215),ey=t(3544);function eN(e){return null}function ew(e){let{onClose:s,onCreate:t}=e,[l,n]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0);(0,r.useEffect)(()=>{x()},[]);let x=async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}finally{h(!1)}},f=e=>{m(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},p=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(J.Zp,{className:"w-full max-w-md mx-4",children:[(0,a.jsxs)(J.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(J.ZB,{children:"Create Group Chat"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.p,{value:l,onChange:e=>n(e.target.value),placeholder:"Group chat name"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Add Friends"}),u?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"Loading friends..."}):0===o.length?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No friends to add"}):(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(es,{id:e.friend_id,checked:d.includes(e.friend_id),onCheckedChange:()=>f(e.friend_id)}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:p(e.friend_name_color),children:(0,a.jsxs)("span",{className:p(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{onClick:()=>{l.trim()&&t(l.trim(),d)},disabled:!l.trim(),className:"flex-1",children:"Create Group"}),(0,a.jsx)(i.$,{variant:"outline",onClick:s,children:"Cancel"})]})]})]})})}var e_=t(3868);function ek(e){let{currentUserId:s}=e,[t,l]=(0,r.useState)([]),[n,i]=(0,r.useState)(!0),o=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/users/online");if(e.ok){let s=await e.json();l(s.onlineUsers)}}catch(e){console.error("Failed to fetch online users:",e)}finally{i(!1)}},[]),c=(0,r.useCallback)(async()=>{try{await fetch("/api/user/activity",{method:"POST"})}catch(e){console.error("Failed to update activity:",e)}},[]);(0,r.useEffect)(()=>{o(),c();let e=setInterval(c,12e4),s=setInterval(o,3e4);return()=>{clearInterval(e),clearInterval(s)}},[o,c]);let d=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{};return n?(0,a.jsxs)(J.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"h-5 w-5"}),"Online Friends"]})}),(0,a.jsx)(J.Wu,{children:(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground animate-pulse",children:"Loading..."})})]}):(0,a.jsxs)(J.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(e_.A,{className:"h-5 w-5 text-green-500"}),"Online Friends (",t.length,")"]})}),(0,a.jsx)(J.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-4 text-muted-foreground",children:[(0,a.jsx)(ea.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No online friends"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Add some friends to see them here!"})]}):(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent/50 transition-colors",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,a.jsxs)("span",{className:e.has_gold_animation?d(void 0,!0):"text-sm",style:e.has_gold_animation?{}:d(e.name_color),children:["@",e.username]})]},e.id))})})]})}function eC(e){var s;let{currentUserId:t,onViewAllPolls:l}=e,[n,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[m,u]=(0,r.useState)(!1),h=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/polls/recent?userId=".concat(t));if(e.ok){let s=await e.json();o(s.poll)}}catch(e){console.error("Failed to fetch recent poll:",e)}finally{d(!1)}},[t]);(0,r.useEffect)(()=>{h()},[h]);let x=async e=>{if(n&&!m){u(!0);try{let s=await fetch("/api/polls/".concat(n.id,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:e})});if(s.ok)await h();else{let e=await s.json();console.error("Failed to vote:",e.error)}}catch(e){console.error("Failed to vote:",e)}finally{u(!1)}}},f=(e,s)=>0===s?0:Math.round(e/s*100);if(c)return(0,a.jsxs)(J.Zp,{className:"glass-effect animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),"Latest Poll"]})}),(0,a.jsx)(J.Wu,{children:(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground animate-pulse",children:"Loading..."})})]});if(!n)return(0,a.jsxs)(J.Zp,{className:"glass-effect animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),"Latest Poll"]})}),(0,a.jsx)(J.Wu,{children:(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(g.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No polls available"}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",className:"mt-2 bg-transparent hover-lift",onClick:l,children:"View All Polls"})]})})]});let p=void 0!==n.user_response,j=!!(s=n.expires_at)&&new Date(s)<new Date;return(0,a.jsxs)(J.Zp,{className:"glass-effect animate-fadeIn hover-lift ".concat(j?"opacity-75":""),children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),"Latest Poll"]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:l,className:"text-xs hover-lift",children:"View All"})]})}),(0,a.jsxs)(J.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:n.title}),n.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[n.is_public?(0,a.jsx)(w.A,{className:"h-3 w-3 hue-accent"}):(0,a.jsx)(ea.A,{className:"h-3 w-3"}),(0,a.jsx)(er.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[n.total_responses," votes"]}),n.expires_at&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(el.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:j?"text-red-500":"",children:j?"Expired":"Expires ".concat(new Date(n.expires_at).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[n.options.slice(0,2).map((e,s)=>{let t=n.results.find(e=>e.option_index===s),r=(null==t?void 0:t.count)||0,l=f(r,n.total_responses),o=n.user_response===s;return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.$,{variant:o?"default":"outline",size:"sm",className:"flex-1 justify-start text-xs h-7 hover-lift transition-all duration-200 ".concat(o?"hue-shadow":""),onClick:()=>!p&&!j&&!m&&x(s),disabled:p||j||m,children:[(0,a.jsx)("span",{className:"flex-1 text-left",children:e}),m&&(0,a.jsx)("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin ml-1"})]}),p&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-2 min-w-[45px] text-right",children:[r," (",l,"%)"]})]}),p&&(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:(0,a.jsx)("div",{className:"h-1 rounded-full transition-all duration-500 ".concat(o?"hue-bg":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(l,"%"),backgroundColor:o?"hsl(var(--hue) 50% 50%)":void 0}})})]},s)}),n.options.length>2&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["+",n.options.length-2," more options"]})]}),!p&&!j&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-center opacity-70",children:"Click an option to vote"})]})]})}function eS(e){let{onClose:s,onMessageClick:t}=e,[l,n]=(0,r.useState)(""),[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=setTimeout(()=>{l.trim().length>=2?u():c([])},500);return()=>clearTimeout(e)},[l]);let u=async()=>{m(!0);try{let e=await fetch("/api/messages/search?q=".concat(encodeURIComponent(l.trim())));if(e.ok){let s=await e.json();c(s.messages||[])}}catch(e){console.error("Failed to search messages:",e)}finally{m(!1)}},h=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":e?{color:e}:{},x=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=e=>"global"===e.chat_type?"Global Chat":"dm"===e.chat_type?"Direct Message":"Group Chat";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(J.Zp,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)(J.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(J.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(H.A,{className:"h-5 w-5"}),"Search Messages"]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(J.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P.p,{value:l,onChange:e=>n(e.target.value),placeholder:"Search messages...",className:"flex-1",autoFocus:!0}),d&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:l.trim().length<2?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(H.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Type at least 2 characters to search"})]}):0!==o.length||d?o.map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>{null==t||t(e.chat_type,e.chat_id),s()},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:e.has_gold_animation?h(void 0,!0):"text-sm font-medium",style:e.has_gold_animation?{}:h(e.name_color),children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:f(e)}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:x(e.created_at)})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"image"===e.message_type?"\uD83D\uDCF7 Shared an image":e.content})]},e.id)):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsxs)("p",{children:['No messages found for "',l,'"']})]})})]})]})})}let eA=[{id:"blue",name:"Blue"},{id:"purple",name:"Purple"},{id:"pink",name:"Pink"},{id:"red",name:"Red"},{id:"orange",name:"Orange"},{id:"yellow",name:"Yellow"},{id:"green",name:"Green"},{id:"teal",name:"Teal"}];function eF(){let{user:e,loading:s,setUser:t}=(0,B.J)(),{theme:o,setTheme:c}=(0,n.D)(),[d,m]=(0,r.useState)("dashboard"),[u,h]=(0,r.useState)([]),[x,f]=(0,r.useState)({type:null,name:""}),[p,g]=(0,r.useState)(!1),[j,v]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),N=(0,l.useRouter)(),_=(0,r.useCallback)(async()=>{if(e)try{let e=await fetch("/api/group-chats");if(e.ok){let s=await e.json();h(s.groupChats)}else console.error("Failed to fetch group chats:",e.status,await e.text())}catch(e){console.error("Failed to fetch group chats:",e)}},[e]);(0,r.useEffect)(()=>{!s&&e&&_()},[s,e,_]);let k=async(e,s)=>{try{let t=await fetch("/api/group-chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,memberIds:s})});if(t.ok){let e=await t.json();h(s=>[e.groupChat,...s]),g(!1),f({type:"group",id:e.groupChat.id,name:e.groupChat.name}),m("dashboard")}else console.error("Failed to create group chat:",t.status,await t.text())}catch(e){console.error("Failed to create group chat:",e)}},C=async s=>{if(e&&confirm("Are you sure you want to delete this group chat? This action cannot be undone."))try{let e=await fetch("/api/group-chats/".concat(s),{method:"DELETE"});if(e.ok)console.log("Group chat ".concat(s," deleted successfully.")),_(),"group"===x.type&&x.id===s&&f({type:null,name:""});else{let s=await e.json();console.error("Failed to delete group chat:",s.error||e.statusText),alert("Failed to delete group chat: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to delete group chat:",e),alert("An unexpected error occurred while deleting the group chat.")}},S=async()=>{try{let e=await fetch("/api/auth/signout",{method:"POST",credentials:"include"});e.ok?t(null):console.error("Sign out failed:",e.status),window.location.href="/auth"}catch(e){console.error("Failed to sign out:",e),window.location.href="/auth"}},A=(e,s)=>{f({type:"dm",id:e,name:"@".concat(s)}),m("dashboard"),y(null)},F=async()=>{if(!e)return;let s="light"===o?"dark":"light";console.log("[dashboard] Cycling theme from",o,"to",s),c(s);try{let a=await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({theme:s})});if(a.ok)t({...e,theme:s});else{let e=await a.json();console.error("[dashboard] Failed to update theme:",e.error||a.statusText),c(o||"light"),alert("Failed to change theme: ".concat(e.error||a.statusText))}}catch(e){console.error("[dashboard] Failed to update theme:",e),c(o||"light"),alert("An unexpected error occurred while changing theme: ".concat(e.message))}},D=async()=>{if(!e)return;let s=(eA.findIndex(s=>s.id===e.hue)+1)%eA.length,a=eA[s].id;console.log("[dashboard] Cycling hue from",e.hue,"to",a);try{let e=await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({hue:a})});if(e.ok){let s=await e.json();console.log("[dashboard] Hue update successful:",s.user.hue),t(s.user)}else{let s=await e.json();console.error("[dashboard] Failed to update hue:",s.error||e.statusText),alert("Failed to change hue: ".concat(s.error||e.statusText))}}catch(e){console.error("[dashboard] Failed to update hue:",e),alert("An unexpected error occurred while changing hue: ".concat(e.message))}},I=async e=>{try{let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)alert("Friend request sent!");else{let e=await s.json();alert("Failed to send friend request: ".concat(e.error))}}catch(e){console.error("Failed to send friend request:",e),alert("An error occurred while sending friend request")}};return s?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading..."})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-background transition-colors duration-300",children:[(0,a.jsx)(T,{currentPage:d,onPageChange:e=>{"settings"===e?N.push("/settings"):"about"===e?N.push("/about"):"movies"===e?(N.push("/movies"),f({type:null,name:""}),y(null)):"games"===e?(N.push("/games"),f({type:null,name:""}),y(null)):(m(e),"dashboard"!==e&&(f({type:null,name:""}),y(null)))},onSignOut:S,onGlobalChatClick:()=>{f({type:"global",name:"Global Chat"}),m("dashboard"),y(null)},onAIChatClick:()=>{f({type:"dm",id:"00000000-0000-0000-0000-00000000000a",name:"real.AI"}),m("dashboard"),y(null)},username:e.username,onThemeCycle:F,onHueCycle:D}),(0,a.jsxs)("div",{className:"pt-20 px-4 pb-4",children:[(0,a.jsx)(eN,{currentUserId:e.id}),"dashboard"===d&&(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 max-w-7xl mx-auto h-[calc(100vh-theme(spacing.20))]",children:[(0,a.jsxs)("div",{className:"w-full md:w-80 space-y-4 flex-shrink-0",children:[(0,a.jsxs)(J.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(J.aR,{children:(0,a.jsxs)(J.ZB,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Group Chats"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>v(!0),title:"Search Messages",children:(0,a.jsx)(H.A,{className:"h-4 w-4"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>g(!0),children:(0,a.jsx)(et.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsx)(J.Wu,{children:0===u.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No group chats yet"}):(0,a.jsx)("div",{className:"space-y-1",children:u.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.$,{variant:"group"===x.type&&x.id===s.id?"default":"ghost",className:"flex-1 justify-start text-left transition-all duration-200 hover:scale-102",onClick:()=>f({type:"group",id:s.id,name:s.name}),children:[(0,a.jsx)(ea.A,{className:"h-4 w-4 mr-2 shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:s.name})]}),e.id===s.creator_id&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>C(s.id),className:"ml-2 text-red-500 hover:bg-red-500/10",title:"Delete Group Chat",children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})]},s.id))})})]}),(0,a.jsx)(ek,{currentUserId:e.id}),(0,a.jsx)(eC,{currentUserId:e.id,onViewAllPolls:()=>{m("polls"),y(null)}})]}),(0,a.jsx)("div",{className:"flex-1 h-full",children:x.type?(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(G,{chatType:x.type,chatId:x.id,chatName:x.name,currentUserId:e.id,onUserClick:e=>{console.log("[dashboard] User clicked:",e),y(e),m("profile"),f({type:null,name:""})}})}):(0,a.jsx)(J.Zp,{className:"flex items-center justify-center h-full animate-fadeIn",children:(0,a.jsxs)(J.Wu,{className:"text-center py-12",children:[(0,a.jsx)(w.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 animate-pulse"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:"Welcome to real."}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-2 mb-4",children:['Click on "Global" or "AI Chat" in the dynamic island above to start chatting,',(0,a.jsx)("br",{}),"or select a group chat from the sidebar."]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"Ready to connect"})]})]})})})]}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto mb-3 flex justify-end gap-2",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>m("movies"),children:"Movies"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>m("games"),children:"Games"})]}),"friends"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(X,{currentUserId:e.id,onStartDM:A})}),"dms"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(K,{currentUserId:e.id,onSelectDM:A})}),"polls"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(en,{currentUserId:e.id,userSignupCode:e.signup_code})}),"channels"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(ei,{currentUserId:e.id,userSignupCode:e.signup_code,onSelectChannel:(e,s)=>{f({type:"channel",id:e,name:"# ".concat(s)}),m("dashboard"),y(null)}})}),"calendar"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(ed,{currentUserId:e.id})}),"voice"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(ev,{})}),"movies"===d&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,a.jsx)(eb.default,{})}),"games"===d&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,a.jsx)(ey.A,{})}),"profile"===d&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(eu,{userId:null!=b?b:void 0,onStartDM:A,onSendFriendRequest:I})})]}),p&&e&&(0,a.jsx)(ew,{onClose:()=>g(!1),onCreate:k}),j&&(0,a.jsx)(eS,{onClose:()=>v(!1),onMessageClick:(e,s)=>{if("global"===e)f({type:"global",name:"Global Chat"});else if("dm"===e)f({type:"dm",id:s,name:"Direct Message"});else if("group"===e){let e=u.find(e=>e.id===s);f({type:"group",id:s,name:(null==e?void 0:e.name)||"Group Chat"})}m("dashboard"),y(null)}})]}):null}},2708:(e,s,t)=>{"use strict";t.d(s,{$:()=>c});var a=t(2432),r=t(364),l=t(4793),n=t(6992),i=t(4963);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,s)=>{let{className:t,variant:r,size:n,asChild:c=!1,...d}=e,m=c?l.DX:"button";return(0,a.jsx)(m,{className:(0,i.cn)(o({variant:r,size:n,className:t})),ref:s,...d})});c.displayName="Button"},3215:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(2432),r=t(364),l=t(8725),n=t(855),i=t(6334),o=t(1823),c=t(8311),d=t(9266);let m="https://image.tmdb.org/t/p/w500";function u(){let e=d.env.NEXT_PUBLIC_TMDB_API_KEY||"2713804610e1e236b1cf44bfac3a7776",[s,t]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[x,f]=(0,r.useState)(""),[p,g]=(0,r.useState)(null),[j,v]=(0,r.useState)(!1),b=(0,r.useRef)(null),y=(0,r.useRef)(null),N=(0,r.useCallback)(async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,a=t?"https://api.themoviedb.org/3/search/movie?api_key=".concat(e,"&query=").concat(encodeURIComponent(t),"&page=").concat(s):"https://api.themoviedb.org/3/movie/popular?api_key=".concat(e,"&page=").concat(s),r=await fetch(a);return(await r.json()).results||[]},[e]);(0,r.useEffect)(()=>{N(1).then(e=>{t([...e].sort(()=>.5-Math.random()).slice(0,10)),h(e)})},[N]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{x.trim()?N(1,x.trim()).then(h):N(1).then(h)},250);return()=>clearTimeout(e)},[x,N]);let w=e=>{g(e),v(!1)},_=(0,r.useMemo)(()=>s[0],[s]);return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsxs)("div",{className:"h-64 md:h-96 rounded-b-[40px] relative overflow-hidden",style:{backgroundImage:(null==_?void 0:_.poster_path)?"url(".concat(m).concat(_.poster_path,")"):void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-background to-transparent"}),(0,a.jsx)("div",{className:"absolute bottom-4 left-4 hue-bg/50 px-4 py-2 rounded-full text-sm backdrop-blur",children:"Real TV • Fresh releases in 4K when available"})]}),(0,a.jsx)("div",{className:"sticky top-4 z-10 flex justify-end px-4",children:(0,a.jsxs)("div",{className:"glass-effect flex items-center gap-2 px-4 py-2 rounded-full shadow-lg",children:[(0,a.jsx)(l.A,{className:"h-4 w-4 opacity-70"}),(0,a.jsx)("input",{value:x,onChange:e=>f(e.target.value),placeholder:"Search...",className:"bg-transparent outline-none text-sm"})]})}),(0,a.jsxs)("section",{className:"mt-8 px-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Top 10 Today"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{ref:b,className:"flex gap-3 overflow-x-auto no-scrollbar p-2 pr-10",children:s.map(e=>(0,a.jsx)("button",{onClick:()=>w(e),className:"flex-none w-40 rounded-xl overflow-hidden shadow-md transition-transform hover:scale-105",children:e.poster_path?(0,a.jsx)("img",{src:"".concat(m).concat(e.poster_path),alt:e.title,className:"w-full h-auto"}):(0,a.jsx)("div",{className:"w-full h-60 bg-muted"})},e.id))}),(0,a.jsx)("button",{onClick:()=>{b.current&&b.current.scrollBy({left:.8*b.current.clientWidth,behavior:"smooth"})},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white rounded-full p-2","aria-label":"Scroll right",children:(0,a.jsx)(n.A,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:()=>{b.current&&b.current.scrollBy({left:-(.8*b.current.clientWidth),behavior:"smooth"})},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white rounded-full p-2","aria-label":"Scroll left",children:(0,a.jsx)(i.A,{className:"h-5 w-5"})})]})]}),(0,a.jsxs)("section",{className:"mt-6 px-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"All"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:u.map(e=>(0,a.jsx)("button",{onClick:()=>w(e),className:"rounded-xl overflow-hidden shadow-md transition-transform hover:scale-105",children:e.poster_path?(0,a.jsx)("img",{src:"".concat(m).concat(e.poster_path),alt:e.title,className:"w-full h-auto"}):(0,a.jsx)("div",{className:"w-full aspect-[2/3] bg-muted"})},e.id))})]}),p&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm",children:[(0,a.jsx)("button",{onClick:()=>{v(!1),g(null),y.current&&(window.open=y.current,y.current=null)},className:"absolute top-4 left-4 bg-purple-600 hover:bg-purple-700 text-white rounded-full p-2 shadow-lg","aria-label":"Close",children:(0,a.jsx)(o.A,{className:"h-5 w-5"})}),p.poster_path&&(0,a.jsx)("img",{src:"".concat(m).concat(p.poster_path),alt:p.title,className:"hidden md:block absolute top-6 right-6 w-60 h-80 object-cover rounded-3xl shadow-2xl"}),(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center px-4",children:[(0,a.jsx)("h3",{className:"text-2xl md:text-3xl font-bold mb-4",children:p.title}),j?(0,a.jsx)("div",{className:"absolute inset-0",children:(0,a.jsx)("iframe",{src:"".concat("https://player.autoembed.cc/embed/movie/").concat(p.id),className:"w-full h-full",sandbox:"allow-same-origin allow-scripts allow-pointer-lock allow-forms",allow:"autoplay; encrypted-media; fullscreen",referrerPolicy:"no-referrer"},p.id)}):(0,a.jsxs)("button",{onClick:()=>{p&&(y.current=window.open,window.open=()=>null,v(!0))},className:"inline-flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold px-6 py-3 rounded-full shadow-lg",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"})," Play"]})]})]})]})}},4963:(e,s,t)=>{"use strict";t.d(s,{cn:()=>l});var a=t(2126),r=t(8441);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}},5564:(e,s,t)=>{Promise.resolve().then(t.bind(t,2681))},7304:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(2432),r=t(364),l=t(4963);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...n})});n.displayName="Input"},7382:(e,s,t)=>{"use strict";t.d(s,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>i});var a=t(2432),r=t(364),l=t(4963);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});n.displayName="Card";let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});i.displayName="CardHeader";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...r})});d.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter"},7616:(e,s,t)=>{"use strict";t.d(s,{J:()=>o,v:()=>i});var a=t(2432),r=t(364),l=t(7328);let n=(0,r.createContext)(void 0);function i(e){let{children:s}=e,[t,i]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0),{setTheme:d,theme:m}=(0,l.D)(),[u,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h(!0)},[]);let x=e=>{u&&((null==e?void 0:e.hue)?(console.log("[UserProvider] Applying hue:",e.hue),["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-".concat(e.hue))):(["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-blue")))};return(0,r.useEffect)(()=>{let e=async()=>{try{console.log("[UserProvider] Fetching user data...");let e=await fetch("/api/auth/me");if(e.ok){let s=await e.json();console.log("[UserProvider] User data received:",s.user),i(s.user),u&&s.user&&x(s.user)}else console.log("[UserProvider] No user found"),i(null)}catch(e){console.error("[UserProvider] Fetch error:",e),i(null)}finally{c(!1)}};u&&e()},[u,d]),(0,r.useEffect)(()=>{u&&x(t)},[t,u]),(0,a.jsx)(n.Provider,{value:{user:t,loading:o,setUser:e=>{console.log("[UserProvider] updateUser called with:",e),i(e),u&&e&&(d(e.theme||"light"),x(e))}},children:s})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[1617,5111,3920,1163,5022,5575,7358],()=>s(5564)),_N_E=e.O()}]);