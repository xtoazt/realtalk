(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1325:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(2432);let l=(0,t(9759).default)(()=>t.e(836).then(t.bind(t,836)),{loadableGenerated:{webpack:()=>[836]},ssr:!1});function r(){return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto animate-fadeIn px-4",children:[(0,a.jsx)("div",{className:"sticky top-4 z-10 mb-3",children:(0,a.jsx)("button",{onClick:()=>location.href="/dashboard",className:"text-xs px-3 py-1 rounded-full border backdrop-blur-md bg-white/40 dark:bg-black/30 text-black dark:text-white border-white/40 dark:border-white/20 hover:bg-white/60 dark:hover:bg-black/50",children:"Back to Dashboard"})}),(0,a.jsx)(l,{})]})}},2355:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eC});var a=t(2432),l=t(364),r=t(9262),i=t(7328),n=t(2708),c=t(1947),o=t(6589),d=t(4504),m=t(4963),h=t(7616);function x(e){let{className:s,size:t="default",variant:r="ghost"}=e,{theme:c,setTheme:x}=(0,i.D)(),{user:u,setUser:p}=(0,h.J)(),[f,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{g(!0)},[]);let j=async()=>{let e="light"===c?"dark":"light";if(x(e),u)try{(await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({theme:e})})).ok?p({...u,theme:e}):console.error("Failed to save theme preference")}catch(e){console.error("Error saving theme preference:",e)}};if(!f)return(0,a.jsx)(n.$,{variant:r,size:t,className:(0,m.cn)("animate-pulse",s),disabled:!0,children:(0,a.jsx)("div",{className:"h-4 w-4"})});let v={sm:"h-4 w-4",default:"h-5 w-5",lg:"h-6 w-6",icon:"h-4 w-4"};return(0,a.jsxs)(n.$,{variant:r,size:t,onClick:j,className:(0,m.cn)("transition-all duration-300 ease-in-out hover:scale-105","focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{sm:"h-8 w-8",default:"h-10 w-10",lg:"h-12 w-12",icon:"h-8 w-8"}[t],s),title:"Switch to ".concat("light"===c?"dark":"light"," mode"),children:["dark"===c?(0,a.jsx)(o.A,{className:(0,m.cn)("transition-transform duration-300",v[t])}):(0,a.jsx)(d.A,{className:(0,m.cn)("transition-transform duration-300",v[t])}),(0,a.jsx)("span",{className:"sr-only",children:"light"===c?"Switch to dark mode":"Switch to light mode"})]})}var u=t(6939),p=t(7693),f=t(5588),g=t(9861),j=t(9920),v=t(8055),N=t(1309),y=t(4010),w=t(4652),b=t(2121),C=t(1194),k=t(3394),S=t(6230),A=t(8175),_=t(7972),F=t(2664),E=t(7088),T=t(4260);function I(e){let{currentPage:s,onPageChange:t,onSignOut:r,onGlobalChatClick:i,onAIChatClick:o,username:d,onThemeCycle:m,onHueCycle:h}=e,[I,$]=(0,l.useState)(!1),[D,z]=(0,l.useState)(!1),P=[{id:"dashboard",label:"Dashboard",icon:u.A},{id:"friends",label:"Friends",icon:p.A},{id:"dms",label:"DMs",icon:f.A},{id:"channels",label:"Channels",icon:g.A},{id:"polls",label:"Polls",icon:j.A},{id:"voice",label:"Voice",icon:v.A},{id:"calendar",label:"Calendar",icon:N.A},{id:"profile",label:"Profile",icon:y.A},{id:"settings",label:"Settings",icon:w.A},{id:"about",label:"About",icon:b.A}],O=e=>{D||(z(!0),$(e),setTimeout(()=>z(!1),300))},R=e=>{"global"===e?i():"ai-chat"===e?o():t(e)};return(0,a.jsx)("div",{className:"fixed z-50 transition-all duration-300 top-4 left-1/2 -translate-x-1/2",children:(0,a.jsx)("div",{className:"glass text-foreground rounded-full transition-all duration-300 ease-out ".concat(I?"px-4 py-2 min-w-[700px]":"px-8 py-4 w-fit"),onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:I?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 py-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>R("global"),className:"h-8 w-8 btn-ghost rounded-full",title:"Global",children:(0,a.jsx)(C.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>R("ai-chat"),className:"h-8 w-8 btn-ghost rounded-full",title:"AI Chat",children:(0,a.jsx)(k.A,{className:"h-3 w-3"})}),(0,a.jsx)("div",{className:"w-px h-5 bg-border mx-1"}),P.map(e=>{let t=e.icon,l="channels"===e.id||"dms"===e.id||"polls"===e.id;return(0,a.jsxs)(n.$,{variant:s===e.id?"secondary":"ghost",size:l?"sm":"icon",onClick:()=>R(e.id),className:"h-8 ".concat(l?"px-3":"w-8"," ").concat(s===e.id?"btn-primary":"btn-ghost"," rounded-full"),children:[(0,a.jsx)(t,{className:"h-3 w-3"}),l&&(0,a.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:e.label})]},e.id)}),(0,a.jsxs)(c.AM,{children:[(0,a.jsx)(c.Wv,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"movies"===s||"games"===s||"radio"===s?"secondary":"ghost",size:"sm",className:"h-8 px-3 ".concat("movies"===s||"games"===s||"radio"===s?"btn-primary":"btn-ghost"," rounded-full"),title:"Entertainment",children:[(0,a.jsx)(S.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:"Entertainment"})]})}),(0,a.jsx)(c.hl,{className:"w-48 p-2",align:"center",avoidCollisions:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>R("movies"),className:"justify-start gap-2",children:[(0,a.jsx)(S.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Movies"})]}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>R("games"),className:"justify-start gap-2",children:[(0,a.jsx)(A.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Games"})]}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>R("radio"),className:"justify-start gap-2",children:[(0,a.jsx)(_.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Radio"})]})]})})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-border mx-1"}),(0,a.jsx)(x,{size:"sm",variant:"ghost",className:"h-8 w-8 btn-ghost rounded-full"}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:h,className:"h-8 w-8 btn-ghost rounded-full",title:"Cycle Color",children:(0,a.jsx)(F.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>{try{localStorage.setItem("ui-mode","simple")}catch(e){}window.location.href="/dashboard/simple"},className:"h-8 w-8 btn-ghost rounded-full",title:"Simple Mode",children:(0,a.jsx)(E.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:r,className:"h-8 w-8 btn-ghost rounded-full text-red-500 hover:text-red-400",title:"Sign out",children:(0,a.jsx)(T.A,{className:"h-3 w-3"})})]}):(0,a.jsxs)("div",{className:"flex items-center gap-3 transition-all duration-200",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-green-400 rounded-full animate-ping opacity-30"})]}),(0,a.jsx)("span",{className:"text-lg font-bold tracking-wide",children:"real."}),(0,a.jsxs)("span",{className:"text-xs text-subtle font-medium",children:["@",d]})]})})})}var $=t(3143),D=t(129),z=t(9495),P=t(7304),O=t(6446),R=t(7382),M=t(7759),Z=t(5009),L=t(3079),U=t(5213),q=t(4329),G=t(3702),W=t(1823);function J(e){let{currentUserId:s,userSignupCode:t}=e,[r,i]=(0,l.useState)([]),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!0),[u,p]=(0,l.useState)(null),[f,g]=(0,l.useState)(null),[v,N]=(0,l.useState)(""),[y,w]=(0,l.useState)(""),[b,k]=(0,l.useState)(["",""]),[S,A]=(0,l.useState)(!1),[_,F]=(0,l.useState)([]),[E,T]=(0,l.useState)(""),I=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls");if(e.ok){let s=await e.json();console.log("[polls-page] Fetched polls:",s.polls),i(s.polls)}else console.error("[polls-page] Failed to fetch polls:",e.status)}catch(e){console.error("Failed to fetch polls:",e)}finally{x(!1)}},[]),$=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();o(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{I(),$()},[I,$]);let D=async()=>{if(g(null),v.trim()&&!(b.filter(e=>e.trim()).length<2))try{let e=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.trim(),description:y.trim()||void 0,options:b.filter(e=>e.trim()),is_public:S,shared_with:_,expires_at:E||void 0})});if(e.ok)m(!1),B(),I();else{let s=await e.json();g("Failed to create poll: ".concat(s.error))}}catch(e){g("An unexpected error occurred while creating the poll.")}},z=async e=>{g(null);try{let s=await fetch("/api/polls/".concat(e),{method:"DELETE"});if(s.ok)I();else{let e=await s.json();g("Failed to delete poll: ".concat(e.error||s.statusText))}}catch(e){g("An unexpected error occurred while deleting the poll.")}},J=async(e,s)=>{console.log("[polls-page] Voting on poll ".concat(e," with option ").concat(s)),p(e);try{let t=await fetch("/api/polls/".concat(e,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:s})});if(t.ok)console.log("[polls-page] Vote successful, refreshing polls"),await I();else{let e=await t.json();console.error("Failed to vote:",e.error),alert("Failed to vote: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Failed to vote:",e),alert("An unexpected error occurred while voting.")}finally{p(null)}},B=()=>{N(""),w(""),k(["",""]),A(!1),F([]),T("")},K=e=>{b.length>2&&k(b.filter((s,t)=>t!==e))},V=(e,s)=>{let t=[...b];t[e]=s,k(t)},H=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",Y=e=>e?{color:e}:{},Q=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=e=>!!e&&new Date(e)<new Date,ee=(e,s)=>0===s?0:Math.round(e/s*100);return h?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading polls..."})}):(0,a.jsxs)("div",{className:"space-y-6 relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Polls"}),(0,a.jsxs)(n.$,{onClick:()=>m(!0),className:"hover-lift hover-glow",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-2"}),"Create Poll"]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===r.length?(0,a.jsx)(R.Zp,{className:"glass-effect animate-fadeIn",children:(0,a.jsxs)(R.Wu,{className:"text-center py-8",children:[(0,a.jsx)(j.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No polls yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first poll to gather opinions!"})]})}):r.map((e,t)=>{let l=void 0!==e.user_response;return(0,a.jsxs)(R.Zp,{className:"glass-effect hover-lift animate-fadeIn ".concat(X(e.expires_at)?"opacity-75":""),style:{animationDelay:"".concat(.1*t,"s")},children:[(0,a.jsxs)(R.aR,{children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(R.ZB,{className:"text-lg",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.is_public?(0,a.jsx)(C.A,{className:"h-3 w-3 hue-accent"}):(0,a.jsx)(L.A,{className:"h-3 w-3"}),(0,a.jsx)(U.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[e.total_responses," votes"]}),e.expires_at&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:X(e.expires_at)?"text-red-500":"",children:X(e.expires_at)?"Expired":"Expires ".concat(Q(e.expires_at))})]})]}),e.creator_id===s&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>z(e.id),className:"text-red-500 hover:bg-red-500/10 h-6 w-6 p-0",title:"Delete Poll",children:(0,a.jsx)(G.A,{className:"h-3 w-3"})})]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{className:e.creator_username?H(void 0,!1):"",children:["by @",e.creator_username]}),(0,a.jsxs)("span",{children:[void 0!==e.user_response?"You voted":"Click to vote"," • ",e.total_responses," total votes"]})]})]}),(0,a.jsxs)(R.Wu,{className:"space-y-3",children:[e.options.map((s,t)=>{let r=e.results.find(e=>e.option_index===t),i=(null==r?void 0:r.count)||0,c=ee(i,e.total_responses),o=e.user_response===t,d=u===e.id;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(n.$,{variant:o?"default":"outline",className:"flex-1 justify-start hover-lift transition-all duration-200 ".concat(o?"hue-shadow":""," ").concat(X(e.expires_at)?"":"cursor-pointer"),onClick:()=>!X(e.expires_at)&&!d&&J(e.id,t),disabled:X(e.expires_at)||d,children:[(0,a.jsx)("span",{className:"flex-1 text-left",children:s}),d&&(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin ml-2"})]}),l&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground ml-3 min-w-[60px] text-right",children:[i," (",c,"%)"]})]}),l&&(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-700 ease-out ".concat(o?"bg-gradient-to-r from-blue-500 to-purple-500 hue-shadow":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(c,"%"),backgroundColor:o?"hsl(var(--hue) 60% 50%)":void 0}})})]},t)}),!X(e.expires_at)&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4 opacity-70",children:["Click on an option to ",l?"change your vote":"cast your vote"]})]})]},e.id)})}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(R.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto glass-effect animate-fadeIn",children:[(0,a.jsxs)(R.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(R.ZB,{children:"Create Poll"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(R.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.p,{value:v,onChange:e=>N(e.target.value),placeholder:"Poll title",className:"focus:hue-shadow"})}),(0,a.jsx)("div",{children:(0,a.jsx)(O.T,{value:y,onChange:e=>w(e.target.value),placeholder:"Description (optional)",rows:2,className:"focus:hue-shadow"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Options"}),b.map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P.p,{value:e,onChange:e=>V(s,e.target.value),placeholder:"Option ".concat(s+1),className:"focus:hue-shadow"}),b.length>2&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>K(s),children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]},s)),b.length<6&&(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{b.length<6&&k([...b,""])},className:"hover-lift bg-transparent",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P.p,{type:"datetime-local",value:E,onChange:e=>T(e.target.value),className:"focus:hue-shadow"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional expiration date"})]}),"qwea"===t&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3 hue-bg rounded-lg",children:[(0,a.jsx)(M.S,{id:"public",checked:S,onCheckedChange:e=>A(!0===e)}),(0,a.jsx)("label",{htmlFor:"public",className:"text-sm font-medium",children:"Share with all users (public poll)"})]}),!S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Share with friends"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:c.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(M.S,{id:e.friend_id,checked:_.includes(e.friend_id),onCheckedChange:s=>{s?F([..._,e.friend_id]):F(_.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:Y(e.friend_name_color),children:(0,a.jsxs)("span",{className:H(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:D,disabled:!v.trim()||b.filter(e=>e.trim()).length<2,className:"flex-1 hover-glow",children:"Create Poll"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})})]})}function B(e){let{currentUserId:s,userSignupCode:t,onSelectChannel:r}=e,[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),[x,u]=(0,l.useState)(""),p="qwea"===t,f=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/channels");if(e.ok){let s=await e.json();c(s.channels)}}finally{d(!1)}},[]);(0,l.useEffect)(()=>{f()},[f]);let j=(0,l.useMemo)(()=>i.filter(e=>e.is_system),[i]),v=(0,l.useMemo)(()=>i.filter(e=>!e.is_system),[i]),N=async e=>{if(!confirm("Delete this channel?"))return;let s=await fetch("/api/channels/".concat(e),{method:"DELETE"});if(s.ok)f();else{let e=await s.json().catch(()=>({}));alert("Failed to delete: ".concat(e.error||s.statusText))}},y=async()=>{if(p&&x.trim()){h(!0);try{let e=await fetch("/api/channels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x.trim()})});if(e.ok)u(""),f();else{let s=await e.json().catch(()=>({}));alert("Failed to create channel: ".concat(s.error||e.statusText))}}finally{h(!1)}}};return o?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading channels..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Channels"}),p&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.p,{value:x,onChange:e=>u(e.target.value),placeholder:"Create a new channel",className:"w-48"}),(0,a.jsxs)(n.$,{onClick:y,disabled:!x.trim()||m,className:"hover-glow",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-1"})," Create"]})]})]}),(0,a.jsxs)(R.Zp,{className:"glass-effect",children:[(0,a.jsx)(R.aR,{children:(0,a.jsx)(R.ZB,{children:"Default"})}),(0,a.jsx)(R.Wu,{className:"space-y-2",children:0===j.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No channels."}):j.map(e=>(0,a.jsxs)(n.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>r(e.id,e.name),children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"})," ",e.name]},e.id))})]}),v.length>0&&(0,a.jsxs)(R.Zp,{className:"glass-effect",children:[(0,a.jsx)(R.aR,{children:(0,a.jsx)(R.ZB,{children:"Created by Gold users"})}),(0,a.jsx)(R.Wu,{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.$,{variant:"ghost",className:"flex-1 justify-start",onClick:()=>r(e.id,e.name),children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"})," ",e.name]}),e.creator_id===s&&(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>N(e.id),className:"text-red-500",children:(0,a.jsx)(G.A,{className:"h-4 w-4"})})]},e.id))})]})]})}var K=t(6334),V=t(855);function H(e){let{currentUserId:s}=e,[t,r]=(0,l.useState)([]),[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!0),[x,u]=(0,l.useState)(new Date),[p,f]=(0,l.useState)(""),[g,j]=(0,l.useState)(""),[v,y]=(0,l.useState)(""),[w,b]=(0,l.useState)(""),[C,k]=(0,l.useState)(!1),[S,A]=(0,l.useState)([]),_=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/calendar");if(e.ok){let s=await e.json();r(s.events)}}catch(e){console.error("Failed to fetch events:",e)}finally{h(!1)}},[]),F=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{_(),F()},[_,F]);let E=async()=>{if(p.trim()&&v&&w)try{(await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p.trim(),description:g.trim()||void 0,start_time:v,end_time:w,is_collaborative:C,participants:S})})).ok&&(d(!1),T(),_())}catch(e){console.error("Failed to create event:",e)}},T=()=>{f(""),j(""),y(""),b(""),k(!1),A([])},I=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",$=e=>e?{color:e}:{},D=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=e=>{let s=e.toDateString();return t.filter(e=>new Date(e.start_time).toDateString()===s)},U=e=>{u(s=>{let t=new Date(s);return"prev"===e?t.setMonth(s.getMonth()-1):t.setMonth(s.getMonth()+1),t})},G=e=>{if(!e)return!1;let s=new Date;return e.toDateString()===s.toDateString()};if(m)return(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading calendar..."})});let J=(e=>{let s=e.getFullYear(),t=e.getMonth(),a=new Date(s,t,1),l=new Date(s,t+1,0).getDate(),r=a.getDay(),i=[];for(let e=0;e<r;e++)i.push(null);for(let e=1;e<=l;e++)i.push(new Date(s,t,e));return i})(x),B=x.toLocaleDateString([],{month:"long",year:"numeric"});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Calendar"}),(0,a.jsxs)(n.$,{onClick:()=>d(!0),children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-2"}),"Create Event"]})]}),(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"h-5 w-5"}),B]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>U("prev"),children:(0,a.jsx)(K.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>U("next"),children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsxs)(R.Wu,{children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:J.map((e,s)=>{let t=e?z(e):[];return(0,a.jsx)("div",{className:"min-h-[80px] p-1 border rounded-lg ".concat(e?"hover:bg-accent/50 cursor-pointer":""," ").concat(G(e)?"bg-primary/10 border-primary":""),children:e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm font-medium ".concat(G(e)?"text-primary":""),children:e.getDate()}),(0,a.jsxs)("div",{className:"space-y-1",children:[t.slice(0,2).map(e=>(0,a.jsx)("div",{className:"text-xs p-1 bg-primary/20 rounded truncate",title:e.title,children:e.title},e.id)),t.length>2&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]})},s)})})]})]}),(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsx)(R.ZB,{children:"Upcoming Events"})}),(0,a.jsx)(R.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(q.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No events scheduled"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first event to get started!"})]}):(0,a.jsx)("div",{className:"space-y-3",children:t.filter(e=>new Date(e.start_time)>=new Date).sort((e,s)=>new Date(e.start_time).getTime()-new Date(s.start_time).getTime()).slice(0,5).map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:[D(e.start_time)," - ",D(e.end_time)]}),e.is_collaborative&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(L.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Collaborative"})]})]})]})}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Created by @",e.creator_username]})]},e.id))})})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(R.Zp,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(R.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(R.ZB,{children:"Create Event"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(R.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.p,{value:p,onChange:e=>f(e.target.value),placeholder:"Event title"})}),(0,a.jsx)("div",{children:(0,a.jsx)(O.T,{value:g,onChange:e=>j(e.target.value),placeholder:"Description (optional)",rows:2})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Start Time"}),(0,a.jsx)(P.p,{type:"datetime-local",value:v,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"End Time"}),(0,a.jsx)(P.p,{type:"datetime-local",value:w,onChange:e=>b(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(M.S,{id:"collaborative",checked:C,onCheckedChange:e=>k(!0===e)}),(0,a.jsx)("label",{htmlFor:"collaborative",className:"text-sm",children:"Make this a collaborative event"})]}),C&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Invite participants"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:i.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(M.S,{id:e.friend_id,checked:S.includes(e.friend_id),onCheckedChange:s=>{s?A([...S,e.friend_id]):A(S.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:$(e.friend_name_color),children:(0,a.jsxs)("span",{className:I(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:E,disabled:!p.trim()||!v||!w,className:"flex-1",children:"Create Event"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]})]})})]})}var Y=t(1942),Q=t(4311),X=t(3335),ee=t(1873),es=t(7709);function et(e){let{userId:s,onStartDM:t,onSendFriendRequest:r}=e,{user:i,setUser:c}=(0,h.J)(),[o,d]=(0,l.useState)(null),[m,x]=(0,l.useState)(!0),[u,g]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[N,w]=(0,l.useState)(!1),[b,C]=(0,l.useState)(""),[k,S]=(0,l.useState)(!1),[A,_]=(0,l.useState)(null),[F,E]=(0,l.useState)(""),[T,I]=(0,l.useState)(""),$=!s||s===(null==i?void 0:i.id),D=!!(null==i?void 0:i.has_gold_animation);(0,l.useEffect)(()=>{let e=async()=>{if(!$&&s&&i)try{let e=await fetch("/api/friends/check?userId=".concat(s));if(e.ok){let s=await e.json();_(s.friendship)}}catch(e){console.error("Failed to fetch friendship:",e)}};(async()=>{if($&&i)d(i),E(i.bio||""),I(i.profile_picture||"");else if(s)try{let e=await fetch("/api/users/".concat(s));if(e.ok){let s=await e.json();d(s.user)}}catch(e){console.error("Failed to fetch profile:",e)}x(!1)})(),e()},[s,i,$]);let z=async e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){S(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(t.name)),{method:"POST",body:t});if(e.ok){let s=await e.json();I(s.url)}else{let s=await e.json();alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{S(!1)}}},P=async()=>{if($){v(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile_picture:T||null,bio:F.trim()||null})});if(e.ok){let s=await e.json();c(s.user),d(s.user),g(!1)}else{let s=await e.json();alert("Failed to update profile: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to update profile:",e),alert("An unexpected error occurred while updating profile.")}finally{v(!1)}}};return m?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading profile..."})}):o?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:$?"Your Profile":"@".concat(o.username,"'s Profile")}),$&&(0,a.jsx)(n.$,{onClick:()=>g(!u),variant:u?"outline":"default",children:u?"Cancel":"Edit Profile"})]}),(0,a.jsxs)(R.Zp,{className:"glass-effect hover-lift animate-fadeIn",children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5"}),"Profile Information"]})}),(0,a.jsxs)(R.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"relative",children:[o.profile_picture?(0,a.jsx)(es.default,{src:o.profile_picture||"/placeholder.svg",alt:"".concat(o.username,"'s profile"),width:100,height:100,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:(0,a.jsx)(y.A,{className:"h-12 w-12 text-gray-400"})}),u&&(0,a.jsxs)("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-2 cursor-pointer hover:bg-primary/90 transition-colors",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:z,className:"hidden",disabled:k})]}),k&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold ".concat(o.has_gold_animation&&o.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":""),style:o.has_gold_animation?{}:o.name_color?{color:o.name_color}:{},children:["@",o.username]}),o.custom_title&&(0,a.jsx)("p",{className:"text-sm italic text-muted-foreground mt-1",children:o.custom_title}),o.signup_code&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:["asdf"===o.signup_code&&"✨ Custom Colors","qwea"===o.signup_code&&"\uD83D\uDC51 Gold Member"]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),u?(0,a.jsx)(O.T,{value:F,onChange:e=>E(e.target.value),placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"resize-none"}):(0,a.jsx)("div",{className:"min-h-[100px] p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:o.bio?(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:o.bio}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground italic",children:$?"Add a bio to tell others about yourself":"No bio available"})}),u&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[F.length,"/500 characters"]})]}),(0,a.jsx)("div",{className:"flex gap-3",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.$,{onClick:P,disabled:j,className:"flex-1",children:j?"Saving...":"Save Changes"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>g(!1),disabled:j,children:"Cancel"})]}):$?null:(0,a.jsxs)(a.Fragment,{children:[(null==A?void 0:A.status)==="accepted"?(0,a.jsxs)(n.$,{onClick:()=>null==t?void 0:t(o.id,o.username),className:"flex-1",children:[(0,a.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),"Send Message"]}):(0,a.jsxs)(n.$,{disabled:!0,className:"flex-1 opacity-50 cursor-not-allowed",children:[(0,a.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),(null==A?void 0:A.status)==="pending"?"Friend Request Pending":"Add Friend to Message"]}),A&&"blocked"!==A.status?"pending"===A.status?(0,a.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Request Sent"]}):(0,a.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Friends"]}):(0,a.jsxs)(n.$,{variant:"outline",onClick:()=>null==r?void 0:r(o.id),children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Add Friend"]}),D&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.$,{variant:"destructive",onClick:()=>w(!0),children:[(0,a.jsx)(X.A,{className:"h-4 w-4 mr-2"})," Freeze"]}),(0,a.jsxs)(n.$,{variant:"outline",onClick:async()=>{try{await fetch("/api/freeze?targetUserId=".concat(o.id),{method:"DELETE"}),alert("User unfrozen")}catch(e){alert("Failed to unfreeze")}},children:[(0,a.jsx)(ee.A,{className:"h-4 w-4 mr-2"})," Unfreeze"]})]})]})})]})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-white dark:bg-gray-900 rounded-xl p-4 border",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold mb-2",children:["Freeze @",o.username]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Only gold members can do this. The user will be prevented from typing or using voice."}),(0,a.jsx)("textarea",{className:"w-full border rounded p-2 text-sm mb-3",rows:3,placeholder:"Optional message shown on their screen",value:b,onChange:e=>C(e.target.value)}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(n.$,{variant:"secondary",onClick:async()=>{let e=prompt("Popup message to show immediately (optional)")||"";if(e)try{await fetch("/api/freeze/popup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,popupMessage:e})}),alert("Popup sent")}catch(e){alert("Failed to send popup")}},children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"})," Send Popup"]}),(0,a.jsxs)(n.$,{variant:"destructive",onClick:async()=>{try{let e=await fetch("/api/freeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,message:b})});if(e.ok)alert("User frozen"),w(!1),C("");else{let s=await e.json();alert(s.error||"Failed to freeze")}}catch(e){alert("Failed to freeze")}},children:[(0,a.jsx)(X.A,{className:"h-4 w-4 mr-1"})," Confirm Freeze"]})]})]})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Profile not found"})})}var ea=t(9370);function el(){let{user:e}=(0,h.J)();return e?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(ea.n,{roomId:"global-voice",userId:e.id}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{id:"voice-enable-widget",type:"checkbox",defaultChecked:"1"===localStorage.getItem("voiceWidgetEnabled"),onChange:e=>{localStorage.setItem("voiceWidgetEnabled",e.target.checked?"1":"0"),window.dispatchEvent(new Event("voice-widget-toggle"))}}),(0,a.jsx)("label",{htmlFor:"voice-enable-widget",children:"Enable floating voice widget across pages"})]})]}):null}var er=t(3215),ei=t(1325),en=t(3544);function ec(e){return null}var eo=t(4992);function ed(e){let{onClose:s,onJoinSuccess:t}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(""),h=async e=>{if(e.preventDefault(),r.trim()){o(!0),m("");try{let e=await fetch("/api/group-chats/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortCode:r.trim().toUpperCase()})}),a=await e.json();e.ok?(t(a.groupChat),s()):m(a.error||"Failed to join group chat")}catch(e){m("An unexpected error occurred")}finally{o(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)(R.Zp,{className:"w-full max-w-md mx-4",children:[(0,a.jsxs)(R.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),"Join Group Chat"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(R.Wu,{children:(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Enter Group Code"}),(0,a.jsx)(P.p,{value:r,onChange:e=>i(e.target.value.toUpperCase()),placeholder:"e.g., ABC123",maxLength:6,className:"text-center text-lg font-mono tracking-wider",disabled:c}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"6-character code provided by the group creator"})]}),d&&(0,a.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:d}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{type:"submit",disabled:!r.trim()||c,className:"flex-1",children:c?"Joining...":"Join Group"}),(0,a.jsx)(n.$,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})})]})})}var em=t(3491);function eh(e){let{groupChatId:s,groupChatName:t,onClose:r,onRequestProcessed:i}=e,[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{u()},[s]);let u=async()=>{try{let e=await fetch("/api/group-chats/".concat(s,"/requests"));if(e.ok){let s=await e.json();o(s.requests)}}catch(e){console.error("Failed to fetch requests:",e)}finally{m(!1)}},p=async(e,t,a)=>{x(e);try{let l=await fetch("/api/group-chats/".concat(s,"/requests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestId:e,requesterId:t,action:a})});if(l.ok)o(s=>s.filter(s=>s.id!==e)),i();else{let e=await l.json();alert(e.error||"Failed to process request")}}catch(e){alert("An error occurred while processing the request")}finally{x(null)}},f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return d?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsx)(R.Zp,{className:"w-full max-w-md mx-4",children:(0,a.jsxs)(R.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading requests..."})]})})}):(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)(R.Zp,{className:"w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)(R.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"h-5 w-5"}),"Join Requests"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(R.Wu,{className:"p-0",children:[(0,a.jsx)("div",{className:"px-6 pb-2",children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Pending requests for ",(0,a.jsx)("strong",{children:t})]})}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===c.length?(0,a.jsxs)("div",{className:"px-6 py-8 text-center text-muted-foreground",children:[(0,a.jsx)(y.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No pending join requests"})]}):(0,a.jsx)("div",{className:"space-y-2 px-6 pb-6",children:c.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(y.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-sm",children:["@",e.username]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:f(e.created_at)})]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"approve"),disabled:h===e.id,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:(0,a.jsx)(em.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"reject"),disabled:h===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]})]},e.id))})})]})]})})}var ex=t(3868);function eu(e){let{currentUserId:s}=e,[t,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),c=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/users/online");if(e.ok){let s=await e.json();r(s.onlineUsers)}}catch(e){console.error("Failed to fetch online users:",e)}finally{n(!1)}},[]),o=(0,l.useCallback)(async()=>{try{await fetch("/api/user/activity",{method:"POST"})}catch(e){console.error("Failed to update activity:",e)}},[]);(0,l.useEffect)(()=>{c(),o();let e=setInterval(o,12e4),s=setInterval(c,3e4);return()=>{clearInterval(e),clearInterval(s)}},[c,o]);let d=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",m=e=>e?{color:e}:{};return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(L.A,{className:"h-4 w-4"}),"Online Friends"]})}),(0,a.jsx)(R.Wu,{className:"pt-0",children:(0,a.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(ex.A,{className:"h-4 w-4 text-green-500"}),"Online (",t.length,")"]})}),(0,a.jsx)(R.Wu,{className:"pt-0",children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(L.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No friends online"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:"Add friends to see them here"})]}):(0,a.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-1.5 rounded hover:bg-muted/30 transition-colors",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),(0,a.jsxs)("span",{className:e.has_gold_animation?d(void 0,!0):"text-xs",style:e.has_gold_animation?{}:m(e.name_color),children:["@",e.username]})]},e.id))})})]})}function ep(e){var s;let{currentUserId:t,onViewAllPolls:r}=e,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),x=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls/recent?userId=".concat(t));if(e.ok){let s=await e.json();c(s.poll)}}catch(e){console.error("Failed to fetch recent poll:",e)}finally{d(!1)}},[t]);(0,l.useEffect)(()=>{x()},[x]);let u=async e=>{if(i&&!m){h(!0);try{let s=await fetch("/api/polls/".concat(i.id,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:e})});if(s.ok)await x();else{let e=await s.json();console.error("Failed to vote:",e.error)}}catch(e){console.error("Failed to vote:",e)}finally{h(!1)}}},p=(e,s)=>0===s?0:Math.round(e/s*100);if(o)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,a.jsx)(R.Wu,{className:"pt-0",children:(0,a.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]});if(!i)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,a.jsx)(R.Wu,{className:"pt-0",children:(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(j.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No polls available"}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",className:"mt-2 h-7 text-xs",onClick:r,children:"View All Polls"})]})})]});let f=void 0!==i.user_response,g=!!(s=i.expires_at)&&new Date(s)<new Date;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),"Latest Poll"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-xs h-6 px-2",children:"View All"})]})}),(0,a.jsxs)(R.Wu,{className:"pt-0 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-xs",children:i.title}),i.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:i.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[i.is_public?(0,a.jsx)(C.A,{className:"h-3 w-3"}):(0,a.jsx)(L.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[i.total_responses," votes"]}),i.expires_at&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(q.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:g?"text-red-500":"",children:g?"Expired":"".concat(new Date(i.expires_at).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[i.options.slice(0,2).map((e,s)=>{let t=i.results.find(e=>e.option_index===s),l=p((null==t?void 0:t.count)||0,i.total_responses),r=i.user_response===s;return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)(n.$,{variant:r?"default":"outline",size:"sm",className:"flex-1 justify-start text-xs h-6 px-2 ".concat(r?"bg-foreground text-background":""),onClick:()=>!f&&!g&&!m&&u(s),disabled:f||g||m,children:(0,a.jsx)("span",{className:"flex-1 text-left truncate",children:e})}),f&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground min-w-[35px] text-right",children:[l,"%"]})]}),f&&(0,a.jsx)("div",{className:"w-full bg-muted/30 rounded-full h-0.5",children:(0,a.jsx)("div",{className:"h-0.5 rounded-full transition-all duration-500 ".concat(r?"bg-foreground":"bg-muted-foreground/40"),style:{width:"".concat(l,"%")}})})]},s)}),i.options.length>2&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground/60 text-center",children:["+",i.options.length-2," more"]})]})]})]})}var ef=t(8725);function eg(e){let{onClose:s,onMessageClick:t}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>{r.trim().length>=2?h():o([])},500);return()=>clearTimeout(e)},[r]);let h=async()=>{m(!0);try{let e=await fetch("/api/messages/search?q=".concat(encodeURIComponent(r.trim())));if(e.ok){let s=await e.json();o(s.messages||[])}}catch(e){console.error("Failed to search messages:",e)}finally{m(!1)}},x=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",u=e=>e?{color:e}:{},p=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=e=>"global"===e.chat_type?"Global Chat":"dm"===e.chat_type?"Direct Message":"Group Chat";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(R.Zp,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)(R.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(ef.A,{className:"h-5 w-5"}),"Search Messages"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(R.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P.p,{value:r,onChange:e=>i(e.target.value),placeholder:"Search messages...",className:"flex-1",autoFocus:!0}),d&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:r.trim().length<2?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(ef.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Type at least 2 characters to search"})]}):0!==c.length||d?c.map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>{null==t||t(e.chat_type,e.chat_id),s()},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:e.has_gold_animation?x(void 0,!0):"text-sm font-medium",style:e.has_gold_animation?{}:u(e.name_color),children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:f(e)}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:p(e.created_at)})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"image"===e.message_type?"\uD83D\uDCF7 Shared an image":e.content})]},e.id)):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(Q.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsxs)("p",{children:['No messages found for "',r,'"']})]})})]})]})})}var ej=t(2548),ev=t(4188);function eN(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{localStorage.getItem("seen-mode-gate")||t(!0)}catch(e){}},[]),(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem("refreshed-after-auth");"/dashboard"!==location.pathname&&"/dashboard/lite"!==location.pathname||e||(sessionStorage.setItem("refreshed-after-auth","1"),location.reload())}catch(e){}},[]);let i=s=>{try{localStorage.setItem("seen-mode-gate","1")}catch(e){}"lite"===s?e.push("/dashboard/lite"):e.push("/dashboard")};return s?(0,a.jsx)("div",{className:"fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-[90%] max-w-md border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Choose your experience"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Pick a UI mode. You can change this later in Settings."}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{onClick:()=>i("lite"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Lite"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Minimal and fast. Global chat, Friends, DMs, Settings, Group Chats."})]}),(0,a.jsxs)("button",{onClick:()=>i("full"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Full"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Full experience with entertainment, voice, polls, and more."})]})]})]})}):null}var ey=t(5501);function ew(e){var s,t;let{isOpen:r,onClose:i}=e,[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(""),[p,f]=(0,l.useState)(null),{user:g}=(0,h.J)(),j=(null==g?void 0:g.signup_code)==="qwea";(0,l.useEffect)(()=>{r&&v()},[r]),(0,l.useEffect)(()=>{let e=()=>{};return window.addEventListener("geminiKeyExhausted",e),()=>window.removeEventListener("geminiKeyExhausted",e)},[j]);let v=()=>{f((0,ey.BW)())},N=async()=>{if(!c.trim()){u("Please enter a valid API key");return}m(!0),u("");try{let e=await (0,ey.eE)(c,(null==g?void 0:g.username)||"Unknown");e.success?(u("API key added successfully! \uD83C\uDF89"),o(""),v()):u(e.message)}catch(e){u("Error adding API key. Please try again.")}finally{m(!1)}};return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Gemini API Key Management"}),!j&&(0,a.jsx)("div",{className:"text-red-600 mb-4",children:"Only gold members can add or manage Gemini API keys."}),(null==p?void 0:p.error)&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:p.error}),!(null==p?void 0:p.hasAvailableKeys)&&(0,a.jsx)("div",{className:"text-yellow-600 mb-2",children:"No available Gemini API keys. Please add a new one to restore AI features for all users."}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Current keys: ",null!==(s=null==p?void 0:p.totalKeys)&&void 0!==s?s:0]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Exhausted keys: ",null!==(t=null==p?void 0:p.exhaustedKeys)&&void 0!==t?t:0]})]}),j&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 mb-2",placeholder:"Enter Gemini API key (starts with AIza)",value:c,onChange:e=>o(e.target.value),disabled:d}),(0,a.jsx)(n.$,{onClick:N,disabled:d,className:"w-full mb-2",children:d?"Adding...":"Add API Key"}),(0,a.jsx)(n.$,{onClick:()=>{v(),u("Key status refreshed")},variant:"outline",className:"w-full",children:"Refresh Key Status"})]}),x&&(0,a.jsx)("div",{className:"text-sm text-blue-600 mb-2",children:x}),(0,a.jsx)(n.$,{onClick:i,variant:"secondary",className:"w-full mt-2",children:"Close"})]})}):null}let eb=[{id:"blue",name:"Blue"},{id:"purple",name:"Purple"},{id:"pink",name:"Pink"},{id:"red",name:"Red"},{id:"orange",name:"Orange"},{id:"yellow",name:"Yellow"},{id:"green",name:"Green"},{id:"teal",name:"Teal"}];function eC(){var e,s;let{user:t,loading:c,setUser:o}=(0,h.J)(),{theme:d,setTheme:m}=(0,i.D)(),[x,u]=(0,l.useState)("dashboard"),[p,f]=(0,l.useState)([]),[j,v]=(0,l.useState)({type:null,name:""}),[N,y]=(0,l.useState)(!1),[w,b]=(0,l.useState)(!1),[k,S]=(0,l.useState)(!1),[A,_]=(0,l.useState)(!1),[F,E]=(0,l.useState)(null),[T,P]=(0,l.useState)(!1),O=(0,r.useRouter)(),M=(0,l.useCallback)(async()=>{if(t)try{let e=await fetch("/api/group-chats");if(e.ok){let s=await e.json();f(s.groupChats)}else console.error("Failed to fetch group chats:",e.status,await e.text())}catch(e){console.error("Failed to fetch group chats:",e)}},[t]);(0,l.useEffect)(()=>{!c&&t&&M()},[c,t,M]),(0,l.useEffect)(()=>{let e=e=>{let{type:s,id:t,name:a}=e.detail;v({type:s,id:t,name:a})};return window.addEventListener("navigateToChat",e),()=>{window.removeEventListener("navigateToChat",e)}},[]),(0,l.useEffect)(()=>{let e=()=>{(null==t?void 0:t.signup_code)==="qwea"&&P(!0)};return window.addEventListener("geminiKeyExhausted",e),()=>{window.removeEventListener("geminiKeyExhausted",e)}},[t]);let U=async(e,s)=>{try{let t=await fetch("/api/group-chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,memberIds:s})});if(t.ok){let e=await t.json();f(s=>[e.groupChat,...s]),y(!1),v({type:"group",id:e.groupChat.id,name:e.groupChat.name}),u("dashboard"),e.groupChat.short_code&&alert("Group chat created! Share this code with others: ".concat(e.groupChat.short_code))}else console.error("Failed to create group chat:",t.status,await t.text())}catch(e){console.error("Failed to create group chat:",e)}},W=async e=>{if(t&&confirm("Are you sure you want to delete this group chat? This action cannot be undone."))try{let s=await fetch("/api/group-chats/".concat(e),{method:"DELETE"});if(s.ok)console.log("Group chat ".concat(e," deleted successfully.")),M(),"group"===j.type&&j.id===e&&v({type:null,name:""});else{let e=await s.json();console.error("Failed to delete group chat:",e.error||s.statusText),alert("Failed to delete group chat: ".concat(e.error||s.statusText))}}catch(e){console.error("Failed to delete group chat:",e),alert("An unexpected error occurred while deleting the group chat.")}},K=async()=>{try{let e=await fetch("/api/auth/signout",{method:"POST",credentials:"include"});e.ok?o(null):console.error("Sign out failed:",e.status),window.location.href="/auth"}catch(e){console.error("Failed to sign out:",e),window.location.href="/auth"}},V=(e,s)=>{v({type:"dm",id:e,name:"@".concat(s)}),u("dashboard"),E(null)},Y=()=>{v({type:"global",name:"Global Chat"}),u("dashboard"),E(null)},Q=async()=>{},X=async()=>{if(!t)return;let e=(eb.findIndex(e=>e.id===t.hue)+1)%eb.length,s=eb[e].id;console.log("[dashboard] Cycling hue from",t.hue,"to",s);try{let e=await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({hue:s})});if(e.ok){let s=await e.json();console.log("[dashboard] Hue update successful:",s.user.hue),o(s.user)}else{let s=await e.json();console.error("[dashboard] Failed to update hue:",s.error||e.statusText),alert("Failed to change hue: ".concat(s.error||e.statusText))}}catch(e){console.error("[dashboard] Failed to update hue:",e),alert("An unexpected error occurred while changing hue: ".concat(e.message))}},ee=async e=>{try{let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)alert("Friend request sent!");else{let e=await s.json();alert("Failed to send friend request: ".concat(e.error))}}catch(e){console.error("Failed to send friend request:",e),alert("An error occurred while sending friend request")}};return c?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading..."})}):t?(0,a.jsxs)("div",{className:"relative min-h-screen bg-background",children:[(0,a.jsx)(eN,{}),(0,a.jsx)(I,{currentPage:x,onPageChange:e=>{"settings"===e?O.push("/settings"):"about"===e?O.push("/about"):"movies"===e?(O.push("/movies"),v({type:null,name:""}),E(null)):"games"===e?(O.push("/games"),v({type:null,name:""}),E(null)):"radio"===e?(O.push("/radio"),v({type:null,name:""}),E(null)):(u(e),"dashboard"!==e&&(v({type:null,name:""}),E(null)))},onSignOut:K,onGlobalChatClick:Y,onAIChatClick:()=>{v({type:"dm",id:"00000000-0000-0000-0000-00000000000a",name:"real.AI"}),u("dashboard"),E(null)},username:t.username,onThemeCycle:Q,onHueCycle:X}),(0,a.jsxs)("div",{className:"relative z-10 pt-24 px-4 pb-6",children:["dashboard"===x&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 min-h-[calc(100vh-8rem)]",children:[(0,a.jsxs)("div",{className:"lg:col-span-3 space-y-4",children:[(0,a.jsxs)(R.Zp,{className:"card-modern",children:[(0,a.jsx)(R.aR,{className:"pb-3",children:(0,a.jsxs)(R.ZB,{className:"flex items-center justify-between text-sm font-medium",children:[(0,a.jsx)("span",{children:"Group Chats"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"btn-ghost h-7 w-7",onClick:()=>_(!0),title:"Search Messages",children:(0,a.jsx)(ef.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"btn-ghost h-7 w-7",onClick:()=>b(!0),title:"Join Group Chat",children:(0,a.jsx)(g.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"btn-ghost h-7 w-7",onClick:()=>y(!0),title:"Create Group Chat",children:(0,a.jsx)(Z.A,{className:"h-3 w-3"})})]})]})}),(0,a.jsx)(R.Wu,{className:"pt-0",children:0===p.length?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 mx-auto mb-3 rounded-full bg-muted/30 flex items-center justify-center",children:(0,a.jsx)(L.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No group chats yet"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:"Create one to get started"})]}):(0,a.jsx)("div",{className:"space-y-1",children:p.map(e=>(0,a.jsx)("div",{className:"group",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.$,{variant:"ghost",className:"flex-1 justify-start text-left h-auto p-2 ".concat("group"===j.type&&j.id===e.id?"bg-muted/50 text-foreground":"hover:bg-muted/30"),onClick:()=>v({type:"group",id:e.id,name:e.name}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-muted/40 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(L.A,{className:"h-2.5 w-2.5"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-xs font-medium truncate",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground/60 truncate",children:["by ",e.creator_username]})]})]})}),(0,a.jsx)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:t.id===e.creator_id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>S(!0),className:"h-6 w-6 text-blue-500/70 hover:text-blue-500",title:"View Join Requests",children:(0,a.jsx)(q.A,{className:"h-2.5 w-2.5"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>W(e.id),className:"h-6 w-6 text-red-500/70 hover:text-red-500",title:"Delete Group Chat",children:(0,a.jsx)(G.A,{className:"h-2.5 w-2.5"})})]})})]})},e.id))})})]}),(0,a.jsx)(R.Zp,{className:"card-modern",children:(0,a.jsx)(eu,{currentUserId:t.id})}),(0,a.jsx)(R.Zp,{className:"card-modern",children:(0,a.jsx)(ep,{currentUserId:t.id,onViewAllPolls:()=>{u("polls"),E(null)}})})]}),(0,a.jsx)("div",{className:"lg:col-span-9",children:j.type?(0,a.jsx)("div",{className:"h-[calc(100vh-8rem)]",children:(0,a.jsx)($.l,{chatType:j.type,chatId:j.id,chatName:j.name,currentUserId:t.id,onUserClick:e=>{console.log("[dashboard] User clicked:",e),E(e),u("profile"),v({type:null,name:""})}})}):(0,a.jsx)("div",{className:"h-[calc(100vh-8rem)] flex items-center justify-center",children:(0,a.jsx)(R.Zp,{className:"card-modern w-full max-w-xl",children:(0,a.jsxs)(R.Wu,{className:"text-center py-12 px-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-4xl md:text-5xl font-black tracking-tight mb-3 text-foreground",children:"real."}),(0,a.jsx)("div",{className:"text-sm md:text-base text-muted-foreground font-light",children:"Where conversations come alive"})]}),(0,a.jsxs)("div",{className:"mb-8 space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"bg-muted/30 rounded-full px-3 py-1.5 text-xs text-muted-foreground",children:["Welcome back, ",(0,a.jsxs)("span",{className:"text-foreground font-medium",children:["@",t.username]})]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,a.jsx)(ej._,{large:!0}),(0,a.jsx)(ev.m,{})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-foreground mb-4",children:"Quick Start"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)(n.$,{className:"btn-primary h-12 flex items-center justify-center gap-2 text-sm",onClick:Y,children:[(0,a.jsx)(C.A,{className:"w-4 h-4"}),"Global Chat"]}),(0,a.jsxs)(n.$,{variant:"outline",className:"btn-secondary h-10 flex items-center justify-center gap-2 text-sm",onClick:()=>u("friends"),children:[(0,a.jsx)(L.A,{className:"w-4 h-4"}),"Friends"]}),(0,a.jsxs)(n.$,{variant:"outline",className:"btn-secondary h-10 flex items-center justify-center gap-2 text-sm",onClick:()=>u("channels"),children:[(0,a.jsx)(g.A,{className:"w-4 h-4"}),"Channels"]})]})]})]})})})})]})}),"friends"===x&&t&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(D.r,{currentUserId:t.id,onStartDM:V,onShowProfile:e=>{E(e),u("profile")}})}),"dms"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(z.s,{currentUserId:t.id,onSelectDM:V})}),"polls"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(J,{currentUserId:t.id,userSignupCode:t.signup_code})}),"channels"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(B,{currentUserId:t.id,userSignupCode:t.signup_code,onSelectChannel:(e,s)=>{v({type:"channel",id:e,name:"# ".concat(s)}),u("dashboard"),E(null)}})}),"calendar"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(H,{currentUserId:t.id})}),"voice"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(el,{})}),"movies"===x&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,a.jsx)(er.default,{})}),"games"===x&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,a.jsx)(en.A,{})}),"radio"===x&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,a.jsx)(ei.default,{})}),"profile"===x&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,a.jsx)(et,{userId:null!=F?F:void 0,onStartDM:V,onSendFriendRequest:ee})})]}),(0,a.jsx)(ec,{currentUserId:t.id}),N&&t&&(0,a.jsx)(eo.o,{onClose:()=>y(!1),onCreate:U}),w&&(0,a.jsx)(ed,{onClose:()=>b(!1),onJoinSuccess:e=>{alert("Join request sent to ".concat(e.name,"! The creator will be notified.")),M()}}),k&&(0,a.jsx)(eh,{groupChatId:(null===(e=p.find(e=>e.creator_id===(null==t?void 0:t.id)))||void 0===e?void 0:e.id)||"",groupChatName:(null===(s=p.find(e=>e.creator_id===(null==t?void 0:t.id)))||void 0===s?void 0:s.name)||"",onClose:()=>S(!1),onRequestProcessed:()=>{M()}}),A&&(0,a.jsx)(eg,{onClose:()=>_(!1),onMessageClick:(e,s)=>{if("global"===e)v({type:"global",name:"Global Chat"});else if("dm"===e)v({type:"dm",id:s,name:"Direct Message"});else if("group"===e){let e=p.find(e=>e.id===s);v({type:"group",id:s,name:(null==e?void 0:e.name)||"Group Chat"})}u("dashboard"),E(null)}}),(0,a.jsx)(ew,{isOpen:T,onClose:()=>P(!1)})]}):null}},5564:(e,s,t)=>{Promise.resolve().then(t.bind(t,2355))},9370:(e,s,t)=>{"use strict";t.d(s,{n:()=>h});var a=t(2432),l=t(364),r=t(3966),i=t(2708),n=t(7382),c=t(8055),o=t(3748),d=t(7700),m=t(2815);function h(e){let{roomId:s,userId:t,signalingUrl:h="https://realtalk-voice-server.onrender.com"}=e,[x,u]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[g,j]=(0,l.useState)([]),v=(0,l.useRef)(null),N=(0,l.useRef)(new Map),y=(0,l.useRef)(new Map),w=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let l=await fetch("/api/users/me",{cache:"no-store"});if(l.ok){var a;let e=await l.json();if(null==e?void 0:null===(a=e.user)||void 0===a?void 0:a.is_frozen)return}v.current=await navigator.mediaDevices.getUserMedia({audio:!0});let i=(0,r.Ay)(h,{transports:["websocket"]});w.current=i,i.on("connect",()=>u(!0)),i.on("disconnect",()=>u(!1)),i.emit("join-room",{roomId:s,userId:t}),i.on("room-peers",s=>{e&&(j(s),s.forEach(e=>{let{socketId:s}=e;return c(s)}))}),i.on("user-joined",s=>{let{socketId:t,userId:a}=s;e&&j(e=>e.concat([{socketId:t,userId:a}]))}),i.on("user-left",s=>{let{socketId:t}=s;if(!e)return;j(e=>e.filter(e=>e.socketId!==t));let a=y.current.get(t);null==a||a.close(),y.current.delete(t);let l=N.current.get(t);l&&(l.srcObject=null,l.remove(),N.current.delete(t))}),i.on("signal-offer",async e=>{let{from:s,description:t}=e,a=await n(s);await a.setRemoteDescription(t);let l=await a.createAnswer();await a.setLocalDescription(l),i.emit("signal-answer",{to:s,description:a.localDescription})}),i.on("signal-answer",async e=>{let{from:s,description:t}=e,a=await n(s);await a.setRemoteDescription(t)}),i.on("signal-ice-candidate",async e=>{let{from:s,candidate:t}=e,a=await n(s);try{await a.addIceCandidate(t)}catch(e){}});let n=async e=>{var s;let t=y.current.get(e);return t||(t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),y.current.set(e,t),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>t.addTrack(e,v.current)),t.ontrack=s=>{let[t]=s.streams,a=N.current.get(e);a||((a=new Audio).autoplay=!0,N.current.set(e,a)),a.srcObject=t},t.onicecandidate=s=>{s.candidate&&i.emit("signal-ice-candidate",{to:e,candidate:s.candidate})}),t},c=async e=>{let s=await n(e),t=await s.createOffer();await s.setLocalDescription(t),i.emit("signal-offer",{to:e,description:s.localDescription})}}catch(e){console.error("voice init error",e)}})(),()=>{var s;e=!1;let t=w.current;try{null==t||t.emit("leave-room"),null==t||t.disconnect()}catch(e){}y.current.forEach(e=>e.close()),y.current.clear(),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>e.stop())}},[s,t,h]),(0,a.jsxs)(n.Zp,{className:"glass-effect",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"})," Voice Room"]})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",x?"Connected":"Connecting..."," • Peers: ",g.length]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{onClick:()=>{f(e=>{var s;let t=!e;return null===(s=v.current)||void 0===s||s.getAudioTracks().forEach(e=>e.enabled=!t),t})},variant:p?"destructive":"default",children:[p?(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),p?"Unmute":"Mute"]}),(0,a.jsxs)(i.$,{onClick:()=>location.reload(),variant:"outline",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Leave"]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[4812,7,2261,2354,6782,6345,5849,3215,1163,5022,5575,7358],()=>s(5564)),_N_E=e.O()}]);