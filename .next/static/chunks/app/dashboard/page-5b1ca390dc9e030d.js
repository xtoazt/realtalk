(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1325:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});var t=a(2432);let l=(0,a(9759).default)(()=>a.e(836).then(a.bind(a,836)),{loadableGenerated:{webpack:()=>[836]},ssr:!1});function r(){return(0,t.jsxs)("div",{className:"max-w-7xl mx-auto animate-fadeIn px-4",children:[(0,t.jsx)("div",{className:"sticky top-4 z-10 mb-3",children:(0,t.jsx)("button",{onClick:()=>location.href="/dashboard",className:"text-xs px-3 py-1 rounded-full border backdrop-blur-md bg-white/40 dark:bg-black/30 text-black dark:text-white border-white/40 dark:border-white/20 hover:bg-white/60 dark:hover:bg-black/50",children:"Back to Dashboard"})}),(0,t.jsx)(l,{})]})}},2355:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ew});var t=a(2432),l=a(364),r=a(9262),i=a(7328),n=a(2708),c=a(1947),o=a(6589),d=a(4504),m=a(4963),h=a(7616);function u(e){let{className:s,size:a="default",variant:r="ghost"}=e,{theme:c,setTheme:u}=(0,i.D)(),{user:x,setUser:p}=(0,h.J)(),[f,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{g(!0)},[]);let j=async()=>{let e="light"===c?"dark":"light";if(u(e),x)try{(await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({theme:e})})).ok?p({...x,theme:e}):console.error("Failed to save theme preference")}catch(e){console.error("Error saving theme preference:",e)}};if(!f)return(0,t.jsx)(n.$,{variant:r,size:a,className:(0,m.cn)("animate-pulse",s),disabled:!0,children:(0,t.jsx)("div",{className:"h-4 w-4"})});let v={sm:"h-4 w-4",default:"h-5 w-5",lg:"h-6 w-6",icon:"h-4 w-4"};return(0,t.jsxs)(n.$,{variant:r,size:a,onClick:j,className:(0,m.cn)("transition-all duration-300 ease-in-out hover:scale-105","focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{sm:"h-8 w-8",default:"h-10 w-10",lg:"h-12 w-12",icon:"h-8 w-8"}[a],s),title:"Switch to ".concat("light"===c?"dark":"light"," mode"),children:["dark"===c?(0,t.jsx)(o.A,{className:(0,m.cn)("transition-transform duration-300",v[a])}):(0,t.jsx)(d.A,{className:(0,m.cn)("transition-transform duration-300",v[a])}),(0,t.jsx)("span",{className:"sr-only",children:"light"===c?"Switch to dark mode":"Switch to light mode"})]})}var x=a(6939),p=a(7693),f=a(5588),g=a(9861),j=a(9920),v=a(8055),N=a(1309),y=a(4010),b=a(4652),w=a(2121),k=a(1194),C=a(3394),S=a(6230),_=a(8175),A=a(7972),I=a(2664),F=a(4260);function E(e){let{currentPage:s,onPageChange:a,onSignOut:r,onGlobalChatClick:i,onAIChatClick:o,username:d,onThemeCycle:m,onHueCycle:h}=e,[E,T]=(0,l.useState)(!1),[$,D]=(0,l.useState)(!1),z=[{id:"dashboard",label:"Dashboard",icon:x.A},{id:"friends",label:"Friends",icon:p.A},{id:"dms",label:"DMs",icon:f.A},{id:"channels",label:"Channels",icon:g.A},{id:"polls",label:"Polls",icon:j.A},{id:"voice",label:"Voice",icon:v.A},{id:"calendar",label:"Calendar",icon:N.A},{id:"profile",label:"Profile",icon:y.A},{id:"settings",label:"Settings",icon:b.A},{id:"about",label:"About",icon:w.A}],P=e=>{$||(D(!0),T(e),setTimeout(()=>D(!1),300))},O=e=>{"global"===e?i():"ai-chat"===e?o():a(e)};return(0,t.jsx)("div",{className:"fixed z-50 transition-all duration-300 top-4 left-1/2 -translate-x-1/2",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-gray-900 via-black to-gray-900 dark:from-gray-800 dark:via-gray-900 dark:to-gray-800 text-white rounded-full transition-all duration-300 ease-out backdrop-blur-md border border-gray-700 dark:border-gray-600 ".concat(E?"px-4 py-2 min-w-[750px] shadow-2xl scale-105":"px-8 py-4 w-fit shadow-xl hover:shadow-2xl hover:scale-102"),onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),style:{background:E?"linear-gradient(135deg, rgba(17,24,39,0.95) 0%, rgba(0,0,0,0.98) 50%, rgba(17,24,39,0.95) 100%)":"linear-gradient(135deg, rgba(0,0,0,0.92) 0%, rgba(17,24,39,0.95) 100%)",boxShadow:E?"0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1)":"0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05)"},children:E?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1 py-1",children:[(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("global"),className:"h-8 w-8 text-white hover:bg-gray-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-gray-600/30",title:"Global",children:(0,t.jsx)(k.A,{className:"h-3 w-3"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("ai-chat"),className:"h-8 w-8 text-white hover:bg-blue-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-blue-600/30",title:"AI Chat",children:(0,t.jsx)(C.A,{className:"h-3 w-3"})}),(0,t.jsx)("div",{className:"w-px h-5 bg-gray-600 mx-1"}),z.map(e=>{let a=e.icon,l="channels"===e.id||"dms"===e.id||"polls"===e.id;return(0,t.jsxs)(n.$,{variant:s===e.id?"secondary":"ghost",size:l?"sm":"icon",onClick:()=>O(e.id),className:"h-8 ".concat(l?"px-3":"w-8"," transition-all duration-200 hover:scale-105 rounded-full ").concat(s===e.id?"bg-white text-black hover:bg-gray-100 shadow-lg border border-gray-300":"text-white hover:bg-gray-700/50 border border-gray-600/30"),children:[(0,t.jsx)(a,{className:"h-3 w-3"}),l&&(0,t.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:e.label})]},e.id)}),(0,t.jsxs)(c.AM,{children:[(0,t.jsx)(c.Wv,{asChild:!0,children:(0,t.jsxs)(n.$,{variant:"movies"===s||"games"===s||"radio"===s?"secondary":"ghost",size:"sm",className:"h-8 px-3 transition-all duration-200 hover:scale-105 rounded-full ".concat("movies"===s||"games"===s||"radio"===s?"bg-white text-black hover:bg-gray-100 shadow-lg border border-gray-300":"text-white hover:bg-gray-700/50 border border-gray-600/30"),title:"Entertainment",children:[(0,t.jsx)(S.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"ml-1 text-xs hidden md:inline",children:"Entertainment"})]})}),(0,t.jsx)(c.hl,{className:"w-48 p-2",align:"center",avoidCollisions:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("movies"),className:"justify-start gap-2",children:[(0,t.jsx)(S.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs",children:"Movies"})]}),(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("games"),className:"justify-start gap-2",children:[(0,t.jsx)(_.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs",children:"Games"})]}),(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("radio"),className:"justify-start gap-2",children:[(0,t.jsx)(A.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs",children:"Radio"})]})]})})]}),(0,t.jsx)("div",{className:"w-px h-5 bg-gray-600 mx-1"}),(0,t.jsx)(u,{size:"sm",variant:"ghost",className:"h-8 w-8 text-white hover:bg-purple-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-purple-600/30"}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:h,className:"h-8 w-8 text-white hover:bg-purple-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-purple-600/30",title:"Cycle Color",children:(0,t.jsx)(I.A,{className:"h-3 w-3"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:r,className:"h-8 w-8 text-white hover:bg-red-700/50 transition-all duration-200 hover:scale-105 rounded-full border border-red-600/30",title:"Sign out",children:(0,t.jsx)(F.A,{className:"h-3 w-3"})})]}):(0,t.jsxs)("div",{className:"flex items-center gap-3 transition-all duration-200",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-green-400 rounded-full animate-ping opacity-30"})]}),(0,t.jsx)("span",{className:"text-lg font-bold tracking-wide bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent",children:"real."}),(0,t.jsxs)("span",{className:"text-xs text-gray-300 opacity-80 font-medium",children:["@",d]})]})})})}var T=a(3143),$=a(129),D=a(9495),z=a(7304),P=a(6446),O=a(7382),Z=a(7759),R=a(5009),M=a(3079),L=a(5213),U=a(4329),q=a(3702),G=a(1823);function J(e){let{currentUserId:s,userSignupCode:a}=e,[r,i]=(0,l.useState)([]),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[h,u]=(0,l.useState)(!0),[x,p]=(0,l.useState)(null),[f,g]=(0,l.useState)(null),[v,N]=(0,l.useState)(""),[y,b]=(0,l.useState)(""),[w,C]=(0,l.useState)(["",""]),[S,_]=(0,l.useState)(!1),[A,I]=(0,l.useState)([]),[F,E]=(0,l.useState)(""),T=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls");if(e.ok){let s=await e.json();console.log("[polls-page] Fetched polls:",s.polls),i(s.polls)}else console.error("[polls-page] Failed to fetch polls:",e.status)}catch(e){console.error("Failed to fetch polls:",e)}finally{u(!1)}},[]),$=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();o(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{T(),$()},[T,$]);let D=async()=>{if(g(null),v.trim()&&!(w.filter(e=>e.trim()).length<2))try{let e=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.trim(),description:y.trim()||void 0,options:w.filter(e=>e.trim()),is_public:S,shared_with:A,expires_at:F||void 0})});if(e.ok)m(!1),B(),T();else{let s=await e.json();g("Failed to create poll: ".concat(s.error))}}catch(e){g("An unexpected error occurred while creating the poll.")}},J=async e=>{g(null);try{let s=await fetch("/api/polls/".concat(e),{method:"DELETE"});if(s.ok)T();else{let e=await s.json();g("Failed to delete poll: ".concat(e.error||s.statusText))}}catch(e){g("An unexpected error occurred while deleting the poll.")}},W=async(e,s)=>{console.log("[polls-page] Voting on poll ".concat(e," with option ").concat(s)),p(e);try{let a=await fetch("/api/polls/".concat(e,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:s})});if(a.ok)console.log("[polls-page] Vote successful, refreshing polls"),await T();else{let e=await a.json();console.error("Failed to vote:",e.error),alert("Failed to vote: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Failed to vote:",e),alert("An unexpected error occurred while voting.")}finally{p(null)}},B=()=>{N(""),b(""),C(["",""]),_(!1),I([]),E("")},K=e=>{w.length>2&&C(w.filter((s,a)=>a!==e))},V=(e,s)=>{let a=[...w];a[e]=s,C(a)},H=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",Y=e=>e?{color:e}:{},Q=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=e=>!!e&&new Date(e)<new Date,ee=(e,s)=>0===s?0:Math.round(e/s*100);return h?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading polls..."})}):(0,t.jsxs)("div",{className:"space-y-6 relative z-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Polls"}),(0,t.jsxs)(n.$,{onClick:()=>m(!0),className:"hover-lift hover-glow",children:[(0,t.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Create Poll"]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:0===r.length?(0,t.jsx)(O.Zp,{className:"glass-effect animate-fadeIn",children:(0,t.jsxs)(O.Wu,{className:"text-center py-8",children:[(0,t.jsx)(j.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No polls yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first poll to gather opinions!"})]})}):r.map((e,a)=>{let l=void 0!==e.user_response;return(0,t.jsxs)(O.Zp,{className:"glass-effect hover-lift animate-fadeIn ".concat(X(e.expires_at)?"opacity-75":""),style:{animationDelay:"".concat(.1*a,"s")},children:[(0,t.jsxs)(O.aR,{children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(O.ZB,{className:"text-lg",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.is_public?(0,t.jsx)(k.A,{className:"h-3 w-3 hue-accent"}):(0,t.jsx)(M.A,{className:"h-3 w-3"}),(0,t.jsx)(L.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[e.total_responses," votes"]}),e.expires_at&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:X(e.expires_at)?"text-red-500":"",children:X(e.expires_at)?"Expired":"Expires ".concat(Q(e.expires_at))})]})]}),e.creator_id===s&&(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>J(e.id),className:"text-red-500 hover:bg-red-500/10 h-6 w-6 p-0",title:"Delete Poll",children:(0,t.jsx)(q.A,{className:"h-3 w-3"})})]})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:e.creator_username?H(void 0,!1):"",children:["by @",e.creator_username]}),(0,t.jsxs)("span",{children:[void 0!==e.user_response?"You voted":"Click to vote"," • ",e.total_responses," total votes"]})]})]}),(0,t.jsxs)(O.Wu,{className:"space-y-3",children:[e.options.map((s,a)=>{let r=e.results.find(e=>e.option_index===a),i=(null==r?void 0:r.count)||0,c=ee(i,e.total_responses),o=e.user_response===a,d=x===e.id;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.$,{variant:o?"default":"outline",className:"flex-1 justify-start hover-lift transition-all duration-200 ".concat(o?"hue-shadow":""," ").concat(X(e.expires_at)?"":"cursor-pointer"),onClick:()=>!X(e.expires_at)&&!d&&W(e.id,a),disabled:X(e.expires_at)||d,children:[(0,t.jsx)("span",{className:"flex-1 text-left",children:s}),d&&(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin ml-2"})]}),l&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground ml-3 min-w-[60px] text-right",children:[i," (",c,"%)"]})]}),l&&(0,t.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,t.jsx)("div",{className:"h-2 rounded-full transition-all duration-700 ease-out ".concat(o?"bg-gradient-to-r from-blue-500 to-purple-500 hue-shadow":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(c,"%"),backgroundColor:o?"hsl(var(--hue) 60% 50%)":void 0}})})]},a)}),!X(e.expires_at)&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4 opacity-70",children:["Click on an option to ",l?"change your vote":"cast your vote"]})]})]},e.id)})}),d&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)(O.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto glass-effect animate-fadeIn",children:[(0,t.jsxs)(O.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(O.ZB,{children:"Create Poll"}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)(O.Wu,{className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(z.p,{value:v,onChange:e=>N(e.target.value),placeholder:"Poll title",className:"focus:hue-shadow"})}),(0,t.jsx)("div",{children:(0,t.jsx)(P.T,{value:y,onChange:e=>b(e.target.value),placeholder:"Description (optional)",rows:2,className:"focus:hue-shadow"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Options"}),w.map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(z.p,{value:e,onChange:e=>V(s,e.target.value),placeholder:"Option ".concat(s+1),className:"focus:hue-shadow"}),w.length>2&&(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>K(s),children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]},s)),w.length<6&&(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{w.length<6&&C([...w,""])},className:"hover-lift bg-transparent",children:[(0,t.jsx)(R.A,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(z.p,{type:"datetime-local",value:F,onChange:e=>E(e.target.value),className:"focus:hue-shadow"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional expiration date"})]}),"qwea"===a&&(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-3 hue-bg rounded-lg",children:[(0,t.jsx)(Z.S,{id:"public",checked:S,onCheckedChange:e=>_(!0===e)}),(0,t.jsx)("label",{htmlFor:"public",className:"text-sm font-medium",children:"Share with all users (public poll)"})]}),!S&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Share with friends"}),(0,t.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(Z.S,{id:e.friend_id,checked:A.includes(e.friend_id),onCheckedChange:s=>{s?I([...A,e.friend_id]):I(A.filter(s=>s!==e.friend_id))}}),(0,t.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:Y(e.friend_name_color),children:(0,t.jsxs)("span",{className:H(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{onClick:D,disabled:!v.trim()||w.filter(e=>e.trim()).length<2,className:"flex-1 hover-glow",children:"Create Poll"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})})]})}function W(e){let{currentUserId:s,userSignupCode:a,onSelectChannel:r}=e,[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),[u,x]=(0,l.useState)(""),p="qwea"===a,f=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/channels");if(e.ok){let s=await e.json();c(s.channels)}}finally{d(!1)}},[]);(0,l.useEffect)(()=>{f()},[f]);let j=(0,l.useMemo)(()=>i.filter(e=>e.is_system),[i]),v=(0,l.useMemo)(()=>i.filter(e=>!e.is_system),[i]),N=async e=>{if(!confirm("Delete this channel?"))return;let s=await fetch("/api/channels/".concat(e),{method:"DELETE"});if(s.ok)f();else{let e=await s.json().catch(()=>({}));alert("Failed to delete: ".concat(e.error||s.statusText))}},y=async()=>{if(p&&u.trim()){h(!0);try{let e=await fetch("/api/channels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.trim()})});if(e.ok)x(""),f();else{let s=await e.json().catch(()=>({}));alert("Failed to create channel: ".concat(s.error||e.statusText))}}finally{h(!1)}}};return o?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading channels..."})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Channels"}),p&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.p,{value:u,onChange:e=>x(e.target.value),placeholder:"Create a new channel",className:"w-48"}),(0,t.jsxs)(n.$,{onClick:y,disabled:!u.trim()||m,className:"hover-glow",children:[(0,t.jsx)(R.A,{className:"h-4 w-4 mr-1"})," Create"]})]})]}),(0,t.jsxs)(O.Zp,{className:"glass-effect",children:[(0,t.jsx)(O.aR,{children:(0,t.jsx)(O.ZB,{children:"Default"})}),(0,t.jsx)(O.Wu,{className:"space-y-2",children:0===j.length?(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No channels."}):j.map(e=>(0,t.jsxs)(n.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>r(e.id,e.name),children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"})," ",e.name]},e.id))})]}),v.length>0&&(0,t.jsxs)(O.Zp,{className:"glass-effect",children:[(0,t.jsx)(O.aR,{children:(0,t.jsx)(O.ZB,{children:"Created by Gold users"})}),(0,t.jsx)(O.Wu,{className:"space-y-2",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.$,{variant:"ghost",className:"flex-1 justify-start",onClick:()=>r(e.id,e.name),children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"})," ",e.name]}),e.creator_id===s&&(0,t.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>N(e.id),className:"text-red-500",children:(0,t.jsx)(q.A,{className:"h-4 w-4"})})]},e.id))})]})]})}var B=a(6334),K=a(855);function V(e){let{currentUserId:s}=e,[a,r]=(0,l.useState)([]),[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!0),[u,x]=(0,l.useState)(new Date),[p,f]=(0,l.useState)(""),[g,j]=(0,l.useState)(""),[v,y]=(0,l.useState)(""),[b,w]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[S,_]=(0,l.useState)([]),A=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/calendar");if(e.ok){let s=await e.json();r(s.events)}}catch(e){console.error("Failed to fetch events:",e)}finally{h(!1)}},[]),I=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{A(),I()},[A,I]);let F=async()=>{if(p.trim()&&v&&b)try{(await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p.trim(),description:g.trim()||void 0,start_time:v,end_time:b,is_collaborative:k,participants:S})})).ok&&(d(!1),E(),A())}catch(e){console.error("Failed to create event:",e)}},E=()=>{f(""),j(""),y(""),w(""),C(!1),_([])},T=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",$=e=>e?{color:e}:{},D=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=e=>{let s=e.toDateString();return a.filter(e=>new Date(e.start_time).toDateString()===s)},q=e=>{x(s=>{let a=new Date(s);return"prev"===e?a.setMonth(s.getMonth()-1):a.setMonth(s.getMonth()+1),a})},J=e=>{if(!e)return!1;let s=new Date;return e.toDateString()===s.toDateString()};if(m)return(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading calendar..."})});let W=(e=>{let s=e.getFullYear(),a=e.getMonth(),t=new Date(s,a,1),l=new Date(s,a+1,0).getDate(),r=t.getDay(),i=[];for(let e=0;e<r;e++)i.push(null);for(let e=1;e<=l;e++)i.push(new Date(s,a,e));return i})(u),V=u.toLocaleDateString([],{month:"long",year:"numeric"});return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Calendar"}),(0,t.jsxs)(n.$,{onClick:()=>d(!0),children:[(0,t.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Create Event"]})]}),(0,t.jsxs)(O.Zp,{children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(N.A,{className:"h-5 w-5"}),V]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>q("prev"),children:(0,t.jsx)(B.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>q("next"),children:(0,t.jsx)(K.A,{className:"h-4 w-4"})})]})]})}),(0,t.jsxs)(O.Wu,{children:[(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,t.jsx)("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:W.map((e,s)=>{let a=e?L(e):[];return(0,t.jsx)("div",{className:"min-h-[80px] p-1 border rounded-lg ".concat(e?"hover:bg-accent/50 cursor-pointer":""," ").concat(J(e)?"bg-primary/10 border-primary":""),children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-sm font-medium ".concat(J(e)?"text-primary":""),children:e.getDate()}),(0,t.jsxs)("div",{className:"space-y-1",children:[a.slice(0,2).map(e=>(0,t.jsx)("div",{className:"text-xs p-1 bg-primary/20 rounded truncate",title:e.title,children:e.title},e.id)),a.length>2&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",a.length-2," more"]})]})]})},s)})})]})]}),(0,t.jsxs)(O.Zp,{children:[(0,t.jsx)(O.aR,{children:(0,t.jsx)(O.ZB,{children:"Upcoming Events"})}),(0,t.jsx)(O.Wu,{children:0===a.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(U.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No events scheduled"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first event to get started!"})]}):(0,t.jsx)("div",{className:"space-y-3",children:a.filter(e=>new Date(e.start_time)>=new Date).sort((e,s)=>new Date(e.start_time).getTime()-new Date(s.start_time).getTime()).slice(0,5).map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:[D(e.start_time)," - ",D(e.end_time)]}),e.is_collaborative&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(M.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:"Collaborative"})]})]})]})}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Created by @",e.creator_username]})]},e.id))})})]}),o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)(O.Zp,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(O.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(O.ZB,{children:"Create Event"}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)(O.Wu,{className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(z.p,{value:p,onChange:e=>f(e.target.value),placeholder:"Event title"})}),(0,t.jsx)("div",{children:(0,t.jsx)(P.T,{value:g,onChange:e=>j(e.target.value),placeholder:"Description (optional)",rows:2})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Start Time"}),(0,t.jsx)(z.p,{type:"datetime-local",value:v,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"End Time"}),(0,t.jsx)(z.p,{type:"datetime-local",value:b,onChange:e=>w(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(Z.S,{id:"collaborative",checked:k,onCheckedChange:e=>C(!0===e)}),(0,t.jsx)("label",{htmlFor:"collaborative",className:"text-sm",children:"Make this a collaborative event"})]}),k&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Invite participants"}),(0,t.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(Z.S,{id:e.friend_id,checked:S.includes(e.friend_id),onCheckedChange:s=>{s?_([...S,e.friend_id]):_(S.filter(s=>s!==e.friend_id))}}),(0,t.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:$(e.friend_name_color),children:(0,t.jsxs)("span",{className:T(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{onClick:F,disabled:!p.trim()||!v||!b,className:"flex-1",children:"Create Event"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]})]})})]})}var H=a(1942),Y=a(4311),Q=a(3335),X=a(1873),ee=a(7709);function es(e){let{userId:s,onStartDM:a,onSendFriendRequest:r}=e,{user:i,setUser:c}=(0,h.J)(),[o,d]=(0,l.useState)(null),[m,u]=(0,l.useState)(!0),[x,g]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[N,b]=(0,l.useState)(!1),[w,k]=(0,l.useState)(""),[C,S]=(0,l.useState)(!1),[_,A]=(0,l.useState)(null),[I,F]=(0,l.useState)(""),[E,T]=(0,l.useState)(""),$=!s||s===(null==i?void 0:i.id),D=!!(null==i?void 0:i.has_gold_animation);(0,l.useEffect)(()=>{let e=async()=>{if(!$&&s&&i)try{let e=await fetch("/api/friends/check?userId=".concat(s));if(e.ok){let s=await e.json();A(s.friendship)}}catch(e){console.error("Failed to fetch friendship:",e)}};(async()=>{if($&&i)d(i),F(i.bio||""),T(i.profile_picture||"");else if(s)try{let e=await fetch("/api/users/".concat(s));if(e.ok){let s=await e.json();d(s.user)}}catch(e){console.error("Failed to fetch profile:",e)}u(!1)})(),e()},[s,i,$]);let z=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a){S(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(a.name)),{method:"POST",body:a});if(e.ok){let s=await e.json();T(s.url)}else{let s=await e.json();alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{S(!1)}}},Z=async()=>{if($){v(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile_picture:E||null,bio:I.trim()||null})});if(e.ok){let s=await e.json();c(s.user),d(s.user),g(!1)}else{let s=await e.json();alert("Failed to update profile: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to update profile:",e),alert("An unexpected error occurred while updating profile.")}finally{v(!1)}}};return m?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading profile..."})}):o?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:$?"Your Profile":"@".concat(o.username,"'s Profile")}),$&&(0,t.jsx)(n.$,{onClick:()=>g(!x),variant:x?"outline":"default",children:x?"Cancel":"Edit Profile"})]}),(0,t.jsxs)(O.Zp,{className:"glass-effect hover-lift animate-fadeIn",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(y.A,{className:"h-5 w-5"}),"Profile Information"]})}),(0,t.jsxs)(O.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"relative",children:[o.profile_picture?(0,t.jsx)(ee.default,{src:o.profile_picture||"/placeholder.svg",alt:"".concat(o.username,"'s profile"),width:100,height:100,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:(0,t.jsx)(y.A,{className:"h-12 w-12 text-gray-400"})}),x&&(0,t.jsxs)("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-2 cursor-pointer hover:bg-primary/90 transition-colors",children:[(0,t.jsx)(H.A,{className:"h-4 w-4"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:z,className:"hidden",disabled:C})]}),C&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-2xl font-bold ".concat(o.has_gold_animation&&o.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":""),style:o.has_gold_animation?{}:o.name_color?{color:o.name_color}:{},children:["@",o.username]}),o.custom_title&&(0,t.jsx)("p",{className:"text-sm italic text-muted-foreground mt-1",children:o.custom_title}),o.signup_code&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:["asdf"===o.signup_code&&"✨ Custom Colors","qwea"===o.signup_code&&"\uD83D\uDC51 Gold Member"]})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),x?(0,t.jsx)(P.T,{value:I,onChange:e=>F(e.target.value),placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"resize-none"}):(0,t.jsx)("div",{className:"min-h-[100px] p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:o.bio?(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:o.bio}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground italic",children:$?"Add a bio to tell others about yourself":"No bio available"})}),x&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[I.length,"/500 characters"]})]}),(0,t.jsx)("div",{className:"flex gap-3",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.$,{onClick:Z,disabled:j,className:"flex-1",children:j?"Saving...":"Save Changes"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>g(!1),disabled:j,children:"Cancel"})]}):$?null:(0,t.jsxs)(t.Fragment,{children:[(null==_?void 0:_.status)==="accepted"?(0,t.jsxs)(n.$,{onClick:()=>null==a?void 0:a(o.id,o.username),className:"flex-1",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),"Send Message"]}):(0,t.jsxs)(n.$,{disabled:!0,className:"flex-1 opacity-50 cursor-not-allowed",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),(null==_?void 0:_.status)==="pending"?"Friend Request Pending":"Add Friend to Message"]}),_&&"blocked"!==_.status?"pending"===_.status?(0,t.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Request Sent"]}):(0,t.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Friends"]}):(0,t.jsxs)(n.$,{variant:"outline",onClick:()=>null==r?void 0:r(o.id),children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Add Friend"]}),D&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.$,{variant:"destructive",onClick:()=>b(!0),children:[(0,t.jsx)(Q.A,{className:"h-4 w-4 mr-2"})," Freeze"]}),(0,t.jsxs)(n.$,{variant:"outline",onClick:async()=>{try{await fetch("/api/freeze?targetUserId=".concat(o.id),{method:"DELETE"}),alert("User unfrozen")}catch(e){alert("Failed to unfreeze")}},children:[(0,t.jsx)(X.A,{className:"h-4 w-4 mr-2"})," Unfreeze"]})]})]})})]})]}),N&&(0,t.jsx)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/50",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white dark:bg-gray-900 rounded-xl p-4 border",children:[(0,t.jsxs)("div",{className:"text-lg font-semibold mb-2",children:["Freeze @",o.username]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Only gold members can do this. The user will be prevented from typing or using voice."}),(0,t.jsx)("textarea",{className:"w-full border rounded p-2 text-sm mb-3",rows:3,placeholder:"Optional message shown on their screen",value:w,onChange:e=>k(e.target.value)}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)(n.$,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.$,{variant:"secondary",onClick:async()=>{let e=prompt("Popup message to show immediately (optional)")||"";if(e)try{await fetch("/api/freeze/popup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,popupMessage:e})}),alert("Popup sent")}catch(e){alert("Failed to send popup")}},children:[(0,t.jsx)(f.A,{className:"h-4 w-4 mr-1"})," Send Popup"]}),(0,t.jsxs)(n.$,{variant:"destructive",onClick:async()=>{try{let e=await fetch("/api/freeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,message:w})});if(e.ok)alert("User frozen"),b(!1),k("");else{let s=await e.json();alert(s.error||"Failed to freeze")}}catch(e){alert("Failed to freeze")}},children:[(0,t.jsx)(Q.A,{className:"h-4 w-4 mr-1"})," Confirm Freeze"]})]})]})]})})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Profile not found"})})}var ea=a(9370);function et(){let{user:e}=(0,h.J)();return e?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(ea.n,{roomId:"global-voice",userId:e.id}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{id:"voice-enable-widget",type:"checkbox",defaultChecked:"1"===localStorage.getItem("voiceWidgetEnabled"),onChange:e=>{localStorage.setItem("voiceWidgetEnabled",e.target.checked?"1":"0"),window.dispatchEvent(new Event("voice-widget-toggle"))}}),(0,t.jsx)("label",{htmlFor:"voice-enable-widget",children:"Enable floating voice widget across pages"})]})]}):null}var el=a(3215),er=a(1325),ei=a(3544);function en(e){return null}var ec=a(4992);function eo(e){let{onClose:s,onJoinSuccess:a}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(""),h=async e=>{if(e.preventDefault(),r.trim()){o(!0),m("");try{let e=await fetch("/api/group-chats/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortCode:r.trim().toUpperCase()})}),t=await e.json();e.ok?(a(t.groupChat),s()):m(t.error||"Failed to join group chat")}catch(e){m("An unexpected error occurred")}finally{o(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsxs)(O.Zp,{className:"w-full max-w-md mx-4",children:[(0,t.jsxs)(O.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Join Group Chat"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,t.jsx)(O.Wu,{children:(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Enter Group Code"}),(0,t.jsx)(z.p,{value:r,onChange:e=>i(e.target.value.toUpperCase()),placeholder:"e.g., ABC123",maxLength:6,className:"text-center text-lg font-mono tracking-wider",disabled:c}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"6-character code provided by the group creator"})]}),d&&(0,t.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:d}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{type:"submit",disabled:!r.trim()||c,className:"flex-1",children:c?"Joining...":"Join Group"}),(0,t.jsx)(n.$,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})})]})})}var ed=a(3491);function em(e){let{groupChatId:s,groupChatName:a,onClose:r,onRequestProcessed:i}=e,[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[h,u]=(0,l.useState)(null);(0,l.useEffect)(()=>{x()},[s]);let x=async()=>{try{let e=await fetch("/api/group-chats/".concat(s,"/requests"));if(e.ok){let s=await e.json();o(s.requests)}}catch(e){console.error("Failed to fetch requests:",e)}finally{m(!1)}},p=async(e,a,t)=>{u(e);try{let l=await fetch("/api/group-chats/".concat(s,"/requests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestId:e,requesterId:a,action:t})});if(l.ok)o(s=>s.filter(s=>s.id!==e)),i();else{let e=await l.json();alert(e.error||"Failed to process request")}}catch(e){alert("An error occurred while processing the request")}finally{u(null)}},f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return d?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsx)(O.Zp,{className:"w-full max-w-md mx-4",children:(0,t.jsxs)(O.Wu,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading requests..."})]})})}):(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsxs)(O.Zp,{className:"w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[(0,t.jsxs)(O.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(U.A,{className:"h-5 w-5"}),"Join Requests"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)(O.Wu,{className:"p-0",children:[(0,t.jsx)("div",{className:"px-6 pb-2",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Pending requests for ",(0,t.jsx)("strong",{children:a})]})}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===c.length?(0,t.jsxs)("div",{className:"px-6 py-8 text-center text-muted-foreground",children:[(0,t.jsx)(y.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No pending join requests"})]}):(0,t.jsx)("div",{className:"space-y-2 px-6 pb-6",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-sm",children:["@",e.username]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:f(e.created_at)})]})]}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"approve"),disabled:h===e.id,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:(0,t.jsx)(ed.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"reject"),disabled:h===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]})]},e.id))})})]})]})})}var eh=a(3868);function eu(e){let{currentUserId:s}=e,[a,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),c=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/users/online");if(e.ok){let s=await e.json();r(s.onlineUsers)}}catch(e){console.error("Failed to fetch online users:",e)}finally{n(!1)}},[]),o=(0,l.useCallback)(async()=>{try{await fetch("/api/user/activity",{method:"POST"})}catch(e){console.error("Failed to update activity:",e)}},[]);(0,l.useEffect)(()=>{c(),o();let e=setInterval(o,12e4),s=setInterval(c,3e4);return()=>{clearInterval(e),clearInterval(s)}},[c,o]);let d=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",m=e=>e?{color:e}:{};return i?(0,t.jsxs)(O.Zp,{className:"animate-fadeIn",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(M.A,{className:"h-5 w-5"}),"Online Friends"]})}),(0,t.jsx)(O.Wu,{children:(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground animate-pulse",children:"Loading..."})})]}):(0,t.jsxs)(O.Zp,{className:"animate-fadeIn",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(eh.A,{className:"h-5 w-5 text-green-500"}),"Online Friends (",a.length,")"]})}),(0,t.jsx)(O.Wu,{children:0===a.length?(0,t.jsxs)("div",{className:"text-center py-4 text-muted-foreground",children:[(0,t.jsx)(M.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No online friends"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Add some friends to see them here!"})]}):(0,t.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent/50 transition-colors",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,t.jsxs)("span",{className:e.has_gold_animation?d(void 0,!0):"text-sm",style:e.has_gold_animation?{}:m(e.name_color),children:["@",e.username]})]},e.id))})})]})}function ex(e){var s;let{currentUserId:a,onViewAllPolls:r}=e,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),u=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls/recent?userId=".concat(a));if(e.ok){let s=await e.json();c(s.poll)}}catch(e){console.error("Failed to fetch recent poll:",e)}finally{d(!1)}},[a]);(0,l.useEffect)(()=>{u()},[u]);let x=async e=>{if(i&&!m){h(!0);try{let s=await fetch("/api/polls/".concat(i.id,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:e})});if(s.ok)await u();else{let e=await s.json();console.error("Failed to vote:",e.error)}}catch(e){console.error("Failed to vote:",e)}finally{h(!1)}}},p=(e,s)=>0===s?0:Math.round(e/s*100);if(o)return(0,t.jsxs)(O.Zp,{className:"glass-effect animate-fadeIn",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-5 w-5"}),"Latest Poll"]})}),(0,t.jsx)(O.Wu,{children:(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground animate-pulse",children:"Loading..."})})]});if(!i)return(0,t.jsxs)(O.Zp,{className:"glass-effect animate-fadeIn",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-5 w-5"}),"Latest Poll"]})}),(0,t.jsx)(O.Wu,{children:(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)(j.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No polls available"}),(0,t.jsx)(n.$,{variant:"outline",size:"sm",className:"mt-2 bg-transparent hover-lift",onClick:r,children:"View All Polls"})]})})]});let f=void 0!==i.user_response,g=!!(s=i.expires_at)&&new Date(s)<new Date;return(0,t.jsxs)(O.Zp,{className:"glass-effect animate-fadeIn hover-lift ".concat(g?"opacity-75":""),children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-5 w-5"}),"Latest Poll"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-xs hover-lift",children:"View All"})]})}),(0,t.jsxs)(O.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:i.title}),i.description&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:i.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[i.is_public?(0,t.jsx)(k.A,{className:"h-3 w-3 hue-accent"}):(0,t.jsx)(M.A,{className:"h-3 w-3"}),(0,t.jsx)(L.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[i.total_responses," votes"]}),i.expires_at&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(U.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:g?"text-red-500":"",children:g?"Expired":"Expires ".concat(new Date(i.expires_at).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[i.options.slice(0,2).map((e,s)=>{let a=i.results.find(e=>e.option_index===s),l=(null==a?void 0:a.count)||0,r=p(l,i.total_responses),c=i.user_response===s;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.$,{variant:c?"default":"outline",size:"sm",className:"flex-1 justify-start text-xs h-7 hover-lift transition-all duration-200 ".concat(c?"hue-shadow":""),onClick:()=>!f&&!g&&!m&&x(s),disabled:f||g||m,children:[(0,t.jsx)("span",{className:"flex-1 text-left",children:e}),m&&(0,t.jsx)("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin ml-1"})]}),f&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-2 min-w-[45px] text-right",children:[l," (",r,"%)"]})]}),f&&(0,t.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1",children:(0,t.jsx)("div",{className:"h-1 rounded-full transition-all duration-500 ".concat(c?"hue-bg":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(r,"%"),backgroundColor:c?"hsl(var(--hue) 50% 50%)":void 0}})})]},s)}),i.options.length>2&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:["+",i.options.length-2," more options"]})]}),!f&&!g&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center opacity-70",children:"Click an option to vote"})]})]})}var ep=a(8725);function ef(e){let{onClose:s,onMessageClick:a}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>{r.trim().length>=2?h():o([])},500);return()=>clearTimeout(e)},[r]);let h=async()=>{m(!0);try{let e=await fetch("/api/messages/search?q=".concat(encodeURIComponent(r.trim())));if(e.ok){let s=await e.json();o(s.messages||[])}}catch(e){console.error("Failed to search messages:",e)}finally{m(!1)}},u=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",x=e=>e?{color:e}:{},p=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=e=>"global"===e.chat_type?"Global Chat":"dm"===e.chat_type?"Direct Message":"Group Chat";return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)(O.Zp,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[(0,t.jsxs)(O.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)(O.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.A,{className:"h-5 w-5"}),"Search Messages"]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,t.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)(O.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(z.p,{value:r,onChange:e=>i(e.target.value),placeholder:"Search messages...",className:"flex-1",autoFocus:!0}),d&&(0,t.jsx)("div",{className:"flex items-center px-3",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:r.trim().length<2?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(ep.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Type at least 2 characters to search"})]}):0!==c.length||d?c.map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>{null==a||a(e.chat_type,e.chat_id),s()},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsxs)("span",{className:e.has_gold_animation?u(void 0,!0):"text-sm font-medium",style:e.has_gold_animation?{}:x(e.name_color),children:["@",e.username]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:f(e)}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:p(e.created_at)})]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"image"===e.message_type?"\uD83D\uDCF7 Shared an image":e.content})]},e.id)):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(Y.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsxs)("p",{children:['No messages found for "',r,'"']})]})})]})]})})}var eg=a(2548),ej=a(4188);function ev(){let e=(0,r.useRouter)(),[s,a]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{localStorage.getItem("seen-mode-gate")||a(!0)}catch(e){}},[]),(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem("refreshed-after-auth");"/dashboard"!==location.pathname&&"/dashboard/lite"!==location.pathname||e||(sessionStorage.setItem("refreshed-after-auth","1"),location.reload())}catch(e){}},[]);let i=s=>{try{localStorage.setItem("seen-mode-gate","1")}catch(e){}"lite"===s?e.push("/dashboard/lite"):e.push("/dashboard")};return s?(0,t.jsx)("div",{className:"fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-[90%] max-w-md border",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Choose your experience"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Pick a UI mode. You can change this later in Settings."}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("button",{onClick:()=>i("lite"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:"Lite"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Minimal and fast. Global chat, Friends, DMs, Settings, Group Chats."})]}),(0,t.jsxs)("button",{onClick:()=>i("full"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:"Full"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Full experience with entertainment, voice, polls, and more."})]})]})]})}):null}var eN=a(5501);function ey(e){var s,a;let{isOpen:r,onClose:i}=e,[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(!1),[u,x]=(0,l.useState)(""),[p,f]=(0,l.useState)(null),{user:g}=(0,h.J)(),j=(null==g?void 0:g.signup_code)==="qwea";(0,l.useEffect)(()=>{r&&v()},[r]),(0,l.useEffect)(()=>{let e=()=>{};return window.addEventListener("geminiKeyExhausted",e),()=>window.removeEventListener("geminiKeyExhausted",e)},[j]);let v=()=>{f((0,eN.BW)())},N=async()=>{if(!c.trim()){x("Please enter a valid API key");return}m(!0),x("");try{let e=await (0,eN.eE)(c,(null==g?void 0:g.username)||"Unknown");e.success?(x("API key added successfully! \uD83C\uDF89"),o(""),v()):x(e.message)}catch(e){x("Error adding API key. Please try again.")}finally{m(!1)}};return r?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Gemini API Key Management"}),!j&&(0,t.jsx)("div",{className:"text-red-600 mb-4",children:"Only gold members can add or manage Gemini API keys."}),(null==p?void 0:p.error)&&(0,t.jsx)("div",{className:"text-red-600 mb-2",children:p.error}),!(null==p?void 0:p.hasAvailableKeys)&&(0,t.jsx)("div",{className:"text-yellow-600 mb-2",children:"No available Gemini API keys. Please add a new one to restore AI features for all users."}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Current keys: ",null!==(s=null==p?void 0:p.totalKeys)&&void 0!==s?s:0]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Exhausted keys: ",null!==(a=null==p?void 0:p.exhaustedKeys)&&void 0!==a?a:0]})]}),j&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 mb-2",placeholder:"Enter Gemini API key (starts with AIza)",value:c,onChange:e=>o(e.target.value),disabled:d}),(0,t.jsx)(n.$,{onClick:N,disabled:d,className:"w-full mb-2",children:d?"Adding...":"Add API Key"}),(0,t.jsx)(n.$,{onClick:()=>{v(),x("Key status refreshed")},variant:"outline",className:"w-full",children:"Refresh Key Status"})]}),u&&(0,t.jsx)("div",{className:"text-sm text-blue-600 mb-2",children:u}),(0,t.jsx)(n.$,{onClick:i,variant:"secondary",className:"w-full mt-2",children:"Close"})]})}):null}let eb=[{id:"blue",name:"Blue"},{id:"purple",name:"Purple"},{id:"pink",name:"Pink"},{id:"red",name:"Red"},{id:"orange",name:"Orange"},{id:"yellow",name:"Yellow"},{id:"green",name:"Green"},{id:"teal",name:"Teal"}];function ew(){var e,s;let{user:a,loading:c,setUser:o}=(0,h.J)(),{theme:d,setTheme:m}=(0,i.D)(),[u,x]=(0,l.useState)("dashboard"),[p,f]=(0,l.useState)([]),[j,v]=(0,l.useState)({type:null,name:""}),[N,y]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[S,_]=(0,l.useState)(!1),[A,I]=(0,l.useState)(null),[F,z]=(0,l.useState)(!1),P=(0,r.useRouter)(),Z=(0,l.useCallback)(async()=>{if(a)try{let e=await fetch("/api/group-chats");if(e.ok){let s=await e.json();f(s.groupChats)}else console.error("Failed to fetch group chats:",e.status,await e.text())}catch(e){console.error("Failed to fetch group chats:",e)}},[a]);(0,l.useEffect)(()=>{!c&&a&&Z()},[c,a,Z]),(0,l.useEffect)(()=>{let e=e=>{let{type:s,id:a,name:t}=e.detail;v({type:s,id:a,name:t})};return window.addEventListener("navigateToChat",e),()=>{window.removeEventListener("navigateToChat",e)}},[]),(0,l.useEffect)(()=>{let e=()=>{(null==a?void 0:a.signup_code)==="qwea"&&z(!0)};return window.addEventListener("geminiKeyExhausted",e),()=>{window.removeEventListener("geminiKeyExhausted",e)}},[a]);let L=async(e,s)=>{try{let a=await fetch("/api/group-chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,memberIds:s})});if(a.ok){let e=await a.json();f(s=>[e.groupChat,...s]),y(!1),v({type:"group",id:e.groupChat.id,name:e.groupChat.name}),x("dashboard"),e.groupChat.short_code&&alert("Group chat created! Share this code with others: ".concat(e.groupChat.short_code))}else console.error("Failed to create group chat:",a.status,await a.text())}catch(e){console.error("Failed to create group chat:",e)}},G=async e=>{if(a&&confirm("Are you sure you want to delete this group chat? This action cannot be undone."))try{let s=await fetch("/api/group-chats/".concat(e),{method:"DELETE"});if(s.ok)console.log("Group chat ".concat(e," deleted successfully.")),Z(),"group"===j.type&&j.id===e&&v({type:null,name:""});else{let e=await s.json();console.error("Failed to delete group chat:",e.error||s.statusText),alert("Failed to delete group chat: ".concat(e.error||s.statusText))}}catch(e){console.error("Failed to delete group chat:",e),alert("An unexpected error occurred while deleting the group chat.")}},B=async()=>{try{let e=await fetch("/api/auth/signout",{method:"POST",credentials:"include"});e.ok?o(null):console.error("Sign out failed:",e.status),window.location.href="/auth"}catch(e){console.error("Failed to sign out:",e),window.location.href="/auth"}},K=(e,s)=>{v({type:"dm",id:e,name:"@".concat(s)}),x("dashboard"),I(null)},H=()=>{v({type:"global",name:"Global Chat"}),x("dashboard"),I(null)},Y=async()=>{},Q=async()=>{if(!a)return;let e=(eb.findIndex(e=>e.id===a.hue)+1)%eb.length,s=eb[e].id;console.log("[dashboard] Cycling hue from",a.hue,"to",s);try{let e=await fetch("/api/user/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({hue:s})});if(e.ok){let s=await e.json();console.log("[dashboard] Hue update successful:",s.user.hue),o(s.user)}else{let s=await e.json();console.error("[dashboard] Failed to update hue:",s.error||e.statusText),alert("Failed to change hue: ".concat(s.error||e.statusText))}}catch(e){console.error("[dashboard] Failed to update hue:",e),alert("An unexpected error occurred while changing hue: ".concat(e.message))}},X=async e=>{try{let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)alert("Friend request sent!");else{let e=await s.json();alert("Failed to send friend request: ".concat(e.error))}}catch(e){console.error("Failed to send friend request:",e),alert("An error occurred while sending friend request")}};return c?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading..."})}):a?(0,t.jsxs)("div",{className:"relative min-h-screen bg-background",children:[(0,t.jsx)(ev,{}),(0,t.jsx)(E,{currentPage:u,onPageChange:e=>{"settings"===e?P.push("/settings"):"about"===e?P.push("/about"):"movies"===e?(P.push("/movies"),v({type:null,name:""}),I(null)):"games"===e?(P.push("/games"),v({type:null,name:""}),I(null)):"radio"===e?(P.push("/radio"),v({type:null,name:""}),I(null)):(x(e),"dashboard"!==e&&(v({type:null,name:""}),I(null)))},onSignOut:B,onGlobalChatClick:H,onAIChatClick:()=>{v({type:"dm",id:"00000000-0000-0000-0000-00000000000a",name:"real.AI"}),x("dashboard"),I(null)},username:a.username,onThemeCycle:Y,onHueCycle:Q}),(0,t.jsxs)("div",{className:"relative z-10 pt-20 px-4 pb-4 animate-fadeIn",children:["dashboard"===u&&(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"w-full md:w-80 space-y-4 flex-shrink-0",children:[(0,t.jsxs)(O.Zp,{className:"animate-fadeIn glass",children:[(0,t.jsx)(O.aR,{children:(0,t.jsxs)(O.ZB,{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Group Chats"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>_(!0),title:"Search Messages",children:(0,t.jsx)(ep.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>w(!0),title:"Join Group Chat",children:(0,t.jsx)(g.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>y(!0),children:(0,t.jsx)(R.A,{className:"h-4 w-4"})})]})]})}),(0,t.jsx)(O.Wu,{children:0===p.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No group chats yet"}):(0,t.jsx)("div",{className:"space-y-1",children:p.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.$,{variant:"group"===j.type&&j.id===e.id?"default":"ghost",className:"flex-1 justify-start text-left transition-all duration-200 hover:scale-102",onClick:()=>v({type:"group",id:e.id,name:e.name}),children:[(0,t.jsx)(M.A,{className:"h-4 w-4 mr-2 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:e.name})]}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:a.id===e.creator_id&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"text-blue-500 hover:bg-blue-500/10",title:"View Join Requests",children:(0,t.jsx)(U.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>G(e.id),className:"text-red-500 hover:bg-red-500/10",title:"Delete Group Chat",children:(0,t.jsx)(q.A,{className:"h-4 w-4"})})]})})]},e.id))})})]}),(0,t.jsx)(O.Zp,{className:"glass",children:(0,t.jsx)(eu,{currentUserId:a.id})}),(0,t.jsx)(O.Zp,{className:"glass",children:(0,t.jsx)(ex,{currentUserId:a.id,onViewAllPolls:()=>{x("polls"),I(null)}})})]}),(0,t.jsx)("div",{className:"flex-1 h-full",children:j.type?(0,t.jsx)("div",{className:"animate-fadeIn",children:(0,t.jsx)(T.l,{chatType:j.type,chatId:j.id,chatName:j.name,currentUserId:a.id,onUserClick:e=>{console.log("[dashboard] User clicked:",e),I(e),x("profile"),v({type:null,name:""})}})}):(0,t.jsx)(O.Zp,{className:"h-full flex items-center justify-center glass",children:(0,t.jsxs)(O.Wu,{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-5xl md:text-7xl font-black tracking-tighter text-gradient",children:"real."}),(0,t.jsxs)("div",{className:"mt-6 flex flex-col items-center gap-2",children:[(0,t.jsx)(eg._,{large:!0}),(0,t.jsx)(ej.m,{})]}),(0,t.jsxs)("div",{className:"mt-6 text-sm text-muted-foreground",children:["Welcome back @",a.username]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2 justify-center",children:[(0,t.jsx)(n.$,{variant:"modern",onClick:H,children:"Global Chat"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>x("friends"),children:"Friends"}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>x("channels"),children:"Channels"})]})]})})})]}),"friends"===u&&a&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)($.r,{currentUserId:a.id,onStartDM:K,onShowProfile:e=>{I(e),x("profile")}})}),"dms"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(D.s,{currentUserId:a.id,onSelectDM:K})}),"polls"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(J,{currentUserId:a.id,userSignupCode:a.signup_code})}),"channels"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(W,{currentUserId:a.id,userSignupCode:a.signup_code,onSelectChannel:(e,s)=>{v({type:"channel",id:e,name:"# ".concat(s)}),x("dashboard"),I(null)}})}),"calendar"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(V,{currentUserId:a.id})}),"voice"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(et,{})}),"movies"===u&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(el.default,{})}),"games"===u&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(ei.A,{})}),"radio"===u&&(0,t.jsx)("div",{className:"max-w-7xl mx-auto animate-fadeIn",children:(0,t.jsx)(er.default,{})}),"profile"===u&&(0,t.jsx)("div",{className:"max-w-4xl mx-auto animate-slideIn",children:(0,t.jsx)(es,{userId:null!=A?A:void 0,onStartDM:K,onSendFriendRequest:X})})]}),(0,t.jsx)(en,{currentUserId:a.id}),N&&a&&(0,t.jsx)(ec.o,{onClose:()=>y(!1),onCreate:L}),b&&(0,t.jsx)(eo,{onClose:()=>w(!1),onJoinSuccess:e=>{alert("Join request sent to ".concat(e.name,"! The creator will be notified.")),Z()}}),k&&(0,t.jsx)(em,{groupChatId:(null===(e=p.find(e=>e.creator_id===(null==a?void 0:a.id)))||void 0===e?void 0:e.id)||"",groupChatName:(null===(s=p.find(e=>e.creator_id===(null==a?void 0:a.id)))||void 0===s?void 0:s.name)||"",onClose:()=>C(!1),onRequestProcessed:()=>{Z()}}),S&&(0,t.jsx)(ef,{onClose:()=>_(!1),onMessageClick:(e,s)=>{if("global"===e)v({type:"global",name:"Global Chat"});else if("dm"===e)v({type:"dm",id:s,name:"Direct Message"});else if("group"===e){let e=p.find(e=>e.id===s);v({type:"group",id:s,name:(null==e?void 0:e.name)||"Group Chat"})}x("dashboard"),I(null)}}),(0,t.jsx)(ey,{isOpen:F,onClose:()=>z(!1)})]}):null}},5564:(e,s,a)=>{Promise.resolve().then(a.bind(a,2355))},9370:(e,s,a)=>{"use strict";a.d(s,{n:()=>h});var t=a(2432),l=a(364),r=a(3966),i=a(2708),n=a(7382),c=a(8055),o=a(3748),d=a(7700),m=a(2815);function h(e){let{roomId:s,userId:a,signalingUrl:h="https://realtalk-voice-server.onrender.com"}=e,[u,x]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[g,j]=(0,l.useState)([]),v=(0,l.useRef)(null),N=(0,l.useRef)(new Map),y=(0,l.useRef)(new Map),b=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let l=await fetch("/api/users/me",{cache:"no-store"});if(l.ok){var t;let e=await l.json();if(null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.is_frozen)return}v.current=await navigator.mediaDevices.getUserMedia({audio:!0});let i=(0,r.Ay)(h,{transports:["websocket"]});b.current=i,i.on("connect",()=>x(!0)),i.on("disconnect",()=>x(!1)),i.emit("join-room",{roomId:s,userId:a}),i.on("room-peers",s=>{e&&(j(s),s.forEach(e=>{let{socketId:s}=e;return c(s)}))}),i.on("user-joined",s=>{let{socketId:a,userId:t}=s;e&&j(e=>e.concat([{socketId:a,userId:t}]))}),i.on("user-left",s=>{let{socketId:a}=s;if(!e)return;j(e=>e.filter(e=>e.socketId!==a));let t=y.current.get(a);null==t||t.close(),y.current.delete(a);let l=N.current.get(a);l&&(l.srcObject=null,l.remove(),N.current.delete(a))}),i.on("signal-offer",async e=>{let{from:s,description:a}=e,t=await n(s);await t.setRemoteDescription(a);let l=await t.createAnswer();await t.setLocalDescription(l),i.emit("signal-answer",{to:s,description:t.localDescription})}),i.on("signal-answer",async e=>{let{from:s,description:a}=e,t=await n(s);await t.setRemoteDescription(a)}),i.on("signal-ice-candidate",async e=>{let{from:s,candidate:a}=e,t=await n(s);try{await t.addIceCandidate(a)}catch(e){}});let n=async e=>{var s;let a=y.current.get(e);return a||(a=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),y.current.set(e,a),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>a.addTrack(e,v.current)),a.ontrack=s=>{let[a]=s.streams,t=N.current.get(e);t||((t=new Audio).autoplay=!0,N.current.set(e,t)),t.srcObject=a},a.onicecandidate=s=>{s.candidate&&i.emit("signal-ice-candidate",{to:e,candidate:s.candidate})}),a},c=async e=>{let s=await n(e),a=await s.createOffer();await s.setLocalDescription(a),i.emit("signal-offer",{to:e,description:s.localDescription})}}catch(e){console.error("voice init error",e)}})(),()=>{var s;e=!1;let a=b.current;try{null==a||a.emit("leave-room"),null==a||a.disconnect()}catch(e){}y.current.forEach(e=>e.close()),y.current.clear(),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>e.stop())}},[s,a,h]),(0,t.jsxs)(n.Zp,{className:"glass-effect",children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5"})," Voice Room"]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",u?"Connected":"Connecting..."," • Peers: ",g.length]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.$,{onClick:()=>{f(e=>{var s;let a=!e;return null===(s=v.current)||void 0===s||s.getAudioTracks().forEach(e=>e.enabled=!a),a})},variant:p?"destructive":"default",children:[p?(0,t.jsx)(o.A,{className:"h-4 w-4 mr-1"}):(0,t.jsx)(d.A,{className:"h-4 w-4 mr-1"}),p?"Unmute":"Mute"]}),(0,t.jsxs)(i.$,{onClick:()=>location.reload(),variant:"outline",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Leave"]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[4812,7,2261,2354,7236,6345,5849,3215,1163,5022,5575,7358],()=>s(5564)),_N_E=e.O()}]);