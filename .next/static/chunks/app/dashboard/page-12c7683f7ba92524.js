(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1325:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(2432);let l=(0,t(9759).default)(()=>t.e(836).then(t.bind(t,836)),{loadableGenerated:{webpack:()=>[836]},ssr:!1});function r(){return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto animate-fadeIn px-4",children:[(0,a.jsx)("div",{className:"sticky top-4 z-10 mb-3",children:(0,a.jsx)("button",{onClick:()=>location.href="/dashboard",className:"text-xs px-3 py-1 rounded-full border backdrop-blur-md bg-white/40 dark:bg-black/30 text-black dark:text-white border-white/40 dark:border-white/20 hover:bg-white/60 dark:hover:bg-black/50",children:"Back to Dashboard"})}),(0,a.jsx)(l,{})]})}},4440:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eN});var a=t(2432),l=t(364),r=t(9262),i=t(7328),n=t(2708),c=t(1947),o=t(6939),d=t(7693),m=t(5588),x=t(9861),h=t(9920),u=t(8055),p=t(8452),f=t(4010),g=t(4652),j=t(2121),v=t(1194),N=t(3394),b=t(6230),w=t(8175),y=t(7972),k=t(4504),C=t(7088),S=t(4260);function z(e){let{currentPage:s,onPageChange:t,onSignOut:r,onGlobalChatClick:i,onAIChatClick:z,username:A,onThemeCycle:_,onHueCycle:F}=e,[E,T]=(0,l.useState)(!1),[$,D]=(0,l.useState)(!1),I=[{id:"dashboard",label:"Dashboard",icon:o.A},{id:"friends",label:"Friends",icon:d.A},{id:"dms",label:"DMs",icon:m.A},{id:"channels",label:"Channels",icon:x.A},{id:"polls",label:"Polls",icon:h.A},{id:"voice",label:"Voice",icon:u.A},{id:"calendar",label:"Calendar",icon:p.A},{id:"profile",label:"Profile",icon:f.A},{id:"settings",label:"Settings",icon:g.A},{id:"about",label:"About",icon:j.A}],P=e=>{$||(D(!0),T(e),setTimeout(()=>D(!1),200))},O=e=>{"global"===e?i():"ai-chat"===e?z():t(e)};return(0,a.jsx)("div",{className:"fixed z-50 transition-all duration-200 top-6 left-1/2 -translate-x-1/2",children:(0,a.jsx)("div",{className:"glass rounded-modern-xl text-foreground transition-all duration-200 ease-out ".concat(E?"px-4 py-2 min-w-[600px]":"px-6 py-3 w-fit"),onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:E?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 py-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("global"),className:"h-8 w-8 rounded-lg hover:bg-muted/30 transition-colors",title:"Global",children:(0,a.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>O("ai-chat"),className:"h-8 w-8 rounded-lg hover:bg-muted/30 transition-colors",title:"AI Chat",children:(0,a.jsx)(N.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),I.map(e=>{let t=e.icon,l="channels"===e.id||"dms"===e.id||"polls"===e.id,r=s===e.id;return(0,a.jsxs)(n.$,{variant:"ghost",size:l?"sm":"icon",onClick:()=>O(e.id),className:"h-8 ".concat(l?"px-3":"w-8"," rounded-lg transition-colors ").concat(r?"bg-muted text-foreground":"hover:bg-muted/30 text-muted-foreground"),children:[(0,a.jsx)(t,{className:"h-4 w-4"}),l&&(0,a.jsx)("span",{className:"ml-2 text-xs hidden md:inline font-medium",children:e.label})]},e.id)}),(0,a.jsxs)(c.AM,{children:[(0,a.jsx)(c.Wv,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-lg transition-colors ".concat("movies"===s||"games"===s||"radio"===s?"bg-muted text-foreground":"hover:bg-muted/30 text-muted-foreground"),title:"Entertainment",children:[(0,a.jsx)(b.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"ml-2 text-xs hidden md:inline font-medium",children:"Entertainment"})]})}),(0,a.jsx)(c.hl,{className:"w-48 p-2 glass rounded-modern shadow-modern-xl",align:"center",avoidCollisions:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("movies"),className:"justify-start gap-3 h-9 hover:bg-muted/20 text-foreground rounded-lg transition-colors",children:[(0,a.jsx)(b.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Movies"})]}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("games"),className:"justify-start gap-3 h-9 hover:bg-muted/20 text-foreground rounded-lg transition-colors",children:[(0,a.jsx)(w.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Games"})]}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>O("radio"),className:"justify-start gap-3 h-9 hover:bg-muted/20 text-foreground rounded-lg transition-colors",children:[(0,a.jsx)(y.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Radio"})]})]})})]}),(0,a.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:_,className:"h-8 w-8 rounded-lg hover:bg-muted/30 transition-colors",title:"Toggle Theme",children:(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>{try{localStorage.setItem("ui-mode","simple")}catch(e){}window.location.href="/dashboard/simple"},className:"h-8 w-8 rounded-lg hover:bg-muted/30 transition-colors",title:"Simple Mode",children:(0,a.jsx)(C.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:r,className:"h-8 w-8 rounded-lg hover:bg-destructive/20 transition-colors",title:"Sign out",children:(0,a.jsx)(S.A,{className:"h-4 w-4 text-destructive"})})]}):(0,a.jsxs)("div",{className:"flex items-center gap-3 transition-all duration-150",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-emerald-400 rounded-full"}),(0,a.jsx)("span",{className:"text-lg font-semibold tracking-tight",children:"real."}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground font-medium",children:["@",A]})]})})})}var A=t(3143),_=t(129),F=t(9495),E=t(7304),T=t(6446),$=t(7382),D=t(7759),I=t(5009),P=t(3079),O=t(5213),R=t(4329),M=t(3702),Z=t(1823);function L(e){let{currentUserId:s,userSignupCode:t}=e,[r,i]=(0,l.useState)([]),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(!0),[p,f]=(0,l.useState)(null),[g,j]=(0,l.useState)(null),[N,b]=(0,l.useState)(""),[w,y]=(0,l.useState)(""),[k,C]=(0,l.useState)(["",""]),[S,z]=(0,l.useState)(!1),[A,_]=(0,l.useState)([]),[F,L]=(0,l.useState)(""),U=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls");if(e.ok){let s=await e.json();console.log("[polls-page] Fetched polls:",s.polls),i(s.polls)}else console.error("[polls-page] Failed to fetch polls:",e.status)}catch(e){console.error("Failed to fetch polls:",e)}finally{u(!1)}},[]),q=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();o(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{U(),q()},[U,q]);let G=async()=>{if(j(null),N.trim()&&!(k.filter(e=>e.trim()).length<2))try{let e=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:N.trim(),description:w.trim()||void 0,options:k.filter(e=>e.trim()),is_public:S,shared_with:A,expires_at:F||void 0})});if(e.ok)m(!1),B(),U();else{let s=await e.json();j("Failed to create poll: ".concat(s.error))}}catch(e){j("An unexpected error occurred while creating the poll.")}},W=async e=>{j(null);try{let s=await fetch("/api/polls/".concat(e),{method:"DELETE"});if(s.ok)U();else{let e=await s.json();j("Failed to delete poll: ".concat(e.error||s.statusText))}}catch(e){j("An unexpected error occurred while deleting the poll.")}},J=async(e,s)=>{console.log("[polls-page] Voting on poll ".concat(e," with option ").concat(s)),f(e);try{let t=await fetch("/api/polls/".concat(e,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:s})});if(t.ok)console.log("[polls-page] Vote successful, refreshing polls"),await U();else{let e=await t.json();console.error("Failed to vote:",e.error),alert("Failed to vote: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Failed to vote:",e),alert("An unexpected error occurred while voting.")}finally{f(null)}},B=()=>{b(""),y(""),C(["",""]),z(!1),_([]),L("")},K=e=>{k.length>2&&C(k.filter((s,t)=>t!==e))},V=(e,s)=>{let t=[...k];t[e]=s,C(t)},Y=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",H=e=>e?{color:e}:{},Q=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=e=>!!e&&new Date(e)<new Date,ee=(e,s)=>0===s?0:Math.round(e/s*100);return x?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading polls..."})}):(0,a.jsxs)("div",{className:"space-y-6 relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Polls"}),(0,a.jsxs)(n.$,{onClick:()=>m(!0),className:"hover-lift hover-glow",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Create Poll"]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===r.length?(0,a.jsx)($.Zp,{className:"glass-effect animate-fadeIn",children:(0,a.jsxs)($.Wu,{className:"text-center py-8",children:[(0,a.jsx)(h.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No polls yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first poll to gather opinions!"})]})}):r.map((e,t)=>{let l=void 0!==e.user_response;return(0,a.jsxs)($.Zp,{className:"glass-effect hover-lift animate-fadeIn ".concat(X(e.expires_at)?"opacity-75":""),style:{animationDelay:"".concat(.1*t,"s")},children:[(0,a.jsxs)($.aR,{children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)($.ZB,{className:"text-lg",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.is_public?(0,a.jsx)(v.A,{className:"h-3 w-3 hue-accent"}):(0,a.jsx)(P.A,{className:"h-3 w-3"}),(0,a.jsx)(O.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[e.total_responses," votes"]}),e.expires_at&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:X(e.expires_at)?"text-red-500":"",children:X(e.expires_at)?"Expired":"Expires ".concat(Q(e.expires_at))})]})]}),e.creator_id===s&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>W(e.id),className:"text-red-500 hover:bg-red-500/10 h-6 w-6 p-0",title:"Delete Poll",children:(0,a.jsx)(M.A,{className:"h-3 w-3"})})]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{className:e.creator_username?Y(void 0,!1):"",children:["by @",e.creator_username]}),(0,a.jsxs)("span",{children:[void 0!==e.user_response?"You voted":"Click to vote"," • ",e.total_responses," total votes"]})]})]}),(0,a.jsxs)($.Wu,{className:"space-y-3",children:[e.options.map((s,t)=>{let r=e.results.find(e=>e.option_index===t),i=(null==r?void 0:r.count)||0,c=ee(i,e.total_responses),o=e.user_response===t,d=p===e.id;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(n.$,{variant:o?"default":"outline",className:"flex-1 justify-start hover-lift transition-all duration-200 ".concat(o?"hue-shadow":""," ").concat(X(e.expires_at)?"":"cursor-pointer"),onClick:()=>!X(e.expires_at)&&!d&&J(e.id,t),disabled:X(e.expires_at)||d,children:[(0,a.jsx)("span",{className:"flex-1 text-left",children:s}),d&&(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin ml-2"})]}),l&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground ml-3 min-w-[60px] text-right",children:[i," (",c,"%)"]})]}),l&&(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-700 ease-out ".concat(o?"bg-gradient-to-r from-blue-500 to-purple-500 hue-shadow":"bg-gray-400 dark:bg-gray-600"),style:{width:"".concat(c,"%"),backgroundColor:o?"hsl(var(--hue) 60% 50%)":void 0}})})]},t)}),!X(e.expires_at)&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground text-center mt-4 opacity-70",children:["Click on an option to ",l?"change your vote":"cast your vote"]})]})]},e.id)})}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsxs)($.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto glass-effect animate-fadeIn",children:[(0,a.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)($.ZB,{children:"Create Poll"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)($.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(E.p,{value:N,onChange:e=>b(e.target.value),placeholder:"Poll title",className:"focus:hue-shadow"})}),(0,a.jsx)("div",{children:(0,a.jsx)(T.T,{value:w,onChange:e=>y(e.target.value),placeholder:"Description (optional)",rows:2,className:"focus:hue-shadow"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Options"}),k.map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E.p,{value:e,onChange:e=>V(s,e.target.value),placeholder:"Option ".concat(s+1),className:"focus:hue-shadow"}),k.length>2&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>K(s),children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]},s)),k.length<6&&(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{k.length<6&&C([...k,""])},className:"hover-lift bg-transparent",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-1"}),"Add Option"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E.p,{type:"datetime-local",value:F,onChange:e=>L(e.target.value),className:"focus:hue-shadow"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional expiration date"})]}),"qwea"===t&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3 hue-bg rounded-lg",children:[(0,a.jsx)(D.S,{id:"public",checked:S,onCheckedChange:e=>z(!0===e)}),(0,a.jsx)("label",{htmlFor:"public",className:"text-sm font-medium",children:"Share with all users (public poll)"})]}),!S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Share with friends"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:c.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(D.S,{id:e.friend_id,checked:A.includes(e.friend_id),onCheckedChange:s=>{s?_([...A,e.friend_id]):_(A.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:H(e.friend_name_color),children:(0,a.jsxs)("span",{className:Y(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:G,disabled:!N.trim()||k.filter(e=>e.trim()).length<2,className:"flex-1 hover-glow",children:"Create Poll"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})})]})}function U(e){let{currentUserId:s,userSignupCode:t,onSelectChannel:r}=e,[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(!1),[u,p]=(0,l.useState)(""),f="qwea"===t,g=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/channels");if(e.ok){let s=await e.json();c(s.channels)}}finally{d(!1)}},[]);(0,l.useEffect)(()=>{g()},[g]);let j=(0,l.useMemo)(()=>i.filter(e=>e.is_system),[i]),v=(0,l.useMemo)(()=>i.filter(e=>!e.is_system),[i]),N=async e=>{if(!confirm("Delete this channel?"))return;let s=await fetch("/api/channels/".concat(e),{method:"DELETE"});if(s.ok)g();else{let e=await s.json().catch(()=>({}));alert("Failed to delete: ".concat(e.error||s.statusText))}},b=async()=>{if(f&&u.trim()){h(!0);try{let e=await fetch("/api/channels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.trim()})});if(e.ok)p(""),g();else{let s=await e.json().catch(()=>({}));alert("Failed to create channel: ".concat(s.error||e.statusText))}}finally{h(!1)}}};return o?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading channels..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Channels"}),f&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.p,{value:u,onChange:e=>p(e.target.value),placeholder:"Create a new channel",className:"w-48"}),(0,a.jsxs)(n.$,{onClick:b,disabled:!u.trim()||m,className:"hover-glow",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-1"})," Create"]})]})]}),(0,a.jsxs)($.Zp,{className:"glass-effect",children:[(0,a.jsx)($.aR,{children:(0,a.jsx)($.ZB,{children:"Default"})}),(0,a.jsx)($.Wu,{className:"space-y-2",children:0===j.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No channels."}):j.map(e=>(0,a.jsxs)(n.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>r(e.id,e.name),children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"})," ",e.name]},e.id))})]}),v.length>0&&(0,a.jsxs)($.Zp,{className:"glass-effect",children:[(0,a.jsx)($.aR,{children:(0,a.jsx)($.ZB,{children:"Created by Gold users"})}),(0,a.jsx)($.Wu,{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.$,{variant:"ghost",className:"flex-1 justify-start",onClick:()=>r(e.id,e.name),children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"})," ",e.name]}),e.creator_id===s&&(0,a.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>N(e.id),className:"text-red-500",children:(0,a.jsx)(M.A,{className:"h-4 w-4"})})]},e.id))})]})]})}var q=t(6334),G=t(855);function W(e){let{currentUserId:s}=e,[t,r]=(0,l.useState)([]),[i,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!0),[h,u]=(0,l.useState)(new Date),[f,g]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[N,b]=(0,l.useState)(""),[w,y]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[S,z]=(0,l.useState)([]),A=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/calendar");if(e.ok){let s=await e.json();r(s.events)}}catch(e){console.error("Failed to fetch events:",e)}finally{x(!1)}},[]),_=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/friends/accepted");if(e.ok){let s=await e.json();c(s.friends)}}catch(e){console.error("Failed to fetch friends:",e)}},[]);(0,l.useEffect)(()=>{A(),_()},[A,_]);let F=async()=>{if(f.trim()&&N&&w)try{(await fetch("/api/calendar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f.trim(),description:j.trim()||void 0,start_time:N,end_time:w,is_collaborative:k,participants:S})})).ok&&(d(!1),O(),A())}catch(e){console.error("Failed to create event:",e)}},O=()=>{g(""),v(""),b(""),y(""),C(!1),z([])},M=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",L=e=>e?{color:e}:{},U=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=e=>{let s=e.toDateString();return t.filter(e=>new Date(e.start_time).toDateString()===s)},J=e=>{u(s=>{let t=new Date(s);return"prev"===e?t.setMonth(s.getMonth()-1):t.setMonth(s.getMonth()+1),t})},B=e=>{if(!e)return!1;let s=new Date;return e.toDateString()===s.toDateString()};if(m)return(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading calendar..."})});let K=(e=>{let s=e.getFullYear(),t=e.getMonth(),a=new Date(s,t,1),l=new Date(s,t+1,0).getDate(),r=a.getDay(),i=[];for(let e=0;e<r;e++)i.push(null);for(let e=1;e<=l;e++)i.push(new Date(s,t,e));return i})(h),V=h.toLocaleDateString([],{month:"long",year:"numeric"});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Calendar"}),(0,a.jsxs)(n.$,{onClick:()=>d(!0),children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Create Event"]})]}),(0,a.jsxs)($.Zp,{children:[(0,a.jsx)($.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-5 w-5"}),V]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>J("prev"),children:(0,a.jsx)(q.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>J("next"),children:(0,a.jsx)(G.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsxs)($.Wu,{children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:K.map((e,s)=>{let t=e?W(e):[];return(0,a.jsx)("div",{className:"min-h-[80px] p-1 border rounded-lg ".concat(e?"hover:bg-accent/50 cursor-pointer":""," ").concat(B(e)?"bg-primary/10 border-primary":""),children:e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm font-medium ".concat(B(e)?"text-primary":""),children:e.getDate()}),(0,a.jsxs)("div",{className:"space-y-1",children:[t.slice(0,2).map(e=>(0,a.jsx)("div",{className:"text-xs p-1 bg-primary/20 rounded truncate",title:e.title,children:e.title},e.id)),t.length>2&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",t.length-2," more"]})]})]})},s)})})]})]}),(0,a.jsxs)($.Zp,{children:[(0,a.jsx)($.aR,{children:(0,a.jsx)($.ZB,{children:"Upcoming Events"})}),(0,a.jsx)($.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(R.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No events scheduled"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first event to get started!"})]}):(0,a.jsx)("div",{className:"space-y-3",children:t.filter(e=>new Date(e.start_time)>=new Date).sort((e,s)=>new Date(e.start_time).getTime()-new Date(s.start_time).getTime()).slice(0,5).map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:[U(e.start_time)," - ",U(e.end_time)]}),e.is_collaborative&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(P.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Collaborative"})]})]})]})}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Created by @",e.creator_username]})]},e.id))})})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)($.Zp,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)($.ZB,{children:"Create Event"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)($.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(E.p,{value:f,onChange:e=>g(e.target.value),placeholder:"Event title"})}),(0,a.jsx)("div",{children:(0,a.jsx)(T.T,{value:j,onChange:e=>v(e.target.value),placeholder:"Description (optional)",rows:2})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Start Time"}),(0,a.jsx)(E.p,{type:"datetime-local",value:N,onChange:e=>b(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"End Time"}),(0,a.jsx)(E.p,{type:"datetime-local",value:w,onChange:e=>y(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(D.S,{id:"collaborative",checked:k,onCheckedChange:e=>C(!0===e)}),(0,a.jsx)("label",{htmlFor:"collaborative",className:"text-sm",children:"Make this a collaborative event"})]}),k&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Invite participants"}),(0,a.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:i.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(D.S,{id:e.friend_id,checked:S.includes(e.friend_id),onCheckedChange:s=>{s?z([...S,e.friend_id]):z(S.filter(s=>s!==e.friend_id))}}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:L(e.friend_name_color),children:(0,a.jsxs)("span",{className:M(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:F,disabled:!f.trim()||!N||!w,className:"flex-1",children:"Create Event"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]})]})})]})}var J=t(1942),B=t(4311),K=t(3335),V=t(1873),Y=t(7616),H=t(7709);function Q(e){let{userId:s,onStartDM:t,onSendFriendRequest:r}=e,{user:i,setUser:c}=(0,Y.J)(),[o,x]=(0,l.useState)(null),[h,u]=(0,l.useState)(!0),[p,g]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[N,b]=(0,l.useState)(!1),[w,y]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[S,z]=(0,l.useState)(null),[A,_]=(0,l.useState)(""),[F,E]=(0,l.useState)(""),D=!s||s===(null==i?void 0:i.id),I=!!(null==i?void 0:i.has_gold_animation);(0,l.useEffect)(()=>{let e=async()=>{if(!D&&s&&i)try{let e=await fetch("/api/friends/check?userId=".concat(s));if(e.ok){let s=await e.json();z(s.friendship)}}catch(e){console.error("Failed to fetch friendship:",e)}};(async()=>{if(D&&i)x(i),_(i.bio||""),E(i.profile_picture||"");else if(s)try{let e=await fetch("/api/users/".concat(s));if(e.ok){let s=await e.json();x(s.user)}}catch(e){console.error("Failed to fetch profile:",e)}u(!1)})(),e()},[s,i,D]);let P=async e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){C(!0);try{let e=await fetch("/api/upload-image?filename=".concat(encodeURIComponent(t.name)),{method:"POST",body:t});if(e.ok){let s=await e.json();E(s.url)}else{let s=await e.json();alert("Failed to upload image: ".concat(s.error||e.statusText))}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{C(!1)}}},O=async()=>{if(D){v(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile_picture:F||null,bio:A.trim()||null})});if(e.ok){let s=await e.json();c(s.user),x(s.user),g(!1)}else{let s=await e.json();alert("Failed to update profile: ".concat(s.error||e.statusText))}}catch(e){console.error("Failed to update profile:",e),alert("An unexpected error occurred while updating profile.")}finally{v(!1)}}};return h?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading profile..."})}):o?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:D?"Your Profile":"@".concat(o.username,"'s Profile")}),D&&(0,a.jsx)(n.$,{onClick:()=>g(!p),variant:p?"outline":"default",children:p?"Cancel":"Edit Profile"})]}),(0,a.jsxs)($.Zp,{className:"glass-effect hover-lift animate-fadeIn",children:[(0,a.jsx)($.aR,{children:(0,a.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"h-5 w-5"}),"Profile Information"]})}),(0,a.jsxs)($.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"relative",children:[o.profile_picture?(0,a.jsx)(H.default,{src:o.profile_picture||"/placeholder.svg",alt:"".concat(o.username,"'s profile"),width:100,height:100,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:(0,a.jsx)(f.A,{className:"h-12 w-12 text-gray-400"})}),p&&(0,a.jsxs)("label",{className:"absolute bottom-0 right-0 bg-primary text-primary-foreground rounded-full p-2 cursor-pointer hover:bg-primary/90 transition-colors",children:[(0,a.jsx)(J.A,{className:"h-4 w-4"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:P,className:"hidden",disabled:k})]}),k&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold ".concat(o.has_gold_animation&&o.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":""),style:o.has_gold_animation?{}:o.name_color?{color:o.name_color}:{},children:["@",o.username]}),o.custom_title&&(0,a.jsx)("p",{className:"text-sm italic text-muted-foreground mt-1",children:o.custom_title}),o.signup_code&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:["asdf"===o.signup_code&&"✨ Custom Colors","qwea"===o.signup_code&&"\uD83D\uDC51 Gold Member"]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Bio"}),p?(0,a.jsx)(T.T,{value:A,onChange:e=>_(e.target.value),placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"resize-none"}):(0,a.jsx)("div",{className:"min-h-[100px] p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:o.bio?(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:o.bio}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground italic",children:D?"Add a bio to tell others about yourself":"No bio available"})}),p&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[A.length,"/500 characters"]})]}),(0,a.jsx)("div",{className:"flex gap-3",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.$,{onClick:O,disabled:j,className:"flex-1",children:j?"Saving...":"Save Changes"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>g(!1),disabled:j,children:"Cancel"})]}):D?null:(0,a.jsxs)(a.Fragment,{children:[(null==S?void 0:S.status)==="accepted"?(0,a.jsxs)(n.$,{onClick:()=>null==t?void 0:t(o.id,o.username),className:"flex-1",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 mr-2"}),"Send Message"]}):(0,a.jsxs)(n.$,{disabled:!0,className:"flex-1 opacity-50 cursor-not-allowed",children:[(0,a.jsx)(B.A,{className:"h-4 w-4 mr-2"}),(null==S?void 0:S.status)==="pending"?"Friend Request Pending":"Add Friend to Message"]}),S&&"blocked"!==S.status?"pending"===S.status?(0,a.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Request Sent"]}):(0,a.jsxs)(n.$,{variant:"outline",disabled:!0,className:"opacity-50 cursor-not-allowed",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Friends"]}):(0,a.jsxs)(n.$,{variant:"outline",onClick:()=>null==r?void 0:r(o.id),children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Add Friend"]}),I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.$,{variant:"destructive",onClick:()=>b(!0),children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-2"})," Freeze"]}),(0,a.jsxs)(n.$,{variant:"outline",onClick:async()=>{try{await fetch("/api/freeze?targetUserId=".concat(o.id),{method:"DELETE"}),alert("User unfrozen")}catch(e){alert("Failed to unfreeze")}},children:[(0,a.jsx)(V.A,{className:"h-4 w-4 mr-2"})," Unfreeze"]})]})]})})]})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-white dark:bg-gray-900 rounded-xl p-4 border",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold mb-2",children:["Freeze @",o.username]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Only gold members can do this. The user will be prevented from typing or using voice."}),(0,a.jsx)("textarea",{className:"w-full border rounded p-2 text-sm mb-3",rows:3,placeholder:"Optional message shown on their screen",value:w,onChange:e=>y(e.target.value)}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(n.$,{variant:"secondary",onClick:async()=>{let e=prompt("Popup message to show immediately (optional)")||"";if(e)try{await fetch("/api/freeze/popup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,popupMessage:e})}),alert("Popup sent")}catch(e){alert("Failed to send popup")}},children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Send Popup"]}),(0,a.jsxs)(n.$,{variant:"destructive",onClick:async()=>{try{let e=await fetch("/api/freeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:o.id,message:w})});if(e.ok)alert("User frozen"),b(!1),y("");else{let s=await e.json();alert(s.error||"Failed to freeze")}}catch(e){alert("Failed to freeze")}},children:[(0,a.jsx)(K.A,{className:"h-4 w-4 mr-1"})," Confirm Freeze"]})]})]})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Profile not found"})})}var X=t(9370);function ee(){let{user:e}=(0,Y.J)();return e?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(X.n,{roomId:"global-voice",userId:e.id}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{id:"voice-enable-widget",type:"checkbox",defaultChecked:"1"===localStorage.getItem("voiceWidgetEnabled"),onChange:e=>{localStorage.setItem("voiceWidgetEnabled",e.target.checked?"1":"0"),window.dispatchEvent(new Event("voice-widget-toggle"))}}),(0,a.jsx)("label",{htmlFor:"voice-enable-widget",children:"Enable floating voice widget across pages"})]})]}):null}var es=t(3215),et=t(1325),ea=t(3544);function el(e){return null}var er=t(4992);function ei(e){let{onClose:s,onJoinSuccess:t}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(""),h=async e=>{if(e.preventDefault(),r.trim()){o(!0),m("");try{let e=await fetch("/api/group-chats/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortCode:r.trim().toUpperCase()})}),a=await e.json();e.ok?(t(a.groupChat),s()):m(a.error||"Failed to join group chat")}catch(e){m("An unexpected error occurred")}finally{o(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)($.Zp,{className:"w-full max-w-md mx-4",children:[(0,a.jsxs)($.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-5 w-5"}),"Join Group Chat"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,a.jsx)($.Wu,{children:(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Enter Group Code"}),(0,a.jsx)(E.p,{value:r,onChange:e=>i(e.target.value.toUpperCase()),placeholder:"e.g., ABC123",maxLength:6,className:"text-center text-lg font-mono tracking-wider",disabled:c}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"6-character code provided by the group creator"})]}),d&&(0,a.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:d}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{type:"submit",disabled:!r.trim()||c,className:"flex-1",children:c?"Joining...":"Join Group"}),(0,a.jsx)(n.$,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})})]})})}var en=t(3491);function ec(e){let{groupChatId:s,groupChatName:t,onClose:r,onRequestProcessed:i}=e,[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[x,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{u()},[s]);let u=async()=>{try{let e=await fetch("/api/group-chats/".concat(s,"/requests"));if(e.ok){let s=await e.json();o(s.requests)}}catch(e){console.error("Failed to fetch requests:",e)}finally{m(!1)}},p=async(e,t,a)=>{h(e);try{let l=await fetch("/api/group-chats/".concat(s,"/requests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestId:e,requesterId:t,action:a})});if(l.ok)o(s=>s.filter(s=>s.id!==e)),i();else{let e=await l.json();alert(e.error||"Failed to process request")}}catch(e){alert("An error occurred while processing the request")}finally{h(null)}},g=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return d?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsx)($.Zp,{className:"w-full max-w-md mx-4",children:(0,a.jsxs)($.Wu,{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading requests..."})]})})}):(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)($.Zp,{className:"w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)($.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(R.A,{className:"h-5 w-5"}),"Join Requests"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)($.Wu,{className:"p-0",children:[(0,a.jsx)("div",{className:"px-6 pb-2",children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Pending requests for ",(0,a.jsx)("strong",{children:t})]})}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===c.length?(0,a.jsxs)("div",{className:"px-6 py-8 text-center text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No pending join requests"})]}):(0,a.jsx)("div",{className:"space-y-2 px-6 pb-6",children:c.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(f.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-sm",children:["@",e.username]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:g(e.created_at)})]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"approve"),disabled:x===e.id,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:(0,a.jsx)(en.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>p(e.id,e.requester_id,"reject"),disabled:x===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]})]},e.id))})})]})]})})}var eo=t(3868);function ed(e){let{currentUserId:s}=e,[t,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),c=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/users/online");if(e.ok){let s=await e.json();r(s.onlineUsers)}}catch(e){console.error("Failed to fetch online users:",e)}finally{n(!1)}},[]),o=(0,l.useCallback)(async()=>{try{await fetch("/api/user/activity",{method:"POST"})}catch(e){console.error("Failed to update activity:",e)}},[]);(0,l.useEffect)(()=>{c(),o();let e=setInterval(o,12e4),s=setInterval(c,3e4);return()=>{clearInterval(e),clearInterval(s)}},[c,o]);let d=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",m=e=>e?{color:e}:{};return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.aR,{className:"pb-3",children:(0,a.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(P.A,{className:"h-4 w-4"}),"Online Friends"]})}),(0,a.jsx)($.Wu,{className:"pt-0",children:(0,a.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.aR,{className:"pb-3",children:(0,a.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(eo.A,{className:"h-4 w-4 text-green-500"}),"Online (",t.length,")"]})}),(0,a.jsx)($.Wu,{className:"pt-0",children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(P.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No friends online"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:"Add friends to see them here"})]}):(0,a.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-1.5 rounded hover:bg-muted/30 transition-colors",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full"}),(0,a.jsxs)("span",{className:e.has_gold_animation?d(void 0,!0):"text-xs",style:e.has_gold_animation?{}:m(e.name_color),children:["@",e.username]})]},e.id))})})]})}function em(e){var s;let{currentUserId:t,onViewAllPolls:r}=e,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[m,x]=(0,l.useState)(!1),u=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/polls/recent?userId=".concat(t));if(e.ok){let s=await e.json();c(s.poll)}}catch(e){console.error("Failed to fetch recent poll:",e)}finally{d(!1)}},[t]);(0,l.useEffect)(()=>{u()},[u]);let p=async e=>{if(i&&!m){x(!0);try{let s=await fetch("/api/polls/".concat(i.id,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_index:e})});if(s.ok)await u();else{let e=await s.json();console.error("Failed to vote:",e.error)}}catch(e){console.error("Failed to vote:",e)}finally{x(!1)}}},f=(e,s)=>0===s?0:Math.round(e/s*100);if(o)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.aR,{className:"pb-3",children:(0,a.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,a.jsx)($.Wu,{className:"pt-0",children:(0,a.jsx)("div",{className:"text-center py-4 text-xs text-muted-foreground",children:"Loading..."})})]});if(!i)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.aR,{className:"pb-3",children:(0,a.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]})}),(0,a.jsx)($.Wu,{className:"pt-0",children:(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 mx-auto mb-2 opacity-30 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No polls available"}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",className:"mt-2 h-7 text-xs",onClick:r,children:"View All Polls"})]})})]});let g=void 0!==i.user_response,j=!!(s=i.expires_at)&&new Date(s)<new Date;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)($.ZB,{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Latest Poll"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-xs h-6 px-2",children:"View All"})]})}),(0,a.jsxs)($.Wu,{className:"pt-0 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-xs",children:i.title}),i.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground/60 mt-1",children:i.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[i.is_public?(0,a.jsx)(v.A,{className:"h-3 w-3"}):(0,a.jsx)(P.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[i.total_responses," votes"]}),i.expires_at&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(R.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:j?"text-red-500":"",children:j?"Expired":"".concat(new Date(i.expires_at).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[i.options.slice(0,2).map((e,s)=>{let t=i.results.find(e=>e.option_index===s),l=f((null==t?void 0:t.count)||0,i.total_responses),r=i.user_response===s;return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)(n.$,{variant:r?"default":"outline",size:"sm",className:"flex-1 justify-start text-xs h-6 px-2 ".concat(r?"bg-foreground text-background":""),onClick:()=>!g&&!j&&!m&&p(s),disabled:g||j||m,children:(0,a.jsx)("span",{className:"flex-1 text-left truncate",children:e})}),g&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground min-w-[35px] text-right",children:[l,"%"]})]}),g&&(0,a.jsx)("div",{className:"w-full bg-muted/30 rounded-full h-0.5",children:(0,a.jsx)("div",{className:"h-0.5 rounded-full transition-all duration-500 ".concat(r?"bg-foreground":"bg-muted-foreground/40"),style:{width:"".concat(l,"%")}})})]},s)}),i.options.length>2&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground/60 text-center",children:["+",i.options.length-2," more"]})]})]})]})}var ex=t(8725);function eh(e){let{onClose:s,onMessageClick:t}=e,[r,i]=(0,l.useState)(""),[c,o]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>{r.trim().length>=2?x():o([])},500);return()=>clearTimeout(e)},[r]);let x=async()=>{m(!0);try{let e=await fetch("/api/messages/search?q=".concat(encodeURIComponent(r.trim())));if(e.ok){let s=await e.json();o(s.messages||[])}}catch(e){console.error("Failed to search messages:",e)}finally{m(!1)}},h=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",u=e=>e?{color:e}:{},p=e=>new Date(e).toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=e=>"global"===e.chat_type?"Global Chat":"dm"===e.chat_type?"Direct Message":"Group Chat";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)($.Zp,{className:"w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)($.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)($.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(ex.A,{className:"h-5 w-5"}),"Search Messages"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:s,children:(0,a.jsx)(Z.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)($.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E.p,{value:r,onChange:e=>i(e.target.value),placeholder:"Search messages...",className:"flex-1",autoFocus:!0}),d&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:r.trim().length<2?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(ex.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Type at least 2 characters to search"})]}):0!==c.length||d?c.map(e=>(0,a.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>{null==t||t(e.chat_type,e.chat_id),s()},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:e.has_gold_animation?h(void 0,!0):"text-sm font-medium",style:e.has_gold_animation?{}:u(e.name_color),children:["@",e.username]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:f(e)}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:p(e.created_at)})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"image"===e.message_type?"\uD83D\uDCF7 Shared an image":e.content})]},e.id)):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(B.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsxs)("p",{children:['No messages found for "',r,'"']})]})})]})]})})}var eu=t(2548),ep=t(4188);function ef(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{localStorage.getItem("seen-mode-gate")||t(!0)}catch(e){}},[]),(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem("refreshed-after-auth");"/dashboard"!==location.pathname&&"/dashboard/lite"!==location.pathname||e||(sessionStorage.setItem("refreshed-after-auth","1"),location.reload())}catch(e){}},[]);let i=s=>{try{localStorage.setItem("seen-mode-gate","1")}catch(e){}"lite"===s?e.push("/dashboard/lite"):e.push("/dashboard")};return s?(0,a.jsx)("div",{className:"fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-[90%] max-w-md border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Choose your experience"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Pick a UI mode. You can change this later in Settings."}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{onClick:()=>i("lite"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Lite"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Minimal and fast. Global chat, Friends, DMs, Settings, Group Chats."})]}),(0,a.jsxs)("button",{onClick:()=>i("full"),className:"rounded-lg border p-4 hover:bg-gray-50 dark:hover:bg-gray-800 text-left",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Full"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Full experience with entertainment, voice, polls, and more."})]})]})]})}):null}var eg=t(4855),ej=t(5501);function ev(e){var s,t;let{isOpen:r,onClose:i}=e,[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(""),[u,p]=(0,l.useState)(null),{user:f}=(0,Y.J)(),g=(null==f?void 0:f.signup_code)==="qwea";(0,l.useEffect)(()=>{r&&j()},[r]),(0,l.useEffect)(()=>{let e=()=>{g?j():h("AI features are temporarily unavailable. Gold members can add new API keys.")};return window.addEventListener("geminiKeyExhausted",e),()=>window.removeEventListener("geminiKeyExhausted",e)},[g]);let j=()=>{p((0,ej.BW)())},v=async()=>{if(!c.trim()){h("Please enter a valid API key");return}m(!0),h("");try{let e=await (0,ej.eE)(c,(null==f?void 0:f.username)||"Unknown");e.success?(h("API key added successfully! \uD83C\uDF89"),o(""),j()):h(e.message)}catch(e){h("Error adding API key. Please try again.")}finally{m(!1)}};return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Gemini API Key Management"}),!g&&(0,a.jsx)("div",{className:"text-red-600 mb-4",children:"Only gold members can add or manage Gemini API keys."}),(null==u?void 0:u.error)&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:u.error}),!(null==u?void 0:u.hasAvailableKeys)&&(0,a.jsx)("div",{className:"text-yellow-600 mb-2",children:"No available Gemini API keys. Please add a new one to restore AI features for all users."}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Current keys: ",null!==(s=null==u?void 0:u.totalKeys)&&void 0!==s?s:0]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mb-1",children:["Exhausted keys: ",null!==(t=null==u?void 0:u.exhaustedKeys)&&void 0!==t?t:0]})]}),g&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 mb-2",placeholder:"Enter Gemini API key (starts with AIza)",value:c,onChange:e=>o(e.target.value),disabled:d}),(0,a.jsx)(n.$,{onClick:v,disabled:d,className:"w-full mb-2",children:d?"Adding...":"Add API Key"}),(0,a.jsx)(n.$,{onClick:()=>{j(),h("Key status refreshed")},variant:"outline",className:"w-full",children:"Refresh Key Status"})]}),x&&(0,a.jsx)("div",{className:"text-sm text-blue-600 mb-2",children:x}),(0,a.jsx)(n.$,{onClick:i,variant:"secondary",className:"w-full mt-2",children:"Close"})]})}):null}function eN(){var e,s;let{user:t,loading:c,setUser:o}=(0,Y.J)(),{theme:d,setTheme:m}=(0,i.D)(),[h,u]=(0,l.useState)("dashboard"),[p,f]=(0,l.useState)([]),[g,j]=(0,l.useState)({type:null,name:""}),[N,b]=(0,l.useState)(!1),[w,y]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[S,E]=(0,l.useState)(!1),[T,D]=(0,l.useState)(null),[O,Z]=(0,l.useState)(!1),q=(0,r.useRouter)(),G=(0,l.useCallback)(async()=>{if(t)try{let e=await fetch("/api/group-chats");if(e.ok){let s=await e.json();f(s.groupChats)}else console.error("Failed to fetch group chats:",e.status,await e.text())}catch(e){console.error("Failed to fetch group chats:",e)}},[t]);(0,l.useEffect)(()=>{!c&&t&&G()},[c,t,G]),(0,l.useEffect)(()=>{let e=e=>{let{type:s,id:t,name:a}=e.detail;j({type:s,id:t,name:a})};return window.addEventListener("navigateToChat",e),()=>{window.removeEventListener("navigateToChat",e)}},[]),(0,l.useEffect)(()=>{let e=()=>{(null==t?void 0:t.signup_code)==="qwea"&&Z(!0)};return window.addEventListener("geminiKeyExhausted",e),()=>{window.removeEventListener("geminiKeyExhausted",e)}},[t]);let J=async(e,s)=>{try{let t=await fetch("/api/group-chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,memberIds:s})});if(t.ok){let e=await t.json();f(s=>[e.groupChat,...s]),b(!1),j({type:"group",id:e.groupChat.id,name:e.groupChat.name}),u("dashboard"),e.groupChat.short_code&&alert("Group chat created! Share this code with others: ".concat(e.groupChat.short_code))}else console.error("Failed to create group chat:",t.status,await t.text())}catch(e){console.error("Failed to create group chat:",e)}},B=async e=>{if(t&&confirm("Are you sure you want to delete this group chat? This action cannot be undone."))try{let s=await fetch("/api/group-chats/".concat(e),{method:"DELETE"});if(s.ok)console.log("Group chat ".concat(e," deleted successfully.")),G(),"group"===g.type&&g.id===e&&j({type:null,name:""});else{let e=await s.json();console.error("Failed to delete group chat:",e.error||s.statusText),alert("Failed to delete group chat: ".concat(e.error||s.statusText))}}catch(e){console.error("Failed to delete group chat:",e),alert("An unexpected error occurred while deleting the group chat.")}},K=async()=>{try{let e=await fetch("/api/auth/signout",{method:"POST",credentials:"include"});e.ok?o(null):console.error("Sign out failed:",e.status),window.location.href="/auth"}catch(e){console.error("Failed to sign out:",e),window.location.href="/auth"}},V=(e,s)=>{j({type:"dm",id:e,name:"@".concat(s)}),u("dashboard"),D(null)},H=()=>{j({type:"global",name:"Global Chat"}),u("dashboard"),D(null)},X=async()=>{},en=async()=>{},eo=async e=>{try{let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)alert("Friend request sent!");else{let e=await s.json();alert("Failed to send friend request: ".concat(e.error))}}catch(e){console.error("Failed to send friend request:",e),alert("An error occurred while sending friend request")}};return c?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)("div",{className:"text-foreground text-sm font-medium",children:"Loading..."})}):t?(0,a.jsxs)("div",{className:"relative min-h-screen bg-background",children:[(0,a.jsx)(ef,{}),(0,a.jsx)(z,{currentPage:h,onPageChange:e=>{"settings"===e?q.push("/settings"):"about"===e?q.push("/about"):"movies"===e?(q.push("/movies"),j({type:null,name:""}),D(null)):"games"===e?(q.push("/games"),j({type:null,name:""}),D(null)):"radio"===e?(q.push("/radio"),j({type:null,name:""}),D(null)):(u(e),"dashboard"!==e&&(j({type:null,name:""}),D(null)))},onSignOut:K,onGlobalChatClick:H,onAIChatClick:()=>{j({type:"dm",id:eg.x,name:eg.w}),u("dashboard"),D(null)},username:t.username,onThemeCycle:X,onHueCycle:en}),(0,a.jsxs)("div",{className:"relative z-10 pt-20 px-4 pb-6",children:["dashboard"===h&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 xl:col-span-1 space-y-6",children:[(0,a.jsxs)($.Zp,{className:"glass-effect rounded-modern-lg",children:[(0,a.jsx)($.aR,{className:"pb-4",children:(0,a.jsxs)($.ZB,{className:"flex items-center justify-between text-base font-medium text-foreground",children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-muted-foreground"}),"Groups"]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50 transition-colors",onClick:()=>E(!0),title:"Search Messages",children:(0,a.jsx)(ex.A,{className:"h-4 w-4 text-zinc-400 dark:text-zinc-600"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50 transition-colors",onClick:()=>y(!0),title:"Join Group Chat",children:(0,a.jsx)(x.A,{className:"h-4 w-4 text-zinc-400 dark:text-zinc-600"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"h-8 w-8 rounded-lg hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50 transition-colors",onClick:()=>b(!0),title:"Create Group Chat",children:(0,a.jsx)(I.A,{className:"h-4 w-4 text-zinc-400 dark:text-zinc-600"})})]})]})}),(0,a.jsx)($.Wu,{className:"pt-0",children:0===p.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 rounded-lg bg-zinc-800 dark:bg-zinc-200 flex items-center justify-center",children:(0,a.jsx)(P.A,{className:"h-6 w-6 text-zinc-400 dark:text-zinc-600"})}),(0,a.jsx)("p",{className:"text-sm text-zinc-400 dark:text-zinc-600",children:"No group chats yet"}),(0,a.jsx)("p",{className:"text-xs text-zinc-500 dark:text-zinc-500 mt-1",children:"Create one to get started"})]}):(0,a.jsx)("div",{className:"space-y-2",children:p.map(e=>(0,a.jsx)("div",{className:"group",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.$,{variant:"ghost",className:"flex-1 justify-start text-left h-auto p-3 rounded-lg transition-all ".concat("group"===g.type&&g.id===e.id?"bg-zinc-800 dark:bg-zinc-200 border border-zinc-700 dark:border-zinc-300":"hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50"),onClick:()=>j({type:"group",id:e.id,name:e.name}),children:(0,a.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg bg-zinc-700 dark:bg-zinc-300 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(P.A,{className:"h-4 w-4 text-zinc-300 dark:text-zinc-700"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium truncate text-zinc-100 dark:text-zinc-900",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-zinc-400 dark:text-zinc-600 truncate",children:["by ",e.creator_username]})]})]})}),(0,a.jsx)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:t.id===e.creator_id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"h-8 w-8 rounded-lg text-zinc-400 dark:text-zinc-600 hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors",title:"View Join Requests",children:(0,a.jsx)(R.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>B(e.id),className:"h-8 w-8 rounded-lg text-red-400 hover:bg-red-500/10 transition-colors",title:"Delete Group Chat",children:(0,a.jsx)(M.A,{className:"h-4 w-4"})})]})})]})},e.id))})})]}),(0,a.jsx)($.Zp,{className:"glass-effect rounded-modern-lg",children:(0,a.jsx)(ed,{currentUserId:t.id})}),(0,a.jsx)($.Zp,{className:"glass-effect rounded-modern-lg",children:(0,a.jsx)(em,{currentUserId:t.id,onViewAllPolls:()=>{u("polls"),D(null)}})})]}),(0,a.jsx)("div",{className:"lg:col-span-3 xl:col-span-4",children:g.type?(0,a.jsx)("div",{className:"h-[calc(100vh-7rem)]",children:(0,a.jsx)(A.l,{chatType:g.type,chatId:g.id,chatName:g.name,currentUserId:t.id,onUserClick:e=>{console.log("[dashboard] User clicked:",e),D(e),u("profile"),j({type:null,name:""})}})}):(0,a.jsx)("div",{className:"h-[calc(100vh-7rem)] flex items-center justify-center",children:(0,a.jsx)($.Zp,{className:"bg-zinc-900/50 dark:bg-zinc-100/50 backdrop-blur-xl border border-zinc-800 dark:border-zinc-200 shadow-2xl rounded-xl w-full max-w-2xl",children:(0,a.jsxs)($.Wu,{className:"text-center py-16 px-8",children:[(0,a.jsxs)("div",{className:"mb-12",children:[(0,a.jsx)("div",{className:"text-6xl md:text-7xl font-light tracking-tight mb-4",children:(0,a.jsx)("span",{className:"text-zinc-100 dark:text-zinc-900",children:"real."})}),(0,a.jsx)("div",{className:"text-lg md:text-xl text-zinc-400 dark:text-zinc-600 font-light",children:"Minimal. Focused. Professional."})]}),(0,a.jsxs)("div",{className:"mb-12 space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"bg-zinc-800 dark:bg-zinc-200 rounded-lg px-4 py-2 text-sm text-zinc-300 dark:text-zinc-700 border border-zinc-700 dark:border-zinc-300",children:(0,a.jsxs)("span",{className:"text-zinc-100 dark:text-zinc-900 font-medium",children:["@",t.username]})})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"bg-zinc-800/50 dark:bg-zinc-200/50 backdrop-blur-xl rounded-lg p-4 border border-zinc-700 dark:border-zinc-300",children:(0,a.jsx)(eu._,{large:!0})}),(0,a.jsx)("div",{className:"bg-zinc-800/50 dark:bg-zinc-200/50 backdrop-blur-xl rounded-lg p-4 border border-zinc-700 dark:border-zinc-300",children:(0,a.jsx)(ep.m,{})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-zinc-100 dark:text-zinc-900 mb-6",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(n.$,{className:"bg-zinc-800 dark:bg-zinc-200 hover:bg-zinc-700 dark:hover:bg-zinc-300 text-zinc-100 dark:text-zinc-900 h-14 flex-col gap-2 text-sm font-medium shadow-lg rounded-lg border border-zinc-700 dark:border-zinc-300",onClick:H,children:[(0,a.jsx)(v.A,{className:"w-5 h-5"}),"Global Chat"]}),(0,a.jsxs)(n.$,{variant:"outline",className:"bg-zinc-900/30 dark:bg-zinc-100/30 border-zinc-700 dark:border-zinc-300 hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50 text-zinc-100 dark:text-zinc-900 h-14 flex-col gap-2 text-sm font-medium rounded-lg",onClick:()=>u("friends"),children:[(0,a.jsx)(P.A,{className:"w-5 h-5"}),"Friends"]}),(0,a.jsxs)(n.$,{variant:"outline",className:"bg-zinc-900/30 dark:bg-zinc-100/30 border-zinc-700 dark:border-zinc-300 hover:bg-zinc-800/50 dark:hover:bg-zinc-200/50 text-zinc-100 dark:text-zinc-900 h-14 flex-col gap-2 text-sm font-medium rounded-lg",onClick:()=>u("channels"),children:[(0,a.jsx)(x.A,{className:"w-5 h-5"}),"Channels"]})]})]})]})})})})]})}),"friends"===h&&t&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(_.r,{currentUserId:t.id,onStartDM:V,onShowProfile:e=>{D(e),u("profile")}})}),"dms"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(F.s,{currentUserId:t.id,onSelectDM:V})}),"polls"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(L,{currentUserId:t.id,userSignupCode:t.signup_code})}),"channels"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(U,{currentUserId:t.id,userSignupCode:t.signup_code,onSelectChannel:(e,s)=>{j({type:"channel",id:e,name:"# ".concat(s)}),u("dashboard"),D(null)}})}),"calendar"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(W,{currentUserId:t.id})}),"voice"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(ee,{})}),"movies"===h&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)(es.default,{})}),"games"===h&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)(ea.A,{})}),"radio"===h&&(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)(et.default,{})}),"profile"===h&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(Q,{userId:null!=T?T:void 0,onStartDM:V,onSendFriendRequest:eo})})]}),(0,a.jsx)(el,{currentUserId:t.id}),N&&t&&(0,a.jsx)(er.o,{onClose:()=>b(!1),onCreate:J}),w&&(0,a.jsx)(ei,{onClose:()=>y(!1),onJoinSuccess:e=>{alert("Join request sent to ".concat(e.name,"! The creator will be notified.")),G()}}),k&&(0,a.jsx)(ec,{groupChatId:(null===(e=p.find(e=>e.creator_id===(null==t?void 0:t.id)))||void 0===e?void 0:e.id)||"",groupChatName:(null===(s=p.find(e=>e.creator_id===(null==t?void 0:t.id)))||void 0===s?void 0:s.name)||"",onClose:()=>C(!1),onRequestProcessed:()=>{G()}}),S&&(0,a.jsx)(eh,{onClose:()=>E(!1),onMessageClick:(e,s)=>{if("global"===e)j({type:"global",name:"Global Chat"});else if("dm"===e)j({type:"dm",id:s,name:"Direct Message"});else if("group"===e){let e=p.find(e=>e.id===s);j({type:"group",id:s,name:(null==e?void 0:e.name)||"Group Chat"})}u("dashboard"),D(null)}}),(0,a.jsx)(ev,{isOpen:O,onClose:()=>Z(!1)})]}):null}},4855:(e,s,t)=>{"use strict";t.d(s,{w:()=>l,x:()=>a});let a="00000000-0000-0000-0000-00000000000a",l="real.AI"},5564:(e,s,t)=>{Promise.resolve().then(t.bind(t,4440))},9370:(e,s,t)=>{"use strict";t.d(s,{n:()=>x});var a=t(2432),l=t(364),r=t(3966),i=t(2708),n=t(7382),c=t(8055),o=t(3748),d=t(7700),m=t(2815);function x(e){let{roomId:s,userId:t,signalingUrl:x="https://realtalk-voice-server.onrender.com"}=e,[h,u]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[g,j]=(0,l.useState)([]),v=(0,l.useRef)(null),N=(0,l.useRef)(new Map),b=(0,l.useRef)(new Map),w=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let l=await fetch("/api/users/me",{cache:"no-store"});if(l.ok){var a;let e=await l.json();if(null==e?void 0:null===(a=e.user)||void 0===a?void 0:a.is_frozen)return}v.current=await navigator.mediaDevices.getUserMedia({audio:!0});let i=(0,r.Ay)(x,{transports:["websocket"]});w.current=i,i.on("connect",()=>u(!0)),i.on("disconnect",()=>u(!1)),i.emit("join-room",{roomId:s,userId:t}),i.on("room-peers",s=>{e&&(j(s),s.forEach(e=>{let{socketId:s}=e;return c(s)}))}),i.on("user-joined",s=>{let{socketId:t,userId:a}=s;e&&j(e=>e.concat([{socketId:t,userId:a}]))}),i.on("user-left",s=>{let{socketId:t}=s;if(!e)return;j(e=>e.filter(e=>e.socketId!==t));let a=b.current.get(t);null==a||a.close(),b.current.delete(t);let l=N.current.get(t);l&&(l.srcObject=null,l.remove(),N.current.delete(t))}),i.on("signal-offer",async e=>{let{from:s,description:t}=e,a=await n(s);await a.setRemoteDescription(t);let l=await a.createAnswer();await a.setLocalDescription(l),i.emit("signal-answer",{to:s,description:a.localDescription})}),i.on("signal-answer",async e=>{let{from:s,description:t}=e,a=await n(s);await a.setRemoteDescription(t)}),i.on("signal-ice-candidate",async e=>{let{from:s,candidate:t}=e,a=await n(s);try{await a.addIceCandidate(t)}catch(e){}});let n=async e=>{var s;let t=b.current.get(e);return t||(t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),b.current.set(e,t),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>t.addTrack(e,v.current)),t.ontrack=s=>{let[t]=s.streams,a=N.current.get(e);a||((a=new Audio).autoplay=!0,N.current.set(e,a)),a.srcObject=t},t.onicecandidate=s=>{s.candidate&&i.emit("signal-ice-candidate",{to:e,candidate:s.candidate})}),t},c=async e=>{let s=await n(e),t=await s.createOffer();await s.setLocalDescription(t),i.emit("signal-offer",{to:e,description:s.localDescription})}}catch(e){console.error("voice init error",e)}})(),()=>{var s;e=!1;let t=w.current;try{null==t||t.emit("leave-room"),null==t||t.disconnect()}catch(e){}b.current.forEach(e=>e.close()),b.current.clear(),null===(s=v.current)||void 0===s||s.getTracks().forEach(e=>e.stop())}},[s,t,x]),(0,a.jsxs)(n.Zp,{className:"glass-effect",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"})," Voice Room"]})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Status: ",h?"Connected":"Connecting..."," • Peers: ",g.length]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.$,{onClick:()=>{f(e=>{var s;let t=!e;return null===(s=v.current)||void 0===s||s.getAudioTracks().forEach(e=>e.enabled=!t),t})},variant:p?"destructive":"default",children:[p?(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),p?"Unmute":"Mute"]}),(0,a.jsxs)(i.$,{onClick:()=>location.reload(),variant:"outline",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-1"})," Leave"]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[4812,7,2261,2354,8279,6345,5849,3215,1163,5022,5575,7358],()=>s(5564)),_N_E=e.O()}]);