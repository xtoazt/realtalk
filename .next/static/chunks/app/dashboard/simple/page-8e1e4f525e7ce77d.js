(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1916],{1371:(e,t,s)=>{"use strict";s.d(t,{l:()=>r});class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}setupVisibilityListener(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",()=>{this.isTabActive=!document.hidden})}async requestPermission(){if(!this.isSupported)return!1;if("granted"===this.permission)return!0;try{let e=await Notification.requestPermission();return this.permission=e,"granted"===e}catch(e){return console.error("Failed to request notification permission:",e),!1}}async showNotification(e){if(!this.isSupported||"granted"!==this.permission||this.isTabActive)return!1;try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.png",tag:e.tag,badge:"/favicon.png",requireInteraction:!1,silent:!1,data:e.data});return t.onclick=()=>{var s;window.focus(),null===(s=e.onClick)||void 0===s||s.call(e),t.close()},!0}catch(e){return!1}}async showMessageNotification(e,t){let s="dm"===e.chatType?"New DM from ".concat(e.username):"group"===e.chatType||"channel"===e.chatType?"New message in ".concat(e.chatName):"New global message from ".concat(e.username),a="image"===e.messageType?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content;return this.showNotification({title:s,body:a,tag:"message-".concat(e.id),data:{chatType:e.chatType,chatId:e.chatId,chatName:e.chatName,messageId:e.id},onClick:()=>{t&&t(e.chatType,e.chatName,e.chatId)}})}getIsTabActive(){return this.isTabActive}getPermission(){return this.permission}getIsSupported(){return this.isSupported}updatePermission(){this.isSupported&&(this.permission=Notification.permission)}constructor(){this.isSupported=!1,this.permission="default",this.isTabActive=!0,this.isSupported="Notification"in window,this.permission=this.isSupported?Notification.permission:"denied",this.setupVisibilityListener()}}let r=a.getInstance()},6947:(e,t,s)=>{Promise.resolve().then(s.bind(s,7681))},7328:(e,t,s)=>{"use strict";s.d(t,{D:()=>d,N:()=>u});var a=s(364),r=(e,t,s,a,r,i,n,l)=>{let o=document.documentElement,c=["light","dark"];function d(t){var s;(Array.isArray(e)?e:[e]).forEach(e=>{let s="class"===e,a=s&&i?r.map(e=>i[e]||e):r;s?(o.classList.remove(...a),o.classList.add(i&&i[t]?i[t]:t)):o.setAttribute(e,t)}),s=t,l&&c.includes(s)&&(o.style.colorScheme=s)}if(a)d(a);else try{let e=localStorage.getItem(t)||s,a=n&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;d(a)}catch(e){}},i=["light","dark"],n="(prefers-color-scheme: dark)",l="undefined"==typeof window,o=a.createContext(void 0),c={setTheme:e=>{},themes:[]},d=()=>{var e;return null!=(e=a.useContext(o))?e:c},u=e=>a.useContext(o)?a.createElement(a.Fragment,null,e.children):a.createElement(h,{...e}),m=["light","dark"],h=e=>{let{forcedTheme:t,disableTransitionOnChange:s=!1,enableSystem:r=!0,enableColorScheme:l=!0,storageKey:c="theme",themes:d=m,defaultTheme:u=r?"system":"light",attribute:h="data-theme",value:b,children:v,nonce:y,scriptProps:w}=e,[N,k]=a.useState(()=>g(c,u)),[j,S]=a.useState(()=>"system"===N?f():N),E=b?Object.values(b):d,T=a.useCallback(e=>{let t=e;if(!t)return;"system"===e&&r&&(t=f());let a=b?b[t]:t,n=s?x(y):null,o=document.documentElement,c=e=>{"class"===e?(o.classList.remove(...E),a&&o.classList.add(a)):e.startsWith("data-")&&(a?o.setAttribute(e,a):o.removeAttribute(e))};if(Array.isArray(h)?h.forEach(c):c(h),l){let e=i.includes(u)?u:null,s=i.includes(t)?t:e;o.style.colorScheme=s}null==n||n()},[y]),C=a.useCallback(e=>{let t="function"==typeof e?e(N):e;k(t);try{localStorage.setItem(c,t)}catch(e){}},[N]),I=a.useCallback(e=>{S(f(e)),"system"===N&&r&&!t&&T("system")},[N,t]);a.useEffect(()=>{let e=window.matchMedia(n);return e.addListener(I),I(e),()=>e.removeListener(I)},[I]),a.useEffect(()=>{let e=e=>{e.key===c&&(e.newValue?k(e.newValue):C(u))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[C]),a.useEffect(()=>{T(null!=t?t:N)},[t,N]);let A=a.useMemo(()=>({theme:N,setTheme:C,forcedTheme:t,resolvedTheme:"system"===N?j:N,themes:r?[...d,"system"]:d,systemTheme:r?j:void 0}),[N,C,t,j,r,d]);return a.createElement(o.Provider,{value:A},a.createElement(p,{forcedTheme:t,storageKey:c,attribute:h,enableSystem:r,enableColorScheme:l,defaultTheme:u,value:b,themes:d,nonce:y,scriptProps:w}),v)},p=a.memo(e=>{let{forcedTheme:t,storageKey:s,attribute:i,enableSystem:n,enableColorScheme:l,defaultTheme:o,value:c,themes:d,nonce:u,scriptProps:m}=e,h=JSON.stringify([i,s,o,t,d,c,n,l]).slice(1,-1);return a.createElement("script",{...m,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:"(".concat(r.toString(),")(").concat(h,")")}})}),g=(e,t)=>{let s;if(!l){try{s=localStorage.getItem(e)||void 0}catch(e){}return s||t}},x=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},f=e=>(e||(e=window.matchMedia(n)),e.matches?"dark":"light")},7616:(e,t,s)=>{"use strict";s.d(t,{J:()=>o,v:()=>l});var a=s(2432),r=s(364),i=s(7328);let n=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0),{setTheme:d,theme:u}=(0,i.D)(),[m,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h(!0)},[]);let p=e=>{m&&((null==e?void 0:e.hue)?(console.log("[UserProvider] Applying hue:",e.hue),["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-".concat(e.hue))):(["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-blue")))};return(0,r.useEffect)(()=>{let e=async()=>{try{console.log("[UserProvider] Fetching user data...");let e=await fetch("/api/auth/me",{cache:"no-store"});if(e.ok){let t=await e.json();if(console.log("[UserProvider] User data received:",t.user),l(t.user),m&&t.user){try{d(t.user.theme||"light")}catch(e){}p(t.user)}}else console.log("[UserProvider] No user found"),l(null)}catch(e){console.error("[UserProvider] Fetch error:",e),l(null)}finally{c(!1)}};m&&(e(),setTimeout(()=>{},0))},[m,d]),(0,r.useEffect)(()=>{m&&p(s)},[s,m]),(0,a.jsx)(n.Provider,{value:{user:s,loading:o,setUser:e=>{console.log("[UserProvider] updateUser called with:",e),l(e),m&&e&&(d(e.theme||"light"),p(e))}},children:t})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},7681:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(2432),r=s(364),i=s(9262),n=s(7616),l=s(1371);function o(){let{user:e,loading:t}=(0,n.J)(),s=(0,i.useRouter)(),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)("chat"),x=(0,r.useRef)(null),f=(0,r.useRef)([]);(0,r.useEffect)(()=>{f.current=o},[o]),(0,r.useEffect)(()=>{if(!t&&!e){s.push("/auth");return}if(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&l.l.showNotification("Notifications Enabled","You'll now receive notifications from real.simple",()=>window.focus())}),b();let e=setInterval(b,3e3);return()=>clearInterval(e)}},[e,t,s,p]);let b=async()=>{try{let t="ai"===p?"AI_USER_ID":void 0,s=new URLSearchParams({chatType:"ai"===p?"dm":"global"});t&&s.append("chatId",t);let a=await fetch("/api/messages?".concat(s));if(a.ok){let t=(await a.json()).messages.slice(-20);if(e&&e.notifications_enabled&&f.current.length>0){let s=new Set(f.current.map(e=>e.id));t.filter(t=>!s.has(t.id)&&t.sender_id!==e.id).forEach(e=>{let t="ai"===p?"AI Chat":"Global Chat";l.l.showNotification("New message in ".concat(t),"".concat(e.username,": ").concat(e.content),()=>{window.focus(),x.current&&x.current.scrollIntoView({behavior:"smooth"})})})}c(t),setTimeout(()=>{x.current&&x.current.scrollIntoView({behavior:"smooth"})},100)}}catch(e){console.error("Failed to fetch messages:",e)}},v=async e=>{if(e.preventDefault(),d.trim()&&!m){h(!0);try{let e="ai"===p?"dm":"global",t="ai"===p?"AI_USER_ID":void 0;(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:d.trim(),chatType:e,chatId:t})})).ok&&(u(""),b())}catch(e){console.error("Failed to send message:",e)}finally{h(!1)}}},y=async()=>{try{await fetch("/api/auth/signout",{method:"POST"}),s.push("/auth")}catch(e){s.push("/auth")}},w=e=>{localStorage.setItem("ui-mode",e),s.push("/dashboard".concat("full"===e?"":"/".concat(e)))};return t?(0,a.jsx)("div",{style:{padding:"20px",fontFamily:"monospace"},children:"Loading..."}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800",children:[(0,a.jsx)("div",{className:"sticky top-0 z-10 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border-b border-slate-200 dark:border-slate-700",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsxs)("h1",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-white",children:["real",(0,a.jsx)("span",{className:"text-slate-500",children:".simple"})]})]}),(0,a.jsxs)("div",{className:"hidden xs:flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[(0,a.jsxs)("span",{className:"truncate",children:["@",e.username]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-xs whitespace-nowrap",children:"chat"===p?"\uD83C\uDF10 Global":"\uD83E\uDD16 AI"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[(0,a.jsxs)("button",{onClick:()=>g("chat"===p?"ai":"chat"),className:"px-2 sm:px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ".concat("ai"===p?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"),title:"chat"===p?"Switch to AI":"Switch to Chat",children:[(0,a.jsx)("span",{className:"hidden xs:inline",children:"chat"===p?"\uD83E\uDD16 AI":"\uD83C\uDF10 Chat"}),(0,a.jsx)("span",{className:"xs:hidden",children:"chat"===p?"\uD83E\uDD16":"\uD83C\uDF10"})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>w("lite"),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg text-xs font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:"Lite"}),(0,a.jsx)("button",{onClick:()=>w("full"),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg text-xs font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:"Full"})]}),(0,a.jsx)("button",{onClick:()=>s.push("/settings/simple"),className:"px-2 sm:px-3 py-1.5 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg text-xs font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",title:"Settings",children:"⚙️"}),(0,a.jsxs)("button",{onClick:y,className:"px-2 sm:px-3 py-1.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-xs font-medium hover:bg-red-200 dark:hover:bg-red-900/30 transition-colors",title:"Sign Out",children:[(0,a.jsx)("span",{className:"hidden xs:inline",children:"Sign Out"}),(0,a.jsx)("span",{className:"xs:hidden",children:"Out"})]})]})]})})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[(0,a.jsx)("div",{className:"h-[calc(100vh-160px)] sm:h-[calc(100vh-180px)] overflow-y-auto p-3 sm:p-4 space-y-2 sm:space-y-3",children:0===o.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 dark:text-slate-400",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"ai"===p?"\uD83E\uDD16":"\uD83D\uDCAC"}),(0,a.jsx)("p",{className:"text-sm",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"ai"===p?"Ask the AI something!":"Start a conversation!"})]}):(0,a.jsxs)(a.Fragment,{children:[o.map(t=>(0,a.jsxs)("div",{className:"flex flex-col gap-1 p-2.5 sm:p-3 rounded-lg transition-colors ".concat(t.sender_id===(null==e?void 0:e.id)?"bg-blue-50 dark:bg-blue-900/20 ml-4 sm:ml-8":t.is_ai_response?"bg-purple-50 dark:bg-purple-900/20 mr-4 sm:mr-8":"bg-slate-50 dark:bg-slate-800/50"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-300",children:t.is_ai_response?"\uD83E\uDD16 AI":t.username}),(0,a.jsx)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsx)("p",{className:"text-sm text-slate-900 dark:text-slate-100 leading-relaxed break-words",children:t.content})]},t.id)),(0,a.jsx)("div",{ref:x})]})}),(0,a.jsx)("div",{className:"border-t border-slate-200 dark:border-slate-700 p-3 sm:p-4",children:(0,a.jsx)("form",{onSubmit:v,children:(0,a.jsxs)("div",{className:"flex gap-2 sm:gap-3",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"ai"===p?"Ask AI anything...":"Type your message...",className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg text-sm text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:m}),(0,a.jsxs)("button",{type:"submit",disabled:m||!d.trim(),className:"px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg text-sm font-medium transition-all whitespace-nowrap ".concat(m||!d.trim()?"bg-slate-100 dark:bg-slate-800 text-slate-400 cursor-not-allowed":"ai"===p?"bg-purple-500 hover:bg-purple-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:[(0,a.jsx)("span",{className:"hidden xs:inline",children:m?"Sending...":"Send"}),(0,a.jsx)("span",{className:"xs:hidden",children:m?"...":"→"})]})]})})})]})})]}):null}},9262:(e,t,s)=>{"use strict";var a=s(6834);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[5022,5575,7358],()=>t(6947)),_N_E=e.O()}]);