(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1916],{1371:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}setupVisibilityListener(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",()=>{this.isTabActive=!document.hidden})}async requestPermission(){if(!this.isSupported)return!1;if("granted"===this.permission)return!0;try{let e=await Notification.requestPermission();return this.permission=e,"granted"===e}catch(e){return console.error("Failed to request notification permission:",e),!1}}async showNotification(e){if(!this.isSupported||"granted"!==this.permission||this.isTabActive)return!1;try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.png",tag:e.tag,badge:"/favicon.png",requireInteraction:!1,silent:!1,data:e.data});return t.onclick=()=>{var n;window.focus(),null===(n=e.onClick)||void 0===n||n.call(e),t.close()},!0}catch(e){return!1}}async showMessageNotification(e,t){let n="dm"===e.chatType?"New DM from ".concat(e.username):"group"===e.chatType||"channel"===e.chatType?"New message in ".concat(e.chatName):"New global message from ".concat(e.username),i="image"===e.messageType?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content;return this.showNotification({title:n,body:i,tag:"message-".concat(e.id),data:{chatType:e.chatType,chatId:e.chatId,chatName:e.chatName,messageId:e.id},onClick:()=>{t&&t(e.chatType,e.chatName,e.chatId)}})}getIsTabActive(){return this.isTabActive}getPermission(){return this.permission}getIsSupported(){return this.isSupported}updatePermission(){this.isSupported&&(this.permission=Notification.permission)}constructor(){this.isSupported=!1,this.permission="default",this.isTabActive=!0,this.isSupported="Notification"in window,this.permission=this.isSupported?Notification.permission:"denied",this.setupVisibilityListener()}}let r=i.getInstance()},4168:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var i=n(364);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,i.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d,iconNode:u,...m}=e;return(0,i.createElement)("svg",{ref:t,...a,width:r,height:r,stroke:n,strokeWidth:c?24*Number(o)/Number(r):o,className:s("lucide",l),...m},[...u.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let n=(0,i.forwardRef)((n,a)=>{let{className:c,...l}=n;return(0,i.createElement)(o,{ref:a,iconNode:t,className:s("lucide-".concat(r(e)),c),...l})});return n.displayName="".concat(e),n}},4260:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});let i=(0,n(4168).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},4652:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});let i=(0,n(4168).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},4855:(e,t,n)=>{"use strict";n.d(t,{w:()=>r,x:()=>i});let i="00000000-0000-0000-0000-00000000000a",r="real.AI"},6947:(e,t,n)=>{Promise.resolve().then(n.bind(n,7681))},7328:(e,t,n)=>{"use strict";n.d(t,{D:()=>d,N:()=>u});var i=n(364),r=(e,t,n,i,r,s,a,o)=>{let c=document.documentElement,l=["light","dark"];function d(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,i=n&&s?r.map(e=>s[e]||e):r;n?(c.classList.remove(...i),c.classList.add(s&&s[t]?s[t]:t)):c.setAttribute(e,t)}),n=t,o&&l.includes(n)&&(c.style.colorScheme=n)}if(i)d(i);else try{let e=localStorage.getItem(t)||n,i=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;d(i)}catch(e){}},s=["light","dark"],a="(prefers-color-scheme: dark)",o="undefined"==typeof window,c=i.createContext(void 0),l={setTheme:e=>{},themes:[]},d=()=>{var e;return null!=(e=i.useContext(c))?e:l},u=e=>i.useContext(c)?i.createElement(i.Fragment,null,e.children):i.createElement(h,{...e}),m=["light","dark"],h=e=>{let{forcedTheme:t,disableTransitionOnChange:n=!1,enableSystem:r=!0,enableColorScheme:o=!0,storageKey:l="theme",themes:d=m,defaultTheme:u=r?"system":"light",attribute:h="data-theme",value:b,children:v,nonce:y,scriptProps:k}=e,[w,z]=i.useState(()=>p(l,u)),[N,j]=i.useState(()=>"system"===w?x():w),S=b?Object.values(b):d,C=i.useCallback(e=>{let t=e;if(!t)return;"system"===e&&r&&(t=x());let i=b?b[t]:t,a=n?f(y):null,c=document.documentElement,l=e=>{"class"===e?(c.classList.remove(...S),i&&c.classList.add(i)):e.startsWith("data-")&&(i?c.setAttribute(e,i):c.removeAttribute(e))};if(Array.isArray(h)?h.forEach(l):l(h),o){let e=s.includes(u)?u:null,n=s.includes(t)?t:e;c.style.colorScheme=n}null==a||a()},[y]),E=i.useCallback(e=>{let t="function"==typeof e?e(w):e;z(t);try{localStorage.setItem(l,t)}catch(e){}},[w]),T=i.useCallback(e=>{j(x(e)),"system"===w&&r&&!t&&C("system")},[w,t]);i.useEffect(()=>{let e=window.matchMedia(a);return e.addListener(T),T(e),()=>e.removeListener(T)},[T]),i.useEffect(()=>{let e=e=>{e.key===l&&(e.newValue?z(e.newValue):E(u))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[E]),i.useEffect(()=>{C(null!=t?t:w)},[t,w]);let A=i.useMemo(()=>({theme:w,setTheme:E,forcedTheme:t,resolvedTheme:"system"===w?N:w,themes:r?[...d,"system"]:d,systemTheme:r?N:void 0}),[w,E,t,N,r,d]);return i.createElement(c.Provider,{value:A},i.createElement(g,{forcedTheme:t,storageKey:l,attribute:h,enableSystem:r,enableColorScheme:o,defaultTheme:u,value:b,themes:d,nonce:y,scriptProps:k}),v)},g=i.memo(e=>{let{forcedTheme:t,storageKey:n,attribute:s,enableSystem:a,enableColorScheme:o,defaultTheme:c,value:l,themes:d,nonce:u,scriptProps:m}=e,h=JSON.stringify([s,n,c,t,d,l,a,o]).slice(1,-1);return i.createElement("script",{...m,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:"(".concat(r.toString(),")(").concat(h,")")}})}),p=(e,t)=>{let n;if(!o){try{n=localStorage.getItem(e)||void 0}catch(e){}return n||t}},f=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},x=e=>(e||(e=window.matchMedia(a)),e.matches?"dark":"light")},7616:(e,t,n)=>{"use strict";n.d(t,{J:()=>c,v:()=>o});var i=n(2432),r=n(364),s=n(7328);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,r.useState)(null),[c,l]=(0,r.useState)(!0),{setTheme:d,theme:u}=(0,s.D)(),[m,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h(!0)},[]);let g=e=>{m&&((null==e?void 0:e.hue)?(console.log("[UserProvider] Applying hue:",e.hue),["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-".concat(e.hue))):(["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-blue")))};return(0,r.useEffect)(()=>{let e=async()=>{try{console.log("[UserProvider] Fetching user data...");let e=await fetch("/api/auth/me",{cache:"no-store"});if(e.ok){let t=await e.json();if(console.log("[UserProvider] User data received:",t.user),o(t.user),m&&t.user){try{d(t.user.theme||"light")}catch(e){}g(t.user)}}else console.log("[UserProvider] No user found"),o(null)}catch(e){console.error("[UserProvider] Fetch error:",e),o(null)}finally{l(!1)}};m&&(e(),setTimeout(()=>{},0))},[m,d]),(0,r.useEffect)(()=>{m&&g(n)},[n,m]),(0,i.jsx)(a.Provider,{value:{user:n,loading:c,setUser:e=>{console.log("[UserProvider] updateUser called with:",e),o(e),m&&e&&(d(e.theme||"light"),g(e))}},children:t})}function c(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},7681:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var i=n(2432),r=n(364),s=n(9262),a=n(7616),o=n(1371),c=n(4855),l=n(4652),d=n(4260);function u(){let{user:e,loading:t}=(0,a.J)(),n=(0,s.useRouter)(),[u,m]=(0,r.useState)([]),[h,g]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[x,b]=(0,r.useState)("chat"),v=(0,r.useRef)(null),y=(0,r.useRef)([]);(0,r.useEffect)(()=>{y.current=u},[u]),(0,r.useEffect)(()=>{if(!t&&!e){n.push("/auth");return}if(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&o.l.showNotification({title:"Notifications Enabled",body:"You'll now receive notifications from real.simple",onClick:()=>window.focus()})}),k();let e=setInterval(k,3e3);return()=>clearInterval(e)}},[e,t,n,x]);let k=async()=>{try{let t="ai"===x?c.x:void 0,n=new URLSearchParams({chatType:"ai"===x?"dm":"global"});t&&n.append("chatId",t);let i=await fetch("/api/messages?".concat(n));if(i.ok){let t=(await i.json()).messages.slice(-20);if(e&&e.notifications_enabled&&y.current.length>0){let n=new Set(y.current.map(e=>e.id));t.filter(t=>!n.has(t.id)&&t.sender_id!==e.id).forEach(e=>{let t="ai"===x?"AI Chat":"Global Chat";o.l.showNotification({title:"New message in ".concat(t),body:"".concat(e.username,": ").concat(e.content),onClick:()=>{window.focus(),v.current&&v.current.scrollIntoView({behavior:"smooth"})}})})}m(t),setTimeout(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},100)}}catch(e){console.error("Failed to fetch messages:",e)}},w=async e=>{if(e.preventDefault(),h.trim()&&!p){f(!0);try{let e="ai"===x?"dm":"global",t="ai"===x?c.x:void 0;(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:h.trim(),chatType:e,chatId:t})})).ok&&(g(""),k())}catch(e){console.error("Failed to send message:",e)}finally{f(!1)}}},z=async()=>{try{await fetch("/api/auth/signout",{method:"POST"}),n.push("/auth")}catch(e){n.push("/auth")}},N=e=>{localStorage.setItem("ui-mode",e),n.push("/dashboard".concat("full"===e?"":"/".concat(e)))};return t?(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,i.jsx)("div",{className:"text-foreground text-sm font-medium",children:"Loading..."})}):e?(0,i.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,i.jsx)("div",{className:"sticky top-0 z-20 glass border-b border-border",children:(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-3",children:(0,i.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-emerald-400 rounded-full"}),(0,i.jsxs)("h1",{className:"text-lg font-semibold text-foreground",children:["real",(0,i.jsx)("span",{className:"text-muted-foreground",children:".simple"})]})]}),(0,i.jsxs)("div",{className:"hidden sm:flex items-center gap-3 text-sm",children:[(0,i.jsxs)("span",{className:"text-muted-foreground font-medium truncate",children:["@",e.username]}),(0,i.jsx)("span",{className:"px-2 py-1 bg-muted rounded-md text-xs font-medium text-muted-foreground border border-border",children:"chat"===x?"Global":"AI"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>b("chat"===x?"ai":"chat"),className:"px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ".concat("ai"===x?"bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100":"bg-zinc-800 dark:bg-zinc-200 text-zinc-300 dark:text-zinc-700 hover:bg-zinc-700 dark:hover:bg-zinc-300"),title:"chat"===x?"Switch to AI":"Switch to Chat",children:"chat"===x?"AI":"Chat"}),(0,i.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>N("lite"),className:"px-3 py-1.5 bg-zinc-800 dark:bg-zinc-200 text-zinc-300 dark:text-zinc-700 rounded-lg text-xs font-medium hover:bg-zinc-700 dark:hover:bg-zinc-300 transition-colors",children:"Lite"}),(0,i.jsx)("button",{onClick:()=>N("full"),className:"px-3 py-1.5 bg-zinc-800 dark:bg-zinc-200 text-zinc-300 dark:text-zinc-700 rounded-lg text-xs font-medium hover:bg-zinc-700 dark:hover:bg-zinc-300 transition-colors",children:"Full"})]}),(0,i.jsx)("button",{onClick:()=>n.push("/settings/simple"),className:"p-2 bg-zinc-800 dark:bg-zinc-200 text-zinc-300 dark:text-zinc-700 rounded-lg hover:bg-zinc-700 dark:hover:bg-zinc-300 transition-colors",title:"Settings",children:(0,i.jsx)(l.A,{className:"h-4 w-4"})}),(0,i.jsx)("button",{onClick:z,className:"p-2 bg-zinc-800 dark:bg-zinc-200 text-red-400 rounded-lg hover:bg-red-500/10 transition-colors",title:"Sign Out",children:(0,i.jsx)(d.A,{className:"h-4 w-4"})})]})]})})}),(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,i.jsxs)("div",{className:"bg-zinc-900/50 dark:bg-zinc-100/50 backdrop-blur-xl border border-zinc-800 dark:border-zinc-200 shadow-2xl rounded-xl overflow-hidden",children:[(0,i.jsx)("div",{className:"h-[calc(100vh-160px)] overflow-y-auto p-4 space-y-3",children:0===u.length?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 dark:text-zinc-600",children:[(0,i.jsx)("div",{className:"text-4xl mb-3",children:"ai"===x?"\uD83E\uDD16":"\uD83D\uDCAC"}),(0,i.jsx)("p",{className:"text-sm font-medium",children:"No messages yet"}),(0,i.jsx)("p",{className:"text-xs mt-1 bg-zinc-800/50 dark:bg-zinc-200/50 px-3 py-1 rounded-lg",children:"ai"===x?"Ask the AI something":"Start a conversation"})]}):(0,i.jsxs)(i.Fragment,{children:[u.map(t=>(0,i.jsxs)("div",{className:"flex flex-col gap-1 p-3 rounded-lg transition-colors ".concat(t.sender_id===(null==e?void 0:e.id)?"bg-zinc-800 dark:bg-zinc-200 ml-8 border border-zinc-700 dark:border-zinc-300":t.is_ai_response?"bg-zinc-800/70 dark:bg-zinc-200/70 mr-8 border border-zinc-700/70 dark:border-zinc-300/70":"bg-zinc-800/30 dark:bg-zinc-200/30"),children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-xs font-medium text-zinc-300 dark:text-zinc-700",children:t.is_ai_response?"AI":t.username}),(0,i.jsx)("span",{className:"text-xs text-zinc-500 dark:text-zinc-500",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,i.jsx)("p",{className:"text-sm text-zinc-100 dark:text-zinc-900 leading-relaxed break-words",children:t.content})]},t.id)),(0,i.jsx)("div",{ref:v})]})}),(0,i.jsx)("div",{className:"border-t border-zinc-800 dark:border-zinc-200 p-4",children:(0,i.jsx)("form",{onSubmit:w,children:(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"ai"===x?"Message AI...":"Type message...",className:"flex-1 px-4 py-2 bg-zinc-800 dark:bg-zinc-200 border border-zinc-700 dark:border-zinc-300 rounded-lg text-sm text-zinc-100 dark:text-zinc-900 placeholder-zinc-400 dark:placeholder-zinc-600 focus:outline-none focus:ring-1 focus:ring-zinc-600 dark:focus:ring-zinc-400 focus:border-transparent transition-all",disabled:p}),(0,i.jsx)("button",{type:"submit",disabled:p||!h.trim(),className:"px-6 py-2 rounded-lg text-sm font-medium transition-all ".concat(p||!h.trim()?"bg-zinc-800/50 dark:bg-zinc-200/50 text-zinc-500 cursor-not-allowed":"bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 hover:bg-zinc-200 dark:hover:bg-zinc-800"),children:p?"Sending":"Send"})]})})})]})})]}):null}},9262:(e,t,n)=>{"use strict";var i=n(6834);n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[5022,5575,7358],()=>t(6947)),_N_E=e.O()}]);