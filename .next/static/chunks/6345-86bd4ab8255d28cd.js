"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6345],{1371:(e,t,n)=>{n.d(t,{l:()=>i});class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}setupVisibilityListener(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",()=>{this.isTabActive=!document.hidden})}async requestPermission(){if(!this.isSupported)return!1;if("granted"===this.permission)return!0;try{let e=await Notification.requestPermission();return this.permission=e,"granted"===e}catch(e){return console.error("Failed to request notification permission:",e),!1}}async showNotification(e){if(!this.isSupported||"granted"!==this.permission||this.isTabActive)return!1;try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.png",tag:e.tag,badge:"/favicon.png",requireInteraction:!1,silent:!1,data:e.data});return setTimeout(()=>{t.close()},5e3),e.onClick?t.onclick=()=>{var n;window.focus(),null===(n=e.onClick)||void 0===n||n.call(e),t.close()}:t.onclick=()=>{window.focus(),t.close()},!0}catch(e){return console.error("Failed to show notification:",e),!1}}async showMessageNotification(e,t){let n="dm"===e.chatType?"New DM from ".concat(e.username):"group"===e.chatType||"channel"===e.chatType?"New message in ".concat(e.chatName):"New global message from ".concat(e.username),r="image"===e.messageType?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content;return this.showNotification({title:n,body:r,tag:"message-".concat(e.id),data:{chatType:e.chatType,chatId:e.chatId,chatName:e.chatName,messageId:e.id},onClick:()=>{t&&t(e.chatType,e.chatId,e.chatName)}})}isTabActive(){return this.isTabActive}getPermission(){return this.permission}isSupported(){return this.isSupported}updatePermission(){this.isSupported&&(this.permission=Notification.permission)}constructor(){this.isSupported=!1,this.permission="default",this.isTabActive=!0,this.isSupported="Notification"in window,this.permission=this.isSupported?Notification.permission:"denied",this.setupVisibilityListener()}}let i=r.getInstance()},2708:(e,t,n)=>{n.d(t,{$:()=>d});var r=n(2432),i=n(364),s=n(4793),a=n(6992),o=n(4963);let c=(0,a.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm hover:shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm hover:shadow-md",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm hover:shadow-md",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",modern:"bg-gradient-to-r from-primary to-primary/90 text-primary-foreground hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl hover:scale-105",glass:"backdrop-blur-md bg-white/20 dark:bg-gray-900/20 border border-white/20 dark:border-gray-700/20 hover:bg-white/30 dark:hover:bg-gray-900/30 shadow-sm hover:shadow-md"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:n,variant:i,size:a,asChild:d=!1,...l}=e,u=d?s.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(c({variant:i,size:a,className:n})),ref:t,...l})});d.displayName="Button"},4963:(e,t,n)=>{n.d(t,{cn:()=>s});var r=n(2126),i=n(8441);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.QP)((0,r.$)(t))}},5501:(e,t,n)=>{n.d(t,{BW:()=>g,S8:()=>h,W0:()=>d,b1:()=>u,eE:()=>p,pL:()=>l,pf:()=>m,rb:()=>c});var r=n(3047),i=n(9266);class s{async loadAdditionalKeys(){try{let e=await fetch("/api/gemini/keys");if(e.ok){let t=await e.json();this.apiKeys.push(...t.filter(e=>!this.exhaustedKeys.has(e)))}}catch(e){console.error("Failed to load additional API keys:",e)}}getCurrentKey(){return 0===this.apiKeys.length?null:this.apiKeys[this.currentKeyIndex]}markKeyAsExhausted(e){this.exhaustedKeys.add(e),this.apiKeys=this.apiKeys.filter(t=>t!==e),this.currentKeyIndex>=this.apiKeys.length&&(this.currentKeyIndex=0),0===this.apiKeys.length&&this.triggerGoldMemberNotification()}async addNewKey(e,t){try{let n=new r.ij(e).getGenerativeModel({model:"gemini-1.5-flash"});if(await n.generateContent("test"),(await fetch("/api/gemini/keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,addedBy:t})})).ok)return this.apiKeys.push(e),console.log("New API key added by ".concat(t)),!0}catch(e){return console.error("Invalid API key:",e),!1}}triggerGoldMemberNotification(){window.dispatchEvent(new CustomEvent("geminiKeyExhausted"))}getKeyStatus(){return{totalKeys:this.apiKeys.length,exhaustedKeys:this.exhaustedKeys.size,currentKeyIndex:this.currentKeyIndex,hasAvailableKeys:this.apiKeys.length>0}}constructor(){this.apiKeys=[],this.currentKeyIndex=0,this.exhaustedKeys=new Set;let e=i.env.GEMINI_API_KEY;e&&this.apiKeys.push(e),this.loadAdditionalKeys()}}let a=new s,o=()=>{let e=a.getCurrentKey();if(!e)throw Error("No available Gemini API keys");return new r.ij(e).getGenerativeModel({model:"gemini-1.5-flash"})},c={assistant:{name:"real.AI",personality:'You are real.AI, a helpful and friendly AI assistant in the chat app "real.". Keep responses concise, friendly, and conversational.',capabilities:["conversation","help","entertainment"]},tutor:{name:"Study Buddy",personality:"You are Study Buddy, an educational AI tutor. Help users learn and explain complex topics in simple terms.",capabilities:["education","explanation","study tips"]},creative:{name:"Creative Muse",personality:"You are Creative Muse, an AI that inspires creativity. Help with writing, brainstorming, and creative projects.",capabilities:["writing","brainstorming","creativity"]}},d={smartSuggestions:!0,contentModeration:!0,aiResponses:!0,conversationSummary:!0};async function l(e,t){var n,r,i;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"assistant";try{let r=o(),i=c[s],a="\n".concat(i.personality,"\n\nContext: ").concat(t.chatType," chat, user: ").concat(t.username,"\nRecent messages: ").concat((null===(n=t.messageHistory)||void 0===n?void 0:n.slice(-3).map(e=>"".concat(e.role,": ").concat(e.content)).join("\n"))||"No recent messages","\n\nUser message: ").concat(e,"\n\nRespond as ").concat(i.name," in a helpful, engaging way. Keep it under 150 words.\n");return{content:(await r.generateContent(a)).response.text(),persona:i.name,confidence:.9}}catch(e){if(console.error("[Gemini] Error generating response:",e),(null===(r=e.message)||void 0===r?void 0:r.includes("quota"))||(null===(i=e.message)||void 0===i?void 0:i.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return{content:"I'm having trouble thinking right now. Please try again later.",persona:"real.AI",confidence:.1}}}async function u(e){try{let t=o();return{isAppropriate:(await t.generateContent('\nAnalyze this message for inappropriate content (hate speech, harassment, explicit content, spam, personal information).\n\nMessage: "'.concat(e,'"\n\nRespond with only: APPROPRIATE or INAPPROPRIATE\n'))).response.text().trim().toLowerCase().includes("appropriate"),confidence:.9}}catch(e){var t,n;if(console.error("[Gemini] Content moderation error:",e),(null===(t=e.message)||void 0===t?void 0:t.includes("quota"))||(null===(n=e.message)||void 0===n?void 0:n.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return{isAppropriate:!0,confidence:.5}}}async function h(e,t){try{let t=o();return(await t.generateContent('\nBased on this message, suggest 3 quick reply options (under 30 characters each):\n\nMessage: "'.concat(e,'"\n\nProvide only the suggestions, one per line:\n1. [suggestion 1]\n2. [suggestion 2]\n3. [suggestion 3]\n'))).response.text().split("\n").filter(e=>e.match(/^\d+\./)).map(e=>e.replace(/^\d+\.\s*/,"")).slice(0,3)}catch(e){var n,r;if(console.error("[Gemini] Smart suggestions error:",e),(null===(n=e.message)||void 0===n?void 0:n.includes("quota"))||(null===(r=e.message)||void 0===r?void 0:r.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return[]}}async function m(e){try{let t=o(),n=e.map(e=>"".concat(e.username,": ").concat(e.content)).join("\n");return(await t.generateContent("\nSummarize this conversation in 1-2 sentences:\n\n".concat(n,"\n\nProvide a concise summary.\n"))).response.text()}catch(e){var t,n;if(console.error("[Gemini] Summary generation error:",e),(null===(t=e.message)||void 0===t?void 0:t.includes("quota"))||(null===(n=e.message)||void 0===n?void 0:n.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return"Unable to generate summary"}}async function p(e,t){return await a.addNewKey(e,t)}function g(){return a.getKeyStatus()}},7304:(e,t,n)=>{n.d(t,{p:()=>a});var r=n(2432),i=n(364),s=n(4963);let a=i.forwardRef((e,t)=>{let{className:n,type:i,...a}=e;return(0,r.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 ease-in-out",n),ref:t,...a})});a.displayName="Input"},7382:(e,t,n)=>{n.d(t,{BT:()=>d,Wu:()=>l,ZB:()=>c,Zp:()=>a,aR:()=>o});var r=n(2432),i=n(364),s=n(4963);let a=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-200 ease-in-out hover:shadow-md",n),...i})});a.displayName="Card";let o=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...i})});o.displayName="CardHeader";let c=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...i})});c.displayName="CardTitle";let d=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...i})});d.displayName="CardDescription";let l=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...i})});l.displayName="CardContent",i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...i})}).displayName="CardFooter"},7616:(e,t,n)=>{n.d(t,{J:()=>c,v:()=>o});var r=n(2432),i=n(364),s=n(7328);let a=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,i.useState)(null),[c,d]=(0,i.useState)(!0),{setTheme:l,theme:u}=(0,s.D)(),[h,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{m(!0)},[]);let p=e=>{h&&((null==e?void 0:e.hue)?(console.log("[UserProvider] Applying hue:",e.hue),["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-".concat(e.hue))):(["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-blue")))};return(0,i.useEffect)(()=>{let e=async()=>{try{console.log("[UserProvider] Fetching user data...");let e=await fetch("/api/auth/me",{cache:"no-store"});if(e.ok){let t=await e.json();if(console.log("[UserProvider] User data received:",t.user),o(t.user),h&&t.user){try{l(t.user.theme||"light")}catch(e){}p(t.user)}}else console.log("[UserProvider] No user found"),o(null)}catch(e){console.error("[UserProvider] Fetch error:",e),o(null)}finally{d(!1)}};h&&(e(),setTimeout(()=>{},0))},[h,l]),(0,i.useEffect)(()=>{h&&p(n)},[n,h]),(0,r.jsx)(a.Provider,{value:{user:n,loading:c,setUser:e=>{console.log("[UserProvider] updateUser called with:",e),o(e),h&&e&&(l(e.theme||"light"),p(e))}},children:t})}function c(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}}}]);