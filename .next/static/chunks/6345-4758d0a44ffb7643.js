"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6345],{1371:(e,t,n)=>{n.d(t,{l:()=>r});class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}setupVisibilityListener(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",()=>{this.isTabActive=!document.hidden})}async requestPermission(){if(!this.isSupported)return!1;if("granted"===this.permission)return!0;try{let e=await Notification.requestPermission();return this.permission=e,"granted"===e}catch(e){return console.error("Failed to request notification permission:",e),!1}}async showNotification(e){if(!this.isSupported||"granted"!==this.permission||this.isTabActive)return!1;try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.png",tag:e.tag,badge:"/favicon.png",requireInteraction:!1,silent:!1,data:e.data});return t.onclick=()=>{var n;window.focus(),null===(n=e.onClick)||void 0===n||n.call(e),t.close()},!0}catch(e){return!1}}async showMessageNotification(e,t){let n="dm"===e.chatType?"New DM from ".concat(e.username):"group"===e.chatType||"channel"===e.chatType?"New message in ".concat(e.chatName):"New global message from ".concat(e.username),i="image"===e.messageType?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content;return this.showNotification({title:n,body:i,tag:"message-".concat(e.id),data:{chatType:e.chatType,chatId:e.chatId,chatName:e.chatName,messageId:e.id},onClick:()=>{t&&t(e.chatType,e.chatName,e.chatId)}})}getIsTabActive(){return this.isTabActive}getPermission(){return this.permission}getIsSupported(){return this.isSupported}updatePermission(){this.isSupported&&(this.permission=Notification.permission)}constructor(){this.isSupported=!1,this.permission="default",this.isTabActive=!0,this.isSupported="Notification"in window,this.permission=this.isSupported?Notification.permission:"denied",this.setupVisibilityListener()}}let r=i.getInstance()},2708:(e,t,n)=>{n.d(t,{$:()=>d});var i=n(2432),r=n(364),s=n(4793),a=n(6992),o=n(4963);let l=(0,a.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 shadow-sm hover:shadow-md focus-visible:shadow-md gap-2 px-4 py-2",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",modern:"bg-gradient-to-r from-primary to-primary/90 text-primary-foreground hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl hover:scale-105",glass:"backdrop-blur-md bg-white/20 dark:bg-gray-900/20 border border-white/20 dark:border-gray-700/20 hover:bg-white/30 dark:hover:bg-gray-900/30"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:n,variant:r,size:a,asChild:d=!1,...c}=e,u=d?s.DX:"button";return(0,i.jsx)(u,{className:(0,o.cn)(l({variant:r,size:a,className:n})),ref:t,...c})});d.displayName="Button"},4963:(e,t,n)=>{n.d(t,{cn:()=>s});var i=n(2126),r=n(8441);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.QP)((0,i.$)(t))}},5501:(e,t,n)=>{n.d(t,{BW:()=>m,S8:()=>h,W0:()=>d,b1:()=>u,eE:()=>p,pL:()=>c,pf:()=>g,rb:()=>l});var i=n(3047),r=n(9266);class s{getError(){return this.error}isLoading(){return this.loading}async loadAdditionalKeys(){this.loading=!0,this.error=null;try{let e=await fetch("/api/gemini/keys");if(e.ok){let t=await e.json();console.log("[GeminiKeyManager] Loaded additional keys:",t.length),this.apiKeys.push(...t.filter(e=>!this.exhaustedKeys.has(e)))}else{let t=await e.json().catch(()=>({}));this.error=t.error||"Failed to load Gemini API keys.",console.log("[GeminiKeyManager] Failed to load keys:",this.error)}}catch(e){this.error="Failed to load Gemini API keys.",console.log("[GeminiKeyManager] Error loading keys:",e.message)}finally{this.loading=!1,console.log("[GeminiKeyManager] Total keys available:",this.apiKeys.length)}}getCurrentKey(){return 0===this.apiKeys.length?null:this.apiKeys[this.currentKeyIndex]}markKeyAsExhausted(e){this.exhaustedKeys.add(e),this.apiKeys=this.apiKeys.filter(t=>t!==e),this.currentKeyIndex>=this.apiKeys.length&&(this.currentKeyIndex=0),0===this.apiKeys.length&&this.triggerGoldMemberNotification()}async addNewKey(e,t){try{let n=new i.ij(e).getGenerativeModel({model:"gemini-1.5-flash"});await n.generateContent("test");let r=await fetch("/api/gemini/keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,addedBy:t})});if(r.ok)return await this.loadAdditionalKeys(),{success:!0,message:"API key added successfully!"};{let e=await r.json().catch(()=>({}));return{success:!1,message:e.error||"Failed to add API key."}}}catch(e){return{success:!1,message:"Invalid API key or network error."}}}triggerGoldMemberNotification(){window.dispatchEvent(new CustomEvent("geminiKeyExhausted"))}getKeyStatus(){return{totalKeys:this.apiKeys.length,exhaustedKeys:this.exhaustedKeys.size,currentKeyIndex:this.currentKeyIndex,hasAvailableKeys:this.apiKeys.length>0,error:this.error,loading:this.loading}}constructor(){this.apiKeys=[],this.currentKeyIndex=0,this.exhaustedKeys=new Set,this.loading=!1,this.error=null;let e=r.env.GEMINI_API_KEY;console.log("[GeminiKeyManager] Env key exists:",!!e,"Length:",null==e?void 0:e.length),e&&e.trim()?(console.log("[GeminiKeyManager] Found API key in env"),this.apiKeys.push(e.trim())):console.log("[GeminiKeyManager] No env key found, loading from database"),this.loadAdditionalKeys()}}let a=new s,o=()=>{let e=a.getCurrentKey();if(console.log("[getGeminiModel] Current key available:",!!e),!e)throw a.triggerGoldMemberNotification(),Error("No available Gemini API keys");return new i.ij(e).getGenerativeModel({model:"gemini-1.5-flash"})},l={assistant:{name:"real.AI",personality:'You are real.AI, a helpful and friendly AI assistant in the chat app "real.". Keep responses concise, friendly, and conversational.',capabilities:["conversation","help","entertainment"]},tutor:{name:"Study Buddy",personality:"You are Study Buddy, an educational AI tutor. Help users learn and explain complex topics in simple terms.",capabilities:["education","explanation","study tips"]},creative:{name:"Creative Muse",personality:"You are Creative Muse, an AI that inspires creativity. Help with writing, brainstorming, and creative projects.",capabilities:["writing","brainstorming","creativity"]}},d={smartSuggestions:!0,contentModeration:!0,aiResponses:!0,conversationSummary:!0};async function c(e,t){var n,i,r;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"assistant";console.log("[generateAIResponse] Starting AI response generation for:",e.substring(0,50));try{let i=o(),r=l[s],a="\n".concat(r.personality,"\n\nContext: ").concat(t.chatType," chat, user: ").concat(t.username,"\nRecent messages: ").concat((null===(n=t.messageHistory)||void 0===n?void 0:n.slice(-3).map(e=>"".concat(e.role,": ").concat(e.content)).join("\n"))||"No recent messages","\n\nUser message: ").concat(e,"\n\nRespond as ").concat(r.name," in a helpful, engaging way. Keep it under 150 words.\n");console.log("[generateAIResponse] Sending prompt to Gemini");let d=(await i.generateContent(a)).response.text();return console.log("[generateAIResponse] Got response:",d.substring(0,100)),{content:d,persona:r.name,confidence:.9}}catch(e){if(console.log("[generateAIResponse] Error:",e.message),(null===(i=e.message)||void 0===i?void 0:i.includes("quota"))||(null===(r=e.message)||void 0===r?void 0:r.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}throw e}}async function u(e){try{let t=o();return{isAppropriate:(await t.generateContent('\nAnalyze this message for inappropriate content (hate speech, harassment, explicit content, spam, personal information).\n\nMessage: "'.concat(e,'"\n\nRespond with only: APPROPRIATE or INAPPROPRIATE\n'))).response.text().trim().toLowerCase().includes("appropriate"),confidence:.9}}catch(e){var t,n;if((null===(t=e.message)||void 0===t?void 0:t.includes("quota"))||(null===(n=e.message)||void 0===n?void 0:n.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return{isAppropriate:!0,confidence:.5}}}async function h(e,t){try{let t=o();return(await t.generateContent('\nBased on this message, suggest 3 quick reply options (under 30 characters each):\n\nMessage: "'.concat(e,'"\n\nProvide only the suggestions, one per line:\n1. [suggestion 1]\n2. [suggestion 2]\n3. [suggestion 3]\n'))).response.text().split("\n").filter(e=>e.match(/^\d+\./)).map(e=>e.replace(/^\d+\.\s*/,"")).slice(0,3)}catch(e){var n,i;if((null===(n=e.message)||void 0===n?void 0:n.includes("quota"))||(null===(i=e.message)||void 0===i?void 0:i.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return[]}}async function g(e){try{let t=o(),n=e.map(e=>"".concat(e.username,": ").concat(e.content)).join("\n");return(await t.generateContent("\nSummarize this conversation in 1-2 sentences:\n\n".concat(n,"\n\nProvide a concise summary.\n"))).response.text()}catch(e){var t,n;if((null===(t=e.message)||void 0===t?void 0:t.includes("quota"))||(null===(n=e.message)||void 0===n?void 0:n.includes("exceeded"))){let e=a.getCurrentKey();e&&a.markKeyAsExhausted(e)}return"Unable to generate summary"}}async function p(e,t){return await a.addNewKey(e,t)}function m(){return a.getKeyStatus()}},7304:(e,t,n)=>{n.d(t,{p:()=>a});var i=n(2432),r=n(364),s=n(4963);let a=r.forwardRef((e,t)=>{let{className:n,type:r,...a}=e;return(0,i.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 focus-visible:shadow-md",n),ref:t,...a})});a.displayName="Input"},7382:(e,t,n)=>{n.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>a,aR:()=>o});var i=n(2432),r=n(364),s=n(4963);let a=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-200 hover:shadow-md focus-within:shadow-md p-6",n),...r})});a.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...r})});o.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...r})});l.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...r})});c.displayName="CardContent",r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...r})}).displayName="CardFooter"},7616:(e,t,n)=>{n.d(t,{J:()=>l,v:()=>o});var i=n(2432),r=n(364),s=n(7328);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,r.useState)(null),[l,d]=(0,r.useState)(!0),{setTheme:c,theme:u}=(0,s.D)(),[h,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(!0)},[]);let p=e=>{h&&((null==e?void 0:e.hue)?(console.log("[UserProvider] Applying hue:",e.hue),["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-".concat(e.hue))):(["hue-blue","hue-purple","hue-pink","hue-red","hue-orange","hue-yellow","hue-green","hue-teal"].forEach(e=>document.documentElement.classList.remove(e)),document.documentElement.classList.add("hue-blue")))};return(0,r.useEffect)(()=>{let e=async()=>{try{console.log("[UserProvider] Fetching user data...");let e=await fetch("/api/auth/me",{cache:"no-store"});if(e.ok){let t=await e.json();if(console.log("[UserProvider] User data received:",t.user),o(t.user),h&&t.user){try{c(t.user.theme||"light")}catch(e){}p(t.user)}}else console.log("[UserProvider] No user found"),o(null)}catch(e){console.error("[UserProvider] Fetch error:",e),o(null)}finally{d(!1)}};h&&(e(),setTimeout(()=>{},0))},[h,c]),(0,r.useEffect)(()=>{h&&p(n)},[n,h]),(0,i.jsx)(a.Provider,{value:{user:n,loading:l,setUser:e=>{console.log("[UserProvider] updateUser called with:",e),o(e),h&&e&&(c(e.theme||"light"),p(e))}},children:t})}function l(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}}}]);