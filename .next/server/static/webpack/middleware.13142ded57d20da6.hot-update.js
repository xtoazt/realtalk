"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addMessageReaction: () => (/* binding */ addMessageReaction),\n/* harmony export */   clearUserFrozen: () => (/* binding */ clearUserFrozen),\n/* harmony export */   createFriendship: () => (/* binding */ createFriendship),\n/* harmony export */   createGroupChat: () => (/* binding */ createGroupChat),\n/* harmony export */   createMessage: () => (/* binding */ createMessage),\n/* harmony export */   createNotification: () => (/* binding */ createNotification),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   deleteGroupChat: () => (/* binding */ deleteGroupChat),\n/* harmony export */   getAcceptedFriends: () => (/* binding */ getAcceptedFriends),\n/* harmony export */   getFriendships: () => (/* binding */ getFriendships),\n/* harmony export */   getMessages: () => (/* binding */ getMessages),\n/* harmony export */   getOnlineUsers: () => (/* binding */ getOnlineUsers),\n/* harmony export */   getUnreadNotifications: () => (/* binding */ getUnreadNotifications),\n/* harmony export */   getUserById: () => (/* binding */ getUserById),\n/* harmony export */   getUserByUsername: () => (/* binding */ getUserByUsername),\n/* harmony export */   getUserDMs: () => (/* binding */ getUserDMs),\n/* harmony export */   getUserFreezeStatus: () => (/* binding */ getUserFreezeStatus),\n/* harmony export */   getUserGroupChats: () => (/* binding */ getUserGroupChats),\n/* harmony export */   markNotificationAsRead: () => (/* binding */ markNotificationAsRead),\n/* harmony export */   query: () => (/* binding */ query),\n/* harmony export */   removeMessageReaction: () => (/* binding */ removeMessageReaction),\n/* harmony export */   searchUsers: () => (/* binding */ searchUsers),\n/* harmony export */   setUserFrozen: () => (/* binding */ setUserFrozen),\n/* harmony export */   updateFriendshipStatus: () => (/* binding */ updateFriendshipStatus),\n/* harmony export */   updateUserActivity: () => (/* binding */ updateUserActivity),\n/* harmony export */   updateUserSettings: () => (/* binding */ updateUserSettings)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(middleware)/./node_modules/.pnpm/next@15.2.4_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @neondatabase/serverless */ \"(middleware)/./node_modules/.pnpm/@neondatabase+serverless@1.0.1/node_modules/@neondatabase/serverless/index.mjs\");\n/* harmony import */ var _lib_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/constants */ \"(middleware)/./lib/constants.ts\");\n\n\n\n// Check if we should use SQLite for local development\nconst databaseUrl = process.env.DATABASE_URL || \"\";\nconst useSQLite = !databaseUrl.includes('postgresql://') || databaseUrl.includes('localhost:5432');\nlet sql;\nif (useSQLite) {\n    // Use a simple in-memory database for development\n    console.log(\"[db] Using in-memory SQLite database for development\");\n    // Create a simple mock database interface\n    const mockDb = {\n        async query (strings, ...values) {\n            // Return mock data for development\n            console.log(\"[db] Mock query:\", strings.join('?'), values);\n            // Return appropriate mock data based on the query\n            const query = strings.join('?').toLowerCase();\n            if (query.includes('select * from users where username')) {\n                // For development, return a mock user if username is provided\n                const username = values[0];\n                if (username) {\n                    return [\n                        {\n                            id: 'mock-user-id',\n                            username: username,\n                            email: null,\n                            signup_code: null,\n                            name_color: null,\n                            custom_title: null,\n                            has_gold_animation: false,\n                            notifications_enabled: false,\n                            theme: 'light',\n                            hue: 'blue',\n                            profile_picture: null,\n                            bio: null,\n                            ui_mode: 'full',\n                            last_active: new Date(),\n                            is_frozen: false,\n                            frozen_by: null,\n                            freeze_message: null,\n                            freeze_popup_message: null,\n                            freeze_updated_at: new Date(),\n                            password_hash: 'mock-hash'\n                        }\n                    ];\n                }\n                return [];\n            }\n            if (query.includes('insert into users')) {\n                return [\n                    {\n                        id: 'mock-user-id',\n                        username: values[0],\n                        email: null,\n                        signup_code: values[2] || null,\n                        name_color: values[3] || null,\n                        custom_title: null,\n                        has_gold_animation: values[4] || false,\n                        notifications_enabled: false,\n                        theme: 'light',\n                        hue: 'blue',\n                        profile_picture: null,\n                        bio: null,\n                        ui_mode: 'full',\n                        last_active: new Date(),\n                        is_frozen: false,\n                        frozen_by: null,\n                        freeze_message: null,\n                        freeze_popup_message: null,\n                        freeze_updated_at: new Date()\n                    }\n                ];\n            }\n            if (query.includes('select * from users where id')) {\n                return [\n                    {\n                        id: values[0],\n                        username: 'mockuser',\n                        email: null,\n                        signup_code: null,\n                        name_color: null,\n                        custom_title: null,\n                        has_gold_animation: false,\n                        notifications_enabled: false,\n                        theme: 'light',\n                        hue: 'blue',\n                        profile_picture: null,\n                        bio: null,\n                        ui_mode: 'full',\n                        last_active: new Date(),\n                        is_frozen: false,\n                        frozen_by: null,\n                        freeze_message: null,\n                        freeze_popup_message: null,\n                        freeze_updated_at: new Date()\n                    }\n                ];\n            }\n            if (query.includes('select * from messages')) {\n                return [];\n            }\n            if (query.includes('select * from friendships')) {\n                return [];\n            }\n            if (query.includes('select * from group_chats')) {\n                return [];\n            }\n            if (query.includes('select * from polls')) {\n                return [];\n            }\n            if (query.includes('select * from calendar_events')) {\n                return [];\n            }\n            if (query.includes('select * from channels')) {\n                return [\n                    {\n                        id: 'school',\n                        name: 'School',\n                        creator_id: null,\n                        is_system: true,\n                        created_at: new Date()\n                    },\n                    {\n                        id: 'unblocked',\n                        name: 'Unblocked',\n                        creator_id: null,\n                        is_system: true,\n                        created_at: new Date()\n                    },\n                    {\n                        id: 'random',\n                        name: 'Random',\n                        creator_id: null,\n                        is_system: true,\n                        created_at: new Date()\n                    }\n                ];\n            }\n            return [];\n        }\n    };\n    sql = mockDb;\n} else {\n    // Use Neon PostgreSQL\n    sql = (0,_neondatabase_serverless__WEBPACK_IMPORTED_MODULE_1__.neon)(process.env.DATABASE_URL);\n}\nconst query = sql;\nconst db = sql;\n// Database helper functions\nasync function createUser(username, passwordHash, signupCode) {\n    try {\n        let nameColor = null;\n        const customTitle = null;\n        let hasGoldAnimation = false;\n        if (signupCode === \"asdf\") {\n            nameColor = \"#6366f1\";\n        } else if (signupCode === \"qwea\") {\n            hasGoldAnimation = true;\n        }\n        const result = await sql`\n      INSERT INTO users (username, password_hash, signup_code, name_color, has_gold_animation, email, last_active, theme, hue, ui_mode)\n      VALUES (${username}, ${passwordHash}, ${signupCode}, ${nameColor}, ${hasGoldAnimation}, NULL, NOW(), 'light', 'blue', 'full')\n      RETURNING id, username, email, signup_code, name_color, custom_title, has_gold_animation, notifications_enabled, theme, hue, profile_picture, bio, ui_mode\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] createUser error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUserByUsername(username) {\n    try {\n        const rows = await sql`\n      SELECT *\n      FROM users\n      WHERE username = ${username}\n      LIMIT 1\n    `;\n        return rows[0];\n    } catch (err) {\n        console.error(\"[db] getUserByUsername error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUserById(id) {\n    try {\n        const result = await sql`\n      SELECT id, username, email, signup_code, name_color, custom_title, has_gold_animation, \n             notifications_enabled, theme, hue, profile_picture, bio, ui_mode\n      FROM users WHERE id = ${id}\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] getUserById error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function updateUserActivity(userId) {\n    try {\n        await sql`\n      UPDATE users \n      SET last_active = NOW()\n      WHERE id = ${userId}\n    `;\n        return true;\n    } catch (err) {\n        console.error(\"[db] updateUserActivity error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getOnlineUsers(currentUserId) {\n    try {\n        const result = await sql`\n      SELECT DISTINCT u.id, u.username, u.name_color, u.has_gold_animation, u.last_active\n      FROM users u\n      JOIN friendships f ON (\n        (f.requester_id = ${currentUserId} AND f.addressee_id = u.id) OR\n        (f.addressee_id = ${currentUserId} AND f.requester_id = u.id)\n      )\n      WHERE u.last_active > NOW() - INTERVAL '10 minutes'\n      AND f.status = 'accepted'\n      AND u.id != ${currentUserId}\n      AND u.id != ${_lib_constants__WEBPACK_IMPORTED_MODULE_2__.AI_USER_ID}\n      ORDER BY u.username\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getOnlineUsers error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function searchUsers(searchQuery, currentUserId) {\n    try {\n        const result = await sql`\n      SELECT id, username, name_color, custom_title, has_gold_animation\n      FROM users \n      WHERE username ILIKE ${`%${searchQuery}%`} \n      AND id != ${currentUserId}\n      AND id != ${_lib_constants__WEBPACK_IMPORTED_MODULE_2__.AI_USER_ID}\n      LIMIT 10\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] searchUsers error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getMessages(chatType, chatId, userId, limit = 50) {\n    try {\n        if (chatType === \"global\") {\n            const result = await sql`\n        SELECT m.*, u.username, u.name_color, u.custom_title, u.has_gold_animation,\n               COALESCE(\n                 json_agg(\n                   json_build_object(\n                     'emoji', mr.emoji,\n                     'count', mr.reaction_count,\n                     'reacted_by_me', CASE WHEN mr.user_reacted THEN true ELSE false END\n                   )\n                 ) FILTER (WHERE mr.emoji IS NOT NULL), \n                 '[]'::json\n               ) as reactions,\n               pm.content AS parent_message_content,\n               pu.username AS parent_message_username\n        FROM messages m\n        JOIN users u ON m.sender_id = u.id\n        LEFT JOIN (\n          SELECT \n            message_id,\n            emoji,\n            COUNT(*) as reaction_count,\n            BOOL_OR(user_id = ${userId || null}) as user_reacted\n          FROM message_reactions\n          GROUP BY message_id, emoji\n        ) mr ON m.id = mr.message_id\n        LEFT JOIN messages pm ON m.parent_message_id = pm.id\n        LEFT JOIN users pu ON pm.sender_id = pu.id\n        WHERE m.chat_type = 'global'\n        GROUP BY m.id, u.username, u.name_color, u.custom_title, u.has_gold_animation, pm.content, pu.username\n        ORDER BY m.created_at DESC\n        LIMIT ${limit}\n      `;\n            return result.reverse();\n        } else if (chatType === \"dm\") {\n            const result = await sql`\n        SELECT m.*, u.username, u.name_color, u.custom_title, u.has_gold_animation,\n               COALESCE(\n                 json_agg(\n                   json_build_object(\n                     'emoji', mr.emoji,\n                     'count', mr.reaction_count,\n                     'reacted_by_me', CASE WHEN mr.user_reacted THEN true ELSE false END\n                   )\n                 ) FILTER (WHERE mr.emoji IS NOT NULL), \n                 '[]'::json\n               ) as reactions,\n               pm.content AS parent_message_content,\n               pu.username AS parent_message_username\n        FROM messages m\n        JOIN users u ON m.sender_id = u.id\n        LEFT JOIN (\n          SELECT \n            message_id,\n            emoji,\n            COUNT(*) as reaction_count,\n            BOOL_OR(user_id = ${userId || null}) as user_reacted\n          FROM message_reactions\n          GROUP BY message_id, emoji\n        ) mr ON m.id = mr.message_id\n        LEFT JOIN messages pm ON m.parent_message_id = pm.id\n        LEFT JOIN users pu ON pm.sender_id = pu.id\n        WHERE m.chat_type = 'dm' \n          AND ((m.sender_id = ${userId} AND m.chat_id = ${chatId}) \n               OR (m.sender_id = ${chatId} AND m.chat_id = ${userId}))\n        GROUP BY m.id, u.username, u.name_color, u.custom_title, u.has_gold_animation, pm.content, pu.username\n        ORDER BY m.created_at DESC\n        LIMIT ${limit}\n      `;\n            return result.reverse();\n        } else if (chatType === \"channel\") {\n            const result = await sql`\n        SELECT m.*, u.username, u.name_color, u.custom_title, u.has_gold_animation,\n               COALESCE(\n                 json_agg(\n                   json_build_object(\n                     'emoji', mr.emoji,\n                     'count', mr.reaction_count,\n                     'reacted_by_me', CASE WHEN mr.user_reacted THEN true ELSE false END\n                   )\n                 ) FILTER (WHERE mr.emoji IS NOT NULL), \n                 '[]'::json\n               ) as reactions,\n               pm.content AS parent_message_content,\n               pu.username AS parent_message_username\n        FROM messages m\n        JOIN users u ON m.sender_id = u.id\n        LEFT JOIN (\n          SELECT \n            message_id,\n            emoji,\n            COUNT(*) as reaction_count,\n            BOOL_OR(user_id = ${userId || null}) as user_reacted\n          FROM message_reactions\n          GROUP BY message_id, emoji\n        ) mr ON m.id = mr.message_id\n        LEFT JOIN messages pm ON m.parent_message_id = pm.id\n        LEFT JOIN users pu ON pm.sender_id = pu.id\n        WHERE m.chat_type = 'channel' AND m.chat_id = ${chatId}\n        GROUP BY m.id, u.username, u.name_color, u.custom_title, u.has_gold_animation, pm.content, pu.username\n        ORDER BY m.created_at DESC\n        LIMIT ${limit}\n      `;\n            return result.reverse();\n        } else {\n            const result = await sql`\n        SELECT m.*, u.username, u.name_color, u.custom_title, u.has_gold_animation,\n               COALESCE(\n                 json_agg(\n                   json_build_object(\n                     'emoji', mr.emoji,\n                     'count', mr.reaction_count,\n                     'reacted_by_me', CASE WHEN mr.user_reacted THEN true ELSE false END\n                   )\n                 ) FILTER (WHERE mr.emoji IS NOT NULL), \n                 '[]'::json\n               ) as reactions,\n               pm.content AS parent_message_content,\n               pu.username AS parent_message_username\n        FROM messages m\n        JOIN users u ON m.sender_id = u.id\n        LEFT JOIN (\n          SELECT \n            message_id,\n            emoji,\n            COUNT(*) as reaction_count,\n            BOOL_OR(user_id = ${userId || null}) as user_reacted\n          FROM message_reactions\n          GROUP BY message_id, emoji\n        ) mr ON m.id = mr.message_id\n        LEFT JOIN messages pm ON m.parent_message_id = pm.id\n        LEFT JOIN users pu ON pm.sender_id = pu.id\n        WHERE m.chat_type = ${chatType} AND m.chat_id = ${chatId}\n        GROUP BY m.id, u.username, u.name_color, u.custom_title, u.has_gold_animation, pm.content, pu.username\n        ORDER BY m.created_at DESC\n        LIMIT ${limit}\n      `;\n            return result.reverse();\n        }\n    } catch (err) {\n        console.error(\"[db] getMessages error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function createMessage(senderId, content, chatType, chatId, mentions = [], isAiResponse = false, parentMessageId, messageType = \"text\") {\n    try {\n        const result = await sql`\n      INSERT INTO messages (sender_id, content, chat_type, chat_id, mentions, is_ai_response, parent_message_id, message_type)\n      VALUES (${senderId}, ${content}, ${chatType}, ${chatId}, ${mentions}, ${isAiResponse}, ${parentMessageId}, ${messageType})\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] createMessage error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function createGroupChat(name, creatorId, memberIds = []) {\n    try {\n        const result = await sql`\n      INSERT INTO group_chats (name, creator_id)\n      VALUES (${name}, ${creatorId})\n      RETURNING *\n    `;\n        await sql`\n      INSERT INTO group_chat_members (group_chat_id, user_id)\n      VALUES (${result[0].id}, ${creatorId})\n    `;\n        for (const memberId of memberIds){\n            if (memberId !== creatorId) {\n                await sql`\n          INSERT INTO group_chat_members (group_chat_id, user_id)\n          VALUES (${result[0].id}, ${memberId})\n          ON CONFLICT (group_chat_id, user_id) DO NOTHING\n        `;\n            }\n        }\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] createGroupChat error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUserGroupChats(userId) {\n    try {\n        const result = await sql`\n      SELECT gc.*, u.username as creator_username\n      FROM group_chats gc\n      JOIN group_chat_members gcm ON gc.id = gcm.group_chat_id\n      JOIN users u ON gc.creator_id = u.id\n      WHERE gcm.user_id = ${userId}\n      ORDER BY gc.updated_at DESC\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getUserGroupChats error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function deleteGroupChat(groupId, creatorId) {\n    try {\n        const chat = await sql`SELECT creator_id FROM group_chats WHERE id = ${groupId}`;\n        if (!chat[0] || chat[0].creator_id !== creatorId) {\n            throw new Error(\"Unauthorized to delete this group chat.\");\n        }\n        await sql`BEGIN`;\n        await sql`DELETE FROM messages WHERE chat_type = 'group' AND chat_id = ${groupId}`;\n        await sql`DELETE FROM group_chat_members WHERE group_chat_id = ${groupId}`;\n        await sql`DELETE FROM group_chats WHERE id = ${groupId}`;\n        await sql`COMMIT`;\n        return true;\n    } catch (err) {\n        await sql`ROLLBACK`;\n        console.error(\"[db] deleteGroupChat error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function createFriendship(requesterId, addresseeId) {\n    try {\n        if (requesterId === addresseeId) {\n            throw new Error(\"Cannot send friend request to yourself.\");\n        }\n        const existing = await sql`\n      SELECT * FROM friendships\n      WHERE (requester_id = ${requesterId} AND addressee_id = ${addresseeId})\n         OR (requester_id = ${addresseeId} AND addressee_id = ${requesterId})\n      LIMIT 1\n    `;\n        if (existing.length > 0) {\n            if (existing[0].status === \"pending\") {\n                throw new Error(\"Friend request already pending.\");\n            } else if (existing[0].status === \"accepted\") {\n                throw new Error(\"Already friends with this user.\");\n            } else if (existing[0].status === \"blocked\") {\n                throw new Error(\"Cannot send request due to existing block.\");\n            }\n        }\n        const result = await sql`\n      INSERT INTO friendships (requester_id, addressee_id, status)\n      VALUES (${requesterId}, ${addresseeId}, 'pending')\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] createFriendship error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function updateFriendshipStatus(friendshipId, status) {\n    try {\n        const result = await sql`\n      UPDATE friendships \n      SET status = ${status}, updated_at = NOW()\n      WHERE id = ${friendshipId}\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] updateFriendshipStatus error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getFriendships(userId) {\n    try {\n        const result = await sql`\n      SELECT f.*, \n             u1.username as requester_username,\n             u2.username as addressee_username,\n             u1.name_color as requester_name_color,\n             u2.name_color as addressee_name_color,\n             u1.has_gold_animation as requester_has_gold,\n             u2.has_gold_animation as addressee_has_gold\n      FROM friendships f\n      JOIN users u1 ON f.requester_id = u1.id\n      JOIN users u2 ON f.addressee_id = u2.id\n      WHERE (f.requester_id = ${userId} OR f.addressee_id = ${userId})\n      ORDER BY f.created_at DESC\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getFriendships error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getAcceptedFriends(userId) {\n    try {\n        const result = await sql`\n      SELECT DISTINCT\n        CASE \n          WHEN f.requester_id = ${userId} THEN u2.id\n          ELSE u1.id\n        END as friend_id,\n        CASE \n          WHEN f.requester_id = ${userId} THEN u2.username\n          ELSE u1.username\n        END as friend_username,\n        CASE \n          WHEN f.requester_id = ${userId} THEN u2.name_color\n          ELSE u1.name_color\n        END as friend_name_color,\n        CASE \n          WHEN f.requester_id = ${userId} THEN u2.has_gold_animation\n          ELSE u1.has_gold_animation\n        END as friend_has_gold\n      FROM friendships f\n      JOIN users u1 ON f.requester_id = u1.id\n      JOIN users u2 ON f.addressee_id = u2.id\n      WHERE (f.requester_id = ${userId} OR f.addressee_id = ${userId})\n      AND f.status = 'accepted'\n      ORDER BY friend_username\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getAcceptedFriends error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUserDMs(userId) {\n    try {\n        const result = await sql`\n      SELECT DISTINCT\n        CASE\n          WHEN m.sender_id = ${userId} THEN m.chat_id\n          ELSE m.sender_id\n        END as friend_id,\n        u.username as friend_username,\n        u.name_color as friend_name_color,\n        u.has_gold_animation as friend_has_gold,\n        MAX(m.created_at) as last_message_at\n      FROM messages m\n      JOIN users u ON \n        CASE\n          WHEN m.sender_id = ${userId} THEN m.chat_id\n          ELSE m.sender_id\n        END = u.id\n      WHERE m.chat_type = 'dm' \n      AND (m.sender_id = ${userId} OR m.chat_id = ${userId})\n      AND u.id != ${userId}\n      AND u.id != ${_lib_constants__WEBPACK_IMPORTED_MODULE_2__.AI_USER_ID}\n      GROUP BY friend_id, u.username, u.name_color, u.has_gold_animation\n      ORDER BY last_message_at DESC\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getUserDMs error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function createNotification(userId, title, message, chatType, chatId, senderUsername) {\n    try {\n        const result = await sql`\n      INSERT INTO notifications (user_id, title, message, chat_type, chat_id, sender_username)\n      VALUES (${userId}, ${title}, ${message}, ${chatType}, ${chatId}, ${senderUsername})\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] createNotification error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUnreadNotifications(userId) {\n    try {\n        const result = await sql`\n      SELECT * FROM notifications\n      WHERE user_id = ${userId} AND is_read = FALSE\n      ORDER BY created_at DESC\n    `;\n        return result;\n    } catch (err) {\n        console.error(\"[db] getUnreadNotifications error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function markNotificationAsRead(notificationId, userId) {\n    try {\n        const result = await sql`\n      UPDATE notifications\n      SET is_read = TRUE, created_at = NOW()\n      WHERE id = ${notificationId} AND user_id = ${userId}\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] markNotificationAsRead error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function addMessageReaction(messageId, userId, emoji) {\n    try {\n        const result = await sql`\n      INSERT INTO message_reactions (message_id, user_id, emoji)\n      VALUES (${messageId}, ${userId}, ${emoji})\n      ON CONFLICT (message_id, user_id, emoji) DO NOTHING\n      RETURNING *\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] addMessageReaction error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function removeMessageReaction(messageId, userId, emoji) {\n    try {\n        await sql`\n      DELETE FROM message_reactions\n      WHERE message_id = ${messageId}\n        AND user_id   = ${userId}\n        AND emoji     = ${emoji}\n    `;\n        return true;\n    } catch (err) {\n        console.error(\"[db] removeMessageReaction error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function updateUserSettings(userId, updates) {\n    try {\n        const allowedFields = [\n            \"name_color\",\n            \"notifications_enabled\",\n            \"theme\",\n            \"hue\",\n            \"ui_mode\"\n        ];\n        const validUpdates = {};\n        for (const [key, value] of Object.entries(updates)){\n            if (allowedFields.includes(key)) {\n                validUpdates[key] = value;\n            }\n        }\n        if (Object.keys(validUpdates).length === 0) {\n            throw new Error(\"No valid fields to update\");\n        }\n        const setClause = Object.keys(validUpdates).map((key, index)=>`${key} = $${index + 2}`).join(\", \");\n        const queryString = `\n      UPDATE users \n      SET ${setClause}, updated_at = NOW()\n      WHERE id = $1\n      RETURNING id, username, email, signup_code, name_color, custom_title, has_gold_animation, notifications_enabled, theme, hue, profile_picture, bio, ui_mode\n    `;\n        const params = [\n            userId,\n            ...Object.values(validUpdates)\n        ];\n        const result = await sql.unsafe(queryString, params);\n        if (!result || result.length === 0) {\n            throw new Error(\"User not found or no settings updated.\");\n        }\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] updateUserSettings error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\n// Freeze feature\nasync function setUserFrozen(targetUserId, frozenByUserId, message) {\n    try {\n        const result = await sql`\n      UPDATE users\n      SET is_frozen = TRUE, frozen_by = ${frozenByUserId}, freeze_message = ${message || null}, updated_at = NOW()\n      WHERE id = ${targetUserId}\n      RETURNING id, is_frozen, frozen_by, freeze_message\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] setUserFrozen error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function clearUserFrozen(targetUserId) {\n    try {\n        const result = await sql`\n      UPDATE users\n      SET is_frozen = FALSE, frozen_by = NULL, freeze_message = NULL, updated_at = NOW()\n      WHERE id = ${targetUserId}\n      RETURNING id, is_frozen, frozen_by, freeze_message\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] clearUserFrozen error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\nasync function getUserFreezeStatus(userId) {\n    try {\n        const result = await sql`\n      SELECT is_frozen, frozen_by, freeze_message FROM users WHERE id = ${userId}\n    `;\n        return result[0];\n    } catch (err) {\n        console.error(\"[db] getUserFreezeStatus error:\", err);\n        throw new Error(\"Database error: \" + err.message);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZXJzL3JvaGFuL2NvZGUvcmVhbHRhbGsvbGliL2RiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcInNlcnZlci1vbmx5XCJcbmltcG9ydCB7IG5lb24gfSBmcm9tIFwiQG5lb25kYXRhYmFzZS9zZXJ2ZXJsZXNzXCJcbmltcG9ydCB7IEFJX1VTRVJfSUQgfSBmcm9tIFwiQC9saWIvY29uc3RhbnRzXCJcblxuLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIHVzZSBTUUxpdGUgZm9yIGxvY2FsIGRldmVsb3BtZW50XG5jb25zdCBkYXRhYmFzZVVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCBcIlwiXG5jb25zdCB1c2VTUUxpdGUgPSAhZGF0YWJhc2VVcmwuaW5jbHVkZXMoJ3Bvc3RncmVzcWw6Ly8nKSB8fCBkYXRhYmFzZVVybC5pbmNsdWRlcygnbG9jYWxob3N0OjU0MzInKVxuXG5sZXQgc3FsOiBhbnlcblxuaWYgKHVzZVNRTGl0ZSkge1xuICAvLyBVc2UgYSBzaW1wbGUgaW4tbWVtb3J5IGRhdGFiYXNlIGZvciBkZXZlbG9wbWVudFxuICBjb25zb2xlLmxvZyhcIltkYl0gVXNpbmcgaW4tbWVtb3J5IFNRTGl0ZSBkYXRhYmFzZSBmb3IgZGV2ZWxvcG1lbnRcIilcbiAgXG4gIC8vIENyZWF0ZSBhIHNpbXBsZSBtb2NrIGRhdGFiYXNlIGludGVyZmFjZVxuICBjb25zdCBtb2NrRGIgPSB7XG4gICAgYXN5bmMgcXVlcnkoc3RyaW5nczogVGVtcGxhdGVTdHJpbmdzQXJyYXksIC4uLnZhbHVlczogYW55W10pIHtcbiAgICAgIC8vIFJldHVybiBtb2NrIGRhdGEgZm9yIGRldmVsb3BtZW50XG4gICAgICBjb25zb2xlLmxvZyhcIltkYl0gTW9jayBxdWVyeTpcIiwgc3RyaW5ncy5qb2luKCc/JyksIHZhbHVlcylcbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIG1vY2sgZGF0YSBiYXNlZCBvbiB0aGUgcXVlcnlcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gc3RyaW5ncy5qb2luKCc/JykudG9Mb3dlckNhc2UoKVxuICAgICAgXG4gICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3NlbGVjdCAqIGZyb20gdXNlcnMgd2hlcmUgdXNlcm5hbWUnKSkge1xuICAgICAgICAvLyBGb3IgZGV2ZWxvcG1lbnQsIHJldHVybiBhIG1vY2sgdXNlciBpZiB1c2VybmFtZSBpcyBwcm92aWRlZFxuICAgICAgICBjb25zdCB1c2VybmFtZSA9IHZhbHVlc1swXVxuICAgICAgICBpZiAodXNlcm5hbWUpIHtcbiAgICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgIGlkOiAnbW9jay11c2VyLWlkJyxcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBudWxsLFxuICAgICAgICAgICAgc2lnbnVwX2NvZGU6IG51bGwsXG4gICAgICAgICAgICBuYW1lX2NvbG9yOiBudWxsLFxuICAgICAgICAgICAgY3VzdG9tX3RpdGxlOiBudWxsLFxuICAgICAgICAgICAgaGFzX2dvbGRfYW5pbWF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnNfZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICB0aGVtZTogJ2xpZ2h0JyxcbiAgICAgICAgICAgIGh1ZTogJ2JsdWUnLFxuICAgICAgICAgICAgcHJvZmlsZV9waWN0dXJlOiBudWxsLFxuICAgICAgICAgICAgYmlvOiBudWxsLFxuICAgICAgICAgICAgdWlfbW9kZTogJ2Z1bGwnLFxuICAgICAgICAgICAgbGFzdF9hY3RpdmU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBpc19mcm96ZW46IGZhbHNlLFxuICAgICAgICAgICAgZnJvemVuX2J5OiBudWxsLFxuICAgICAgICAgICAgZnJlZXplX21lc3NhZ2U6IG51bGwsXG4gICAgICAgICAgICBmcmVlemVfcG9wdXBfbWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgIGZyZWV6ZV91cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmRfaGFzaDogJ21vY2staGFzaCdcbiAgICAgICAgICB9XVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ2luc2VydCBpbnRvIHVzZXJzJykpIHtcbiAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgaWQ6ICdtb2NrLXVzZXItaWQnLFxuICAgICAgICAgIHVzZXJuYW1lOiB2YWx1ZXNbMF0sXG4gICAgICAgICAgZW1haWw6IG51bGwsXG4gICAgICAgICAgc2lnbnVwX2NvZGU6IHZhbHVlc1syXSB8fCBudWxsLFxuICAgICAgICAgIG5hbWVfY29sb3I6IHZhbHVlc1szXSB8fCBudWxsLFxuICAgICAgICAgIGN1c3RvbV90aXRsZTogbnVsbCxcbiAgICAgICAgICBoYXNfZ29sZF9hbmltYXRpb246IHZhbHVlc1s0XSB8fCBmYWxzZSxcbiAgICAgICAgICBub3RpZmljYXRpb25zX2VuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgIHRoZW1lOiAnbGlnaHQnLFxuICAgICAgICAgIGh1ZTogJ2JsdWUnLFxuICAgICAgICAgIHByb2ZpbGVfcGljdHVyZTogbnVsbCxcbiAgICAgICAgICBiaW86IG51bGwsXG4gICAgICAgICAgdWlfbW9kZTogJ2Z1bGwnLFxuICAgICAgICAgIGxhc3RfYWN0aXZlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGlzX2Zyb3plbjogZmFsc2UsXG4gICAgICAgICAgZnJvemVuX2J5OiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV9tZXNzYWdlOiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV9wb3B1cF9tZXNzYWdlOiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV91cGRhdGVkX2F0OiBuZXcgRGF0ZSgpXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnc2VsZWN0ICogZnJvbSB1c2VycyB3aGVyZSBpZCcpKSB7XG4gICAgICAgIHJldHVybiBbe1xuICAgICAgICAgIGlkOiB2YWx1ZXNbMF0sXG4gICAgICAgICAgdXNlcm5hbWU6ICdtb2NrdXNlcicsXG4gICAgICAgICAgZW1haWw6IG51bGwsXG4gICAgICAgICAgc2lnbnVwX2NvZGU6IG51bGwsXG4gICAgICAgICAgbmFtZV9jb2xvcjogbnVsbCxcbiAgICAgICAgICBjdXN0b21fdGl0bGU6IG51bGwsXG4gICAgICAgICAgaGFzX2dvbGRfYW5pbWF0aW9uOiBmYWxzZSxcbiAgICAgICAgICBub3RpZmljYXRpb25zX2VuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgIHRoZW1lOiAnbGlnaHQnLFxuICAgICAgICAgIGh1ZTogJ2JsdWUnLFxuICAgICAgICAgIHByb2ZpbGVfcGljdHVyZTogbnVsbCxcbiAgICAgICAgICBiaW86IG51bGwsXG4gICAgICAgICAgdWlfbW9kZTogJ2Z1bGwnLFxuICAgICAgICAgIGxhc3RfYWN0aXZlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGlzX2Zyb3plbjogZmFsc2UsXG4gICAgICAgICAgZnJvemVuX2J5OiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV9tZXNzYWdlOiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV9wb3B1cF9tZXNzYWdlOiBudWxsLFxuICAgICAgICAgIGZyZWV6ZV91cGRhdGVkX2F0OiBuZXcgRGF0ZSgpXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnc2VsZWN0ICogZnJvbSBtZXNzYWdlcycpKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3NlbGVjdCAqIGZyb20gZnJpZW5kc2hpcHMnKSkge1xuICAgICAgICByZXR1cm4gW11cbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCdzZWxlY3QgKiBmcm9tIGdyb3VwX2NoYXRzJykpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnc2VsZWN0ICogZnJvbSBwb2xscycpKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3NlbGVjdCAqIGZyb20gY2FsZW5kYXJfZXZlbnRzJykpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnc2VsZWN0ICogZnJvbSBjaGFubmVscycpKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgeyBpZDogJ3NjaG9vbCcsIG5hbWU6ICdTY2hvb2wnLCBjcmVhdG9yX2lkOiBudWxsLCBpc19zeXN0ZW06IHRydWUsIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkgfSxcbiAgICAgICAgICB7IGlkOiAndW5ibG9ja2VkJywgbmFtZTogJ1VuYmxvY2tlZCcsIGNyZWF0b3JfaWQ6IG51bGwsIGlzX3N5c3RlbTogdHJ1ZSwgY3JlYXRlZF9hdDogbmV3IERhdGUoKSB9LFxuICAgICAgICAgIHsgaWQ6ICdyYW5kb20nLCBuYW1lOiAnUmFuZG9tJywgY3JlYXRvcl9pZDogbnVsbCwgaXNfc3lzdGVtOiB0cnVlLCBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cbiAgXG4gIHNxbCA9IG1vY2tEYlxufSBlbHNlIHtcbiAgLy8gVXNlIE5lb24gUG9zdGdyZVNRTFxuICBzcWwgPSBuZW9uKHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCEpXG59XG5cbmV4cG9ydCBjb25zdCBxdWVyeSA9IHNxbFxuZXhwb3J0IGNvbnN0IGRiID0gc3FsXG5cbi8vIERhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVVc2VyKHVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkSGFzaDogc3RyaW5nLCBzaWdudXBDb2RlPzogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgbGV0IG5hbWVDb2xvciA9IG51bGxcbiAgICBjb25zdCBjdXN0b21UaXRsZSA9IG51bGxcbiAgICBsZXQgaGFzR29sZEFuaW1hdGlvbiA9IGZhbHNlXG5cbiAgICBpZiAoc2lnbnVwQ29kZSA9PT0gXCJhc2RmXCIpIHtcbiAgICAgIG5hbWVDb2xvciA9IFwiIzYzNjZmMVwiXG4gICAgfSBlbHNlIGlmIChzaWdudXBDb2RlID09PSBcInF3ZWFcIikge1xuICAgICAgaGFzR29sZEFuaW1hdGlvbiA9IHRydWVcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICBJTlNFUlQgSU5UTyB1c2VycyAodXNlcm5hbWUsIHBhc3N3b3JkX2hhc2gsIHNpZ251cF9jb2RlLCBuYW1lX2NvbG9yLCBoYXNfZ29sZF9hbmltYXRpb24sIGVtYWlsLCBsYXN0X2FjdGl2ZSwgdGhlbWUsIGh1ZSwgdWlfbW9kZSlcbiAgICAgIFZBTFVFUyAoJHt1c2VybmFtZX0sICR7cGFzc3dvcmRIYXNofSwgJHtzaWdudXBDb2RlfSwgJHtuYW1lQ29sb3J9LCAke2hhc0dvbGRBbmltYXRpb259LCBOVUxMLCBOT1coKSwgJ2xpZ2h0JywgJ2JsdWUnLCAnZnVsbCcpXG4gICAgICBSRVRVUk5JTkcgaWQsIHVzZXJuYW1lLCBlbWFpbCwgc2lnbnVwX2NvZGUsIG5hbWVfY29sb3IsIGN1c3RvbV90aXRsZSwgaGFzX2dvbGRfYW5pbWF0aW9uLCBub3RpZmljYXRpb25zX2VuYWJsZWQsIHRoZW1lLCBodWUsIHByb2ZpbGVfcGljdHVyZSwgYmlvLCB1aV9tb2RlXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gY3JlYXRlVXNlciBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJCeVVzZXJuYW1lKHVzZXJuYW1lOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByb3dzID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUICpcbiAgICAgIEZST00gdXNlcnNcbiAgICAgIFdIRVJFIHVzZXJuYW1lID0gJHt1c2VybmFtZX1cbiAgICAgIExJTUlUIDFcbiAgICBgXG4gICAgcmV0dXJuIHJvd3NbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gZ2V0VXNlckJ5VXNlcm5hbWUgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlJZChpZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUIGlkLCB1c2VybmFtZSwgZW1haWwsIHNpZ251cF9jb2RlLCBuYW1lX2NvbG9yLCBjdXN0b21fdGl0bGUsIGhhc19nb2xkX2FuaW1hdGlvbiwgXG4gICAgICAgICAgICAgbm90aWZpY2F0aW9uc19lbmFibGVkLCB0aGVtZSwgaHVlLCBwcm9maWxlX3BpY3R1cmUsIGJpbywgdWlfbW9kZVxuICAgICAgRlJPTSB1c2VycyBXSEVSRSBpZCA9ICR7aWR9XG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gZ2V0VXNlckJ5SWQgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyQWN0aXZpdHkodXNlcklkOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBzcWxgXG4gICAgICBVUERBVEUgdXNlcnMgXG4gICAgICBTRVQgbGFzdF9hY3RpdmUgPSBOT1coKVxuICAgICAgV0hFUkUgaWQgPSAke3VzZXJJZH1cbiAgICBgXG4gICAgcmV0dXJuIHRydWVcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gdXBkYXRlVXNlckFjdGl2aXR5IGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T25saW5lVXNlcnMoY3VycmVudFVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUIERJU1RJTkNUIHUuaWQsIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5oYXNfZ29sZF9hbmltYXRpb24sIHUubGFzdF9hY3RpdmVcbiAgICAgIEZST00gdXNlcnMgdVxuICAgICAgSk9JTiBmcmllbmRzaGlwcyBmIE9OIChcbiAgICAgICAgKGYucmVxdWVzdGVyX2lkID0gJHtjdXJyZW50VXNlcklkfSBBTkQgZi5hZGRyZXNzZWVfaWQgPSB1LmlkKSBPUlxuICAgICAgICAoZi5hZGRyZXNzZWVfaWQgPSAke2N1cnJlbnRVc2VySWR9IEFORCBmLnJlcXVlc3Rlcl9pZCA9IHUuaWQpXG4gICAgICApXG4gICAgICBXSEVSRSB1Lmxhc3RfYWN0aXZlID4gTk9XKCkgLSBJTlRFUlZBTCAnMTAgbWludXRlcydcbiAgICAgIEFORCBmLnN0YXR1cyA9ICdhY2NlcHRlZCdcbiAgICAgIEFORCB1LmlkICE9ICR7Y3VycmVudFVzZXJJZH1cbiAgICAgIEFORCB1LmlkICE9ICR7QUlfVVNFUl9JRH1cbiAgICAgIE9SREVSIEJZIHUudXNlcm5hbWVcbiAgICBgXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiW2RiXSBnZXRPbmxpbmVVc2VycyBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaFVzZXJzKHNlYXJjaFF1ZXJ5OiBzdHJpbmcsIGN1cnJlbnRVc2VySWQ6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgIFNFTEVDVCBpZCwgdXNlcm5hbWUsIG5hbWVfY29sb3IsIGN1c3RvbV90aXRsZSwgaGFzX2dvbGRfYW5pbWF0aW9uXG4gICAgICBGUk9NIHVzZXJzIFxuICAgICAgV0hFUkUgdXNlcm5hbWUgSUxJS0UgJHtgJSR7c2VhcmNoUXVlcnl9JWB9IFxuICAgICAgQU5EIGlkICE9ICR7Y3VycmVudFVzZXJJZH1cbiAgICAgIEFORCBpZCAhPSAke0FJX1VTRVJfSUR9XG4gICAgICBMSU1JVCAxMFxuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIHNlYXJjaFVzZXJzIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TWVzc2FnZXMoY2hhdFR5cGU6IHN0cmluZywgY2hhdElkPzogc3RyaW5nLCB1c2VySWQ/OiBzdHJpbmcsIGxpbWl0ID0gNTApIHtcbiAgdHJ5IHtcbiAgICBpZiAoY2hhdFR5cGUgPT09IFwiZ2xvYmFsXCIpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgICAgU0VMRUNUIG0uKiwgdS51c2VybmFtZSwgdS5uYW1lX2NvbG9yLCB1LmN1c3RvbV90aXRsZSwgdS5oYXNfZ29sZF9hbmltYXRpb24sXG4gICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAnZW1vamknLCBtci5lbW9qaSxcbiAgICAgICAgICAgICAgICAgICAgICdjb3VudCcsIG1yLnJlYWN0aW9uX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgJ3JlYWN0ZWRfYnlfbWUnLCBDQVNFIFdIRU4gbXIudXNlcl9yZWFjdGVkIFRIRU4gdHJ1ZSBFTFNFIGZhbHNlIEVORFxuICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIG1yLmVtb2ppIElTIE5PVCBOVUxMKSwgXG4gICAgICAgICAgICAgICAgICdbXSc6Ompzb25cbiAgICAgICAgICAgICAgICkgYXMgcmVhY3Rpb25zLFxuICAgICAgICAgICAgICAgcG0uY29udGVudCBBUyBwYXJlbnRfbWVzc2FnZV9jb250ZW50LFxuICAgICAgICAgICAgICAgcHUudXNlcm5hbWUgQVMgcGFyZW50X21lc3NhZ2VfdXNlcm5hbWVcbiAgICAgICAgRlJPTSBtZXNzYWdlcyBtXG4gICAgICAgIEpPSU4gdXNlcnMgdSBPTiBtLnNlbmRlcl9pZCA9IHUuaWRcbiAgICAgICAgTEVGVCBKT0lOIChcbiAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICBtZXNzYWdlX2lkLFxuICAgICAgICAgICAgZW1vamksXG4gICAgICAgICAgICBDT1VOVCgqKSBhcyByZWFjdGlvbl9jb3VudCxcbiAgICAgICAgICAgIEJPT0xfT1IodXNlcl9pZCA9ICR7dXNlcklkIHx8IG51bGx9KSBhcyB1c2VyX3JlYWN0ZWRcbiAgICAgICAgICBGUk9NIG1lc3NhZ2VfcmVhY3Rpb25zXG4gICAgICAgICAgR1JPVVAgQlkgbWVzc2FnZV9pZCwgZW1vamlcbiAgICAgICAgKSBtciBPTiBtLmlkID0gbXIubWVzc2FnZV9pZFxuICAgICAgICBMRUZUIEpPSU4gbWVzc2FnZXMgcG0gT04gbS5wYXJlbnRfbWVzc2FnZV9pZCA9IHBtLmlkXG4gICAgICAgIExFRlQgSk9JTiB1c2VycyBwdSBPTiBwbS5zZW5kZXJfaWQgPSBwdS5pZFxuICAgICAgICBXSEVSRSBtLmNoYXRfdHlwZSA9ICdnbG9iYWwnXG4gICAgICAgIEdST1VQIEJZIG0uaWQsIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5jdXN0b21fdGl0bGUsIHUuaGFzX2dvbGRfYW5pbWF0aW9uLCBwbS5jb250ZW50LCBwdS51c2VybmFtZVxuICAgICAgICBPUkRFUiBCWSBtLmNyZWF0ZWRfYXQgREVTQ1xuICAgICAgICBMSU1JVCAke2xpbWl0fVxuICAgICAgYFxuICAgICAgcmV0dXJuIHJlc3VsdC5yZXZlcnNlKClcbiAgICB9IGVsc2UgaWYgKGNoYXRUeXBlID09PSBcImRtXCIpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgICAgU0VMRUNUIG0uKiwgdS51c2VybmFtZSwgdS5uYW1lX2NvbG9yLCB1LmN1c3RvbV90aXRsZSwgdS5oYXNfZ29sZF9hbmltYXRpb24sXG4gICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAnZW1vamknLCBtci5lbW9qaSxcbiAgICAgICAgICAgICAgICAgICAgICdjb3VudCcsIG1yLnJlYWN0aW9uX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgJ3JlYWN0ZWRfYnlfbWUnLCBDQVNFIFdIRU4gbXIudXNlcl9yZWFjdGVkIFRIRU4gdHJ1ZSBFTFNFIGZhbHNlIEVORFxuICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIG1yLmVtb2ppIElTIE5PVCBOVUxMKSwgXG4gICAgICAgICAgICAgICAgICdbXSc6Ompzb25cbiAgICAgICAgICAgICAgICkgYXMgcmVhY3Rpb25zLFxuICAgICAgICAgICAgICAgcG0uY29udGVudCBBUyBwYXJlbnRfbWVzc2FnZV9jb250ZW50LFxuICAgICAgICAgICAgICAgcHUudXNlcm5hbWUgQVMgcGFyZW50X21lc3NhZ2VfdXNlcm5hbWVcbiAgICAgICAgRlJPTSBtZXNzYWdlcyBtXG4gICAgICAgIEpPSU4gdXNlcnMgdSBPTiBtLnNlbmRlcl9pZCA9IHUuaWRcbiAgICAgICAgTEVGVCBKT0lOIChcbiAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICBtZXNzYWdlX2lkLFxuICAgICAgICAgICAgZW1vamksXG4gICAgICAgICAgICBDT1VOVCgqKSBhcyByZWFjdGlvbl9jb3VudCxcbiAgICAgICAgICAgIEJPT0xfT1IodXNlcl9pZCA9ICR7dXNlcklkIHx8IG51bGx9KSBhcyB1c2VyX3JlYWN0ZWRcbiAgICAgICAgICBGUk9NIG1lc3NhZ2VfcmVhY3Rpb25zXG4gICAgICAgICAgR1JPVVAgQlkgbWVzc2FnZV9pZCwgZW1vamlcbiAgICAgICAgKSBtciBPTiBtLmlkID0gbXIubWVzc2FnZV9pZFxuICAgICAgICBMRUZUIEpPSU4gbWVzc2FnZXMgcG0gT04gbS5wYXJlbnRfbWVzc2FnZV9pZCA9IHBtLmlkXG4gICAgICAgIExFRlQgSk9JTiB1c2VycyBwdSBPTiBwbS5zZW5kZXJfaWQgPSBwdS5pZFxuICAgICAgICBXSEVSRSBtLmNoYXRfdHlwZSA9ICdkbScgXG4gICAgICAgICAgQU5EICgobS5zZW5kZXJfaWQgPSAke3VzZXJJZH0gQU5EIG0uY2hhdF9pZCA9ICR7Y2hhdElkfSkgXG4gICAgICAgICAgICAgICBPUiAobS5zZW5kZXJfaWQgPSAke2NoYXRJZH0gQU5EIG0uY2hhdF9pZCA9ICR7dXNlcklkfSkpXG4gICAgICAgIEdST1VQIEJZIG0uaWQsIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5jdXN0b21fdGl0bGUsIHUuaGFzX2dvbGRfYW5pbWF0aW9uLCBwbS5jb250ZW50LCBwdS51c2VybmFtZVxuICAgICAgICBPUkRFUiBCWSBtLmNyZWF0ZWRfYXQgREVTQ1xuICAgICAgICBMSU1JVCAke2xpbWl0fVxuICAgICAgYFxuICAgICAgcmV0dXJuIHJlc3VsdC5yZXZlcnNlKClcbiAgICB9IGVsc2UgaWYgKGNoYXRUeXBlID09PSBcImNoYW5uZWxcIikge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgICBTRUxFQ1QgbS4qLCB1LnVzZXJuYW1lLCB1Lm5hbWVfY29sb3IsIHUuY3VzdG9tX3RpdGxlLCB1Lmhhc19nb2xkX2FuaW1hdGlvbixcbiAgICAgICAgICAgICAgIENPQUxFU0NFKFxuICAgICAgICAgICAgICAgICBqc29uX2FnZyhcbiAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICdlbW9qaScsIG1yLmVtb2ppLFxuICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JywgbXIucmVhY3Rpb25fY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAncmVhY3RlZF9ieV9tZScsIENBU0UgV0hFTiBtci51c2VyX3JlYWN0ZWQgVEhFTiB0cnVlIEVMU0UgZmFsc2UgRU5EXG4gICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICApIEZJTFRFUiAoV0hFUkUgbXIuZW1vamkgSVMgTk9UIE5VTEwpLCBcbiAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgKSBhcyByZWFjdGlvbnMsXG4gICAgICAgICAgICAgICBwbS5jb250ZW50IEFTIHBhcmVudF9tZXNzYWdlX2NvbnRlbnQsXG4gICAgICAgICAgICAgICBwdS51c2VybmFtZSBBUyBwYXJlbnRfbWVzc2FnZV91c2VybmFtZVxuICAgICAgICBGUk9NIG1lc3NhZ2VzIG1cbiAgICAgICAgSk9JTiB1c2VycyB1IE9OIG0uc2VuZGVyX2lkID0gdS5pZFxuICAgICAgICBMRUZUIEpPSU4gKFxuICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgIG1lc3NhZ2VfaWQsXG4gICAgICAgICAgICBlbW9qaSxcbiAgICAgICAgICAgIENPVU5UKCopIGFzIHJlYWN0aW9uX2NvdW50LFxuICAgICAgICAgICAgQk9PTF9PUih1c2VyX2lkID0gJHt1c2VySWQgfHwgbnVsbH0pIGFzIHVzZXJfcmVhY3RlZFxuICAgICAgICAgIEZST00gbWVzc2FnZV9yZWFjdGlvbnNcbiAgICAgICAgICBHUk9VUCBCWSBtZXNzYWdlX2lkLCBlbW9qaVxuICAgICAgICApIG1yIE9OIG0uaWQgPSBtci5tZXNzYWdlX2lkXG4gICAgICAgIExFRlQgSk9JTiBtZXNzYWdlcyBwbSBPTiBtLnBhcmVudF9tZXNzYWdlX2lkID0gcG0uaWRcbiAgICAgICAgTEVGVCBKT0lOIHVzZXJzIHB1IE9OIHBtLnNlbmRlcl9pZCA9IHB1LmlkXG4gICAgICAgIFdIRVJFIG0uY2hhdF90eXBlID0gJ2NoYW5uZWwnIEFORCBtLmNoYXRfaWQgPSAke2NoYXRJZH1cbiAgICAgICAgR1JPVVAgQlkgbS5pZCwgdS51c2VybmFtZSwgdS5uYW1lX2NvbG9yLCB1LmN1c3RvbV90aXRsZSwgdS5oYXNfZ29sZF9hbmltYXRpb24sIHBtLmNvbnRlbnQsIHB1LnVzZXJuYW1lXG4gICAgICAgIE9SREVSIEJZIG0uY3JlYXRlZF9hdCBERVNDXG4gICAgICAgIExJTUlUICR7bGltaXR9XG4gICAgICBgXG4gICAgICByZXR1cm4gcmVzdWx0LnJldmVyc2UoKVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICAgIFNFTEVDVCBtLiosIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5jdXN0b21fdGl0bGUsIHUuaGFzX2dvbGRfYW5pbWF0aW9uLFxuICAgICAgICAgICAgICAgQ09BTEVTQ0UoXG4gICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgJ2Vtb2ppJywgbXIuZW1vamksXG4gICAgICAgICAgICAgICAgICAgICAnY291bnQnLCBtci5yZWFjdGlvbl9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICdyZWFjdGVkX2J5X21lJywgQ0FTRSBXSEVOIG1yLnVzZXJfcmVhY3RlZCBUSEVOIHRydWUgRUxTRSBmYWxzZSBFTkRcbiAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICkgRklMVEVSIChXSEVSRSBtci5lbW9qaSBJUyBOT1QgTlVMTCksIFxuICAgICAgICAgICAgICAgICAnW10nOjpqc29uXG4gICAgICAgICAgICAgICApIGFzIHJlYWN0aW9ucyxcbiAgICAgICAgICAgICAgIHBtLmNvbnRlbnQgQVMgcGFyZW50X21lc3NhZ2VfY29udGVudCxcbiAgICAgICAgICAgICAgIHB1LnVzZXJuYW1lIEFTIHBhcmVudF9tZXNzYWdlX3VzZXJuYW1lXG4gICAgICAgIEZST00gbWVzc2FnZXMgbVxuICAgICAgICBKT0lOIHVzZXJzIHUgT04gbS5zZW5kZXJfaWQgPSB1LmlkXG4gICAgICAgIExFRlQgSk9JTiAoXG4gICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgbWVzc2FnZV9pZCxcbiAgICAgICAgICAgIGVtb2ppLFxuICAgICAgICAgICAgQ09VTlQoKikgYXMgcmVhY3Rpb25fY291bnQsXG4gICAgICAgICAgICBCT09MX09SKHVzZXJfaWQgPSAke3VzZXJJZCB8fCBudWxsfSkgYXMgdXNlcl9yZWFjdGVkXG4gICAgICAgICAgRlJPTSBtZXNzYWdlX3JlYWN0aW9uc1xuICAgICAgICAgIEdST1VQIEJZIG1lc3NhZ2VfaWQsIGVtb2ppXG4gICAgICAgICkgbXIgT04gbS5pZCA9IG1yLm1lc3NhZ2VfaWRcbiAgICAgICAgTEVGVCBKT0lOIG1lc3NhZ2VzIHBtIE9OIG0ucGFyZW50X21lc3NhZ2VfaWQgPSBwbS5pZFxuICAgICAgICBMRUZUIEpPSU4gdXNlcnMgcHUgT04gcG0uc2VuZGVyX2lkID0gcHUuaWRcbiAgICAgICAgV0hFUkUgbS5jaGF0X3R5cGUgPSAke2NoYXRUeXBlfSBBTkQgbS5jaGF0X2lkID0gJHtjaGF0SWR9XG4gICAgICAgIEdST1VQIEJZIG0uaWQsIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5jdXN0b21fdGl0bGUsIHUuaGFzX2dvbGRfYW5pbWF0aW9uLCBwbS5jb250ZW50LCBwdS51c2VybmFtZVxuICAgICAgICBPUkRFUiBCWSBtLmNyZWF0ZWRfYXQgREVTQ1xuICAgICAgICBMSU1JVCAke2xpbWl0fVxuICAgICAgYFxuICAgICAgcmV0dXJuIHJlc3VsdC5yZXZlcnNlKClcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldE1lc3NhZ2VzIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTWVzc2FnZShcbiAgc2VuZGVySWQ6IHN0cmluZyxcbiAgY29udGVudDogc3RyaW5nLFxuICBjaGF0VHlwZTogc3RyaW5nLFxuICBjaGF0SWQ/OiBzdHJpbmcsXG4gIG1lbnRpb25zOiBzdHJpbmdbXSA9IFtdLFxuICBpc0FpUmVzcG9uc2UgPSBmYWxzZSxcbiAgcGFyZW50TWVzc2FnZUlkPzogc3RyaW5nLFxuICBtZXNzYWdlVHlwZSA9IFwidGV4dFwiLFxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgSU5TRVJUIElOVE8gbWVzc2FnZXMgKHNlbmRlcl9pZCwgY29udGVudCwgY2hhdF90eXBlLCBjaGF0X2lkLCBtZW50aW9ucywgaXNfYWlfcmVzcG9uc2UsIHBhcmVudF9tZXNzYWdlX2lkLCBtZXNzYWdlX3R5cGUpXG4gICAgICBWQUxVRVMgKCR7c2VuZGVySWR9LCAke2NvbnRlbnR9LCAke2NoYXRUeXBlfSwgJHtjaGF0SWR9LCAke21lbnRpb25zfSwgJHtpc0FpUmVzcG9uc2V9LCAke3BhcmVudE1lc3NhZ2VJZH0sICR7bWVzc2FnZVR5cGV9KVxuICAgICAgUkVUVVJOSU5HICpcbiAgICBgXG4gICAgcmV0dXJuIHJlc3VsdFswXVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiW2RiXSBjcmVhdGVNZXNzYWdlIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlR3JvdXBDaGF0KG5hbWU6IHN0cmluZywgY3JlYXRvcklkOiBzdHJpbmcsIG1lbWJlcklkczogc3RyaW5nW10gPSBbXSkge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgIElOU0VSVCBJTlRPIGdyb3VwX2NoYXRzIChuYW1lLCBjcmVhdG9yX2lkKVxuICAgICAgVkFMVUVTICgke25hbWV9LCAke2NyZWF0b3JJZH0pXG4gICAgICBSRVRVUk5JTkcgKlxuICAgIGBcblxuICAgIGF3YWl0IHNxbGBcbiAgICAgIElOU0VSVCBJTlRPIGdyb3VwX2NoYXRfbWVtYmVycyAoZ3JvdXBfY2hhdF9pZCwgdXNlcl9pZClcbiAgICAgIFZBTFVFUyAoJHtyZXN1bHRbMF0uaWR9LCAke2NyZWF0b3JJZH0pXG4gICAgYFxuXG4gICAgZm9yIChjb25zdCBtZW1iZXJJZCBvZiBtZW1iZXJJZHMpIHtcbiAgICAgIGlmIChtZW1iZXJJZCAhPT0gY3JlYXRvcklkKSB7XG4gICAgICAgIGF3YWl0IHNxbGBcbiAgICAgICAgICBJTlNFUlQgSU5UTyBncm91cF9jaGF0X21lbWJlcnMgKGdyb3VwX2NoYXRfaWQsIHVzZXJfaWQpXG4gICAgICAgICAgVkFMVUVTICgke3Jlc3VsdFswXS5pZH0sICR7bWVtYmVySWR9KVxuICAgICAgICAgIE9OIENPTkZMSUNUIChncm91cF9jaGF0X2lkLCB1c2VyX2lkKSBETyBOT1RISU5HXG4gICAgICAgIGBcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGNyZWF0ZUdyb3VwQ2hhdCBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJHcm91cENoYXRzKHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUIGdjLiosIHUudXNlcm5hbWUgYXMgY3JlYXRvcl91c2VybmFtZVxuICAgICAgRlJPTSBncm91cF9jaGF0cyBnY1xuICAgICAgSk9JTiBncm91cF9jaGF0X21lbWJlcnMgZ2NtIE9OIGdjLmlkID0gZ2NtLmdyb3VwX2NoYXRfaWRcbiAgICAgIEpPSU4gdXNlcnMgdSBPTiBnYy5jcmVhdG9yX2lkID0gdS5pZFxuICAgICAgV0hFUkUgZ2NtLnVzZXJfaWQgPSAke3VzZXJJZH1cbiAgICAgIE9SREVSIEJZIGdjLnVwZGF0ZWRfYXQgREVTQ1xuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldFVzZXJHcm91cENoYXRzIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlR3JvdXBDaGF0KGdyb3VwSWQ6IHN0cmluZywgY3JlYXRvcklkOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjaGF0ID0gYXdhaXQgc3FsYFNFTEVDVCBjcmVhdG9yX2lkIEZST00gZ3JvdXBfY2hhdHMgV0hFUkUgaWQgPSAke2dyb3VwSWR9YFxuICAgIGlmICghY2hhdFswXSB8fCBjaGF0WzBdLmNyZWF0b3JfaWQgIT09IGNyZWF0b3JJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hdXRob3JpemVkIHRvIGRlbGV0ZSB0aGlzIGdyb3VwIGNoYXQuXCIpXG4gICAgfVxuXG4gICAgYXdhaXQgc3FsYEJFR0lOYFxuICAgIGF3YWl0IHNxbGBERUxFVEUgRlJPTSBtZXNzYWdlcyBXSEVSRSBjaGF0X3R5cGUgPSAnZ3JvdXAnIEFORCBjaGF0X2lkID0gJHtncm91cElkfWBcbiAgICBhd2FpdCBzcWxgREVMRVRFIEZST00gZ3JvdXBfY2hhdF9tZW1iZXJzIFdIRVJFIGdyb3VwX2NoYXRfaWQgPSAke2dyb3VwSWR9YFxuICAgIGF3YWl0IHNxbGBERUxFVEUgRlJPTSBncm91cF9jaGF0cyBXSEVSRSBpZCA9ICR7Z3JvdXBJZH1gXG4gICAgYXdhaXQgc3FsYENPTU1JVGBcblxuICAgIHJldHVybiB0cnVlXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGF3YWl0IHNxbGBST0xMQkFDS2BcbiAgICBjb25zb2xlLmVycm9yKFwiW2RiXSBkZWxldGVHcm91cENoYXQgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVGcmllbmRzaGlwKHJlcXVlc3RlcklkOiBzdHJpbmcsIGFkZHJlc3NlZUlkOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBpZiAocmVxdWVzdGVySWQgPT09IGFkZHJlc3NlZUlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VuZCBmcmllbmQgcmVxdWVzdCB0byB5b3Vyc2VsZi5cIilcbiAgICB9XG5cbiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHNxbGBcbiAgICAgIFNFTEVDVCAqIEZST00gZnJpZW5kc2hpcHNcbiAgICAgIFdIRVJFIChyZXF1ZXN0ZXJfaWQgPSAke3JlcXVlc3RlcklkfSBBTkQgYWRkcmVzc2VlX2lkID0gJHthZGRyZXNzZWVJZH0pXG4gICAgICAgICBPUiAocmVxdWVzdGVyX2lkID0gJHthZGRyZXNzZWVJZH0gQU5EIGFkZHJlc3NlZV9pZCA9ICR7cmVxdWVzdGVySWR9KVxuICAgICAgTElNSVQgMVxuICAgIGBcblxuICAgIGlmIChleGlzdGluZy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoZXhpc3RpbmdbMF0uc3RhdHVzID09PSBcInBlbmRpbmdcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGcmllbmQgcmVxdWVzdCBhbHJlYWR5IHBlbmRpbmcuXCIpXG4gICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nWzBdLnN0YXR1cyA9PT0gXCJhY2NlcHRlZFwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFscmVhZHkgZnJpZW5kcyB3aXRoIHRoaXMgdXNlci5cIilcbiAgICAgIH0gZWxzZSBpZiAoZXhpc3RpbmdbMF0uc3RhdHVzID09PSBcImJsb2NrZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2VuZCByZXF1ZXN0IGR1ZSB0byBleGlzdGluZyBibG9jay5cIilcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICBJTlNFUlQgSU5UTyBmcmllbmRzaGlwcyAocmVxdWVzdGVyX2lkLCBhZGRyZXNzZWVfaWQsIHN0YXR1cylcbiAgICAgIFZBTFVFUyAoJHtyZXF1ZXN0ZXJJZH0sICR7YWRkcmVzc2VlSWR9LCAncGVuZGluZycpXG4gICAgICBSRVRVUk5JTkcgKlxuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0WzBdXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGNyZWF0ZUZyaWVuZHNoaXAgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVGcmllbmRzaGlwU3RhdHVzKGZyaWVuZHNoaXBJZDogc3RyaW5nLCBzdGF0dXM6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgIFVQREFURSBmcmllbmRzaGlwcyBcbiAgICAgIFNFVCBzdGF0dXMgPSAke3N0YXR1c30sIHVwZGF0ZWRfYXQgPSBOT1coKVxuICAgICAgV0hFUkUgaWQgPSAke2ZyaWVuZHNoaXBJZH1cbiAgICAgIFJFVFVSTklORyAqXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gdXBkYXRlRnJpZW5kc2hpcFN0YXR1cyBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEZyaWVuZHNoaXBzKHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUIGYuKiwgXG4gICAgICAgICAgICAgdTEudXNlcm5hbWUgYXMgcmVxdWVzdGVyX3VzZXJuYW1lLFxuICAgICAgICAgICAgIHUyLnVzZXJuYW1lIGFzIGFkZHJlc3NlZV91c2VybmFtZSxcbiAgICAgICAgICAgICB1MS5uYW1lX2NvbG9yIGFzIHJlcXVlc3Rlcl9uYW1lX2NvbG9yLFxuICAgICAgICAgICAgIHUyLm5hbWVfY29sb3IgYXMgYWRkcmVzc2VlX25hbWVfY29sb3IsXG4gICAgICAgICAgICAgdTEuaGFzX2dvbGRfYW5pbWF0aW9uIGFzIHJlcXVlc3Rlcl9oYXNfZ29sZCxcbiAgICAgICAgICAgICB1Mi5oYXNfZ29sZF9hbmltYXRpb24gYXMgYWRkcmVzc2VlX2hhc19nb2xkXG4gICAgICBGUk9NIGZyaWVuZHNoaXBzIGZcbiAgICAgIEpPSU4gdXNlcnMgdTEgT04gZi5yZXF1ZXN0ZXJfaWQgPSB1MS5pZFxuICAgICAgSk9JTiB1c2VycyB1MiBPTiBmLmFkZHJlc3NlZV9pZCA9IHUyLmlkXG4gICAgICBXSEVSRSAoZi5yZXF1ZXN0ZXJfaWQgPSAke3VzZXJJZH0gT1IgZi5hZGRyZXNzZWVfaWQgPSAke3VzZXJJZH0pXG4gICAgICBPUkRFUiBCWSBmLmNyZWF0ZWRfYXQgREVTQ1xuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldEZyaWVuZHNoaXBzIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWNjZXB0ZWRGcmllbmRzKHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUIERJU1RJTkNUXG4gICAgICAgIENBU0UgXG4gICAgICAgICAgV0hFTiBmLnJlcXVlc3Rlcl9pZCA9ICR7dXNlcklkfSBUSEVOIHUyLmlkXG4gICAgICAgICAgRUxTRSB1MS5pZFxuICAgICAgICBFTkQgYXMgZnJpZW5kX2lkLFxuICAgICAgICBDQVNFIFxuICAgICAgICAgIFdIRU4gZi5yZXF1ZXN0ZXJfaWQgPSAke3VzZXJJZH0gVEhFTiB1Mi51c2VybmFtZVxuICAgICAgICAgIEVMU0UgdTEudXNlcm5hbWVcbiAgICAgICAgRU5EIGFzIGZyaWVuZF91c2VybmFtZSxcbiAgICAgICAgQ0FTRSBcbiAgICAgICAgICBXSEVOIGYucmVxdWVzdGVyX2lkID0gJHt1c2VySWR9IFRIRU4gdTIubmFtZV9jb2xvclxuICAgICAgICAgIEVMU0UgdTEubmFtZV9jb2xvclxuICAgICAgICBFTkQgYXMgZnJpZW5kX25hbWVfY29sb3IsXG4gICAgICAgIENBU0UgXG4gICAgICAgICAgV0hFTiBmLnJlcXVlc3Rlcl9pZCA9ICR7dXNlcklkfSBUSEVOIHUyLmhhc19nb2xkX2FuaW1hdGlvblxuICAgICAgICAgIEVMU0UgdTEuaGFzX2dvbGRfYW5pbWF0aW9uXG4gICAgICAgIEVORCBhcyBmcmllbmRfaGFzX2dvbGRcbiAgICAgIEZST00gZnJpZW5kc2hpcHMgZlxuICAgICAgSk9JTiB1c2VycyB1MSBPTiBmLnJlcXVlc3Rlcl9pZCA9IHUxLmlkXG4gICAgICBKT0lOIHVzZXJzIHUyIE9OIGYuYWRkcmVzc2VlX2lkID0gdTIuaWRcbiAgICAgIFdIRVJFIChmLnJlcXVlc3Rlcl9pZCA9ICR7dXNlcklkfSBPUiBmLmFkZHJlc3NlZV9pZCA9ICR7dXNlcklkfSlcbiAgICAgIEFORCBmLnN0YXR1cyA9ICdhY2NlcHRlZCdcbiAgICAgIE9SREVSIEJZIGZyaWVuZF91c2VybmFtZVxuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldEFjY2VwdGVkRnJpZW5kcyBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJETXModXNlcklkOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICBTRUxFQ1QgRElTVElOQ1RcbiAgICAgICAgQ0FTRVxuICAgICAgICAgIFdIRU4gbS5zZW5kZXJfaWQgPSAke3VzZXJJZH0gVEhFTiBtLmNoYXRfaWRcbiAgICAgICAgICBFTFNFIG0uc2VuZGVyX2lkXG4gICAgICAgIEVORCBhcyBmcmllbmRfaWQsXG4gICAgICAgIHUudXNlcm5hbWUgYXMgZnJpZW5kX3VzZXJuYW1lLFxuICAgICAgICB1Lm5hbWVfY29sb3IgYXMgZnJpZW5kX25hbWVfY29sb3IsXG4gICAgICAgIHUuaGFzX2dvbGRfYW5pbWF0aW9uIGFzIGZyaWVuZF9oYXNfZ29sZCxcbiAgICAgICAgTUFYKG0uY3JlYXRlZF9hdCkgYXMgbGFzdF9tZXNzYWdlX2F0XG4gICAgICBGUk9NIG1lc3NhZ2VzIG1cbiAgICAgIEpPSU4gdXNlcnMgdSBPTiBcbiAgICAgICAgQ0FTRVxuICAgICAgICAgIFdIRU4gbS5zZW5kZXJfaWQgPSAke3VzZXJJZH0gVEhFTiBtLmNoYXRfaWRcbiAgICAgICAgICBFTFNFIG0uc2VuZGVyX2lkXG4gICAgICAgIEVORCA9IHUuaWRcbiAgICAgIFdIRVJFIG0uY2hhdF90eXBlID0gJ2RtJyBcbiAgICAgIEFORCAobS5zZW5kZXJfaWQgPSAke3VzZXJJZH0gT1IgbS5jaGF0X2lkID0gJHt1c2VySWR9KVxuICAgICAgQU5EIHUuaWQgIT0gJHt1c2VySWR9XG4gICAgICBBTkQgdS5pZCAhPSAke0FJX1VTRVJfSUR9XG4gICAgICBHUk9VUCBCWSBmcmllbmRfaWQsIHUudXNlcm5hbWUsIHUubmFtZV9jb2xvciwgdS5oYXNfZ29sZF9hbmltYXRpb25cbiAgICAgIE9SREVSIEJZIGxhc3RfbWVzc2FnZV9hdCBERVNDXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gZ2V0VXNlckRNcyBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU5vdGlmaWNhdGlvbihcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRpdGxlOiBzdHJpbmcsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgY2hhdFR5cGU/OiBzdHJpbmcsXG4gIGNoYXRJZD86IHN0cmluZyxcbiAgc2VuZGVyVXNlcm5hbWU/OiBzdHJpbmcsXG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICBJTlNFUlQgSU5UTyBub3RpZmljYXRpb25zICh1c2VyX2lkLCB0aXRsZSwgbWVzc2FnZSwgY2hhdF90eXBlLCBjaGF0X2lkLCBzZW5kZXJfdXNlcm5hbWUpXG4gICAgICBWQUxVRVMgKCR7dXNlcklkfSwgJHt0aXRsZX0sICR7bWVzc2FnZX0sICR7Y2hhdFR5cGV9LCAke2NoYXRJZH0sICR7c2VuZGVyVXNlcm5hbWV9KVxuICAgICAgUkVUVVJOSU5HICpcbiAgICBgXG4gICAgcmV0dXJuIHJlc3VsdFswXVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiW2RiXSBjcmVhdGVOb3RpZmljYXRpb24gZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVbnJlYWROb3RpZmljYXRpb25zKHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgU0VMRUNUICogRlJPTSBub3RpZmljYXRpb25zXG4gICAgICBXSEVSRSB1c2VyX2lkID0gJHt1c2VySWR9IEFORCBpc19yZWFkID0gRkFMU0VcbiAgICAgIE9SREVSIEJZIGNyZWF0ZWRfYXQgREVTQ1xuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldFVucmVhZE5vdGlmaWNhdGlvbnMgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXJrTm90aWZpY2F0aW9uQXNSZWFkKG5vdGlmaWNhdGlvbklkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgVVBEQVRFIG5vdGlmaWNhdGlvbnNcbiAgICAgIFNFVCBpc19yZWFkID0gVFJVRSwgY3JlYXRlZF9hdCA9IE5PVygpXG4gICAgICBXSEVSRSBpZCA9ICR7bm90aWZpY2F0aW9uSWR9IEFORCB1c2VyX2lkID0gJHt1c2VySWR9XG4gICAgICBSRVRVUk5JTkcgKlxuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0WzBdXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIG1hcmtOb3RpZmljYXRpb25Bc1JlYWQgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRNZXNzYWdlUmVhY3Rpb24obWVzc2FnZUlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCBlbW9qaTogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3FsYFxuICAgICAgSU5TRVJUIElOVE8gbWVzc2FnZV9yZWFjdGlvbnMgKG1lc3NhZ2VfaWQsIHVzZXJfaWQsIGVtb2ppKVxuICAgICAgVkFMVUVTICgke21lc3NhZ2VJZH0sICR7dXNlcklkfSwgJHtlbW9qaX0pXG4gICAgICBPTiBDT05GTElDVCAobWVzc2FnZV9pZCwgdXNlcl9pZCwgZW1vamkpIERPIE5PVEhJTkdcbiAgICAgIFJFVFVSTklORyAqXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gYWRkTWVzc2FnZVJlYWN0aW9uIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlTWVzc2FnZVJlYWN0aW9uKG1lc3NhZ2VJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgZW1vamk6IHN0cmluZykge1xuICB0cnkge1xuICAgIGF3YWl0IHNxbGBcbiAgICAgIERFTEVURSBGUk9NIG1lc3NhZ2VfcmVhY3Rpb25zXG4gICAgICBXSEVSRSBtZXNzYWdlX2lkID0gJHttZXNzYWdlSWR9XG4gICAgICAgIEFORCB1c2VyX2lkICAgPSAke3VzZXJJZH1cbiAgICAgICAgQU5EIGVtb2ppICAgICA9ICR7ZW1vaml9XG4gICAgYFxuICAgIHJldHVybiB0cnVlXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIHJlbW92ZU1lc3NhZ2VSZWFjdGlvbiBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVVzZXJTZXR0aW5ncyh1c2VySWQ6IHN0cmluZywgdXBkYXRlczogYW55KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYWxsb3dlZEZpZWxkcyA9IFtcIm5hbWVfY29sb3JcIiwgXCJub3RpZmljYXRpb25zX2VuYWJsZWRcIiwgXCJ0aGVtZVwiLCBcImh1ZVwiLCBcInVpX21vZGVcIl1cbiAgICBjb25zdCB2YWxpZFVwZGF0ZXM6IGFueSA9IHt9XG5cbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh1cGRhdGVzKSkge1xuICAgICAgaWYgKGFsbG93ZWRGaWVsZHMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICB2YWxpZFVwZGF0ZXNba2V5XSA9IHZhbHVlXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKE9iamVjdC5rZXlzKHZhbGlkVXBkYXRlcykubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB2YWxpZCBmaWVsZHMgdG8gdXBkYXRlXCIpXG4gICAgfVxuXG4gICAgY29uc3Qgc2V0Q2xhdXNlID0gT2JqZWN0LmtleXModmFsaWRVcGRhdGVzKVxuICAgICAgLm1hcCgoa2V5LCBpbmRleCkgPT4gYCR7a2V5fSA9ICQke2luZGV4ICsgMn1gKVxuICAgICAgLmpvaW4oXCIsIFwiKVxuXG4gICAgY29uc3QgcXVlcnlTdHJpbmcgPSBgXG4gICAgICBVUERBVEUgdXNlcnMgXG4gICAgICBTRVQgJHtzZXRDbGF1c2V9LCB1cGRhdGVkX2F0ID0gTk9XKClcbiAgICAgIFdIRVJFIGlkID0gJDFcbiAgICAgIFJFVFVSTklORyBpZCwgdXNlcm5hbWUsIGVtYWlsLCBzaWdudXBfY29kZSwgbmFtZV9jb2xvciwgY3VzdG9tX3RpdGxlLCBoYXNfZ29sZF9hbmltYXRpb24sIG5vdGlmaWNhdGlvbnNfZW5hYmxlZCwgdGhlbWUsIGh1ZSwgcHJvZmlsZV9waWN0dXJlLCBiaW8sIHVpX21vZGVcbiAgICBgXG5cbiAgICBjb25zdCBwYXJhbXMgPSBbdXNlcklkLCAuLi5PYmplY3QudmFsdWVzKHZhbGlkVXBkYXRlcyldXG4gICAgY29uc3QgcmVzdWx0OiBhbnlbXSA9IGF3YWl0IChzcWwgYXMgYW55KS51bnNhZmUocXVlcnlTdHJpbmcsIHBhcmFtcyBhcyBhbnkpXG5cbiAgICBpZiAoIXJlc3VsdCB8fCAocmVzdWx0IGFzIGFueSkubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIG5vdCBmb3VuZCBvciBubyBzZXR0aW5ncyB1cGRhdGVkLlwiKVxuICAgIH1cblxuICAgIHJldHVybiAocmVzdWx0IGFzIGFueSlbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gdXBkYXRlVXNlclNldHRpbmdzIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG4vLyBGcmVlemUgZmVhdHVyZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldFVzZXJGcm96ZW4odGFyZ2V0VXNlcklkOiBzdHJpbmcsIGZyb3plbkJ5VXNlcklkOiBzdHJpbmcsIG1lc3NhZ2U/OiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICBVUERBVEUgdXNlcnNcbiAgICAgIFNFVCBpc19mcm96ZW4gPSBUUlVFLCBmcm96ZW5fYnkgPSAke2Zyb3plbkJ5VXNlcklkfSwgZnJlZXplX21lc3NhZ2UgPSAke21lc3NhZ2UgfHwgbnVsbH0sIHVwZGF0ZWRfYXQgPSBOT1coKVxuICAgICAgV0hFUkUgaWQgPSAke3RhcmdldFVzZXJJZH1cbiAgICAgIFJFVFVSTklORyBpZCwgaXNfZnJvemVuLCBmcm96ZW5fYnksIGZyZWV6ZV9tZXNzYWdlXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gc2V0VXNlckZyb3plbiBlcnJvcjpcIiwgZXJyKVxuICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGFiYXNlIGVycm9yOiBcIiArIChlcnIgYXMgRXJyb3IpLm1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFyVXNlckZyb3plbih0YXJnZXRVc2VySWQ6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgIFVQREFURSB1c2Vyc1xuICAgICAgU0VUIGlzX2Zyb3plbiA9IEZBTFNFLCBmcm96ZW5fYnkgPSBOVUxMLCBmcmVlemVfbWVzc2FnZSA9IE5VTEwsIHVwZGF0ZWRfYXQgPSBOT1coKVxuICAgICAgV0hFUkUgaWQgPSAke3RhcmdldFVzZXJJZH1cbiAgICAgIFJFVFVSTklORyBpZCwgaXNfZnJvemVuLCBmcm96ZW5fYnksIGZyZWV6ZV9tZXNzYWdlXG4gICAgYFxuICAgIHJldHVybiByZXN1bHRbMF1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltkYl0gY2xlYXJVc2VyRnJvemVuIGVycm9yOlwiLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YWJhc2UgZXJyb3I6IFwiICsgKGVyciBhcyBFcnJvcikubWVzc2FnZSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckZyZWV6ZVN0YXR1cyh1c2VySWQ6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbGBcbiAgICAgIFNFTEVDVCBpc19mcm96ZW4sIGZyb3plbl9ieSwgZnJlZXplX21lc3NhZ2UgRlJPTSB1c2VycyBXSEVSRSBpZCA9ICR7dXNlcklkfVxuICAgIGBcbiAgICByZXR1cm4gcmVzdWx0WzBdXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbZGJdIGdldFVzZXJGcmVlemVTdGF0dXMgZXJyb3I6XCIsIGVycilcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBlcnJvcjogXCIgKyAoZXJyIGFzIEVycm9yKS5tZXNzYWdlKVxuICB9XG59XG4iXSwibmFtZXMiOlsibmVvbiIsIkFJX1VTRVJfSUQiLCJkYXRhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJ1c2VTUUxpdGUiLCJpbmNsdWRlcyIsInNxbCIsImNvbnNvbGUiLCJsb2ciLCJtb2NrRGIiLCJxdWVyeSIsInN0cmluZ3MiLCJ2YWx1ZXMiLCJqb2luIiwidG9Mb3dlckNhc2UiLCJ1c2VybmFtZSIsImlkIiwiZW1haWwiLCJzaWdudXBfY29kZSIsIm5hbWVfY29sb3IiLCJjdXN0b21fdGl0bGUiLCJoYXNfZ29sZF9hbmltYXRpb24iLCJub3RpZmljYXRpb25zX2VuYWJsZWQiLCJ0aGVtZSIsImh1ZSIsInByb2ZpbGVfcGljdHVyZSIsImJpbyIsInVpX21vZGUiLCJsYXN0X2FjdGl2ZSIsIkRhdGUiLCJpc19mcm96ZW4iLCJmcm96ZW5fYnkiLCJmcmVlemVfbWVzc2FnZSIsImZyZWV6ZV9wb3B1cF9tZXNzYWdlIiwiZnJlZXplX3VwZGF0ZWRfYXQiLCJwYXNzd29yZF9oYXNoIiwibmFtZSIsImNyZWF0b3JfaWQiLCJpc19zeXN0ZW0iLCJjcmVhdGVkX2F0IiwiZGIiLCJjcmVhdGVVc2VyIiwicGFzc3dvcmRIYXNoIiwic2lnbnVwQ29kZSIsIm5hbWVDb2xvciIsImN1c3RvbVRpdGxlIiwiaGFzR29sZEFuaW1hdGlvbiIsInJlc3VsdCIsImVyciIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwiZ2V0VXNlckJ5VXNlcm5hbWUiLCJyb3dzIiwiZ2V0VXNlckJ5SWQiLCJ1cGRhdGVVc2VyQWN0aXZpdHkiLCJ1c2VySWQiLCJnZXRPbmxpbmVVc2VycyIsImN1cnJlbnRVc2VySWQiLCJzZWFyY2hVc2VycyIsInNlYXJjaFF1ZXJ5IiwiZ2V0TWVzc2FnZXMiLCJjaGF0VHlwZSIsImNoYXRJZCIsImxpbWl0IiwicmV2ZXJzZSIsImNyZWF0ZU1lc3NhZ2UiLCJzZW5kZXJJZCIsImNvbnRlbnQiLCJtZW50aW9ucyIsImlzQWlSZXNwb25zZSIsInBhcmVudE1lc3NhZ2VJZCIsIm1lc3NhZ2VUeXBlIiwiY3JlYXRlR3JvdXBDaGF0IiwiY3JlYXRvcklkIiwibWVtYmVySWRzIiwibWVtYmVySWQiLCJnZXRVc2VyR3JvdXBDaGF0cyIsImRlbGV0ZUdyb3VwQ2hhdCIsImdyb3VwSWQiLCJjaGF0IiwiY3JlYXRlRnJpZW5kc2hpcCIsInJlcXVlc3RlcklkIiwiYWRkcmVzc2VlSWQiLCJleGlzdGluZyIsImxlbmd0aCIsInN0YXR1cyIsInVwZGF0ZUZyaWVuZHNoaXBTdGF0dXMiLCJmcmllbmRzaGlwSWQiLCJnZXRGcmllbmRzaGlwcyIsImdldEFjY2VwdGVkRnJpZW5kcyIsImdldFVzZXJETXMiLCJjcmVhdGVOb3RpZmljYXRpb24iLCJ0aXRsZSIsInNlbmRlclVzZXJuYW1lIiwiZ2V0VW5yZWFkTm90aWZpY2F0aW9ucyIsIm1hcmtOb3RpZmljYXRpb25Bc1JlYWQiLCJub3RpZmljYXRpb25JZCIsImFkZE1lc3NhZ2VSZWFjdGlvbiIsIm1lc3NhZ2VJZCIsImVtb2ppIiwicmVtb3ZlTWVzc2FnZVJlYWN0aW9uIiwidXBkYXRlVXNlclNldHRpbmdzIiwidXBkYXRlcyIsImFsbG93ZWRGaWVsZHMiLCJ2YWxpZFVwZGF0ZXMiLCJrZXkiLCJ2YWx1ZSIsIk9iamVjdCIsImVudHJpZXMiLCJrZXlzIiwic2V0Q2xhdXNlIiwibWFwIiwiaW5kZXgiLCJxdWVyeVN0cmluZyIsInBhcmFtcyIsInVuc2FmZSIsInNldFVzZXJGcm96ZW4iLCJ0YXJnZXRVc2VySWQiLCJmcm96ZW5CeVVzZXJJZCIsImNsZWFyVXNlckZyb3plbiIsImdldFVzZXJGcmVlemVTdGF0dXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./lib/db.ts\n");

/***/ })

});