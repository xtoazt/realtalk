"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   encrypt: () => (/* binding */ encrypt),\n/* harmony export */   getCurrentUser: () => (/* binding */ getCurrentUser),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signUp: () => (/* binding */ signUp),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/.pnpm/jose@6.0.12/node_modules/jose/dist/webapi/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/.pnpm/jose@6.0.12/node_modules/jose/dist/webapi/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/.pnpm/next@15.2.4_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(middleware)/./lib/db.ts\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bcryptjs */ \"(middleware)/./node_modules/.pnpm/bcryptjs@3.0.2/node_modules/bcryptjs/index.js\");\n\n\n\n\nconst key = new TextEncoder().encode(process.env.JWT_SECRET || \"fallback-secret-key\");\nasync function encrypt(payload) {\n    return await new jose__WEBPACK_IMPORTED_MODULE_3__.SignJWT(payload).setProtectedHeader({\n        alg: \"HS256\"\n    }).setIssuedAt().setExpirationTime(\"24h\").sign(key);\n}\nasync function decrypt(input) {\n    const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_4__.jwtVerify)(input, key, {\n        algorithms: [\n            \"HS256\"\n        ]\n    });\n    return payload;\n}\nasync function verifyToken(token) {\n    try {\n        return await decrypt(token);\n    } catch  {\n        return null;\n    }\n}\nasync function getCurrentUser() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const token = cookieStore.get(\"auth-token\")?.value;\n    if (!token) return null;\n    try {\n        const payload = await decrypt(token);\n        const users = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.query)`SELECT * FROM users WHERE id = ${payload.userId}`;\n        return users[0] || null;\n    } catch  {\n        return null;\n    }\n}\nasync function hashPassword(password) {\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hash(password, 12);\n}\nasync function signUp(username, password, signupCode) {\n    const hashedPassword = await hashPassword(password);\n    // Set default values based on signup code\n    let nameColor = null;\n    let hasGoldAnimation = false;\n    if (signupCode === \"asdf\") {\n        nameColor = \"#6366f1\" // Default indigo color\n        ;\n    } else if (signupCode === \"qwea\") {\n        hasGoldAnimation = true;\n    }\n    const users = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.query)`\n    INSERT INTO users (username, password_hash, signup_code, name_color, has_gold_animation, theme, hue, notifications_enabled, last_active, ui_mode)\n    VALUES (${username}, ${hashedPassword}, ${signupCode || null}, ${nameColor}, ${hasGoldAnimation}, 'light', 'blue', false, NOW(), 'full')\n    RETURNING *\n  `;\n    const user = users[0];\n    const token = await encrypt({\n        userId: user.id\n    });\n    return {\n        user,\n        token\n    };\n}\nasync function signIn(username, password) {\n    const users = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.query)`SELECT * FROM users WHERE username = ${username}`;\n    const user = users[0];\n    if (!user) {\n        throw new Error(\"Invalid username or password\");\n    }\n    const isValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_2__[\"default\"].compare(password, user.password_hash);\n    if (!isValid) {\n        throw new Error(\"Invalid username or password\");\n    }\n    const token = await encrypt({\n        userId: user.id\n    });\n    return {\n        user,\n        token\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZW50IjpbImltcG9ydCB7IFNpZ25KV1QsIGp3dFZlcmlmeSB9IGZyb20gXCJqb3NlXCJcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tIFwibmV4dC9oZWFkZXJzXCJcbmltcG9ydCB7IHF1ZXJ5IH0gZnJvbSBcIkAvbGliL2RiXCJcbmltcG9ydCBiY3J5cHQgZnJvbSBcImJjcnlwdGpzXCJcblxuY29uc3Qga2V5ID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgXCJmYWxsYmFjay1zZWNyZXQta2V5XCIpXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmNyeXB0KHBheWxvYWQ6IGFueSkge1xuICByZXR1cm4gYXdhaXQgbmV3IFNpZ25KV1QocGF5bG9hZClcbiAgICAuc2V0UHJvdGVjdGVkSGVhZGVyKHsgYWxnOiBcIkhTMjU2XCIgfSlcbiAgICAuc2V0SXNzdWVkQXQoKVxuICAgIC5zZXRFeHBpcmF0aW9uVGltZShcIjI0aFwiKVxuICAgIC5zaWduKGtleSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlY3J5cHQoaW5wdXQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IHsgcGF5bG9hZCB9ID0gYXdhaXQgand0VmVyaWZ5KGlucHV0LCBrZXksIHtcbiAgICBhbGdvcml0aG1zOiBbXCJIUzI1NlwiXSxcbiAgfSlcbiAgcmV0dXJuIHBheWxvYWRcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVRva2VuKHRva2VuOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZGVjcnlwdCh0b2tlbilcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIoKSB7XG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpXG4gIGNvbnN0IHRva2VuID0gY29va2llU3RvcmUuZ2V0KFwiYXV0aC10b2tlblwiKT8udmFsdWVcblxuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbFxuXG4gIHRyeSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IGRlY3J5cHQodG9rZW4pXG4gICAgY29uc3QgdXNlcnMgPSBhd2FpdCBxdWVyeWBTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkID0gJHtwYXlsb2FkLnVzZXJJZH1gXG4gICAgcmV0dXJuIHVzZXJzWzBdIHx8IG51bGxcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMilcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNpZ25VcCh1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nLCBzaWdudXBDb2RlPzogc3RyaW5nKSB7XG4gIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKVxuXG4gIC8vIFNldCBkZWZhdWx0IHZhbHVlcyBiYXNlZCBvbiBzaWdudXAgY29kZVxuICBsZXQgbmFtZUNvbG9yID0gbnVsbFxuICBsZXQgaGFzR29sZEFuaW1hdGlvbiA9IGZhbHNlXG5cbiAgaWYgKHNpZ251cENvZGUgPT09IFwiYXNkZlwiKSB7XG4gICAgbmFtZUNvbG9yID0gXCIjNjM2NmYxXCIgLy8gRGVmYXVsdCBpbmRpZ28gY29sb3JcbiAgfSBlbHNlIGlmIChzaWdudXBDb2RlID09PSBcInF3ZWFcIikge1xuICAgIGhhc0dvbGRBbmltYXRpb24gPSB0cnVlXG4gIH1cblxuICBjb25zdCB1c2VycyA9IGF3YWl0IHF1ZXJ5YFxuICAgIElOU0VSVCBJTlRPIHVzZXJzICh1c2VybmFtZSwgcGFzc3dvcmRfaGFzaCwgc2lnbnVwX2NvZGUsIG5hbWVfY29sb3IsIGhhc19nb2xkX2FuaW1hdGlvbiwgdGhlbWUsIGh1ZSwgbm90aWZpY2F0aW9uc19lbmFibGVkLCBsYXN0X2FjdGl2ZSwgdWlfbW9kZSlcbiAgICBWQUxVRVMgKCR7dXNlcm5hbWV9LCAke2hhc2hlZFBhc3N3b3JkfSwgJHtzaWdudXBDb2RlIHx8IG51bGx9LCAke25hbWVDb2xvcn0sICR7aGFzR29sZEFuaW1hdGlvbn0sICdsaWdodCcsICdibHVlJywgZmFsc2UsIE5PVygpLCAnZnVsbCcpXG4gICAgUkVUVVJOSU5HICpcbiAgYFxuXG4gIGNvbnN0IHVzZXIgPSB1c2Vyc1swXVxuICBjb25zdCB0b2tlbiA9IGF3YWl0IGVuY3J5cHQoeyB1c2VySWQ6IHVzZXIuaWQgfSlcblxuICByZXR1cm4geyB1c2VyLCB0b2tlbiB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaWduSW4odXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZykge1xuICBjb25zdCB1c2VycyA9IGF3YWl0IHF1ZXJ5YFNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgdXNlcm5hbWUgPSAke3VzZXJuYW1lfWBcbiAgY29uc3QgdXNlciA9IHVzZXJzWzBdXG5cbiAgaWYgKCF1c2VyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB1c2VybmFtZSBvciBwYXNzd29yZFwiKVxuICB9XG5cbiAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkX2hhc2gpXG4gIGlmICghaXNWYWxpZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmRcIilcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gYXdhaXQgZW5jcnlwdCh7IHVzZXJJZDogdXNlci5pZCB9KVxuICByZXR1cm4geyB1c2VyLCB0b2tlbiB9XG59XG4iXSwibmFtZXMiOlsiU2lnbkpXVCIsImp3dFZlcmlmeSIsImNvb2tpZXMiLCJxdWVyeSIsImJjcnlwdCIsImtleSIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJlbmNyeXB0IiwicGF5bG9hZCIsInNldFByb3RlY3RlZEhlYWRlciIsImFsZyIsInNldElzc3VlZEF0Iiwic2V0RXhwaXJhdGlvblRpbWUiLCJzaWduIiwiZGVjcnlwdCIsImlucHV0IiwiYWxnb3JpdGhtcyIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJnZXRDdXJyZW50VXNlciIsImNvb2tpZVN0b3JlIiwiZ2V0IiwidmFsdWUiLCJ1c2VycyIsInVzZXJJZCIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwiaGFzaCIsInNpZ25VcCIsInVzZXJuYW1lIiwic2lnbnVwQ29kZSIsImhhc2hlZFBhc3N3b3JkIiwibmFtZUNvbG9yIiwiaGFzR29sZEFuaW1hdGlvbiIsInVzZXIiLCJpZCIsInNpZ25JbiIsIkVycm9yIiwiaXNWYWxpZCIsImNvbXBhcmUiLCJwYXNzd29yZF9oYXNoIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./lib/auth.ts\n");

/***/ })

});