"use strict";(()=>{var e={};e.id=6434,e.ids=[6434],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7298:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{patchFetch:()=>c,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>h});var o=n(36044),i=n(63409),a=n(9576),r=n(75263),l=e([r]);r=(l.then?(await l)():l)[0];let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/messages/route",pathname:"/api/messages",filename:"route",bundlePath:"app/api/messages/route"},resolvedPagePath:"/Users/rohan/code/realtalk/app/api/messages/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:u,workUnitAsyncStorage:h,serverHooks:g}=d;function c(){return(0,a.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:h})}s()}catch(e){s(e)}})},10762:e=>{e.exports=import("@neondatabase/serverless")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12714:(e,t,n)=>{var s,o,i,a,r,l,c,d,u,h,g,f;n.d(t,{pL:()=>ee}),function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"}(s||(s={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(o||(o={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(i||(i={}));let p=["user","model","function","system"];(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(a||(a={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(r||(r={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(l||(l={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(c||(c={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(d||(d={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(u||(u={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(h||(h={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(g||(g={}));class m extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class y extends m{constructor(e,t){super(e),this.response=t}}class E extends m{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class C extends m{}class I extends m{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(f||(f={}));class O{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",s=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function v(e){var t;let n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let s=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(e){throw new C(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${e.message}`)}for(let[e,t]of s.entries()){if("x-goog-api-key"===e)throw new C(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new C(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function w(e,t,n,s,o,i){let a=new O(e,t,n,s,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await v(a),body:o})}}async function _(e,t,n,s,o,i={},a=fetch){let{url:r,fetchOptions:l}=await w(e,t,n,s,o,i);return A(r,l,a)}async function A(e,t,n=fetch){let s;try{s=await n(e,t)}catch(t){(function(e,t){let n=e;throw"AbortError"===n.name?(n=new I(`Request aborted when fetching ${t.toString()}: ${e.message}`)).stack=e.stack:e instanceof E||e instanceof C||((n=new m(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),n})(t,e)}return s.ok||await T(s,e),s}async function T(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new E(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function R(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),b(e.candidates[0]))throw new y(`${x(e)}`,e);return function(e){var t,n,s,o;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(o=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===o?void 0:o.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new y(`Text not available. ${x(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),b(e.candidates[0]))throw new y(`${x(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),N(e)[0]}if(e.promptFeedback)throw new y(`Function call not available. ${x(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),b(e.candidates[0]))throw new y(`${x(e)}`,e);return N(e)}if(e.promptFeedback)throw new y(`Function call not available. ${x(e)}`,e)},e}function N(e){var t,n,s,o;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(o=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===o?void 0:o.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let S=[d.RECITATION,d.SAFETY,d.LANGUAGE];function b(e){return!!e.finishReason&&S.includes(e.finishReason)}function x(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(s=e.candidates)||void 0===s?void 0:s[0]){let t=e.candidates[0];b(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function M(e){return this instanceof M?(this.v=e,this):new M(e)}"function"==typeof SuppressedError&&SuppressedError;let P=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function K(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return R(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=s.citationMetadata,n.candidates[e].groundingMetadata=s.groundingMetadata,n.candidates[e].finishReason=s.finishReason,n.candidates[e].finishMessage=s.finishMessage,n.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[e].content||(n.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let o of s.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function H(e,t,n,s){return function(e){let[t,n]=(function(e){let t=e.getReader();return new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let i;if(o){if(n.trim()){e.error(new m("Failed to parse stream"));return}e.close();return}let a=(n+=t).match(P);for(;a;){try{i=JSON.parse(a[1])}catch(t){e.error(new m(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(i),a=(n=n.substring(a[0].length)).match(P)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new I("Request aborted when reading from the stream"):new m("Error reading from the stream")})}()}})})(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof M?Promise.resolve(n.value.v).then(l,c):d(i[0][2],n)}catch(e){d(i[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function d(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield M(t.read());if(n)break;yield yield M(R(e))}})}(t),response:K(n)}}(await _(t,f.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function L(e,t,n,s){let o=await _(t,f.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:R(await o.json())}}function G(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function k(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){let t={role:"user",parts:[]},n={role:"function",parts:[]},s=!1,o=!1;for(let i of e)"functionResponse"in i?(n.parts.push(i),o=!0):(t.parts.push(i),s=!0);if(s&&o)throw new m("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!o)throw new m("No content is provided for sending chat message.");return s?t:n}(t)}function U(e){let t;return t=e.contents?e:{contents:[k(e)]},e.systemInstruction&&(t.systemInstruction=G(e.systemInstruction)),t}let D=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],$={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function j(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let F="SILENT_ERROR";class Y{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new m(`First content should be with role 'user', got ${e}`);if(!p.includes(e))throw new m(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(p)}`);if(!Array.isArray(s))throw new m("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new m("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of D)t in e&&(o[t]+=1);let i=$[e];for(let t of D)if(!i.includes(t)&&o[t]>0)throw new m(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,i,a,r;let l;await this._sendPromise;let c=k(e),d={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>L(this._apiKey,this.model,d,u)).then(e=>{var t;if(j(e.response)){this._history.push(c);let n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{let t=x(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,s,o,i,a,r;await this._sendPromise;let l=k(e),c={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=H(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(F)}).then(e=>e.response).then(e=>{if(j(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=x(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==F&&console.error(e)}),u}}async function B(e,t,n,s){return(await _(t,f.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function q(e,t,n,s){return(await _(t,f.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function J(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await _(t,f.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class V{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=G(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=U(e),o=Object.assign(Object.assign({},this._requestOptions),t);return L(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=U(e),o=Object.assign(Object.assign({},this._requestOptions),t);return H(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},s),o)}startChat(e){var t;return new Y(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new C("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=k(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return B(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:k(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return q(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return J(this.apiKey,this.model,e,n)}}class W{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new m("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new V(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new C("Cached content must contain a `name` field.");if(!e.model)throw new C("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new C(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new V(this.apiKey,s,n)}}class X{constructor(){this.apiKeys=[],this.currentKeyIndex=0,this.exhaustedKeys=new Set,this.loading=!1,this.error=null;let e=process.env.GEMINI_API_KEY;e&&e.trim()&&(console.log("[GeminiKeyManager] Found API key in env"),this.apiKeys.push(e.trim())),this.loadAdditionalKeys()}getError(){return this.error}isLoading(){return this.loading}async loadAdditionalKeys(){this.loading=!0,this.error=null;try{let e=await fetch("/api/gemini/keys");if(e.ok){let t=await e.json();this.apiKeys.push(...t.filter(e=>!this.exhaustedKeys.has(e)))}else{let t=await e.json().catch(()=>({}));this.error=t.error||"Failed to load Gemini API keys."}}catch(e){this.error="Failed to load Gemini API keys."}finally{this.loading=!1}}getCurrentKey(){return 0===this.apiKeys.length?null:this.apiKeys[this.currentKeyIndex]}markKeyAsExhausted(e){this.exhaustedKeys.add(e),this.apiKeys=this.apiKeys.filter(t=>t!==e),this.currentKeyIndex>=this.apiKeys.length&&(this.currentKeyIndex=0),0===this.apiKeys.length&&this.triggerGoldMemberNotification()}async addNewKey(e,t){try{let n=new W(e).getGenerativeModel({model:"gemini-1.5-flash"});await n.generateContent("test");let s=await fetch("/api/gemini/keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,addedBy:t})});if(s.ok)return await this.loadAdditionalKeys(),{success:!0,message:"API key added successfully!"};{let e=await s.json().catch(()=>({}));return{success:!1,message:e.error||"Failed to add API key."}}}catch(e){return{success:!1,message:"Invalid API key or network error."}}}triggerGoldMemberNotification(){}getKeyStatus(){return{totalKeys:this.apiKeys.length,exhaustedKeys:this.exhaustedKeys.size,currentKeyIndex:this.currentKeyIndex,hasAvailableKeys:this.apiKeys.length>0,error:this.error,loading:this.loading}}}let z=new X,Q=()=>{let e=z.getCurrentKey();if(console.log("[getGeminiModel] Current key available:",!!e),!e)throw z.triggerGoldMemberNotification(),Error("No available Gemini API keys");return new W(e).getGenerativeModel({model:"gemini-1.5-flash"})},Z={assistant:{name:"real.AI",personality:'You are real.AI, a helpful and friendly AI assistant in the chat app "real.". Keep responses concise, friendly, and conversational.',capabilities:["conversation","help","entertainment"]},tutor:{name:"Study Buddy",personality:"You are Study Buddy, an educational AI tutor. Help users learn and explain complex topics in simple terms.",capabilities:["education","explanation","study tips"]},creative:{name:"Creative Muse",personality:"You are Creative Muse, an AI that inspires creativity. Help with writing, brainstorming, and creative projects.",capabilities:["writing","brainstorming","creativity"]}};async function ee(e,t,n="assistant"){console.log("[generateAIResponse] Starting AI response generation for:",e.substring(0,50));try{let s=Q(),o=Z[n],i=`
${o.personality}

Context: ${t.chatType} chat, user: ${t.username}
Recent messages: ${t.messageHistory?.slice(-3).map(e=>`${e.role}: ${e.content}`).join("\n")||"No recent messages"}

User message: ${e}

Respond as ${o.name} in a helpful, engaging way. Keep it under 150 words.
`;console.log("[generateAIResponse] Sending prompt to Gemini");let a=(await s.generateContent(i)).response.text();return console.log("[generateAIResponse] Got response:",a.substring(0,100)),{content:a,persona:o.name,confidence:.9}}catch(e){if(console.log("[generateAIResponse] Error:",e.message),e.message?.includes("quota")||e.message?.includes("exceeded")){let e=z.getCurrentKey();e&&z.markKeyAsExhausted(e)}throw e}}},13122:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.d(t,{HW:()=>h,Hh:()=>f,Jv:()=>p});var o=n(7994),i=n(75025),a=n(15886),r=n(19246),l=n(7673),c=e([r]);r=(c.then?(await c)():c)[0];let m=new TextEncoder().encode(process.env.JWT_SECRET||"fallback-secret-key");async function d(e){return await new o.P(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("24h").sign(m)}async function u(e){let{payload:t}=await (0,i.V)(e,m,{algorithms:["HS256"]});return t}async function h(){let e=await (0,a.UL)(),t=e.get("auth-token")?.value;if(console.log("[auth] getCurrentUser called, token exists:",!!t),!t)return console.log("[auth] No auth token found"),null;try{let e=await u(t);console.log("[auth] Token decrypted successfully, userId:",e.userId);let n=(await (0,r.P)`SELECT * FROM users WHERE id = ${e.userId}`)[0]||null;return console.log("[auth] User found:",!!n),n}catch(e){return console.error("[auth] Error getting current user:",e),null}}async function g(e){return await l.Ay.hash(e,12)}async function f(e,t,n){let s=await g(t),o=null,i=!1;"asdf"===n?o="#6366f1":"qwea"===n&&(i=!0);let a=(await (0,r.P)`
    INSERT INTO users (username, password_hash, signup_code, name_color, has_gold_animation, theme, hue, notifications_enabled, last_active, ui_mode)
    VALUES (${e}, ${s}, ${n||null}, ${o}, ${i}, 'light', 'blue', false, NOW(), 'full')
    RETURNING *
  `)[0],l=await d({userId:a.id});return{user:a,token:l}}async function p(e,t){let n=(await (0,r.P)`SELECT * FROM users WHERE username = ${e}`)[0];if(!n||!await l.Ay.compare(t,n.password_hash))throw Error("Invalid username or password");let s=await d({userId:n.id});return{user:n,token:s}}s()}catch(e){s(e)}})},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75263:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{GET:()=>d,POST:()=>u});var o=n(10949),i=n(13122),a=n(19246),r=n(12714),l=n(72903),c=e([i,a]);async function d(e){try{let t=await (0,i.HW)();if(!t)return console.warn("[api/messages/GET] Unauthorized: No current user."),o.NextResponse.json({error:"Unauthorized"},{status:401});console.log(`[api/messages/GET] Current user: ${t.username} (${t.id})`);let{searchParams:n}=new URL(e.url),s=n.get("chatType")||"global",r=n.get("chatId");console.log(`[api/messages/GET] Fetching messages for chatType: ${s}, chatId: ${r}`);let l=await (0,a.VL)(s,r||void 0,t.id);return console.log(`[api/messages/GET] Fetched ${l.length} messages.`),o.NextResponse.json({messages:l})}catch(e){return console.error("[api/messages/GET] Error:",e.message),o.NextResponse.json({error:"Database connection failed"},{status:500})}}async function u(e){try{let t=await (0,i.HW)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{content:n,chatType:s,chatId:c,parentMessageId:d,messageType:u="text"}=await e.json();if(!n||!s)return o.NextResponse.json({error:"Missing required fields"},{status:400});if("dm"===s&&c===l.x){console.log("[messages-api] AI chat detected, creating user message and AI response"),await (0,a.oH)(t.id,n,s,c,[],!1,d,u),t.username;try{let e=await (0,r.pL)(n,{chatType:s,username:t.username});return await (0,a.oH)(l.x,e.content,s,t.id,[],!0,void 0,"text"),o.NextResponse.json({success:!0})}catch(e){if(console.log("[messages-api] AI generation failed:",e.message),e.message?.includes("No available Gemini API keys"))return await (0,a.oH)(l.x,"\uD83D\uDC4B Hi there! I'm real.AI, your friendly assistant. Unfortunately, I need a valid Gemini API key to chat with you. Gold members can add API keys to enable AI features for everyone. Until then, feel free to chat with other users in the global chat!",s,t.id,[],!0,void 0,"text"),o.NextResponse.json({success:!0,trigger_popup:!0,message:"AI features need API keys"});return await (0,a.oH)(l.x,"I'm sorry, I'm having trouble connecting right now. Please try again later.",s,t.id,[],!0,void 0,"text"),o.NextResponse.json({success:!0})}}let h=n.match(/@(\w+)/g)?.map(e=>e.slice(1))||[],g=h.includes("ai")||h.includes("real.ai")||h.includes("realai"),f=await (0,a.oH)(t.id,n,s,c,h,!1,d,u);if("dm"===s&&c&&c!==t.id&&c!==l.x){let e=await (0,a.kl)(c);e&&e.notifications_enabled&&await (0,a.UI)(e.id,`New DM from @${t.username}`,"image"===u?"Sent an image":n,s,c,t.username)}if("dm"!==s&&h.length>0)for(let e of h){if("ai"===e||"real.ai"===e||"realai"===e)continue;let o=await (0,a.JE)(e);o&&o.id!==t.id&&o.notifications_enabled&&await (0,a.UI)(o.id,`You were mentioned by @${t.username}`,"image"===u?"Sent an image":n,s,c,t.username)}if(g&&("global"===s||"group"===s||"channel"===s)){console.log("[messages-api] AI mentioned in",s,"chat, generating response"),t.username;let e=await (0,r.pL)(n,{chatType:s,username:t.username});await (0,a.oH)(l.x,e.content,s,c,[],!0,void 0,"text")}return o.NextResponse.json({message:f})}catch(e){return console.error("POST messages API error:",e.message),o.NextResponse.json({error:"Database connection failed"},{status:500})}}[i,a]=c.then?(await c)():c,s()}catch(e){s(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[7095,2920,5886,1854,5950],()=>n(7298));module.exports=s})();