exports.id=733,exports.ids=[733],exports.modules={9883:(e,s,t)=>{"use strict";t.d(s,{l:()=>O});var a=t(89812),r=t(49837),i=t(43394),n=t(31457),l=t(65395),c=t(98004),d=t(92106),o=t(13107);function m({message:e,currentUserId:s,currentUserHasGold:t=!1,onAddReaction:m,onRemoveReaction:u,onReply:h,onDelete:x,onUserClick:g}){let[p,f]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),N=e.sender_id===s,v=e.is_ai_response,b=s=>{e.reactions?.find(e=>e.emoji===s&&e.reacted_by_me)?u?.(e.id,s):m?.(e.id,s),f(!1)};return(0,a.jsx)("div",{className:`flex ${N?"justify-end":"justify-start"} mb-4 group`,children:(0,a.jsxs)("div",{className:`max-w-[70%] ${N?"order-2":"order-1"}`,children:[(0,a.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${N?"justify-end":"justify-start"}`,children:[(0,a.jsx)("span",{className:`${v?"text-blue-500 font-medium":e.has_gold_animation?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":(e.name_color,"font-medium")} ${v||N?"":"cursor-pointer hover:underline"}`,style:e.name_color&&!e.has_gold_animation?{color:e.name_color}:{},onClick:()=>{!v&&g&&e.sender_id!==s&&g(e.sender_id)},children:v?"AI Assistant":e.username}),e.custom_title&&(0,a.jsx)("span",{className:"text-xs italic text-gray-500",children:e.custom_title}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.parent_message_id&&e.parent_message_content&&e.parent_message_username&&(0,a.jsxs)("div",{className:"mb-1 p-2 bg-gray-100 dark:bg-gray-800 border-l-4 border-blue-400 rounded-r-md text-xs text-gray-600 dark:text-gray-300 italic",children:["Replying to @",e.parent_message_username,': "',e.parent_message_content,'"']}),(0,a.jsx)("div",{className:`px-4 py-2 rounded-2xl ${N?"bg-black dark:bg-gray-700 text-white":v?"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700":"bg-gray-100 dark:bg-gray-800"}`,children:"image"===e.message_type?(0,a.jsx)("div",{className:"relative max-w-sm",children:j?(0,a.jsx)("div",{className:"w-64 h-48 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Failed to load image"})}):(0,a.jsx)(o.default,{src:e.content||"/placeholder.svg",alt:"Shared image",width:400,height:300,className:"rounded-lg object-cover max-h-80 w-auto",onError:()=>y(!0),priority:!1,quality:85})}):(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content})}),e.reactions&&e.reactions.length>0&&(0,a.jsx)("div",{className:"flex gap-1 mt-1",children:e.reactions.map(e=>(0,a.jsxs)(i.$,{variant:"outline",size:"sm",className:`h-6 px-2 rounded-full text-xs ${e.reacted_by_me?"bg-blue-100 dark:bg-blue-900/50 border-blue-400":"bg-gray-50 dark:bg-gray-800"}`,onClick:()=>b(e.emoji),children:[e.emoji," ",e.count]},e.emoji))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity relative",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>f(!p),children:(0,a.jsx)(n.A,{className:"h-3 w-3"})}),h&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>h(e),children:(0,a.jsx)(l.A,{className:"h-3 w-3"})}),(N||t)&&x&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-red-500 hover:bg-red-500/10",onClick:()=>{confirm("Are you sure you want to delete this message?")&&x?.(e.id)},children:(0,a.jsx)(c.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,a.jsx)(d.A,{className:"h-3 w-3"})}),p&&(0,a.jsx)("div",{className:"absolute bottom-full left-0 mb-2 flex gap-1 p-2 bg-white dark:bg-gray-800 border rounded-lg shadow-lg z-10",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"].map(e=>(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>b(e),children:e},e))})]})]})})}var u=t(53380),h=t(92376),x=t(50266),g=t(86703),p=t(92289),f=t(4408),j=t(16138),y=t(61181);function N({message:e,currentUserId:s,onUserClick:t,onReply:n,onReaction:l,showAI:c=!0}){let[o,m]=(0,r.useState)(null),[y,N]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),[w,A]=(0,r.useState)({}),_=e.sender_id===s,k=e.is_ai_response;return(0,a.jsxs)("div",{className:`group relative ${_?"ml-auto":"mr-auto"} max-w-[80%] mb-4`,children:[(0,a.jsx)(u.Zp,{className:`${_?"bg-primary text-primary-foreground":"bg-card"} ${k?"border-l-4 border-l-blue-500":""}`,children:(0,a.jsxs)(u.Wu,{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[k?(0,a.jsx)(h.A,{className:"h-4 w-4 text-blue-500"}):(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:`font-medium text-sm cursor-pointer hover:underline ${_?"text-primary-foreground":""}`,onClick:()=>t?.(e.sender_id),style:{color:e.name_color},children:e.username}),e.custom_title&&(0,a.jsxs)("span",{className:"text-xs opacity-70",children:["(",e.custom_title,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs opacity-70",children:[(0,a.jsx)(g.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:(e=>{let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/6e4);return t<1?"Just now":t<60?`${t}m ago`:t<1440?`${Math.floor(t/60)}h ago`:s.toLocaleDateString()})(e.created_at)})]}),c&&o&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("div",{className:`h-2 w-2 rounded-full ${o.isAppropriate?"bg-green-500":"bg-red-500"}`,title:o.isAppropriate?"Appropriate":"Flagged"})})]}),(0,a.jsxs)("div",{className:"mb-2",children:[e.parent_message_content&&(0,a.jsxs)("div",{className:"text-xs opacity-70 mb-1 p-2 bg-muted rounded",children:[(0,a.jsxs)("span",{className:"font-medium",children:["Replying to ",e.parent_message_username,":"]})," ",e.parent_message_content]}),(0,a.jsx)("div",{className:"text-sm",children:e.content}),"image"===e.message_type&&(0,a.jsx)("div",{className:"mt-2 text-xs opacity-70",children:"\uD83D\uDCF7 Image shared"})]}),c&&Object.keys(w).length>0&&v&&(0,a.jsxs)("div",{className:"mt-3 p-2 bg-muted/50 rounded text-xs space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"font-medium",children:"AI Insights:"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Tone:"}),(0,a.jsx)("span",{className:(e=>{switch(e){case"excited":return"text-yellow-500";case"curious":return"text-blue-500";case"sad":return"text-blue-400";case"angry":return"text-red-500";case"loving":return"text-pink-500";default:return"text-gray-500"}})(w.tone),children:w.tone})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Complexity:"}),(0,a.jsx)("span",{className:(e=>{switch(e){case"complex":return"text-purple-500";case"moderate":return"text-orange-500";case"simple":return"text-green-500";default:return"text-gray-500"}})(w.complexity),children:w.complexity})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Intent:"}),(0,a.jsx)("span",{className:"capitalize",children:w.intent})]}),w.keywords.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"opacity-70",children:"Keywords:"}),(0,a.jsx)("span",{className:"text-blue-500",children:w.keywords.join(", ")})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[e.reactions?.map((s,t)=>a.jsxs(i.$,{variant:"ghost",size:"sm",onClick:()=>l?.(e.id,s.emoji),className:`h-6 px-2 text-xs ${s.reacted_by_me?"bg-primary/20":""}`,children:[s.emoji," ",s.count]},t)),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>l?.(e.id,"\uD83D\uDC4D"),className:"h-6 w-6 p-0",children:"\uD83D\uDC4D"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>l?.(e.id,"❤️"),className:"h-6 w-6 p-0",children:"❤️"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>l?.(e.id,"\uD83D\uDE0A"),className:"h-6 w-6 p-0",children:"\uD83D\uDE0A"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>n?.(e.id),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(f.A,{className:"h-3 w-3"})}),c&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>b(!v),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",title:"AI Analysis",children:(0,a.jsx)(p.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(d.A,{className:"h-3 w-3"})})]})]}),y&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs opacity-70",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-primary"}),(0,a.jsx)("span",{children:"Analyzing message..."})]})]})}),c&&(o||Object.keys(w).length>0)&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 bg-primary text-primary-foreground rounded-full p-1",children:(0,a.jsx)(j.A,{className:"h-3 w-3"})})]})}var v=t(76576),b=t(82105),w=t(59213),A=t(58433),_=t(77219),k=t(67179);let S=["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0A","\uD83D\uDE0D","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDC94","\uD83D\uDD25","\uD83D\uDCAF","\uD83E\uDD14","\uD83E\uDD2F","\uD83D\uDE22","\uD83D\uDE21"];function C({onSendMessage:e,placeholder:s="Type a message...",disabled:t=!1,replyToMessage:n,onClearReply:l}){let[c,d]=(0,r.useState)(""),[o,m]=(0,r.useState)(!1),u=(0,r.useRef)(null),h=(0,r.useRef)(null),x=async s=>{let t=s.target.files?.[0];if(t){m(!0);try{let s=await fetch(`/api/upload-image?filename=${encodeURIComponent(t.name)}`,{method:"POST",body:t});if(s.ok){let t=await s.json();e(t.url,n?.id,"image"),l?.()}else{let e=await s.json();console.error("Image upload failed:",e.error||s.statusText),alert(`Failed to upload image: ${e.error||s.statusText}`)}}catch(e){console.error("Image upload error:",e),alert("An unexpected error occurred during image upload.")}finally{m(!1),u.current&&(u.current.value="")}}},g=e=>{d(s=>s+e),h.current?.focus()};return(0,a.jsxs)("form",{onSubmit:s=>{s.preventDefault(),c.trim()&&!t&&(e(c.trim(),n?.id,"text"),d(""),l?.())},className:"flex flex-col p-4 border-t bg-background",children:[n&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 mb-2 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-800",children:[(0,a.jsxs)("div",{className:"flex-1 truncate",children:["Replying to ",(0,a.jsxs)("span",{className:"font-semibold",children:["@",n.username]}),': "',n.content,'"']}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:l,className:"h-6 w-6 p-0 ml-2",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",ref:u,onChange:x,className:"hidden",disabled:t||o}),(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",className:"shrink-0",onClick:()=>u.current?.click(),disabled:t||o,children:o?(0,a.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):(0,a.jsx)(w.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(v.p,{ref:h,value:c,onChange:e=>d(e.target.value),placeholder:s,disabled:t||o,className:"pr-10 border-gray-200 focus:border-gray-400 transition-colors"}),(0,a.jsxs)(k.AM,{children:[(0,a.jsx)(k.Wv,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0",disabled:t||o,children:(0,a.jsx)(A.A,{className:"h-4 w-4"})})}),(0,a.jsx)(k.hl,{className:"w-64 p-2 grid grid-cols-6 gap-1",children:S.map(e=>(0,a.jsx)(i.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>g(e),children:e},e))})]})]}),(0,a.jsx)(i.$,{type:"submit",disabled:!c.trim()||t||o,size:"sm",className:"shrink-0 bg-black hover:bg-gray-800 text-white",children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})]})]})}var $=t(55844),I=t(58844),T=t(57354),K=t(26012),z=t(73438);function R({onSendMessage:e,onImageUpload:s,chatType:t,chatName:n,currentUser:l,messageHistory:c=[],userPreferences:d,disabled:o=!1}){let[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)([]),[g,f]=(0,r.useState)(null),[N,v]=(0,r.useState)(!1),[b,w]=(0,r.useState)(!1),[A,k]=(0,r.useState)("assistant"),S=(0,r.useRef)(null),C=(0,r.useRef)(null),R=()=>{m.trim()&&!o&&(e(m.trim()),u(""),x([]),f(null))},F=e=>{u(e),w(!1)};return(0,a.jsxs)("div",{className:"space-y-4",children:[N&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground animate-pulse",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Analyzing message..."})]}),g&&(0,a.jsx)("div",{className:"flex items-center gap-4 text-xs",children:(0,a.jsxs)("div",{className:`flex items-center gap-1 ${g.isAppropriate?"text-green-500":"text-red-500"}`,children:[(0,a.jsx)(I.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:g.isAppropriate?"Appropriate":"Flagged"})]})}),h.length>0&&b&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:h.map((e,s)=>(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>F(e),className:"text-xs hover:bg-accent",children:[(0,a.jsx)(T.A,{className:"h-3 w-3 mr-1"}),e]},s))}),(0,a.jsxs)("div",{className:"flex items-end gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)($.T,{ref:S,value:m,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Type your message... (Shift+Enter for new line)",className:"min-h-[60px] max-h-[120px] resize-none pr-20",disabled:o}),(0,a.jsx)("div",{className:"absolute right-2 bottom-2 flex items-center gap-1",children:h.length>0&&(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>w(!b),className:"h-6 w-6 p-0",title:"Smart suggestions",children:(0,a.jsx)(j.A,{className:"h-3 w-3"})})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("select",{value:A,onChange:e=>k(e.target.value),className:"text-xs bg-background border border-input rounded px-2 py-1",title:"AI Persona",children:Object.entries(y.rb).map(([e,s])=>(0,a.jsx)("option",{value:e,children:s.name},e))}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>C.current?.click(),disabled:o,className:"h-8 w-8 p-0",title:"Upload image",children:(0,a.jsx)(K.A,{className:"h-4 w-4"})}),(0,a.jsx)(i.$,{onClick:R,disabled:!m.trim()||o,className:"h-8 w-8 p-0 bg-primary hover:bg-primary/90",title:"Send message",children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("input",{ref:C,type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&s&&s(t)},className:"hidden"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(z.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Smart features enabled"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"AI-powered moderation"})]})]})]})}var F=t(25577),P=t(546),E=t(33967),D=t(78109),M=t(69052);function q({chatType:e,chatName:s,currentUser:t,messageHistory:n,userPreferences:l,onSendMessage:c}){let[d,o]=(0,r.useState)(!1),[m,x]=(0,r.useState)("assistant"),[N,v]=(0,r.useState)(""),[w,A]=(0,r.useState)(""),[_,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(""),[$,I]=(0,r.useState)({}),T=async()=>{if(n.length){k(!0),C("response");try{let s=n[n.length-1],a={chatType:e,username:t,messageHistory:n.slice(-5).map(e=>({role:e.isAI?"assistant":"user",content:e.content}))},r=await (0,y.pL)(s.content,a,m);v(r.content)}catch(e){console.error("Error generating AI response:",e),v("I'm having trouble thinking right now. Could you try rephrasing that?")}finally{k(!1)}}};return(0,a.jsxs)(u.Zp,{className:"glass animate-fadeIn",children:[(0,a.jsx)(u.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(u.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(p.A,{className:"h-5 w-5 text-primary"}),"Smart AI Assistant"]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>o(!d),className:"h-6 w-6 p-0",children:d?(0,a.jsx)(P.A,{className:"h-4 w-4"}):(0,a.jsx)(E.A,{className:"h-4 w-4"})})})]})}),(0,a.jsxs)(u.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI Persona:"}),(0,a.jsx)("select",{value:m,onChange:e=>x(e.target.value),className:"text-sm bg-background border border-input rounded px-2 py-1",children:Object.entries(y.rb).map(([e,s])=>(0,a.jsx)("option",{value:e,children:s.name},e))}),(e=>{switch(e){case"tutor":return(0,a.jsx)(F.A,{className:"h-4 w-4"});case"creative":return(0,a.jsx)(j.A,{className:"h-4 w-4"});default:return(0,a.jsx)(h.A,{className:"h-4 w-4"})}})(m)]}),Object.keys($).length>0&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[$.totalMessages," messages"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(D.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[$.activeParticipants?.length||0," participants"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(M.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{className:(e=>{switch(e){case"fast":return"text-green-500";case"moderate":return"text-yellow-500";case"slow":return"text-blue-500";default:return"text-gray-500"}})($.conversationPace),children:[$.conversationPace," pace"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(g.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:$.lastActivity})]})]}),w&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(F.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Conversation Summary"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:w})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:T,disabled:_||!n.length,className:"flex-1",children:[_&&"response"===S?(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Generate AI Response"]})}),N&&(0,a.jsxs)("div",{className:"p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-primary",children:[y.rb[m].name," Response:"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{N&&c&&(c(N),v(""))},className:"h-6 w-6 p-0",title:"Send this response",children:(0,a.jsx)(f.A,{className:"h-3 w-3"})}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>v(""),className:"h-6 w-6 p-0",title:"Clear response",children:(0,a.jsx)(b.A,{className:"h-3 w-3"})})]})]}),(0,a.jsx)("p",{className:"text-sm",children:N})]})]}),d&&(0,a.jsxs)("div",{className:"pt-2 border-t",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:"Smart Features:"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-1 text-xs",children:Object.entries(y.W0).map(([e,s])=>(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:`h-2 w-2 rounded-full ${s?"bg-green-500":"bg-gray-300"}`}),(0,a.jsx)("span",{className:"capitalize",children:e.replace(/([A-Z])/g," $1").toLowerCase()})]},e))})]})]})]})}var L=t(84962),G=t(81227);function O({chatType:e,chatId:s,chatName:t,currentUserId:n,onUserClick:l}){let[c,d]=(0,r.useState)([]),[o,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),[y,v]=(0,r.useState)(!1),[b,w]=(0,r.useState)(!1),[A,_]=(0,r.useState)(!0),[k,S]=(0,r.useState)(!1),$=(0,r.useRef)(null),I=(0,r.useRef)(null),T=(0,r.useRef)([]),{user:K}=(0,L.J)(),z=()=>{$.current?.scrollIntoView({behavior:"smooth"}),v(!1),w(!1)},F=(0,r.useCallback)(async()=>{try{let a=new URLSearchParams({chatType:e});s&&a.append("chatId",s);let r=await fetch(`/api/messages?${a}`);if(!r.ok){console.error("Failed to fetch messages:",r.status,await r.text());return}let i=await r.json();if(i.messages){let a=new Set(T.current.map(e=>e.id)),r=i.messages.filter(e=>!a.has(e.id));d(i.messages),r.length>0&&y&&w(!0),K&&K.notifications_enabled&&r.length>0&&r.forEach(a=>{a.sender_id!==n&&G.l.showMessageNotification({content:a.content,username:a.username,chatType:e,chatName:t,chatId:s,messageType:a.message_type,id:a.id},(e,s,t)=>{(e!=e||s&&s!=s)&&window.dispatchEvent(new CustomEvent("navigateToChat",{detail:{type:e,id:s,name:t}}))})})}}catch(e){console.error("Failed to fetch messages:",e)}finally{u(!1)}},[e,s,K,n,t,y]),P=async(t,a,r="text")=>{x(!0);try{let i=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t,chatType:e,chatId:s,parentMessageId:a,messageType:r})});if(i.ok){let e=await i.json(),s=!I.current||I.current.scrollHeight-I.current.scrollTop-I.current.clientHeight<100;await F(),s&&setTimeout(()=>{z()},100),e.trigger_popup&&(console.log("Triggering gold member popup for API keys"),window.dispatchEvent(new CustomEvent("geminiKeyExhausted")))}else{let e=await i.json().catch(()=>({error:"Unknown error"}));console.error("Failed to send message:",i.status,e),"GEMINI_KEY_EXHAUSTED"===e.error&&(console.log("Gemini API key exhausted, triggering popup"),window.dispatchEvent(new CustomEvent("geminiKeyExhausted")))}}catch(e){console.error("Failed to send message:",e)}finally{x(!1)}},D=async(e,s)=>{try{let t=await fetch(`/api/messages/${e}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?F():console.error("Failed to add reaction:",t.status,await t.text())}catch(e){console.error("Failed to add reaction:",e)}},M=async(e,s)=>{try{let t=await fetch(`/api/messages/${e}/reactions`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})});t.ok?F():console.error("Failed to remove reaction:",t.status,await t.text())}catch(e){console.error("Failed to remove reaction:",e)}},O=e=>{let s=c.find(s=>s.id===e);s&&f(s)},U=e=>{f(e)},Z=async e=>{try{let s=await fetch(`/api/messages/${e}/delete`,{method:"DELETE"});if(s.ok)F();else{let e=await s.json();console.error("Failed to delete message:",e.error),alert(`Failed to delete message: ${e.error}`)}}catch(e){console.error("Failed to delete message:",e),alert("An error occurred while deleting the message")}},W=async e=>{if(!h){x(!0);try{let s=new FormData;s.append("image",e);let t=await fetch("/api/upload-image",{method:"POST",body:s});if(t.ok){let e=await t.json();await P(`[Image: ${e.url}]`,void 0,"image")}else console.error("Failed to upload image:",t.status)}catch(e){console.error("Error uploading image:",e)}finally{x(!1)}}};return o?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading messages..."})}):(0,a.jsxs)("div",{className:"flex flex-col h-full card-modern overflow-hidden relative",children:[(0,a.jsx)("div",{className:"border-b border-border/50 p-4 bg-background/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[t,A&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"text-xs text-primary",children:"AI Enhanced"})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"global"===e?"Global chat • Everyone can see your messages":"group"===e?"Group chat":"channel"===e?"Channel":"Direct message"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>_(!A),className:"flex items-center gap-1",title:A?"Disable smart features":"Enable smart features",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"Smart"})]}),(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>S(!k),className:"flex items-center gap-1",title:"AI Assistant",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"AI"})]})]})]})}),(0,a.jsxs)("div",{ref:I,className:"flex-1 overflow-y-auto p-4 space-y-1 bg-background",onScroll:()=>{if(!I.current)return;let{scrollTop:e,scrollHeight:s,clientHeight:t}=I.current,a=s-e-t<100;v(!a),a&&w(!1)},children:[0===c.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)("p",{children:"No messages yet"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Start the conversation!"})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[k&&(0,a.jsx)(q,{chatType:e,chatName:t,currentUser:K?.username||"",messageHistory:c.map(e=>({content:e.content,username:e.username,timestamp:e.created_at,isAI:e.is_ai_response})),userPreferences:K,onSendMessage:P}),c.map(e=>A?(0,a.jsx)(N,{message:e,currentUserId:n,onUserClick:l,onReply:O,onReaction:D,showAI:A},e.id):(0,a.jsx)(m,{message:e,currentUserId:n,currentUserHasGold:K?.has_gold_animation||!1,onAddReaction:D,onRemoveReaction:M,onReply:U,onDelete:Z,onUserClick:l},e.id))]}),(0,a.jsx)("div",{ref:$})]}),y&&(0,a.jsx)("div",{className:"absolute bottom-20 right-4 z-10",children:(0,a.jsxs)(i.$,{onClick:z,className:`rounded-full w-12 h-12 shadow-lg transition-all duration-200 hover:scale-110 ${b?"bg-blue-500 hover:bg-blue-600 animate-pulse":"bg-gray-600 hover:bg-gray-700"}`,size:"sm",children:[(0,a.jsx)(E.A,{className:"h-5 w-5"}),b&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"})]})}),(0,a.jsxs)("div",{className:"bg-card border-t p-4",children:[g&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-muted rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"font-medium",children:["Replying to ",g.username,":"]}),(0,a.jsx)("span",{className:"text-muted-foreground ml-2",children:g.content.length>50?g.content.substring(0,50)+"...":g.content})]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{f(null)},children:"\xd7"})]})}),A?(0,a.jsx)(R,{onSendMessage:P,onImageUpload:W,chatType:e,chatName:t,currentUser:K?.username||"",messageHistory:c.slice(-5).map(e=>({role:e.is_ai_response?"assistant":"user",content:e.content})),userPreferences:K,disabled:h}):(0,a.jsx)(C,{onSendMessage:P,disabled:h,placeholder:"global"===e?"Message everyone...":"group"===e?"Message the group...":"channel"===e?"Message the channel...":"Send a message..."})]})]})}},11671:(e,s,t)=>{"use strict";function a(){return null}t.r(s),t.d(s,{default:()=>a})},19578:(e,s,t)=>{"use strict";t.d(s,{_:()=>l});var a=t(89812),r=t(49837),i=t(86703),n=t(28031);function l({large:e=!1}){let[s,t]=(0,r.useState)(new Date),l=s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),c=s.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"});return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 text-muted-foreground",children:[(0,a.jsxs)("div",{className:`flex items-center gap-2 ${e?"text-3xl":"text-lg"} font-medium`,children:[(0,a.jsx)(i.A,{className:e?"h-7 w-7":"h-5 w-5"}),(0,a.jsx)("span",{children:l})]}),(0,a.jsxs)("div",{className:`flex items-center gap-2 ${e?"text-base":"text-sm"}`,children:[(0,a.jsx)(n.A,{className:e?"h-5 w-5":"h-4 w-4"}),(0,a.jsx)("span",{children:c})]})]})}},29399:(e,s,t)=>{"use strict";t.d(s,{s:()=>o});var a=t(89812),r=t(49837),i=t(53380),n=t(43394),l=t(8329),c=t(65395),d=t(4408);function o({currentUserId:e,onSelectDM:s}){let[t,o]=(0,r.useState)([]),[m,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(Date.now());(0,r.useCallback)(async()=>{try{let e=await fetch("/api/dms");if(e.ok){let s=await e.json();o(s.dms),x(Date.now())}}catch(e){console.error("Failed to fetch DMs:",e)}finally{u(!1)}},[]);let g=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",p=e=>e?{color:e}:{},f=e=>{let s=new Date(e),t=(new Date().getTime()-s.getTime())/36e5;return t<1?"Just now":t<24?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()};return m?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"text-muted-foreground animate-pulse",children:"Loading DMs..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Direct Messages"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(l.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(h).toLocaleTimeString()]})]})]}),(0,a.jsxs)(i.Zp,{className:"animate-fadeIn",children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"}),"Direct Messages"]})}),(0,a.jsx)(i.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(c.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 animate-pulse"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No direct messages yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Start a conversation with a friend!"})]}):(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{className:"group flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200 hover:scale-102 animate-slideIn",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>s(e.friend_id,e.friend_username),children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary",children:e.friend_username.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:e.friend_has_gold?g(void 0,!0):"",style:e.friend_has_gold?{}:p(e.friend_name_color),children:["@",e.friend_username]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Last message: ",f(e.last_message_at)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.$,{size:"icon",variant:"ghost",onClick:()=>s(e.friend_id,e.friend_username),title:"Message",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})]},e.friend_id))})})]})]})}},30496:()=>{},40318:(e,s,t)=>{"use strict";t.d(s,{o:()=>o});var a=t(89812),r=t(49837),i=t(43394),n=t(76576),l=t(53380),c=t(44897),d=t(82105);function o({onClose:e,onCreate:s}){let[t,o]=(0,r.useState)(""),[m,u]=(0,r.useState)([]),[h,x]=(0,r.useState)([]),[g,p]=(0,r.useState)(!0),f=e=>{x(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},j=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",y=e=>e?{color:e}:{};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(l.Zp,{className:"w-full max-w-md mx-4",children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(l.ZB,{children:"Create Group Chat"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:e,children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(n.p,{value:t,onChange:e=>o(e.target.value),placeholder:"Group chat name"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Add Friends"}),g?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"Loading friends..."}):0===m.length?(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No friends to add"}):(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.S,{id:e.friend_id,checked:h.includes(e.friend_id),onCheckedChange:()=>f(e.friend_id)}),(0,a.jsx)("label",{htmlFor:e.friend_id,className:"text-sm cursor-pointer",style:e.friend_has_gold?{}:y(e.friend_name_color),children:(0,a.jsxs)("span",{className:j(e.friend_name_color,e.friend_has_gold),children:["@",e.friend_username]})})]},e.friend_id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{onClick:()=>{t.trim()&&s(t.trim(),h)},disabled:!t.trim(),className:"flex-1",children:"Create Group"}),(0,a.jsx)(i.$,{variant:"outline",onClick:e,children:"Cancel"})]})]})]})})}},43648:()=>{},44897:(e,s,t)=>{"use strict";t.d(s,{S:()=>c});var a=t(89812),r=t(49837),i=t(21046),n=t(43509),l=t(87677);let c=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(i.bL,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:(0,a.jsx)(i.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})}));c.displayName=i.bL.displayName},54002:(e,s,t)=>{"use strict";t.d(s,{r:()=>x});var a=t(89812),r=t(49837),i=t(43394),n=t(76576),l=t(53380),c=t(8329),d=t(8757),o=t(71187),m=t(43509),u=t(82105),h=t(65395);function x({currentUserId:e,onStartDM:s,onShowProfile:t}){let[x,g]=(0,r.useState)(""),[p,f]=(0,r.useState)([]),[j,y]=(0,r.useState)([]),[N,v]=(0,r.useState)(!1),[b,w]=(0,r.useState)(!1),[A,_]=(0,r.useState)(null),[k,S]=(0,r.useState)(Date.now()),[C,$]=(0,r.useState)(null),I=(0,r.useCallback)(async()=>{if(!e){console.log("[friends-page] No currentUserId, skipping fetch");return}try{v(!0),$(null),console.log("[friends-page] Fetching friendships for user:",e);let s=await fetch("/api/friends",{credentials:"include",headers:{"Cache-Control":"no-cache"}});if(s.ok){let e=await s.json();y(e.friendships),S(Date.now()),console.log("[friends-page] Successfully fetched friendships:",e.friendships?.length||0)}else if(401===s.status){let e=await s.text();console.error("Authentication error fetching friendships:",s.status,e),$("Authentication failed. Please log in again.")}else{let e=await s.text();console.error("Failed to fetch friendships:",s.status,e),$("Failed to load friendships. Please try again.")}}catch(e){console.error("Failed to fetch friendships:",e),$("Network error. Please check your connection.")}finally{v(!1)}},[e]),T=async e=>{_(null);try{console.log("[friends-page] Sending friend request to:",e);let s=await fetch("/api/friends",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresseeId:e})});if(s.ok)console.log("[friends-page] Friend request sent successfully"),I();else{let e=await s.json();console.error("Failed to send friend request:",e.error),_(e.error||"Failed to send friend request.")}}catch(e){console.error("Failed to send friend request:",e),_(e.message||"Something went wrong.")}},K=async(e,s)=>{try{let t=await fetch(`/api/friends/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(t.ok)I();else{let e=await t.json();console.error("Failed to respond to friend request:",e.error||t.statusText),alert(`Failed to respond: ${e.error||t.statusText}`)}}catch(e){console.error("Failed to respond to friend request:",e),alert("An unexpected error occurred while responding to request.")}},z=(e,s)=>s?"bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 bg-clip-text text-transparent animate-pulse font-medium":"",R=e=>e?{color:e}:{},F=e=>{let s=D.some(s=>s.requester_id===e.id||s.addressee_id===e.id),t=P.some(s=>s.requester_id===e.id),a=E.some(s=>s.addressee_id===e.id);return s?{text:"Friends",disabled:!0,variant:"secondary"}:t?{text:"Accept?",disabled:!1,variant:"default"}:a?{text:"Pending",disabled:!0,variant:"outline"}:{text:"Add Friend",disabled:!1,variant:"default"}},P=j.filter(s=>"pending"===s.status&&s.addressee_id===e),E=j.filter(s=>"pending"===s.status&&s.requester_id===e),D=j.filter(e=>"accepted"===e.status);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Friends"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["Last updated: ",new Date(k).toLocaleTimeString()]})]})]}),C&&(0,a.jsx)(l.Zp,{className:"border-destructive/20 bg-destructive/5",children:(0,a.jsx)(l.Wu,{className:"pt-6",children:(0,a.jsx)("div",{className:"text-sm text-destructive text-center p-2 bg-destructive/10 rounded-md",children:C})})}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"h-5 w-5"}),"Find Friends"]})}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.p,{value:x,onChange:e=>g(e.target.value),placeholder:"Search by username...",className:"transition-all duration-200 focus:scale-102"}),b&&(0,a.jsx)("div",{className:"flex items-center px-3",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),A&&(0,a.jsx)("div",{className:"text-sm text-destructive text-center p-2 bg-destructive/10 rounded-md animate-fadeIn",children:A}),p.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Found ",p.length," user(s)"]}),p.map(e=>{let s=F(e);return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-all duration-200",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>t?.(e.id),className:e.has_gold_animation?z(void 0,!0):"",style:e.has_gold_animation?{}:R(e.name_color),children:["@",e.username]}),(0,a.jsxs)(i.$,{size:"sm",variant:s.variant,onClick:()=>T(e.id),className:"transition-all duration-200 hover:scale-105",disabled:s.disabled,children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}),s.text]})]},e.id)})]}),x.trim()&&0===p.length&&!b&&!A&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500",children:['No users found for "',x,'"']})]})]}),P.length>0&&(0,a.jsxs)(l.Zp,{className:"border-primary/20",children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)(l.ZB,{className:"text-primary",children:["Friend Requests (",P.length,")"]})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:P.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-primary/5",children:[(0,a.jsxs)("span",{className:e.requester_has_gold?z(void 0,!0):"",style:e.requester_has_gold?{}:R(e.requester_name_color),children:["@",e.requester_username]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{size:"sm",onClick:()=>K(e.id,"accepted"),className:"bg-green-600 hover:bg-green-700 transition-all duration-200 hover:scale-105",children:(0,a.jsx)(m.A,{className:"h-4 w-4"})}),(0,a.jsx)(i.$,{size:"sm",variant:"destructive",onClick:()=>K(e.id,"blocked"),className:"transition-all duration-200 hover:scale-105",children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]})]},e.id))})})]}),E.length>0&&(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)(l.ZB,{children:["Sent Requests (",E.length,")"]})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("span",{className:e.addressee_has_gold?z(void 0,!0):"",style:e.addressee_has_gold?{}:R(e.addressee_name_color),children:["@",e.addressee_username]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground animate-pulse",children:"Pending"})]},e.id))})})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)(l.ZB,{children:["Friends (",D.length,")"]})}),(0,a.jsx)(l.Wu,{children:N?(0,a.jsx)("div",{className:"text-center text-muted-foreground py-4 animate-pulse",children:"Loading friends..."}):0===D.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No friends yet. Start by searching for users above!"}):(0,a.jsx)("div",{className:"space-y-2",children:D.map(t=>{let r=t.requester_id===e?{id:t.addressee_id,username:t.addressee_username,name_color:t.addressee_name_color,has_gold:t.addressee_has_gold}:{id:t.requester_id,username:t.requester_username,name_color:t.requester_name_color,has_gold:t.requester_has_gold};return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors duration-200",children:[(0,a.jsxs)("span",{className:r.has_gold?z(void 0,!0):"",style:r.has_gold?{}:R(r.name_color),children:["@",r.username]}),(0,a.jsxs)(i.$,{size:"sm",onClick:()=>s(r.id,r.username),className:"transition-all duration-200 hover:scale-105",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-1"}),"Message"]})]},t.id)})})})]})]})}},55844:(e,s,t)=>{"use strict";t.d(s,{T:()=>n});var a=t(89812),r=t(49837),i=t(87677);let n=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...s}));n.displayName="Textarea"},61181:(e,s,t)=>{"use strict";t.d(s,{BW:()=>x,S8:()=>m,W0:()=>c,b1:()=>o,eE:()=>h,pL:()=>d,pf:()=>u,rb:()=>l});var a=t(14927);class r{constructor(){this.apiKeys=[],this.currentKeyIndex=0,this.exhaustedKeys=new Set,this.loading=!1,this.error=null;let e=process.env.GEMINI_API_KEY;e&&e.trim()&&(console.log("[GeminiKeyManager] Found API key in env"),this.apiKeys.push(e.trim())),this.loadAdditionalKeys()}getError(){return this.error}isLoading(){return this.loading}async loadAdditionalKeys(){this.loading=!0,this.error=null;try{let e=await fetch("/api/gemini/keys");if(e.ok){let s=await e.json();this.apiKeys.push(...s.filter(e=>!this.exhaustedKeys.has(e)))}else{let s=await e.json().catch(()=>({}));this.error=s.error||"Failed to load Gemini API keys."}}catch(e){this.error="Failed to load Gemini API keys."}finally{this.loading=!1}}getCurrentKey(){return 0===this.apiKeys.length?null:this.apiKeys[this.currentKeyIndex]}markKeyAsExhausted(e){this.exhaustedKeys.add(e),this.apiKeys=this.apiKeys.filter(s=>s!==e),this.currentKeyIndex>=this.apiKeys.length&&(this.currentKeyIndex=0),0===this.apiKeys.length&&this.triggerGoldMemberNotification()}async addNewKey(e,s){try{let t=new a.ij(e).getGenerativeModel({model:"gemini-1.5-flash"});await t.generateContent("test");let r=await fetch("/api/gemini/keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,addedBy:s})});if(r.ok)return await this.loadAdditionalKeys(),{success:!0,message:"API key added successfully!"};{let e=await r.json().catch(()=>({}));return{success:!1,message:e.error||"Failed to add API key."}}}catch(e){return{success:!1,message:"Invalid API key or network error."}}}triggerGoldMemberNotification(){}getKeyStatus(){return{totalKeys:this.apiKeys.length,exhaustedKeys:this.exhaustedKeys.size,currentKeyIndex:this.currentKeyIndex,hasAvailableKeys:this.apiKeys.length>0,error:this.error,loading:this.loading}}}let i=new r,n=()=>{let e=i.getCurrentKey();if(console.log("[getGeminiModel] Current key available:",!!e),!e)throw i.triggerGoldMemberNotification(),Error("No available Gemini API keys");return new a.ij(e).getGenerativeModel({model:"gemini-1.5-flash"})},l={assistant:{name:"real.AI",personality:'You are real.AI, a helpful and friendly AI assistant in the chat app "real.". Keep responses concise, friendly, and conversational.',capabilities:["conversation","help","entertainment"]},tutor:{name:"Study Buddy",personality:"You are Study Buddy, an educational AI tutor. Help users learn and explain complex topics in simple terms.",capabilities:["education","explanation","study tips"]},creative:{name:"Creative Muse",personality:"You are Creative Muse, an AI that inspires creativity. Help with writing, brainstorming, and creative projects.",capabilities:["writing","brainstorming","creativity"]}},c={smartSuggestions:!0,contentModeration:!0,aiResponses:!0,conversationSummary:!0};async function d(e,s,t="assistant"){console.log("[generateAIResponse] Starting AI response generation for:",e.substring(0,50));try{let a=n(),r=l[t],i=`
${r.personality}

Context: ${s.chatType} chat, user: ${s.username}
Recent messages: ${s.messageHistory?.slice(-3).map(e=>`${e.role}: ${e.content}`).join("\n")||"No recent messages"}

User message: ${e}

Respond as ${r.name} in a helpful, engaging way. Keep it under 150 words.
`;console.log("[generateAIResponse] Sending prompt to Gemini");let c=(await a.generateContent(i)).response.text();return console.log("[generateAIResponse] Got response:",c.substring(0,100)),{content:c,persona:r.name,confidence:.9}}catch(e){if(console.log("[generateAIResponse] Error:",e.message),e.message?.includes("quota")||e.message?.includes("exceeded")){let e=i.getCurrentKey();e&&i.markKeyAsExhausted(e)}throw e}}async function o(e){try{let s=n(),t=`
Analyze this message for inappropriate content (hate speech, harassment, explicit content, spam, personal information).

Message: "${e}"

Respond with only: APPROPRIATE or INAPPROPRIATE
`;return{isAppropriate:(await s.generateContent(t)).response.text().trim().toLowerCase().includes("appropriate"),confidence:.9}}catch(e){if(e.message?.includes("quota")||e.message?.includes("exceeded")){let e=i.getCurrentKey();e&&i.markKeyAsExhausted(e)}return{isAppropriate:!0,confidence:.5}}}async function m(e,s){try{let s=n(),t=`
Based on this message, suggest 3 quick reply options (under 30 characters each):

Message: "${e}"

Provide only the suggestions, one per line:
1. [suggestion 1]
2. [suggestion 2]
3. [suggestion 3]
`;return(await s.generateContent(t)).response.text().split("\n").filter(e=>e.match(/^\d+\./)).map(e=>e.replace(/^\d+\.\s*/,"")).slice(0,3)}catch(e){if(e.message?.includes("quota")||e.message?.includes("exceeded")){let e=i.getCurrentKey();e&&i.markKeyAsExhausted(e)}return[]}}async function u(e){try{let s=n(),t=e.map(e=>`${e.username}: ${e.content}`).join("\n"),a=`
Summarize this conversation in 1-2 sentences:

${t}

Provide a concise summary.
`;return(await s.generateContent(a)).response.text()}catch(e){if(e.message?.includes("quota")||e.message?.includes("exceeded")){let e=i.getCurrentKey();e&&i.markKeyAsExhausted(e)}return"Unable to generate summary"}}async function h(e,s){return await i.addNewKey(e,s)}function x(){return i.getKeyStatus()}},66170:(e,s,t)=>{"use strict";t.d(s,{m:()=>i});var a=t(89812),r=t(49837);function i(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)(null);return null===e?null:(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Battery: ",e,"% ",t?"⚡":""]})}},67179:(e,s,t)=>{"use strict";t.d(s,{AM:()=>l,Wv:()=>c,hl:()=>d});var a=t(89812),r=t(49837),i=t(82341),n=t(87677);let l=i.bL,c=i.l9,d=r.forwardRef(({className:e,align:s="center",sideOffset:t=4,...r},l)=>(0,a.jsx)(i.ZL,{children:(0,a.jsx)(i.UC,{ref:l,align:s,sideOffset:t,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));d.displayName=i.UC.displayName},76576:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(89812),r=t(49837),i=t(87677);let n=r.forwardRef(({className:e,type:s,...t},r)=>(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 focus-visible:shadow-md",e),ref:r,...t}));n.displayName="Input"},81227:(e,s,t)=>{"use strict";t.d(s,{l:()=>r});class a{constructor(){this.isSupported=!1,this.permission="default",this.isTabActive=!0}static getInstance(){return a.instance||(a.instance=new a),a.instance}setupVisibilityListener(){}async requestPermission(){return!1}async showNotification(e){return!1}async showMessageNotification(e,s){let t="dm"===e.chatType?`New DM from ${e.username}`:"group"===e.chatType||"channel"===e.chatType?`New message in ${e.chatName}`:`New global message from ${e.username}`,a="image"===e.messageType?"\uD83D\uDCF7 Sent an image":e.content.length>100?e.content.substring(0,100)+"...":e.content;return this.showNotification({title:t,body:a,tag:`message-${e.id}`,data:{chatType:e.chatType,chatId:e.chatId,chatName:e.chatName,messageId:e.id},onClick:()=>{s&&s(e.chatType,e.chatName,e.chatId)}})}getIsTabActive(){return this.isTabActive}getPermission(){return this.permission}getIsSupported(){return this.isSupported}updatePermission(){}}let r=a.getInstance()}};